!function(t,e){"use strict";function i(t,e){function i(){}i.prototype=t;var s=new i;for(var n in e)s[n]=e[n];return e.toString!==Object.prototype.toString&&(s.toString=e.toString),s}function s(t){return t instanceof Array?function(){return d.iter(t)}:"function"==typeof t.iterator?n(t,t.iterator):t.iterator}function n(t,e){if(null==e)return null;null==e.__id__&&(e.__id__=Hr++);var i;return null==t.hx__closures__?t.hx__closures__={}:i=t.hx__closures__[e.__id__],null==i&&(i=function(){return i.method.apply(i.scope,arguments)},i.scope=t,i.method=e,t.hx__closures__[e.__id__]=i),i}var r={},o=function(){return Ee.__string_rec(this,"")},l=function(t,e){null==e&&(e=""),null==t&&(t=""),this.name="",this.name=t,this.id=""==e?m.utils.uniqueid():e};r["luxe.ID"]=l,l.__name__=["luxe","ID"],l.prototype={__class__:l};var a=function(t){var e="";null!=t&&null!=t.name&&(e=t.name),l.call(this,""==e?m.utils.uniqueid():e)};r["luxe.Component"]=a,a.__name__=["luxe","Component"],a.__super__=l,a.prototype=i(l.prototype,{init:function(){},update:function(){},onadded:function(){},onremoved:function(){},onfixedupdate:function(){},onreset:function(){},ondestroy:function(){},onkeyup:function(){},onkeydown:function(){},ontextinput:function(){},oninputdown:function(){},oninputup:function(){},onmousedown:function(){},onmouseup:function(){},onmousemove:function(){},onmousewheel:function(){},ontouchdown:function(){},ontouchup:function(){},ontouchmove:function(){},ongamepadup:function(){},ongamepaddown:function(){},ongamepadaxis:function(){},ongamepaddevice:function(){},onwindowmoved:function(){},onwindowresized:function(){},onwindowsized:function(){},onwindowminimized:function(){},onwindowrestored:function(){},add:function(t){return this.get_entity().add(t)},remove:function(t){return this.get_entity().remove(t)},get:function(t,e){return null==e&&(e=!1),this.get_entity().get(t,e)},get_any:function(t,e,i){return null==i&&(i=!0),null==e&&(e=!1),this.get_entity().get_any(t,e,i)},has:function(t){return this.get_entity().has(t)},_detach_entity:function(){null!=this.get_entity()},_attach_entity:function(){null!=this.get_entity()},set_entity:function(t){return this._detach_entity(),this.entity=t,this._attach_entity(),this.get_entity()},get_entity:function(){return this.entity},set_pos:function(t){return this.get_entity().get_transform().set_pos(t)},get_pos:function(){return this.get_entity().get_transform().get_pos()},set_rotation:function(t){return this.get_entity().get_transform().set_rotation(t)},get_rotation:function(){return this.get_entity().get_transform().get_rotation()},set_scale:function(t){return this.get_entity().get_transform().set_scale(t)},get_scale:function(){return this.get_entity().get_transform().get_scale()},set_origin:function(t){return this.get_entity().get_transform().set_origin(t)},get_origin:function(){return this.get_entity().get_transform().get_origin()},set_transform:function(t){return this.get_entity().set_transform(t)},get_transform:function(){return this.get_entity().get_transform()},entity_pos_change:function(){},entity_scale_change:function(){},entity_rotation_change:function(){},entity_origin_change:function(){},entity_parent_change:function(){},__class__:a,__properties__:{set_origin:"set_origin",get_origin:"get_origin",set_scale:"set_scale",get_scale:"get_scale",set_rotation:"set_rotation",get_rotation:"get_rotation",set_pos:"set_pos",get_pos:"get_pos",set_entity:"set_entity",get_entity:"get_entity"}});var h=function(t){if(this.mousedown=!1,this.unlock_time=0,this.delay=.3,this.held_down=!1,null==t)throw new Ie(ei.null_assertion("_options was null ( Button requires options )"));a.call(this,{name:"button"}),this.options=t};r.Button=h,h.__name__=["Button"],h.__super__=a,h.prototype=i(a.prototype,{onadded:function(){if(this.sprite=this.get_entity(),null==this.sprite)throw new Ie(ei.null_assertion("sprite was null ( Button must be attached to a Sprite only. )"));if(null==this.sprite.texture)throw new Ie(ei.null_assertion("sprite.texture was null ( Button must be attached to a Sprite with a texture. )"));var t=this.options.texid;if(-1==t.indexOf("_up"))throw new Ie(ei.assertion("up_id.indexOf('_up') != -1 ( Button requires a texid with _up in the id. )"));var e=B.replace(t,"_up","_down");if(this.up=t,this.down=e,this.sprite.set_uv(k.btns.frame(this.up).uv),1024==this.sprite.size.x&&this.sprite.set_size(k.btns.frame(this.up).size),null==this.down)throw new Ie(ei.null_assertion("down was null ( Button cant find texture, is it loaded? )"));null!=this.options.text&&(this.text=new mi({no_scene:!0,name:this.sprite.get_name()+".txt",text:this.options.text,point_size:64,sdf:!0,letter_spacing:3,font:k.font_letters,color:(new F).rgb(16711679),bounds:new on(this.sprite.get_pos().x-this.sprite.size.x/2,this.sprite.get_pos().y-this.sprite.size.y/2+5,this.sprite.size.x,this.sprite.size.y),align:2,align_vertical:2,depth:this.sprite.depth+.01,batcher:this.options.batcher}))},onmousedown:function(t){this.sprite.visible&&this.is_inside(t.pos)&&(this.mousedown=!0,this.hover())},hover:function(){if(this.held_down=!0,this.sprite.set_uv(k.btns.frame(this.down).uv),null!=this.text){var t=this.text.get_pos();t.set_y(t.y+16),this.text.geometry.set_dirty(!0)}},unhover:function(){if(this.held_down=!1,null!=this.text){var t=this.text.get_pos();t.set_y(t.y-16),this.text.geometry.set_dirty(!0)}this.sprite.set_uv(k.btns.frame(this.up).uv)},onmousemove:function(t){if(this.sprite.visible&&this.mousedown){var e=this.is_inside(t.pos);!this.held_down&&e?this.hover():this.held_down&&!e&&this.unhover()}},onmouseup:function(t){this.sprite.visible&&(this.held_down&&this.unhover(),this.mousedown&&this.is_inside(t.pos)&&Nn.core.timestamp()>this.unlock_time&&null!=this.options.onclick&&(this.options.onclick(),this.unlock_time=Nn.core.timestamp()+this.delay),this.mousedown=!1)},is_inside:function(t){var e;e=null==this.options.batcher?m.camera.view:this.options.batcher.view;var i=e.screen_point_to_world(t);return this.sprite.point_inside(i)},init:function(){a.prototype.init.call(this),this.get_entity()._listen(17,n(this,this.onmousedown)),this.get_entity()._listen(19,n(this,this.onmousemove)),this.get_entity()._listen(18,n(this,this.onmouseup))},ondestroy:function(){a.prototype.ondestroy.call(this),this.get_entity()._unlisten(17,n(this,this.onmousedown)),this.get_entity()._unlisten(19,n(this,this.onmousemove)),this.get_entity()._unlisten(18,n(this,this.onmouseup))},onremoved:function(){a.prototype.onremoved.call(this),this.get_entity()._unlisten(17,n(this,this.onmousedown)),this.get_entity()._unlisten(19,n(this,this.onmousemove)),this.get_entity()._unlisten(18,n(this,this.onmouseup))},__class__:h});var _=function(t,e){e=e.split("u").join(""),this.r=new RegExp(t,e)};r.EReg=_,_.__name__=["EReg"],_.prototype={match:function(t){return this.r.global&&(this.r.lastIndex=0),this.r.m=this.r.exec(t),this.r.s=t,null!=this.r.m},matched:function(t){if(null!=this.r.m&&t>=0&&t<this.r.m.length)return this.r.m[t];throw new Ie("EReg::matched")},matchedRight:function(){if(null==this.r.m)throw new Ie("No string matched");var t=this.r.m.index+this.r.m[0].length;return d.substr(this.r.s,t,this.r.s.length-t)},replace:function(t,e){return t.replace(this.r,e)},__class__:_};var u=function(t){this.inited=!1,this.enabled=!1,this.active=!1,l.call(this,t.name)};r["luxe.State"]=u,u.__name__=["luxe","State"],u.__super__=l,u.prototype=i(l.prototype,{enable:function(t){this.machine.enable(this.name,t)},disable:function(t){this.machine.disable(this.name,t)},destroy:function(){this.machine.kill(this.name)},init:function(){},update:function(){},onfixedupdate:function(){},onleave:function(){},onenter:function(){},onenabled:function(){},ondisabled:function(){},onadded:function(){},onremoved:function(){},onrender:function(){},onprerender:function(){},onpostrender:function(){},onreset:function(){},ondestroy:function(){},onkeyup:function(){},onkeydown:function(){},ontextinput:function(){},oninputdown:function(){},oninputup:function(){},onmousedown:function(){},onmouseup:function(){},onmousemove:function(){},onmousewheel:function(){},ontouchdown:function(){},ontouchup:function(){},ontouchmove:function(){},ongamepadup:function(){},ongamepaddown:function(){},ongamepadaxis:function(){},ongamepaddevice:function(){},onwindowmoved:function(){},onwindowresized:function(){},onwindowsized:function(){},onwindowminimized:function(){},onwindowrestored:function(){},_init:function(){this.inited||(this.inited=!0,this.init())},__class__:u});var c=function(){this.bg_h=310,this.delayed=!1,u.call(this,{name:"ending"}),this.create_ending()};r.Ending=c,c.__name__=["Ending"],c.texture=function(t,e){return null==e&&(e="png"),m.resources.cache.get("assets/"+t+"."+e)},c.TimespanToString=function(t,e){if(isNaN(t))return"00:00:00:00.00";if(isNaN(e))return"00:00:00:00.00";var i=(e-t)/1e3,s=i%86400%3600%60,n=Math.floor(i%86400%3600/60),r=Math.floor(i%86400/3600),o=Math.floor(i/86400),l=Math.floor(s),a=Cs.fixed(s-l,2),h=""+a;-1!=h.indexOf(".")&&(h=h.split(".")[1]);var _=B.lpad(""+l,"0",2)+"."+B.lpad(h,"0",2);n=Math.floor(n),r=Math.floor(r),o=Math.floor(o);var u=B.lpad(""+o,"0",2)+":";return u+=B.lpad(""+r,"0",2)+":",u+=B.lpad(""+n,"0",2)+":",u+=""+_},c.show=function(t,e){null==e&&(e=.1),P.I.HideHint(),c.overlay.set_visible(!0),c.bg.set_visible(!0),c.time.set_visible(!0),c.title.set_visible(!0),c.thanks.set_visible(!0),c.footer.set_visible(!0),m.timer.schedule(e,function(){c.thanks.set_text(g.string.Ending_Subtitle),c.title.set_text(g.string.Ending_Time);var e=Or.string("StartTimestamp"),i=parseFloat(e),s=t;c.time.set_text(c.TimespanToString(i,s)),k.state.set("ending"),z.particles.start(-1)})},c.LockIn=function(){c.isLocked=!0},c.GetReady=function(){c.isReady||(c.isReady=!0,c.isLocked=!1,c.isEnding=!1,c.hasEnded=!1)},c.Begin=function(){P.finishTime=(new Date).getTime(),c.isEnding=!0,c.show(P.finishTime)},c.End=function(){P.I.EndGamePreCount(),c.Unready()},c.Unready=function(){c.isReady=!1,c.isLocked=!1,c.isEnding=!1,c.hasEnded=!1},c.__super__=u,c.prototype=i(u.prototype,{onleave:function(){var t=this;is.tween(this.transform.local.pos,.4,{y:-this.bg_h}).onComplete(function(){t.transform.local.pos.set_y(-t.bg_h),c.activated=!1,c.overlay.set_visible(!1),c.bg.set_visible(!1),c.time.set_visible(!1),c.title.set_visible(!1),c.thanks.set_visible(!1),c.footer.set_visible(!1)}),is.tween(c.overlay.color,.5,{a:0}),is.tween(c.footer.color,.5,{a:0}),z.particles.stop(),c.End()},onenter:function(){var t=this;this.delayed=!0,c.activated=!0,is.tween(this.transform.local.pos,.5,{y:480-this.bg_h/2}).ease(fs.get_easeOut()),is.tween(c.overlay.color,3,{a:.5}),is.tween(c.footer.color,4,{a:1}),m.timer.schedule(.9,function(){t.delayed=!1})},onmouseup:function(){this.delayed||k.state.set("game")},onkeyup:function(){this.delayed||k.state.set("game")},create_ending:function(){var t=this;this.transform=new gn,this.transform.local.pos.set_y(-this.bg_h),this.transform.id="ending",c.overlay=new pi({no_scene:!0,batcher:k.batch_t,centered:!1,size:new y(640,960),color:new F(1,1,1,0).rgb(16448250),depth:1999,visible:!1}),c.bg=new pi({no_scene:!0,centered:!1,batcher:k.batch_t,size:new y(640,this.bg_h),color:(new F).rgb(16448250),depth:4e3,visible:!1}),c.bg.get_transform().set_parent(this.transform),c.title=new mi({no_scene:!0,font:k.font_letters,batcher:k.batch_t,name:"ending_title",text:"",color:(new F).rgb(6737151),point_size:48,sdf:!0,pos:new y(320,160),align:2,align_vertical:2,depth:4001,visible:!1}),c.time=new mi({no_scene:!0,font:k.font_numbers,batcher:k.batch_t,name:"ending_time",text:"",color:(new F).rgb(6737151),point_size:40,sdf:!0,pos:new y(320,200),align:2,align_vertical:2,depth:4001,visible:!1}),c.thanks=new mi({no_scene:!0,font:k.font_letters,batcher:k.batch_t,name:"ending_thanks",text:"",color:(new F).rgb(16737920),point_size:32,sdf:!0,pos:new y(320,72),align:2,align_vertical:2,depth:4001,visible:!1}),c.title.get_transform().set_parent(t.transform),c.time.get_transform().set_parent(t.transform),c.thanks.get_transform().set_parent(t.transform),c.footer=new mi({batcher:k.batch_t,no_scene:!0,name:"ending_footer",text:g.string.GameOver_SwipeNoSign,point_size:30,font:k.font_letters,sdf:!0,color:new F(1,1,1,0).rgb(16737920),pos:new y(320,928),letter_spacing:0,align:2,align_vertical:2,depth:4001,visible:!1})},__class__:c});var d=function(){};r.HxOverrides=d,d.__name__=["HxOverrides"],d.strDate=function(t){var e=t.length;switch(e){case 8:var i=t.split(":"),s=new Date;return s.setTime(0),s.setUTCHours(i[0]),s.setUTCMinutes(i[1]),s.setUTCSeconds(i[2]),s;case 10:var n=t.split("-");return new Date(n[0],n[1]-1,n[2],0,0,0);case 19:var r=t.split(" "),o=r[0].split("-"),l=r[1].split(":");return new Date(o[0],o[1]-1,o[2],l[0],l[1],l[2]);default:throw new Ie("Invalid date format : "+t)}},d.cca=function(t,e){var i=t.charCodeAt(e);return i!=i?void 0:i},d.substr=function(t,e,i){return null!=e&&0!=e&&null!=i&&0>i?"":(null==i&&(i=t.length),0>e?(e=t.length+e,0>e&&(e=0)):0>i&&(i=t.length+i-e),t.substr(e,i))},d.indexOf=function(t,e,i){var s=t.length;for(0>i&&(i+=s,0>i&&(i=0));s>i;){if(t[i]===e)return i;i++}return-1},d.remove=function(t,e){var i=d.indexOf(t,e,0);return-1==i?!1:(t.splice(i,1),!0)},d.iter=function(t){return{cur:0,arr:t,hasNext:function(){return this.cur<this.arr.length},next:function(){return this.arr[this.cur++]}}};var f=function(){};r.Lambda=f,f.__name__=["Lambda"],f.has=function(t,e){for(var i=s(t)();i.hasNext();){var n=i.next();if(n==e)return!0}return!1},f.count=function(t,e){var i=0;if(null==e)for(var n=s(t)();n.hasNext();){{n.next()}i++}else for(var r=s(t)();r.hasNext();){var o=r.next();e(o)&&i++}return i};var p=function(){this.length=0};r.List=p,p.__name__=["List"],p.prototype={add:function(t){var e=[t];null==this.h?this.h=e:this.q[1]=e,this.q=e,this.length++},push:function(t){var e=[t,this.h];this.h=e,null==this.q&&(this.q=e),this.length++},remove:function(t){for(var e=null,i=this.h;null!=i;){if(i[0]==t)return null==e?this.h=i[1]:e[1]=i[1],this.q==i&&(this.q=e),this.length--,!0;e=i,i=i[1]}return!1},__class__:p};var g=function(t){null==t&&(t="English");var e=m.resources.cache.get("assets/lang/"+t+".json");g.string=e.asset.json};r.Loc=g,g.__name__=["Loc"],g.get=function(t){var e=I.field(g.string,t);return null==e?"":e},g.prototype={__class__:g};var m=function(){};r.Luxe=m,m.__name__=["Luxe"],m.__properties__={set_alpha:"set_alpha",get_alpha:"get_alpha",set_cur_frame_start:"set_cur_frame_start",get_cur_frame_start:"get_cur_frame_start",set_current_time:"set_current_time",get_current_time:"get_current_time",set_last_frame_start:"set_last_frame_start",get_last_frame_start:"get_last_frame_start",set_delta_sim:"set_delta_sim",get_delta_sim:"get_delta_sim",set_dt:"set_dt",get_dt:"get_dt",set_max_frame_time:"set_max_frame_time",get_max_frame_time:"get_max_frame_time",set_update_rate:"set_update_rate",get_update_rate:"get_update_rate",set_fixed_delta:"set_fixed_delta",get_fixed_delta:"get_fixed_delta",set_timescale:"set_timescale",get_timescale:"get_timescale",get_screen:"get_screen",get_time:"get_time",get_snow:"get_snow"},m.on=function(t,e){m.core.emitter.on(t,e)},m.off=function(t,e){return m.core.emitter.off(t,e)},m.next=function(t){null!=t&&Nn.next_queue.push(t)},m.shutdown=function(){m.core.shutdown()},m.showConsole=function(t){m.core.show_console(t)},m.get_snow=function(){return m.core.app},m.get_screen=function(){return m.core.screen},m.get_time=function(){return Nn.core.timestamp()},m.get_timescale=function(){return m.core.timescale},m.get_fixed_delta=function(){return m.core.fixed_delta},m.get_update_rate=function(){return m.core.update_rate},m.get_max_frame_time=function(){return m.core.max_frame_time},m.get_dt=function(){return m.core.delta_time},m.get_delta_sim=function(){return m.core.delta_sim},m.get_last_frame_start=function(){return m.core.last_frame_start},m.get_current_time=function(){return m.core.current_time},m.get_cur_frame_start=function(){return m.core.cur_frame_start},m.get_alpha=function(){return m.core.alpha},m.set_timescale=function(t){return m.core.timescale=t},m.set_fixed_delta=function(t){return m.core.fixed_delta=t},m.set_update_rate=function(t){return m.core.update_rate=t},m.set_max_frame_time=function(t){return m.core.max_frame_time=t},m.set_dt=function(t){return m.core.delta_time=t},m.set_delta_sim=function(t){return m.core.delta_sim=t},m.set_last_frame_start=function(t){return m.core.last_frame_start=t},m.set_current_time=function(t){return m.core.current_time=t},m.set_cur_frame_start=function(t){return m.core.cur_frame_start=t},m.set_alpha=function(t){return m.core.alpha=t};var v=function(){};r.LuxeApp=v,v.__name__=["LuxeApp"],v.main=function(){v._conf={window:{width:960,height:640,fullscreen:!1,resizable:!0,borderless:!1,title:"luxe app"}},v._conf.window.width=316,v._conf.window.height=476,v._conf.window.fullscreen=!1,v._conf.window.resizable=!0,v._conf.window.borderless=!0,v._conf.window.title="Threes",v._snow=new Nn,v._game=new k,v._core=new Oe(v._game,v._conf);var t={has_loop:!0,config_path:"",app_package:"com.underscorediscovery.Threes"};v._snow.init(t,v._core)};var y=function(t,e,i,s){null==s&&(s=0),null==i&&(i=0),null==e&&(e=0),null==t&&(t=0),this._construct=!1,this.ignore_listeners=!1,this.w=0,this.z=0,this.y=0,this.x=0,this._construct=!0,this.x=t,this._construct?this.x:(null==this.listen_x||this.ignore_listeners||this.listen_x(t),this.x),this.y=e,this._construct?this.y:(null==this.listen_y||this.ignore_listeners||this.listen_y(e),this.y),this.z=i,this._construct?this.z:(null==this.listen_z||this.ignore_listeners||this.listen_z(i),this.z),this.w=s,this._construct=!1};r["phoenix.Vector"]=y,y.__name__=["phoenix","Vector"],y.Add=function(t,e){return new y(t.x+e.x,t.y+e.y,t.z+e.z)},y.Subtract=function(t,e){return new y(t.x-e.x,t.y-e.y,t.z-e.z)},y.MultiplyVector=function(t,e){return new y(t.x*e.x,t.y*e.y,t.z*e.z)},y.DivideVector=function(t,e){return new y(t.x/e.x,t.y/e.y,t.z/e.z)},y.Multiply=function(t,e){return new y(t.x*e,t.y*e,t.z*e)},y.Divide=function(t,e){return new y(t.x/e,t.y/e,t.z/e)},y.AddScalar=function(t,e){return new y(t.x+e,t.y+e,t.z+e)},y.SubtractScalar=function(t,e){return new y(t.x-e,t.y-e,t.z-e)},y.Cross=function(t,e){return new y(t.y*e.z-t.z*e.y,t.z*e.x-t.x*e.z,t.x*e.y-t.y*e.x)},y.RotationTo=function(t,e){return t.rotationTo(e)},y.Listen=function(t,e){t.listen_x=e,t.listen_y=e,t.listen_z=e},y.Degrees=function(t){return new y(t.x,t.y,t.z,t.w).degrees()},y.Radians=function(t){return new y(t.x,t.y,t.z,t.w).radians()},y.prototype={copy_from:function(t){var e=t.x,i=t.y,s=t.z,n=this.ignore_listeners;return this.ignore_listeners=!0,this.x=e,this._construct?this.x:(null==this.listen_x||this.ignore_listeners||this.listen_x(e),this.x),this.y=i,this._construct?this.y:(null==this.listen_y||this.ignore_listeners||this.listen_y(i),this.y),this.z=s,this._construct?this.z:(null==this.listen_z||this.ignore_listeners||this.listen_z(s),this.z),this.w=t.w,this.ignore_listeners=n,null==this.listen_x||this.ignore_listeners||this.listen_x(this.x),null==this.listen_y||this.ignore_listeners||this.listen_y(this.y),null==this.listen_z||this.ignore_listeners||this.listen_z(this.z),this},lerp_xy:function(t,e,i){var s=Cs.lerp(this.x,t,i),n=Cs.lerp(this.y,e,i),r=this.ignore_listeners;return this.ignore_listeners=!0,this.x=s,this._construct?this.x:(null==this.listen_x||this.ignore_listeners||this.listen_x(s),this.x),this.y=n,this._construct?this.y:(null==this.listen_y||this.ignore_listeners||this.listen_y(n),this.y),this.ignore_listeners=r,null==this.listen_x||this.ignore_listeners||this.listen_x(this.x),null==this.listen_y||this.ignore_listeners||this.listen_y(this.y),this},lerp_xyz:function(t,e,i,s){var n=Cs.lerp(this.x,t,s),r=Cs.lerp(this.y,e,s),o=Cs.lerp(this.z,i,s),l=this.ignore_listeners;return this.ignore_listeners=!0,this.x=n,this._construct?this.x:(null==this.listen_x||this.ignore_listeners||this.listen_x(n),this.x),this.y=r,this._construct?this.y:(null==this.listen_y||this.ignore_listeners||this.listen_y(r),this.y),this.z=o,this._construct?this.z:(null==this.listen_z||this.ignore_listeners||this.listen_z(o),this.z),this.ignore_listeners=l,null==this.listen_x||this.ignore_listeners||this.listen_x(this.x),null==this.listen_y||this.ignore_listeners||this.listen_y(this.y),null==this.listen_z||this.ignore_listeners||this.listen_z(this.z),this},lerp:function(t,e){var i=Cs.lerp(this.x,t.x,e),s=Cs.lerp(this.y,t.y,e),n=Cs.lerp(this.z,t.z,e),r=this.ignore_listeners;return this.ignore_listeners=!0,this.x=i,this._construct?this.x:(null==this.listen_x||this.ignore_listeners||this.listen_x(i),this.x),this.y=s,this._construct?this.y:(null==this.listen_y||this.ignore_listeners||this.listen_y(s),this.y),this.z=n,this._construct?this.z:(null==this.listen_z||this.ignore_listeners||this.listen_z(n),this.z),this.ignore_listeners=r,null==this.listen_x||this.ignore_listeners||this.listen_x(this.x),null==this.listen_y||this.ignore_listeners||this.listen_y(this.y),null==this.listen_z||this.ignore_listeners||this.listen_z(this.z),this},weighted_average_xy:function(t,e,i){var s=Cs.weighted_avg(this.x,t,i),n=Cs.weighted_avg(this.y,e,i),r=this.ignore_listeners;return this.ignore_listeners=!0,this.x=s,this._construct?this.x:(null==this.listen_x||this.ignore_listeners||this.listen_x(s),this.x),this.y=n,this._construct?this.y:(null==this.listen_y||this.ignore_listeners||this.listen_y(n),this.y),this.ignore_listeners=r,null==this.listen_x||this.ignore_listeners||this.listen_x(this.x),null==this.listen_y||this.ignore_listeners||this.listen_y(this.y),this},weighted_average_xyz:function(t,e,i,s){var n=Cs.weighted_avg(this.x,t,s),r=Cs.weighted_avg(this.y,e,s),o=Cs.weighted_avg(this.z,i,s),l=this.ignore_listeners;return this.ignore_listeners=!0,this.x=n,this._construct?this.x:(null==this.listen_x||this.ignore_listeners||this.listen_x(n),this.x),this.y=r,this._construct?this.y:(null==this.listen_y||this.ignore_listeners||this.listen_y(r),this.y),this.z=o,this._construct?this.z:(null==this.listen_z||this.ignore_listeners||this.listen_z(o),this.z),this.ignore_listeners=l,null==this.listen_x||this.ignore_listeners||this.listen_x(this.x),null==this.listen_y||this.ignore_listeners||this.listen_y(this.y),null==this.listen_z||this.ignore_listeners||this.listen_z(this.z),this},"int":function(){var t=Math.round(this.x),e=Math.round(this.y),i=Math.round(this.z),s=this.ignore_listeners;return this.ignore_listeners=!0,this.x=t,this._construct?this.x:(null==this.listen_x||this.ignore_listeners||this.listen_x(t),this.x),this.y=e,this._construct?this.y:(null==this.listen_y||this.ignore_listeners||this.listen_y(e),this.y),this.z=i,this._construct?this.z:(null==this.listen_z||this.ignore_listeners||this.listen_z(i),this.z),this.ignore_listeners=s,null==this.listen_x||this.ignore_listeners||this.listen_x(this.x),null==this.listen_y||this.ignore_listeners||this.listen_y(this.y),null==this.listen_z||this.ignore_listeners||this.listen_z(this.z),this},int_x:function(){return this.set_x(Math.round(this.x)),this},int_y:function(){return this.set_y(Math.round(this.y)),this},int_z:function(){return this.set_z(Math.round(this.z)),this},toString:function(){return"{ x:"+this.x+", y:"+this.y+", z:"+this.z+" }"},equals:function(t){return this.x==t.x&&this.y==t.y&&this.z==t.z&&this.w==t.w},clone:function(){return new y(this.x,this.y,this.z,this.w)},normalize:function(){return this.divideScalar(Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z))},dot:function(t){return this.x*t.x+this.y*t.y+this.z*t.z},cross:function(t,e){var i=t.y*e.z-t.z*e.y,s=t.z*e.x-t.x*e.z,n=t.x*e.y-t.y*e.x,r=this.ignore_listeners;return this.ignore_listeners=!0,this.x=i,this._construct?this.x:(null==this.listen_x||this.ignore_listeners||this.listen_x(i),this.x),this.y=s,this._construct?this.y:(null==this.listen_y||this.ignore_listeners||this.listen_y(s),this.y),this.z=n,this._construct?this.z:(null==this.listen_z||this.ignore_listeners||this.listen_z(n),this.z),this.ignore_listeners=r,null==this.listen_x||this.ignore_listeners||this.listen_x(this.x),null==this.listen_y||this.ignore_listeners||this.listen_y(this.y),null==this.listen_z||this.ignore_listeners||this.listen_z(this.z),this},invert:function(){var t=-this.x,e=-this.y,i=-this.z,s=this.ignore_listeners;return this.ignore_listeners=!0,this.x=t,this._construct?this.x:(null==this.listen_x||this.ignore_listeners||this.listen_x(t),this.x),this.y=e,this._construct?this.y:(null==this.listen_y||this.ignore_listeners||this.listen_y(e),this.y),this.z=i,this._construct?this.z:(null==this.listen_z||this.ignore_listeners||this.listen_z(i),this.z),this.ignore_listeners=s,null==this.listen_x||this.ignore_listeners||this.listen_x(this.x),null==this.listen_y||this.ignore_listeners||this.listen_y(this.y),null==this.listen_z||this.ignore_listeners||this.listen_z(this.z),this},add:function(t){if(null==t)throw new Ie(ei.null_assertion("other was null"));var e=this.x+t.x,i=this.y+t.y,s=this.z+t.z,n=this.ignore_listeners;return this.ignore_listeners=!0,this.x=e,this._construct?this.x:(null==this.listen_x||this.ignore_listeners||this.listen_x(e),this.x),this.y=i,this._construct?this.y:(null==this.listen_y||this.ignore_listeners||this.listen_y(i),this.y),this.z=s,this._construct?this.z:(null==this.listen_z||this.ignore_listeners||this.listen_z(s),this.z),this.ignore_listeners=n,null==this.listen_x||this.ignore_listeners||this.listen_x(this.x),null==this.listen_y||this.ignore_listeners||this.listen_y(this.y),null==this.listen_z||this.ignore_listeners||this.listen_z(this.z),this},add_xyz:function(t,e,i){null==i&&(i=0),null==e&&(e=0),null==t&&(t=0);var s=this.x+t,n=this.y+e,r=this.z+i,o=this.ignore_listeners;return this.ignore_listeners=!0,this.x=s,this._construct?this.x:(null==this.listen_x||this.ignore_listeners||this.listen_x(s),this.x),this.y=n,this._construct?this.y:(null==this.listen_y||this.ignore_listeners||this.listen_y(n),this.y),this.z=r,this._construct?this.z:(null==this.listen_z||this.ignore_listeners||this.listen_z(r),this.z),this.ignore_listeners=o,null==this.listen_x||this.ignore_listeners||this.listen_x(this.x),null==this.listen_y||this.ignore_listeners||this.listen_y(this.y),null==this.listen_z||this.ignore_listeners||this.listen_z(this.z),this},subtract:function(t){if(null==t)throw new Ie(ei.null_assertion("other was null"));var e=this.x-t.x,i=this.y-t.y,s=this.z-t.z,n=this.ignore_listeners;return this.ignore_listeners=!0,this.x=e,this._construct?this.x:(null==this.listen_x||this.ignore_listeners||this.listen_x(e),this.x),this.y=i,this._construct?this.y:(null==this.listen_y||this.ignore_listeners||this.listen_y(i),this.y),this.z=s,this._construct?this.z:(null==this.listen_z||this.ignore_listeners||this.listen_z(s),this.z),this.ignore_listeners=n,null==this.listen_x||this.ignore_listeners||this.listen_x(this.x),null==this.listen_y||this.ignore_listeners||this.listen_y(this.y),null==this.listen_z||this.ignore_listeners||this.listen_z(this.z),this},subtract_xyz:function(t,e,i){null==i&&(i=0),null==e&&(e=0),null==t&&(t=0);var s=this.x-t,n=this.y-e,r=this.z-i,o=this.ignore_listeners;return this.ignore_listeners=!0,this.x=s,this._construct?this.x:(null==this.listen_x||this.ignore_listeners||this.listen_x(s),this.x),this.y=n,this._construct?this.y:(null==this.listen_y||this.ignore_listeners||this.listen_y(n),this.y),this.z=r,this._construct?this.z:(null==this.listen_z||this.ignore_listeners||this.listen_z(r),this.z),this.ignore_listeners=o,null==this.listen_x||this.ignore_listeners||this.listen_x(this.x),null==this.listen_y||this.ignore_listeners||this.listen_y(this.y),null==this.listen_z||this.ignore_listeners||this.listen_z(this.z),this},multiply:function(t){if(null==t)throw new Ie(ei.null_assertion("other was null"));var e=this.x*t.x,i=this.y*t.y,s=this.z*t.z,n=this.ignore_listeners;return this.ignore_listeners=!0,this.x=e,this._construct?this.x:(null==this.listen_x||this.ignore_listeners||this.listen_x(e),this.x),this.y=i,this._construct?this.y:(null==this.listen_y||this.ignore_listeners||this.listen_y(i),this.y),this.z=s,this._construct?this.z:(null==this.listen_z||this.ignore_listeners||this.listen_z(s),this.z),this.ignore_listeners=n,null==this.listen_x||this.ignore_listeners||this.listen_x(this.x),null==this.listen_y||this.ignore_listeners||this.listen_y(this.y),null==this.listen_z||this.ignore_listeners||this.listen_z(this.z),this},multiply_xyz:function(t,e,i){null==i&&(i=1),null==e&&(e=1),null==t&&(t=1);var s=this.x*t,n=this.y*e,r=this.z*i,o=this.ignore_listeners;return this.ignore_listeners=!0,this.x=s,this._construct?this.x:(null==this.listen_x||this.ignore_listeners||this.listen_x(s),this.x),this.y=n,this._construct?this.y:(null==this.listen_y||this.ignore_listeners||this.listen_y(n),this.y),this.z=r,this._construct?this.z:(null==this.listen_z||this.ignore_listeners||this.listen_z(r),this.z),this.ignore_listeners=o,null==this.listen_x||this.ignore_listeners||this.listen_x(this.x),null==this.listen_y||this.ignore_listeners||this.listen_y(this.y),null==this.listen_z||this.ignore_listeners||this.listen_z(this.z),this},divide:function(t){if(null==t)throw new Ie(ei.null_assertion("other was null"));if(0==t.x)throw new Ie(ei.assertion("other.x != 0 ( Vector: division by zero (other.x) )"));if(0==t.y)throw new Ie(ei.assertion("other.y != 0 ( Vector: division by zero (other.y) )"));var e=this.x/t.x,i=this.y/t.y,s=this.z/t.z,n=this.ignore_listeners;return this.ignore_listeners=!0,this.x=e,this._construct?this.x:(null==this.listen_x||this.ignore_listeners||this.listen_x(e),this.x),this.y=i,this._construct?this.y:(null==this.listen_y||this.ignore_listeners||this.listen_y(i),this.y),this.z=s,this._construct?this.z:(null==this.listen_z||this.ignore_listeners||this.listen_z(s),this.z),this.ignore_listeners=n,null==this.listen_x||this.ignore_listeners||this.listen_x(this.x),null==this.listen_y||this.ignore_listeners||this.listen_y(this.y),null==this.listen_z||this.ignore_listeners||this.listen_z(this.z),this},divide_xyz:function(t,e,i){if(null==i&&(i=1),null==e&&(e=1),null==t&&(t=1),0==t)throw new Ie(ei.assertion("_x != 0 ( Vector.divide_xyz: division by zero (x) )"));if(0==e)throw new Ie(ei.assertion("_y != 0 ( Vector.divide_xyz: division by zero (y) )"));if(0==i)throw new Ie(ei.assertion("_z != 0 ( Vector.divide_xyz: division by zero (z) )"));var s=this.x/t,n=this.y/e,r=this.z/i,o=this.ignore_listeners;return this.ignore_listeners=!0,this.x=s,this._construct?this.x:(null==this.listen_x||this.ignore_listeners||this.listen_x(s),this.x),this.y=n,this._construct?this.y:(null==this.listen_y||this.ignore_listeners||this.listen_y(n),this.y),this.z=r,this._construct?this.z:(null==this.listen_z||this.ignore_listeners||this.listen_z(r),this.z),this.ignore_listeners=o,null==this.listen_x||this.ignore_listeners||this.listen_x(this.x),null==this.listen_y||this.ignore_listeners||this.listen_y(this.y),null==this.listen_z||this.ignore_listeners||this.listen_z(this.z),this},addScalar:function(t){var e=this.x+t,i=this.y+t,s=this.z+t,n=this.ignore_listeners;return this.ignore_listeners=!0,this.x=e,this._construct?this.x:(null==this.listen_x||this.ignore_listeners||this.listen_x(e),this.x),this.y=i,this._construct?this.y:(null==this.listen_y||this.ignore_listeners||this.listen_y(i),this.y),this.z=s,this._construct?this.z:(null==this.listen_z||this.ignore_listeners||this.listen_z(s),this.z),this.ignore_listeners=n,null==this.listen_x||this.ignore_listeners||this.listen_x(this.x),null==this.listen_y||this.ignore_listeners||this.listen_y(this.y),null==this.listen_z||this.ignore_listeners||this.listen_z(this.z),this},subtractScalar:function(t){var e=this.x-t,i=this.y-t,s=this.z-t,n=this.ignore_listeners;return this.ignore_listeners=!0,this.x=e,this._construct?this.x:(null==this.listen_x||this.ignore_listeners||this.listen_x(e),this.x),this.y=i,this._construct?this.y:(null==this.listen_y||this.ignore_listeners||this.listen_y(i),this.y),this.z=s,this._construct?this.z:(null==this.listen_z||this.ignore_listeners||this.listen_z(s),this.z),this.ignore_listeners=n,null==this.listen_x||this.ignore_listeners||this.listen_x(this.x),null==this.listen_y||this.ignore_listeners||this.listen_y(this.y),null==this.listen_z||this.ignore_listeners||this.listen_z(this.z),this
},multiplyScalar:function(t){var e=this.x*t,i=this.y*t,s=this.z*t,n=this.ignore_listeners;return this.ignore_listeners=!0,this.x=e,this._construct?this.x:(null==this.listen_x||this.ignore_listeners||this.listen_x(e),this.x),this.y=i,this._construct?this.y:(null==this.listen_y||this.ignore_listeners||this.listen_y(i),this.y),this.z=s,this._construct?this.z:(null==this.listen_z||this.ignore_listeners||this.listen_z(s),this.z),this.ignore_listeners=n,null==this.listen_x||this.ignore_listeners||this.listen_x(this.x),null==this.listen_y||this.ignore_listeners||this.listen_y(this.y),null==this.listen_z||this.ignore_listeners||this.listen_z(this.z),this},divideScalar:function(t){if(0!=t){var e=this.x/t,i=this.y/t,s=this.z/t,n=this.ignore_listeners;this.ignore_listeners=!0,this.x=e,this._construct?this.x:(null==this.listen_x||this.ignore_listeners||this.listen_x(e),this.x),this.y=i,this._construct?this.y:(null==this.listen_y||this.ignore_listeners||this.listen_y(i),this.y),this.z=s,this._construct?this.z:(null==this.listen_z||this.ignore_listeners||this.listen_z(s),this.z),this.ignore_listeners=n,null==this.listen_x||this.ignore_listeners||this.listen_x(this.x),null==this.listen_y||this.ignore_listeners||this.listen_y(this.y),null==this.listen_z||this.ignore_listeners||this.listen_z(this.z)}else{var r=this.ignore_listeners;this.ignore_listeners=!0,this.x=0,this._construct?this.x:(null==this.listen_x||this.ignore_listeners||this.listen_x(0),this.x),this.y=0,this._construct?this.y:(null==this.listen_y||this.ignore_listeners||this.listen_y(0),this.y),this.z=0,this._construct?this.z:(null==this.listen_z||this.ignore_listeners||this.listen_z(0),this.z),this.ignore_listeners=r,null==this.listen_x||this.ignore_listeners||this.listen_x(this.x),null==this.listen_y||this.ignore_listeners||this.listen_y(this.y),null==this.listen_z||this.ignore_listeners||this.listen_z(this.z)}return this},set_length:function(t){return this.divideScalar(Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)).multiplyScalar(t),t},get_length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},get_lengthsq:function(){return this.x*this.x+this.y*this.y+this.z*this.z},get_normalized:function(){return y.Divide(this,Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z))},set_x:function(t){return this.x=t,this._construct?this.x:(null==this.listen_x||this.ignore_listeners||this.listen_x(t),this.x)},set_y:function(t){return this.y=t,this._construct?this.y:(null==this.listen_y||this.ignore_listeners||this.listen_y(t),this.y)},set_z:function(t){return this.z=t,this._construct?this.z:(null==this.listen_z||this.ignore_listeners||this.listen_z(t),this.z)},get_inverted:function(){return new y(-this.x,-this.y,-this.z)},set_angle2D:function(t){var e=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z),i=Math.cos(t)*e,s=Math.sin(t)*e,n=this.ignore_listeners;return this.ignore_listeners=!0,this.x=i,this._construct?this.x:(null==this.listen_x||this.ignore_listeners||this.listen_x(i),this.x),this.y=s,this._construct?this.y:(null==this.listen_y||this.ignore_listeners||this.listen_y(s),this.y),this.ignore_listeners=n,null==this.listen_x||this.ignore_listeners||this.listen_x(this.x),null==this.listen_y||this.ignore_listeners||this.listen_y(this.y),t},get_angle2D:function(){return Math.atan2(this.y,this.x)},truncate:function(t){return this.set_length(Math.min(t,Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z))),this},rotationTo:function(t){var e=Math.atan2(t.x-this.x,t.y-this.y),i=-(180+180*e/Math.PI);return i},applyQuaternion:function(t){var e=t.x,i=t.y,s=t.z,n=t.w,r=n*this.x+i*this.z-s*this.y,o=n*this.y+s*this.x-e*this.z,l=n*this.z+e*this.y-i*this.x,a=-e*this.x-i*this.y-s*this.z,h=r*n+a*-e+o*-s-l*-i,_=o*n+a*-i+l*-e-r*-s,u=l*n+a*-s+r*-i-o*-e,c=this.ignore_listeners;return this.ignore_listeners=!0,this.x=h,this._construct?this.x:(null==this.listen_x||this.ignore_listeners||this.listen_x(h),this.x),this.y=_,this._construct?this.y:(null==this.listen_y||this.ignore_listeners||this.listen_y(_),this.y),this.z=u,this._construct?this.z:(null==this.listen_z||this.ignore_listeners||this.listen_z(u),this.z),this.ignore_listeners=c,null==this.listen_x||this.ignore_listeners||this.listen_x(this.x),null==this.listen_y||this.ignore_listeners||this.listen_y(this.y),null==this.listen_z||this.ignore_listeners||this.listen_z(this.z),this},applyProjection:function(t){var e=t.elements,i=this.x,s=this.y,n=this.z,r=1/(e[3]*i+e[7]*s+e[11]*n+e[15]),o=(e[0]*i+e[4]*s+e[8]*n+e[12])*r,l=(e[1]*i+e[5]*s+e[9]*n+e[13])*r,a=(e[2]*i+e[6]*s+e[10]*n+e[14])*r,h=this.ignore_listeners;return this.ignore_listeners=!0,this.x=o,this._construct?this.x:(null==this.listen_x||this.ignore_listeners||this.listen_x(o),this.x),this.y=l,this._construct?this.y:(null==this.listen_y||this.ignore_listeners||this.listen_y(l),this.y),this.z=a,this._construct?this.z:(null==this.listen_z||this.ignore_listeners||this.listen_z(a),this.z),this.ignore_listeners=h,null==this.listen_x||this.ignore_listeners||this.listen_x(this.x),null==this.listen_y||this.ignore_listeners||this.listen_y(this.y),null==this.listen_z||this.ignore_listeners||this.listen_z(this.z),this},transformDirection:function(t){var e=t.elements,i=this.x,s=this.y,n=this.z,r=e[0]*i+e[4]*s+e[8]*n,o=e[1]*i+e[5]*s+e[9]*n,l=e[2]*i+e[6]*s+e[10]*n,a=this.ignore_listeners;return this.ignore_listeners=!0,this.x=r,this._construct?this.x:(null==this.listen_x||this.ignore_listeners||this.listen_x(r),this.x),this.y=o,this._construct?this.y:(null==this.listen_y||this.ignore_listeners||this.listen_y(o),this.y),this.z=l,this._construct?this.z:(null==this.listen_z||this.ignore_listeners||this.listen_z(l),this.z),this.ignore_listeners=a,null==this.listen_x||this.ignore_listeners||this.listen_x(this.x),null==this.listen_y||this.ignore_listeners||this.listen_y(this.y),null==this.listen_z||this.ignore_listeners||this.listen_z(this.z),this.divideScalar(Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)),this},setEulerFromRotationMatrix:function(t,e){null==e&&(e=0);var i=t.elements,s=i[0],n=i[4],r=i[8],o=i[1],l=i[5],a=i[9],h=i[2],_=i[6],u=i[10],c=this.x,d=this.y,f=this.z;0==e?(d=Math.asin(-1>r?-1:r>1?1:r),Math.abs(r)<.99999?(c=Math.atan2(-a,u),f=Math.atan2(-n,s)):(c=Math.atan2(_,l),f=0)):1==e?(c=Math.asin(-(-1>a?-1:a>1?1:a)),Math.abs(a)<.99999?(d=Math.atan2(r,u),f=Math.atan2(o,l)):(d=Math.atan2(-h,s),f=0)):2==e?(c=Math.asin(-1>_?-1:_>1?1:_),Math.abs(_)<.99999?(d=Math.atan2(-h,u),f=Math.atan2(-n,l)):(d=0,f=Math.atan2(o,s))):3==e?(d=Math.asin(-(-1>h?-1:h>1?1:h)),Math.abs(h)<.99999?(c=Math.atan2(_,u),f=Math.atan2(o,s)):(c=0,f=Math.atan2(-n,l))):4==e?(f=Math.asin(-1>o?-1:o>1?1:o),Math.abs(o)<.99999?(c=Math.atan2(-a,l),d=Math.atan2(-h,s)):(c=0,d=Math.atan2(r,u))):5==e&&(f=Math.asin(-(-1>n?-1:n>1?1:n)),Math.abs(n)<.99999?(c=Math.atan2(_,l),d=Math.atan2(r,s)):(c=Math.atan2(-a,u),d=0));var p=this.ignore_listeners;return this.ignore_listeners=!0,this.x=c,this._construct?this.x:(null==this.listen_x||this.ignore_listeners||this.listen_x(c),this.x),this.y=d,this._construct?this.y:(null==this.listen_y||this.ignore_listeners||this.listen_y(d),this.y),this.z=f,this._construct?this.z:(null==this.listen_z||this.ignore_listeners||this.listen_z(f),this.z),this.ignore_listeners=p,null==this.listen_x||this.ignore_listeners||this.listen_x(this.x),null==this.listen_y||this.ignore_listeners||this.listen_y(this.y),null==this.listen_z||this.ignore_listeners||this.listen_z(this.z),this},setEulerFromQuaternion:function(t,e){null==e&&(e=0);var i=t.x*t.x,s=t.y*t.y,n=t.z*t.z,r=t.w*t.w,o=this.x,l=this.y,a=this.z;0==e?(o=Math.atan2(2*(t.x*t.w-t.y*t.z),r-i-s+n),l=Math.asin(Cs.clamp(2*(t.x*t.z+t.y*t.w),-1,1)),a=Math.atan2(2*(t.z*t.w-t.x*t.y),r+i-s-n)):1==e?(o=Math.asin(Cs.clamp(2*(t.x*t.w-t.y*t.z),-1,1)),l=Math.atan2(2*(t.x*t.z+t.y*t.w),r-i-s+n),a=Math.atan2(2*(t.x*t.y+t.z*t.w),r-i+s-n)):2==e?(o=Math.asin(Cs.clamp(2*(t.x*t.w+t.y*t.z),-1,1)),l=Math.atan2(2*(t.y*t.w-t.z*t.x),r-i-s+n),a=Math.atan2(2*(t.z*t.w-t.x*t.y),r-i+s-n)):3==e?(o=Math.atan2(2*(t.x*t.w+t.z*t.y),r-i-s+n),l=Math.asin(Cs.clamp(2*(t.y*t.w-t.x*t.z),-1,1)),a=Math.atan2(2*(t.x*t.y+t.z*t.w),r+i-s-n)):4==e?(o=Math.atan2(2*(t.x*t.w-t.z*t.y),r-i+s-n),l=Math.atan2(2*(t.y*t.w-t.x*t.z),r+i-s-n),a=Math.asin(Cs.clamp(2*(t.x*t.y+t.z*t.w),-1,1))):5==e&&(o=Math.atan2(2*(t.x*t.w+t.y*t.z),r-i+s-n),l=Math.atan2(2*(t.x*t.z+t.y*t.w),r+i-s-n),a=Math.asin(Cs.clamp(2*(t.z*t.w-t.x*t.y),-1,1)));var h=this.ignore_listeners;return this.ignore_listeners=!0,this.x=o,this._construct?this.x:(null==this.listen_x||this.ignore_listeners||this.listen_x(o),this.x),this.y=l,this._construct?this.y:(null==this.listen_y||this.ignore_listeners||this.listen_y(l),this.y),this.z=a,this._construct?this.z:(null==this.listen_z||this.ignore_listeners||this.listen_z(a),this.z),this.ignore_listeners=h,null==this.listen_x||this.ignore_listeners||this.listen_x(this.x),null==this.listen_y||this.ignore_listeners||this.listen_y(this.y),null==this.listen_z||this.ignore_listeners||this.listen_z(this.z),this},degrees:function(){var t=57.29577951308238*this.x,e=57.29577951308238*this.y,i=57.29577951308238*this.z,s=this.ignore_listeners;return this.ignore_listeners=!0,this.x=t,this._construct?this.x:(null==this.listen_x||this.ignore_listeners||this.listen_x(t),this.x),this.y=e,this._construct?this.y:(null==this.listen_y||this.ignore_listeners||this.listen_y(e),this.y),this.z=i,this._construct?this.z:(null==this.listen_z||this.ignore_listeners||this.listen_z(i),this.z),this.ignore_listeners=s,null==this.listen_x||this.ignore_listeners||this.listen_x(this.x),null==this.listen_y||this.ignore_listeners||this.listen_y(this.y),null==this.listen_z||this.ignore_listeners||this.listen_z(this.z),this},radians:function(){var t=.017453292519943278*this.x,e=.017453292519943278*this.y,i=.017453292519943278*this.z,s=this.ignore_listeners;return this.ignore_listeners=!0,this.x=t,this._construct?this.x:(null==this.listen_x||this.ignore_listeners||this.listen_x(t),this.x),this.y=e,this._construct?this.y:(null==this.listen_y||this.ignore_listeners||this.listen_y(e),this.y),this.z=i,this._construct?this.z:(null==this.listen_z||this.ignore_listeners||this.listen_z(i),this.z),this.ignore_listeners=s,null==this.listen_x||this.ignore_listeners||this.listen_x(this.x),null==this.listen_y||this.ignore_listeners||this.listen_y(this.y),null==this.listen_z||this.ignore_listeners||this.listen_z(this.z),this},__class__:y,__properties__:{get_inverted:"get_inverted",get_normalized:"get_normalized",set_angle2D:"set_angle2D",get_angle2D:"get_angle2D",get_lengthsq:"get_lengthsq",set_length:"set_length",get_length:"get_length",set_z:"set_z",set_y:"set_y",set_x:"set_x"}};var w=function(){};r.MagicNumbers=w,w.__name__=["MagicNumbers"];var x=function(){this._checking=!1,this._to_remove=new p,this.connected=new p,this.bindings=new _e};r["luxe.Emitter"]=x,x.__name__=["luxe","Emitter"],x.prototype={emit:function(t,e){this._check();var i=this.bindings.h[t];if(null!=i&&i.length>0)for(var s=0;s<i.length;){var n=i[s];++s,n(e)}this._check()},on:function(t,e){if(this._check(),this.bindings.h.hasOwnProperty(t)){var i=this.bindings.h[t];-1==d.indexOf(i,e,0)&&(i.push(e),this.connected.push({handler:e,event:t}))}else this.bindings.h[t]=[e],this.connected.push({handler:e,event:t})},off:function(t,e){this._check();var i=!1;if(this.bindings.h.hasOwnProperty(t)){this._to_remove.push({event:t,handler:e});for(var s=this.connected.h,n=null;null!=s;){var r;r=function(){var t;return n=s[0],s=s[1],t=n}(this),r.event==t&&r.handler==e&&this.connected.remove(r)}i=!0}return i},connections:function(t){for(var e=[],i=this.connected.h,s=null;null!=i;){var n;n=function(){var t;return s=i[0],i=i[1],t=s}(this),n.handler==t&&e.push(n)}return e},_check:function(){if(!this._checking){if(this._checking=!0,this._to_remove.length>0){for(var t=this._to_remove.h,e=null;null!=t;){var i;i=function(){var i;return e=t[0],t=t[1],i=e}(this);var s=this.bindings.h[i.event];d.remove(s,i.handler),0==s.length&&this.bindings.remove(i.event)}this._to_remove=null,this._to_remove=new p}this._checking=!1}},__class__:x};var b=function(){x.call(this)};r["luxe.Game"]=b,b.__name__=["luxe","Game"],b.__super__=x,b.prototype=i(x.prototype,{config:function(t){return t},ready:function(){},update:function(){},onevent:function(){},ondestroy:function(){},onprerender:function(){},onrender:function(){},onpostrender:function(){},oninputdown:function(){},oninputup:function(){},onmousedown:function(){},onmouseup:function(){},onmousewheel:function(){},onmousemove:function(){},onkeydown:function(){},onkeyup:function(){},ontextinput:function(){},ontouchdown:function(){},ontouchup:function(){},ontouchmove:function(){},ongamepadaxis:function(){},ongamepaddown:function(){},ongamepadup:function(){},ongamepaddevice:function(){},onwindowmoved:function(){},onwindowresized:function(){},onwindowsized:function(){},onwindowminimized:function(){},onwindowrestored:function(){},__class__:b});var k=function(){this._stt=0,this._sty=0,this._stx=0,b.call(this)};r.Main=k,k.__name__=["Main"],k.ismobile=function(){return"android"==m.core.app.os||"ios"==m.core.app.os?!0:!1},k.__super__=b,k.prototype=i(b.prototype,{texture:function(t,e){return null==e&&(e="png"),m.resources.cache.get("assets/"+t+"."+e)},pre:function(){m.renderer.blend_mode(1,771)},post:function(){m.renderer.blend_mode()},ready:function(){m.renderer.clear_color.rgb(16448250);var t=.4*m.core.screen.get_w(),e=Cs.clamp(t/280,.3,1);k.overlay=new pi({no_scene:!0,color:(new F).rgb(16448250),centered:!1}),k.loading=new pi({no_scene:!0,texture:m.resources.cache.get("loading.png"),pos:new y(m.core.screen.get_mid().x,Math.floor(.66*m.core.screen.get_h())),scale:new y(e,e)}),k.spinner=new pi({no_scene:!0,color:new F(1,1,1,.2),texture:m.resources.cache.get("spinner.png"),pos:new y(m.core.screen.get_mid().x,Math.floor(.33*m.core.screen.get_h())),scale:new y(.6*e,.6*e)});var i=new ni(this.parcel_info());i.load("main")},update:function(t){if(null!=k.spinner){var e=k.spinner;e.set_rotation_z(e.get_rotation_z()+180*t)}},onwindowsized:function(){k.view_y=m.camera.get_pos().y,k.view_x=m.camera.get_pos().x},onkeyup:function(t){if(t.keycode==tr.key_v&&(m.renderer.logging=!0),t.keycode==tr.escape&&null!=k.state.current_state&&!U.IsActive()){var e=k.state.current_state.name;switch(e){case"menu":k.state.set("game");break;case"game":k.state.set("menu")}}},ontouchmove:function(t){if("android"==m.core.app.os||"ios"==m.core.app.os?!0:!1){var e=Math.floor(t.x*m.core.screen.get_w()),i=Math.floor(t.y*m.core.screen.get_h());m.core.onmousemove(e,i,0,0,t.timestamp,0)}},ontouchdown:function(t){if("android"==m.core.app.os||"ios"==m.core.app.os?!0:!1){this._stx=t.x,this._sty=t.y,this._stt=Nn.core.timestamp();var e=Math.floor(t.x*m.core.screen.get_w()),i=Math.floor(t.y*m.core.screen.get_h());m.core.onmousedown(e,i,1,t.timestamp,0)}},ontouchup:function(t){if("android"==m.core.app.os||"ios"==m.core.app.os?!0:!1){var e=.75;if(k.touch_dir_x=k.touch_dir_y=0,Nn.core.timestamp()-this._stt<=e){var i=t.x-this._stx,s=t.y-this._sty,n=Math.abs(i),r=Math.abs(s),o=n>=r,l=Cs.degrees(Math.atan2(r,n)),a=.12,h=.12,_=35,u=55;o&&_>=l?n>=a&&(k.touch_dir_x=i>0?1:-1):!o&&l>=u&&r>=h&&(k.touch_dir_y=s>0?1:-1)}(0!=k.touch_dir_x||0!=k.touch_dir_y)&&(P.any_key=!0);var c=Math.floor(t.x*m.core.screen.get_w()),d=Math.floor(t.y*m.core.screen.get_h());m.core.onmouseup(c,d,1,t.timestamp,0),10>=d&&10>=c&&(m.renderer.logging=!0)}},load_complete:function(){var t=new T("assets.parcel");t.preload().then(n(this,this.finish_loading))},finish_loading:function(){k.overlay.color.tween(.25,{a:0}).onComplete(n(this,this.do_ready)),k.loading.color.tween(.2,{a:0}),k.spinner.color.tween(.2,{a:0})},do_ready:function(){k.overlay.destroy(),k.loading.destroy(),k.spinner.destroy(),k.overlay=k.loading=k.spinner=null,m.renderer.batcher.emitter.on(1,n(this,this.pre)),m.renderer.batcher.emitter.on(2,n(this,this.post)),k.batch_t=m.renderer.create_batcher({name:"textbatch",camera:m.renderer.batcher.view,layer:1}),k.batch_p=m.renderer.create_batcher({name:"postbatch",camera:m.renderer.batcher.view,layer:2}),k.batch_p.emitter.on(1,n(this,this.pre)),k.batch_p.emitter.on(2,n(this,this.post)),k.font_letters=m.resources.cache.get("assets/fonts/letters.fnt"),k.font_lettersi=m.resources.cache.get("assets/fonts/lettersi.fnt"),k.font_numbers=m.resources.cache.get("assets/fonts/numbers.fnt"),new g;var t=m.resources.cache.get("assets/cards.json").asset.json;k.cards=Bi.parse(t),k.card_scale=100/k.cards.frame("1").size.x;var e=m.resources.cache.get("assets/btns.json").asset.json;k.btns=Bi.parse(e),m.camera.set_size(new y(640,960)),Cs.clamp(m.camera.get_zoom(),.1,1),k.view_y=m.camera.get_pos().y,k.view_x=m.camera.get_pos().x,k.state=new gi({name:"machine"}),k.state.add(new z),k.state.add(new P),k.state.add(new S),k.state.add(new c);var i=new Dr(4);i.Add(1),i.Add(2),i.Add(3),i.GenerateList(),i.Shuffle(),m.core.inited?k.state.set("game"):m.on(2,function(){k.state.set("game")})},parcel_info:function(){return{oncomplete:n(this,this.load_complete),bytes:[{id:"assets.parcel"}]}},config:function(t){return t.preload.textures=[{id:"loading.png",load_premultiply_alpha:!0},{id:"spinner.png",load_premultiply_alpha:!0}],t},__class__:k}),Math.__name__=["Math"];var z=function(){this.sliding=!1,this.moving=!1,u.call(this,{name:"menu"}),is.defaultEase=vs.get_easeOut(),this.batch=m.renderer.create_batcher({name:"menu_batch",layer:2}),this.batch_t=m.renderer.create_batcher({name:"menu_batch_t",layer:3,camera:this.batch.view}),this.batch.emitter.on(1,function(){m.renderer.blend_mode(1,771)}),this.batch.emitter.on(2,function(){m.renderer.blend_mode()}),this.camera=new De({name:"menu camera",view:this.batch.view}),this.camera.set_size(new y(640,960)),Cs.clamp(this.camera.get_zoom(),.1,1),this.screens=new y(0,-1),this.create_top(),this.create_bottom(),this.create_scoreboard(),this.create_confirm(),this.create_particles(),this.batch.enabled=!1,this.batch_t.enabled=!1};r.Menu=z,z.__name__=["Menu"],z.texture=function(t,e){return null==e&&(e="png"),m.resources.cache.get("assets/"+t+"."+e)},z.update_score=function(t){for(var e=0,i=0,s=t.values;i<s.length;){var n=s[i];++i;var r="scoreboard_3",o=""+n,l=(new F).rgb(197379);2>=n&&(r=1==n?"scoreboard_1":"scoreboard_2",o=""),P.GetRank(n)==t.rank&&(l=P.highColor.clone()),z.score_tiles[e].set_texture(m.resources.cache.get("assets/"+r+".png")),z.score_texts[e].set_text(o),z.score_texts[e].set_color(l),z.score_texts[e].set_point_size(function(t){var e,i=o.length;return e=function(){var t;switch(i){case 3:t=41;break;case 4:t=32;break;case 5:t=26;break;default:t=56}return t}(t)}(this)),z.score_texts[e].geometry.set_dirty(!0),++e}z.score.set_text(Nr.AddCommasi(t.score))},z.__super__=u,z.prototype=i(u.prototype,{view_x:function(t){return k.view_x+t},url_click:function(t){m.io.core.app.io.module.url_open(t)},move:function(t,e){var i=this;if(!this.moving){this.moving=!0;var s=1,n=0,r=null;if(0>e)if(this.screens.x<=n)r=this.slide(t,-1,0,!0);else{r=this.slide(t,-1,0);var o=this.screens;o.set_x(o.x-1),this.title()}else if(e>0)if(this.screens.x>=s)r=this.slide(t,1,0,!0);else{r=this.slide(t,1,0);var l=this.screens;l.set_x(l.x+1),this.title()}null!=r&&r.then(function(){i.moving=!1})}},reset:function(){this.batch.enabled=!0,this.batch_t.enabled=!0,this.moving=!1,this.sliding=!1,this.camera.get_pos().set_x(k.view_x),this.screens.set_x(0),this.title(!1)},onenter:function(){this.reset(),this.slide(m.camera,0,1),this.slide(this.camera,0,1)},onleave:function(){var t=this;this.slide(m.camera,0,-1),this.slide(this.camera,0,-1).then(function(){t.batch.enabled=!1,t.batch_t.enabled=!1})},title:function(t){null==t&&(t=!0);var e=this;if(null!=this.txt_title){var i,s=this.screens.x;switch(s){case 0:i="High Score";break;case 1:i="";break;default:i="?!"}if(!t)return this.txt_title.set_text(i),void(this.txt_title.color.a=1);var n=.5;this.txt_title.color.tween(n/4,{a:0}).onComplete(function(){e.txt_title.set_text(i),e.txt_title.get_pos().set_y(896),e.txt_title.color.tween(n,{a:1}),is.tween(e.txt_title.get_pos(),n,{y:1090})})}},slide:function(t,e,i,s){null==s&&(s=!1);var n=this;return this.sliding=!0,new Un(function(r){var o,l=640,a=960,h=is.defaultEase,_=t.get_pos().x,u=t.get_pos().y;o=s?.125:.5,s&&(l*=.25,a*=.25,h=Ts.get_easeInOut());var c=t.get_pos().x+l*e,d=t.get_pos().y+a*i;is.tween(t.get_pos(),o,{x:c,y:d}).ease(h).onComplete(function(){s?is.tween(t.get_pos(),2*o,{x:_,y:u}).ease(h).onComplete(function(){n.sliding=!1,r()}):(n.sliding=!1,r())})})},onkeyup:function(t){if(!this.sliding&&!this.moving){var e=t.keycode;switch(e){case 32:case 13:var i=this.screens.x;switch(i){case 0:this.push_mainmenu();break;case 1:this.leave_menu(!0)}}}},create_confirm:function(){var t=this,e=960,i=710,s=e+240,n=500,r=160,o=new si({texture:m.resources.cache.get("assets/board.png"),name:"confirm_block",batcher:this.batch,bottom:25,right:30,depth:1,left:30,top:40});o.create(new y(i,s),n,r),new mi({no_scene:!0,name:"txt_confirm",text:"Careful!\nYou will lose all progress on\nyour current board",point_size:32,font:k.font_lettersi,sdf:!0,line_spacing:-4,color:(new F).rgb(7831180),bounds:new on(i,s+10,n,r),align:2,align_vertical:2,batcher:t.batch_t,depth:2});var l=(new mi({no_scene:!0,name:"txt_sure_title",text:"Are you sure?",point_size:48,font:k.font_lettersi,sdf:!0,color:(new F).rgb(7831180),pos:new y(960,e+128),align:2,align_vertical:2,batcher:t.batch_t,depth:4}),640),a=e,_=new pi({texture:m.resources.cache.get("assets/btns.png"),pos:new y(l+320,a+512),name:"btn_end_game",batcher:t.batch,depth:3});_.add(new h({texid:"btn_big_red_up",batcher:t.batch_t,onclick:function(){t.leave_menu(!0)},text:"END GAME"}));var u=new pi({texture:m.resources.cache.get("assets/btns.png"),pos:new y(l+320,a+e-100),name:"btn_keep_playing",batcher:t.batch,depth:3});u.add(new h({texid:"btn_big_up",batcher:t.batch_t,onclick:function(){t.move(t.camera,-1,0)},text:"KEEP PLAYING"}))},create_scoreboard:function(){z.score_texts=[],z.score_tiles=[];var t=1380,e=960,i=320;new pi({no_scene:!0,texture:m.resources.cache.get("assets/scoreboard.png"),pos:new y(i,t+2),size:new y(340,497),name:"scoreboard",batcher:this.batch,depth:1}),z.score=new mi({no_scene:!0,name:"txt_score",text:"0",point_size:72,font:k.font_numbers,sdf:!0,color:(new F).rgb(197379),pos:new y(i,e+740),align:2,align_vertical:2,batcher:this.batch_t,depth:4});for(var s=m.resources.cache.get("assets/scoreboard_3.png"),n=t-200,r=155,o=10,l=5,a=0,h=70,_=100,u=0;4>u;)for(var c=u++,d=0;4>d;){var f=d++,p=3-c,g=f*(h+o),v=p*(_+o),w=new pi({no_scene:!0,texture:s,centered:!1,pos:new y(r+o+g,n+l+v),name:"scoreboard"+p+"x"+f,batcher:this.batch,size:new y(h,_),depth:1}),x=new on(r+o+g,n+l+v,h,_),b=new mi({no_scene:!0,name:"scoreboard"+p+"x"+f+".txt",text:"",point_size:56,line_spacing:-8,font:k.font_numbers,sdf:!0,color:(new F).rgb(197379),bounds:x,align:2,align_vertical:2,batcher:this.batch_t,depth:2});a++,z.score_texts.push(b),z.score_tiles.push(w)}},create_particles:function(){z.particles=new ri({name:"particles"});var t=60,e=100,i=1,s=40,n=8,r={batcher:k.batch_t,name:"pink",cache_size:e,emit_count:i,emit_time:.009009009009009009,pos:new y(0,0),pos_random:new y(320,0),end_rotation_random:t,speed:n,direction:270,direction_random:s,start_color:(new F).rgb(6737151),end_color:(new F).rgb(16737920),start_size:new y(10,20),start_size_random:new y(4,2),end_size:new y(8,18),end_size_random:new y(2,2),gravity:new y(0,450),life:1.5,depth:3e3},o={batcher:k.batch_t,name:"blue",cache_size:e,emit_count:i,emit_time:.009009009009009009,pos:new y(0,0),pos_random:new y(320,0),end_rotation_random:t,speed:n,direction:270,direction_random:s,start_color:(new F).rgb(16737920),end_color:(new F).rgb(6737151),start_size:new y(10,20),start_size_random:new y(4,2),end_size:new y(8,18),end_size_random:new y(2,2),gravity:new y(0,450),life:1.5,depth:3e3},l=z.particles.get_pos();l.set_x(l.x+320),z.particles.add_emitter(r),z.particles.add_emitter(o),z.particles.stop()},create_bottom:function(){var t=this,e=0,i=960,s=new pi({texture:m.resources.cache.get("assets/btns.png"),pos:new y(e+320,i+960-100),name:"btn_main_menu",batcher:this.batch,depth:3});s.add(new h({texid:"btn_big_red_up",batcher:this.batch_t,onclick:function(){t.push_mainmenu()},text:"MAIN MENU"}))},push_mainmenu:function(){return P.InProgress()?void this.move(this.camera,1,0):void this.leave_menu()},leave_menu:function(t){null==t&&(t=!1),(!P.InProgress()||t)&&P.I.ShowMainMenu(),k.state.set("game")},create_top:function(){var t=this,e=0,i=960;t.back_button=new pi({texture:m.resources.cache.get("assets/btns.png"),pos:new y(e+320-250+50,i+180-85),size:new y(100,70),name:"btn_back",batcher:t.batch,depth:3}),t.back_button.add(new h({texid:"btn_back_up",batcher:t.batch_t,onclick:function(){var e=t.screens.x;switch(e){case 0:t.leave_menu()}}})),t.txt_title=new mi({no_scene:!0,name:"txt_menu_title",text:"High Score",font:k.font_lettersi,sdf:!0,point_size:56,color:(new F).rgb(7831180),pos:new y(e+320+250,i+160),align:1,align_vertical:4,batcher:t.batch_t,depth:4}),t.txt_back=new mi({no_scene:!0,name:"txt_back",text:"back",point_size:30,font:k.font_lettersi,sdf:!0,color:(new F).rgb(7831180),pos:new y(70,1116),align:0,align_vertical:2,batcher:t.batch_t,depth:4})},__class__:z});var S=function(){this.card_h=310,this.delayed=!1,u.call(this,{name:"new_card"}),this.create_new_card()};r.NewCard=S,S.__name__=["NewCard"],S.texture=function(t,e){return null==e&&(e="png"),m.resources.cache.get("assets/"+t+"."+e)},S.show=function(t,e,i){null==i&&(i=!1),null==e&&(e=.4),m.timer.schedule(e,function(){S.from_menu=!i;var e=P.GetValue(t),s=g.get("Characters_"+e+"_Name"),n=k.cards.frame(""+e);S.card.set_size(n.size),S.card.set_uv(n.uv);var r=S.card.geometry.transform.origin,o=r.ignore_listeners;r.ignore_listeners=!0,r.x=0,r._construct?r.x:(null==r.listen_x||r.ignore_listeners||r.listen_x(0),r.x),r.y=0,r._construct?r.y:(null==r.listen_y||r.ignore_listeners||r.listen_y(0),r.y),r.ignore_listeners=o,null==r.listen_x||r.ignore_listeners||r.listen_x(r.x),null==r.listen_y||r.ignore_listeners||r.listen_y(r.y),S.card.set_scale(new y(k.card_scale,k.card_scale)),S.card_shadow.set_scale(S.card.get_scale());var l=203;switch(S.timer=m.timer.schedule(1,function(){is.tween(S.card.get_pos(),.125,{y:190}).onComplete(function(){is.tween(S.card.get_pos(),.1,{y:l}).onComplete(function(){is.tween(S.card.get_pos(),.125,{y:190}).onComplete(function(){is.tween(S.card.get_pos(),.1,{y:l})})})})},!0),e){case 384:S.card.geometry.transform.origin.set_y(5/k.card_scale);break;case 768:S.card.geometry.transform.origin.set_y(15/k.card_scale);break;case 3072:S.card.geometry.transform.origin.set_x(-5/k.card_scale),S.card.geometry.transform.origin.set_y(20/k.card_scale);break;case 6144:S.card.geometry.transform.origin.set_y(15/k.card_scale)}S.card_name.set_text('"'+s+'"'),S.card_desc.set_text(g.get("Characters_"+e+"_Bio")),k.state.set("new_card"),S.from_menu?P.I.HideStartText():z.particles.start(2)})},S.HandleUpgrade=function(t){!U.IsActive()&&t>=5&&S.show(t,null,!0)},S.__super__=u,S.prototype=i(u.prototype,{onleave:function(){var t=this;is.tween(this.transform.local.pos,.4,{y:-this.card_h}).onComplete(function(){t.transform.local.pos.set_y(-t.card_h),S.activated=!1,S.card.set_visible(!1),S.footer.set_visible(!1),S.card_shadow.set_visible(!1),S.card_intro.set_visible(!1),S.card_desc.set_visible(!1),S.overlay.set_visible(!1),S.card_name.set_visible(!1),S.bg.set_visible(!1)}),is.tween(S.overlay.color,.5,{a:0}),is.tween(S.footer.color,.5,{a:0}),null!=S.timer&&S.timer.stop(),S.timer=null,S.from_menu&&(S.from_menu=!1,P.I.DoStartText())},onenter:function(){var t=this;this.delayed=!0,S.activated=!0,S.card.set_visible(!0),S.footer.set_visible(!0),S.card_shadow.set_visible(!0),S.card_intro.set_visible(!0),S.card_desc.set_visible(!0),S.overlay.set_visible(!0),S.card_name.set_visible(!0),S.bg.set_visible(!0),is.tween(this.transform.local.pos,.5,{y:480-this.card_h/2}).ease(fs.get_easeOut()),is.tween(S.overlay.color,3,{a:.5}),is.tween(S.footer.color,4,{a:1}),m.timer.schedule(.9,function(){t.delayed=!1})},onmouseup:function(){this.delayed||k.state.set("game")},onkeyup:function(){this.delayed||k.state.set("game")},create_new_card:function(){var t=this;this.transform=new gn,this.transform.local.pos.set_y(-this.card_h),this.transform.id="new_card",S.overlay=new pi({no_scene:!0,batcher:k.batch_t,centered:!1,size:new y(640,960),color:new F(1,1,1,0).rgb(16448250),depth:1999,visible:!1}),S.bg=new pi({centered:!1,batcher:k.batch_t,size:new y(640,this.card_h),color:(new F).rgb(16448250),depth:2e3,visible:!1}),S.bg.get_transform().set_parent(this.transform),S.card_shadow=new pi({no_scene:!0,batcher:k.batch_p,depth:2001,pos:new y(215,214),size:k.cards.frame("shadow").size,uv:k.cards.frame("shadow").uv,texture:m.resources.cache.get("assets/cards.png"),visible:!1});var e=203;S.card=new pi({no_scene:!0,batcher:k.batch_p,depth:2001.1,size:k.cards.frame("48").size,uv:k.cards.frame("48").uv,pos:new y(215,e),texture:m.resources.cache.get("assets/cards.png"),visible:!1}),S.card_shadow.get_transform().set_parent(t.transform),S.card.get_transform().set_parent(t.transform),S.card_intro=new mi({no_scene:!0,font:k.font_lettersi,batcher:k.batch_t,name:"new_card_intro",text:g.string.Characters_Title,color:(new F).rgb(7831180),point_size:42,sdf:!0,pos:new y(320,40),align:2,align_vertical:2,depth:2001,visible:!1}),S.card_intro.get_transform().set_parent(t.transform),S.card_name=new mi({no_scene:!0,font:k.font_lettersi,batcher:k.batch_t,name:"new_card_name",text:"",color:(new F).rgb(16737920),point_size:48,sdf:!0,pos:new y(320,90),align:2,align_vertical:2,depth:2001,visible:!1}),S.card_name.get_transform().set_parent(t.transform),S.card_desc=new mi({no_scene:!0,font:k.font_lettersi,batcher:k.batch_t,name:"new_card_desc",text:"",color:(new F).rgb(7831180),point_size:30,letter_spacing:0,line_spacing:-16,sdf:!0,bounds:new on(305,125,280,170),bounds_wrap:!0,align:0,align_vertical:3,depth:2001,visible:!1}),S.card_desc.get_transform().set_parent(t.transform),S.footer=new mi({batcher:k.batch_t,no_scene:!0,name:"new_card_footer",text:g.string.Characters_Footer,point_size:30,font:k.font_letters,sdf:!0,color:new F(1,1,1,0).rgb(16737920),pos:new y(320,928),letter_spacing:0,align:2,align_vertical:2,depth:2001,visible:!1})},__class__:S});var T=function(t,e){null==e&&(e=!1),this.id=t,this.silent=e};r.Pack=T,T.__name__=["Pack"],T.count=function(t){return f.count(t.bytes)+f.count(t.texts)+f.count(t.jsons)+f.count(t.textures)+f.count(t.sounds)+f.count(t.fonts)+f.count(t.shaders)},T.prototype={preload:function(){var t=this;return new Un(function(e,i){var s=m.resources.load_bytes(t.id);s.then(function(s){t.pack=A.uncompress_pack(new oe(new Yr(s.asset.bytes.buffer))),t.doload().then(function(){e(t.pack)}).error(i)}).error(i)})},_log:function(){!this.silent},doload:function(){var t=this;return new Un(function(e,i){t._log("queuing packed parcel: "+t.pack.id),t.preprocess_sound_meta(t.pack.sounds),t.preprocess_texture_meta(t.pack.textures),t.load(t.pack.bytes,n(t,t.create_bytes)),t.load(t.pack.texts,n(t,t.create_text)),t.load(t.pack.jsons,n(t,t.create_json)),t.load(t.pack.sounds,n(t,t.create_sound)),t.load(t.pack.shaders,n(t,t.create_shader)),t.load(t.pack.textures,n(t,t.create_texture)).then(function(){t.load(t.pack.fonts,n(t,t.create_font)),t.process_shader_meta(t.pack.shaders),e()}).error(i)})},preprocess_texture_meta:function(){},preprocess_sound_meta:function(){this.meta_sound=new de;for(var t=this.meta_content(this.pack.sounds,"sound"),e=0;e<t.length;){var i=t[e];++e,this.meta_sound.set(i.id,i)}},process_shader_meta:function(t){if(!function(e){var i,s=e.meta_id("shader");return i=null!=Xr[s]?t.existsReserved(s):t.h.hasOwnProperty(s)}(this))return void this._log("     shaders: no meta information, no shaders will be created if any were packed");var e=this.meta_content(t,"shader");this._log("process_shader_meta: "+e.length);for(var i=0;i<e.length;){var s=e[i];++i;var n,r=new fn({id:s.id,system:m.resources,vert_id:s.vert_id,frag_id:s.frag_id}),o=s.vert_id;switch(o){case"default":n=m.renderer.shaders.plain.source.vert;
break;default:n=m.resources.cache.get(s.vert_id).asset.text}var l,a=s.frag_id;switch(a){case"default":l=m.renderer.shaders.plain.source.frag;break;case"textured":l=m.renderer.shaders.textured.source.frag;break;default:l=m.resources.cache.get(s.frag_id).asset.text}r.from_string(n,l)?(m.resources.add(r),this._log("      created shader "+s.id+" / "+s.vert_id+" / "+s.frag_id)):this._log("      failed to load shader "+s.id)}},load:function(t,e){for(var i=[],s=t.keys();s.hasNext();){var n=s.next();this._log("   load "+n);var r;r=null!=Xr[n]?t.getReserved(n):t.h[n],i.push(e(n,r,r.bytes))}return 0==i.length?Un.resolve():Un.all(i)},create_font:function(t,e,i){for(var s=i.toString(),n=Mi.parse(s),r=we.directory(t),o=[],l=0,a=n.pages;l<a.length;){var h=a[l];++l;var _=we.join([r,h.file]);this._log("      looking for font texture: "+_);var u=m.resources.cache.get(_);if(null==u)throw new Ie(ei.null_assertion("tex was null ( font texture not found )"));o.push(u)}var c={id:t,system:m.resources};c.font_data=s,c.pages=o;var d=new Qs(c);return d.set_state(3),m.resources.add(d),this._log("     created font "+t),Un.resolve()},create_bytes:function(t,e,i){var s={id:t,system:m.resources};s.asset=new dr(m.core.app.assets,t,new Yr(i.b.bufferValue));var n=new Gi(s);return n.set_state(3),m.resources.add(n),this._log("     created bytes "+t),Un.resolve()},create_text:function(t,e,i){var s=i.toString(),n={id:t,system:m.resources};n.asset=new fr(m.core.app.assets,t,s);var r=new Di(n);return r.set_state(3),m.resources.add(r),this._log("     created text "+t),Un.resolve()},create_json:function(t,e,i){var s=i.toString(),n=JSON.parse(s),r={id:t,system:m.resources};r.asset=new pr(m.core.app.assets,t,n);var o=new Li(r);return o.set_state(3),m.resources.add(o),this._log("     created json "+t),Un.resolve()},create_sound:function(t,e,i){if(this.is_meta("sound",t))return this._log("   -- skip sound meta "+t),Un.resolve();var s=this.meta_sound.get(t),n=we.withoutExtension(we.withoutDirectory(t)),r=we.extension(t);null!=s&&(n=s.name);var o=0;switch(r){case"ogg":o=1;break;case"wav":o=2}var l=new Yr(i.b.bufferValue);return m.audio.create_from_bytes(n,l,o),this._log("     created sound "+t),Un.resolve()},create_texture:function(t,e,i){var s=this;return new Un(function(e,n){var r=new hn({id:t,system:m.resources});r.set_state(2),m.resources.add(r);var o=new Yr(i.b.bufferValue),l=cr.load_from_bytes(m.core.app.assets,t,o);l.then(function(i){m.utils.premultiply_alpha(i.image.pixels),r.from_asset(i),r.set_state(3),s._log("     created texture "+t),e()}).error(n)})},create_shader:function(t,e,i){return this.is_meta("shader",t)?(this._log("   -- skip shader meta "+t),Un.resolve()):this.create_text(t,e,i)},is_meta:function(t,e){return-1!=e.indexOf(this.meta_id(t))},meta_id:function(t){return"bytes"==t&&(t="byte"),"assets/"+t+"s.parcel-"+t+"s-meta"},meta_content:function(t,e){var i,s=this.meta_id(e);return i=null!=Xr[s]?t.getReserved(s):t.h[s],null==i?[]:JSON.parse(i.bytes.toString())},__class__:T};var A=function(){};r.Packer=A,A.__name__=["Packer"],A.compress_pack=function(t){var e=new ee;e.serialize(t);var i=e.toString(),s=oe.ofString(i),n=s.length;A.use_zip&&(s=xe.run(s,9));{var r=s.length;m.utils.bytes_to_string(n),m.utils.bytes_to_string(r)}return s},A.uncompress_pack=function(t){var e=t,i=t.length;A.use_zip&&(e=Ae.run(e));{var s=e.toString(),n=new se(s),r=n.unserialize(),o=e.length;m.utils.bytes_to_string(i),m.utils.bytes_to_string(o)}return r};var I=function(){};r.Reflect=I,I.__name__=["Reflect"],I.field=function(t,e){try{return t[e]}catch(i){return i instanceof Ie&&(i=i.val),null}},I.setField=function(t,e,i){t[e]=i},I.getProperty=function(t,e){var i;return null==t?null:t.__properties__&&(i=t.__properties__["get_"+e])?t[i]():t[e]},I.setProperty=function(t,e,i){var s;t.__properties__&&(s=t.__properties__["set_"+e])?t[s](i):t[e]=i},I.callMethod=function(t,e,i){return e.apply(t,i)},I.fields=function(t){var e=[];if(null!=t){var i=Object.prototype.hasOwnProperty;for(var s in t)"__id__"!=s&&"hx__closures__"!=s&&i.call(t,s)&&e.push(s)}return e},I.isFunction=function(t){return"function"==typeof t&&!(t.__name__||t.__ename__)},I.deleteField=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)?(delete t[e],!0):!1};var E=function(t,e,i){null==i&&(i=!0),this.quad_id=-1,this.coords=e,this.id=t,i&&(this.set_pos(new y),this.quad_id=P.I.slotspack.quad_add({x:-50,y:-70,w:100,h:140}),P.I.slotspack.quad_uv(this.quad_id,new on(0,0,200,280)))};r.Slot=E,E.__name__=["Slot"],E.CanMerge=function(t,e){return 0!=t.team&&0!=e.team&&t.team!=e.team?!1:t.IsThree()&&e.IsThree()?P.settings.onlyMergeSame?0==Math.abs(t.value-e.value):!0:t.type==Z.NUMBER&&e.type==Z.NUMBER&&(t.value+e.value)%3==0},E.prototype={set_pos:function(t){return null!=this.pos&&P.I.slotspack.quad_pos(this.quad_id,new y(t.x-50,t.y-70)),this.pos=t},set_vis:function(t){null!=this.pos&&P.I.slotspack.quad_color(this.quad_id,t?new F(1,1,1,1):new F(1,1,1,0))},clone:function(){var t=new E(this.id,this.coords.clone(),!1);return t.Copy(this),t},Copy:function(t){this.value=t.value,this.type=t.type,this.coords=t.coords.clone(),this.gold=t.gold,this.team=t.team,this.tile=t.tile,this.set_pos(t.pos)},Clear:function(t){null==t&&(t=!1),null!=this.tile&&t&&(this.tile.Hide(),this.tile=null),this.value=0,this.type=Z.EMPTY,this.gold=!1,this.team=0},IsEmpty:function(){return this.type==Z.EMPTY},IsThree:function(){return this.type==Z.NUMBER&&this.value>0&&this.value%3==0},texture:function(t,e){return null==e&&(e="png"),m.resources.cache.get("assets/"+t+"."+e)},__class__:E,__properties__:{set_pos:"set_pos"}};var M=function(t){this.t=0,this.inUse=!1,this.kDisappearTime=.25,this.kMoveSnap=5,this.kMoveTime=1,this.kMoveDist=65,null==M.numbers_shader&&(M.numbers_shader=m.renderer.shaders.bitmapfont.shader.clone("outlined_numbers")),this.sprite=new mi({no_scene:!0,batcher:k.batch_t,font:k.font_numbers,shader:M.numbers_shader,sdf:!0,pos:P.CoordsToWorld(t.x,t.y),point_size:56,outline:.85,outline_color:(new F).rgb(197379),color:(new F).rgb(16764006),align:2,align_vertical:2,text:"000",visible:!1,depth:99}),this.sprite.set_outline(.85)};r.Stamp=M,M.__name__=["Stamp"],M.prototype={Go:function(t,e,i){if(null==i&&(i=(new F).rgb(16764006)),this.sprite.set_pos(new y(t.x,t.y,t.z,t.w)),this.inUse=!0,e<=P.kMaxSupportedTiles+1){this.sprite.set_visible(!0),this.sprite.set_text("+"+Nr.AddCommasi(P.GetScore(P.GetValue(e))));var s=P.GetValue(e),n=(""+s).length;this.sprite.set_point_size(function(){var t;switch(n){case 3:t=40;break;case 4:t=32;break;default:t=56}return t}(this)),this.sprite.set_color(i)}else this.sprite.set_visible(!1);is.tween(this.sprite.get_pos(),this.kMoveTime,{y:this.sprite.get_pos().y-this.kMoveDist})},Fade:function(){var t=this;this.inUse&&(this.inUse=!1,this.sprite.get_outline_color().tween(this.kDisappearTime,{a:0}).onUpdate(function(){t.sprite.set_outline_color(t.sprite.get_outline_color())}),this.sprite.color.tween(this.kDisappearTime,{a:0}).onComplete(function(){t.sprite.set_pos(w.kVeryFarAway.clone()),t.sprite.set_visible(!1),t.sprite.color.a=1,t.sprite.get_outline_color().a=1,t.sprite.set_outline_color(t.sprite.get_outline_color())}))},__class__:M};var C=function(){};r.Std=C,C.__name__=["Std"],C.string=function(t){return Ee.__string_rec(t,"")},C["int"]=function(t){return 0|t},C.parseInt=function(t){var e=parseInt(t,10);return 0!=e||120!=d.cca(t,1)&&88!=d.cca(t,1)||(e=parseInt(t)),isNaN(e)?null:e},C.parseFloat=function(t){return parseFloat(t)},C.random=function(t){return 0>=t?0:Math.floor(Math.random()*t)};var R=function(){this.b=""};r.StringBuf=R,R.__name__=["StringBuf"],R.prototype={add:function(t){this.b+=C.string(t)},__class__:R};var B=function(){};r.StringTools=B,B.__name__=["StringTools"],B.isSpace=function(t,e){var i=d.cca(t,e);return i>8&&14>i||32==i},B.ltrim=function(t){for(var e=t.length,i=0;e>i&&B.isSpace(t,i);)i++;return i>0?d.substr(t,i,e-i):t},B.rtrim=function(t){for(var e=t.length,i=0;e>i&&B.isSpace(t,e-i-1);)i++;return i>0?d.substr(t,0,e-i):t},B.trim=function(t){return B.ltrim(B.rtrim(t))},B.lpad=function(t,e,i){if(e.length<=0)return t;for(;t.length<i;)t=e+t;return t},B.rpad=function(t,e,i){if(e.length<=0)return t;for(;t.length<i;)t+=e;return t},B.replace=function(t,e,i){return t.split(e).join(i)},B.fastCodeAt=function(t,e){return t.charCodeAt(e)};var F=function(t,e,i,s){null==s&&(s=1),null==i&&(i=1),null==e&&(e=1),null==t&&(t=1),this.refreshing=!1,this.is_hsv=!1,this.is_hsl=!1,this.a=1,this.b=1,this.g=1,this.r=1,this.set_r(t),this.set_g(e),this.set_b(i),this.a=s};r["phoenix.Color"]=F,F.__name__=["phoenix","Color"],F.random=function(t){return null==t&&(t=!1),new F(Math.random(),Math.random(),Math.random(),t?Math.random():1)},F.prototype={set_r:function(t){if(this.r=t,!this.refreshing)if(this.is_hsl){var e=this;e.fromColor(this)}else if(this.is_hsv){var i=this;i.fromColor(this)}return this.r},set_g:function(t){if(this.g=t,!this.refreshing)if(this.is_hsl){var e=this;e.fromColor(this)}else if(this.is_hsv){var i=this;i.fromColor(this)}return this.g},set_b:function(t){if(this.b=t,!this.refreshing)if(this.is_hsl){var e=this;e.fromColor(this)}else if(this.is_hsv){var i=this;i.fromColor(this)}return this.b},set:function(t,e,i,s){var n=this.r,r=this.g,o=this.b,l=this.a;return null!=t&&(n=t),null!=e&&(r=e),null!=i&&(o=i),null!=s&&(l=s),this.set_r(n),this.set_g(r),this.set_b(o),this.a=l,this},maxRGB:function(){return Math.max(this.r,Math.max(this.g,this.b))},minRGB:function(){return Math.min(this.r,Math.min(this.g,this.b))},tween:function(t,e,i){if(null==i&&(i=!0),null==t&&(t=.5),null!=e){var s=this.r,n=this.g,r=this.b,o=this.a,l=!1,a=!1,h=!1,_=!1;Ee.__instanceof(e,F)?(s=e.r,n=e.g,r=e.b,o=e.a,l=!0,a=!0,h=!0,_=!0):(null!=e.r&&(s=e.r,l=!0),null!=e.g&&(n=e.g,a=!0),null!=e.b&&(r=e.b,h=!0),null!=e.a&&(o=e.a,_=!0));var u={};return l&&(u.r=s),a&&(u.g=n),h&&(u.b=r),_&&(u.a=o),is.tween(this,t,u,i)}throw new Ie(" Warning: Color.tween passed a null destination ")},clone:function(){return new F(this.r,this.g,this.b,this.a)},rgb:function(t){return null==t&&(t=16777215),this.from_int(t),this},toColorHSL:function(){return(new $s).fromColor(this)},toColorHSV:function(){return(new tn).fromColor(this)},fromColorHSV:function(t){var e=t.h%360/60;0>e&&(e+=6);var i=Math.floor(e),s=i%6,n=e-i,r=t.v,o=t.v*(1-t.s),l=t.v*(1-n*t.s),a=t.v*(1-(1-n)*t.s);switch(s){case 0:this.set_r(r),this.set_g(a),this.set_b(o);break;case 1:this.set_r(l),this.set_g(r),this.set_b(o);break;case 2:this.set_r(o),this.set_g(r),this.set_b(a);break;case 3:this.set_r(o),this.set_g(l),this.set_b(r);break;case 4:this.set_r(a),this.set_g(o),this.set_b(r);break;case 5:this.set_r(r),this.set_g(o),this.set_b(l)}this.a=t.a},fromColorHSL:function(t){var e=1;e=t.l<.5?t.l*(1+t.s):t.l+t.s-t.l*t.s;for(var i=2*t.l-e,s=t.h%360/360,n=s+.3333333333333333,r=s,o=s-.3333333333333333,l=[n,r,o],a=0,h=l.length;h>a;){var _=a++,u=l[_];0>u&&(u+=1),u>1&&(u-=1),l[_]=.16666666666666666>u?i+6*(e-i)*u:.5>u?e:.6666666666666666>u?i+6*(e-i)*(.6666666666666666-u):i}return this.set_r(l[0]),this.set_g(l[1]),this.set_b(l[2]),this.a=t.a,this},toString:function(){return"{ r:"+this.r+" , g:"+this.g+" , b:"+this.b+" , a:"+this.a+" }"},from_int:function(t){var e=t>>16,i=t>>8&255,s=255&t;this.set_r(e/255),this.set_g(i/255),this.set_b(s/255)},__class__:F,__properties__:{set_b:"set_b",set_g:"set_g",set_r:"set_r"}};var P=function(){if(this.kVerbose=!1,this.moveDelayIgnore=!1,this.fleeing=!1,this.moving=!1,this.showing_credits=!1,this.forceSpecial=!1,this.stopBuilding=!1,this._count_i=0,this.numGames=0,this.rigPreview=-1,this.previewY=0,this.previewX=0,this.sliding=!1,this.hinting=!1,this.hintAppear=!1,this.lastHintTime=0,this.doHintIndex=-1,this.hintDelay=30,this.saveDataInitialized=!1,this.countFaster=!1,this.counted=!1,this.counting=!1,this.previewScale=1,this.refreshTiles=!1,null!=P.I)throw new Ie(ei.assertion("I == null"));P.settings=new Br,P.tweaks=new Fr,P.I=this,u.call(this,{name:"game"}),P.state=q.MENU,P.bottomLeft=P.CoordsToWorld(0,0),P.topRight=P.CoordsToWorld(3,3),U.I=new U,P.newCards=[],this.randomCards=new Lr(1),this.create_board(),this.create_stamps(),this.create_info(),this.create_hint(),this.create_top_menu(),this.create_main_menu(),this.create_credits(),this.InitSaveAndDevices();var t=Or["int"]("RecordRank");Or["int"]("CelebrateRank",t),P.completedTutorial=Or.bool("CompletedTutorial");var e=P.InProgress()&&P.completedTutorial,i=!0;if(e){for(var s=0;16>s;){var n=s++,r=Or["int"]("Grid"+n);if(r>0){i=!1;break}}i&&(P.SetInProgress(!1),e=!1)}if(P.completedTutorial)if(P.InProgress()){this.LoadGame();var o=Or["int"]("EndGameState");0==o&&this.topmenu(0)}else this.ShowMainMenu();else this.ShowTutorial()};r.Threes=P,P.__name__=["Threes"],P.InProgress=function(){return Or.bool("InProgress")},P.SetInProgress=function(t){Or.bool("InProgress",t)},P.SpawnTile=function(){for(var t=0,e=P.kMaxTiles;e>t;){var i=t++,s=P.I.tiles[i];if(!s.inUse)return s.inUse=!0,s.isDead=!1,P.I.refreshTiles=!0,s}throw new Ie("RAN OUT OF TILES")},P.HideTile=function(t){t.Hide()},P.GetSlotv=function(t){return P.GetSlot(t.x,t.y)},P.GetSlot=function(t,e){return P.I.grid[P.OneDee(0|t,0|e)]},P.Wrap=function(t,e){var i=new y(t.x,t.y,t.z,t.w);return P.InBounds(i.x+e.x,i.y+e.y)?i.add(e):(i.set_x(0==e.x?i.x:e.x<0?P.gridSize-1:0),i.set_y(0==e.y?i.y:e.y<0?P.gridSize-1:0),i)},P.IdToDir=function(t){switch(t){case 1:return new y(0,1);case 2:return new y(-1,0);case 3:return new y(0,-1);case 4:return new y(1,0);default:return new y(0,0)}},P.DirToId=function(t){return t.y>0?1:t.x<0?2:t.y<0?3:t.x>0?4:0},P.GetScore=function(t){var e=P.GetRank(t);return 1>e?0:C["int"](Math.pow(3,e))},P.GetRank=function(t){if(3>t)return 0;for(var e=1;t>3;)t=t/2|0,e++;return e},P.GetValue=function(t){return 3*C["int"](Math.pow(2,t-1))},P.InBounds=function(t,e){return P.disableCenter&&e>0&&e<P.gridSize-1?!1:t>=0&&t<P.gridSize&&e>=(P.shortBoard?1:0)&&e<P.gridSize},P.CoordsToWorld=function(t,e){var i=new y;i.set_x(t-.5*P.gridSize),i.set_y(e-.5*P.gridSize);var s=i;s.set_x(s.x+.5);var n=i;n.set_y(n.y+.5);var r=i;r.set_x(r.x*P.kSlotWidth);var o=i;o.set_y(o.y*P.kSlotHeight),i["int"]();P.kSlotHeight*P.kMaxGridSize;return i.set_y(-i.y),i},P.Round=function(t){var e=t%1;return.5>e?0|t:e>.5?(0|t)+1:(0|t)+((0|t)%2==1?1:0)},P.WorldToCoords=function(t){var e=new y(t.x,t.y,t.z,t.w),i=e;i.set_x(i.x/P.kSlotWidth);var s=e;s.set_y(s.y/P.kSlotHeight);var n=e;n.set_x(n.x-.5);var r=e;r.set_x(r.x+.5*P.gridSize);var o=e;return o.set_y(o.y+.5*P.gridSize),e.set_x(C["int"](P.Round(e.x))),e.set_y(C["int"](P.Round(e.y))),e},P.OneDee=function(t,e){return t+e*P.kMaxGridSize},P.OneDeev=function(t){return P.OneDee(0|t.x,0|t.y)},P.TwoDee=function(t){return new y(t%P.kMaxGridSize,Math.floor(t/P.kMaxGridSize|0))},P.__super__=u,P.prototype=i(u.prototype,{texture:function(t,e){return null==e&&(e="png"),m.resources.cache.get("assets/"+t+"."+e)},url_click:function(t){m.io.core.app.io.module.url_open(t)},onenter:function(){},onleave:function(){},InitSaveAndDevices:function(){this.saveDataInitialized=!0,P.leaderboard=new Rr("default");var t=P.leaderboard.GetHighScoreObject();null!=t&&z.update_score(t)},ShowNewCard:function(t){S.show(t)},DoHint:function(t){var e=this;if(this.lastHintTime=Nn.core.timestamp(),null==t){var i="";this.doHintIndex++,this.doHintIndex>=this.hints.length&&(this.doHintIndex=0),i=this.hints[this.doHintIndex],t=g.get(i)}this.hintAppear=!0,this.hintText.color.a=0,this.hintText.set_text(t),this.hintText.set_pos(this.hintStart.clone()),this.hinting=!0,is.tween(this.hintText.color,.4,{a:1}),is.tween(this.hintText.get_pos(),.4,{x:this.hintStart.x+50}).onComplete(function(){e.hintAppear||(e.hinting=!1),Nn.next_queue.push(function(){e.hinting=!1})})},HideHint:function(){var t=this;this.hintAppear=!1,this.hinting=!0,is.tween(this.hintText.color,.4,{a:0}).onComplete(function(){t.hintAppear&&(t.hinting=!1),Nn.next_queue.push(function(){t.hinting=!1})})},ResetPreviews:function(){this.sliding=!1,P.previewP=0,this.previewX=0,this.previewY=0},CreateNumbers:function(){this.numbers=new Dr(P.settings.kNumberRandomness),this.numbers.Add(1),this.numbers.Add(2),this.numbers.Add(3),this.numbers.GenerateList(),this.numbers.Shuffle(),this.special=new Dr(1),this.special.Add(1);for(var t=0,e=P.settings.kSpecialRareness;e>t;){{t++}this.special.Add(0)}this.special.GenerateList(),this.special.Shuffle()},StartGame:function(t){P.state=q.PLAYING,this.refresh_outline(),this.done.color.a=0,this.ResetPreviews(),this.saveResult=null;for(var e=0,i=P.kMaxGridLength;i>e;){var s=e++;this.grid[s].Clear(!0)}if(this.SetGridSize(P.settings.kStartSize),this.ShowGrid(!0),this.CreateNumbers(),P.score=0,P.highestRank=1,t){var n=P.settings.kStartSpawnNumbers;Or.string("StartTimestamp",""+(new Date).getTime());for(var r=0;n>0;){var o=this.RandomRangei(0,P.gridSize*P.gridSize),l=P.TwoDee(o),a=P.OneDee(0|l.x,0|l.y);if(this.grid[a].type==Z.EMPTY){n>0&&(this.grid[a].type=Z.NUMBER,this.grid[a].value=this.numbers.GetNext(),P.settings.multiplayer&&3==this.grid[a].value&&(this.grid[a].value=this.RandomRangei(1,3)),n--);var h=P.SpawnTile();h.SetSlot(this.grid[a],null,null,!0),h.GotoCoords(P.TwoDee(o)),h.AppearDelay(.025*r),r++}}Or["int"]("EndGameState",0),P.movesLeft=P.settings.kMaxMoves,P.numMoves=0,P.doSpawn=!0,P.noGold=!1,this.RecountScore(),this.PredictFuture(),this.AllowPause(!0)}this.refreshTiles=!0,P.doSpawn=!0,P.canMove=!0,P.noGold=!1,this.curScore=null,this.hinting=!1,this.lastHintTime=.5*-this.hintDelay,this.RefreshAll(),this.FindGold(),this.DelayMove(.5)},EndGame:function(){this.ExitGame(!1)},ExitGame:function(t){if(P.state=q.MENU,this.ShowGrid(!1),c.Unready(),t){this.SaveGameForReal();for(var e=0,i=P.kMaxGridLength;i>e;){var s=e++;this.grid[s].Clear(!0)}}else{for(var n=0,r=P.kMaxGridLength;r>n;){var o=n++;this.stamps[o].Fade()}z.particles.kill(),this.numGames++,Or["int"]("GamesSinceTutorial",Or["int"]("GamesSinceTutorial")+1),this.SaveScore()}},_count_next:function(t){var e=this;if(null!=this._count_timer&&(this._count_i--,this._count_timer.stop(),this._count_timer=null),this._count_i++,this._count_i>=P.gridLength)return void this._finish_counting();var i=this._count_slots[this._count_i];if(null==i)return void this._count_next(t);if(t)this._count_one(i),this._count_next(t);else{var s;s=this.countFaster?.02:.35,this._count_timer=m.timer.schedule(s,function(){e._count_timer=null,e._count_one(i),e._count_next(t)})}},_count_one:function(t){var e=t.tile,i=P.GetScore(t.value),s=P.GetRank(t.value);null!=t.pos&&this.stamps[this._count_i].Go(t.pos,s,e.isGold?P.highColor.clone():P.lowColor.clone()),P.score+=i,this.info.set_text(Nr.AddCommasi(P.score)),e.isGold&&s<=P.kMaxSupportedTiles?(e.Appear(),e.Bounce()):e.Flip(t.value,!0)},_finish_counting:function(){this._count_i=-1,this._count_slots=[],null!=this._count_timer&&(this._count_timer.stop(),this._count_timer=null),this.curScore=new Cr,this.curScore.score=P.score,this.curScore.rank=P.highestRank,this.curScore.values=[];for(var t=0,e=P.gridLength;e>t;){var i=t++;this.curScore.values.push(this.grid[i].value)}P.leaderboard.ReportScore(this.curScore),P.numRecords=0,P.scoreRecord=!1,P.score>P.leaderboard.GetHighScore()&&(P.scoreRecord=!0,P.numRecords++,z.particles.start()),P.highestRank>Or["int"]("RecordRank")&&(P.rankRecord=!0,P.numRecords++,Or["int"]("RecordRank",P.highestRank)),P.canMove=!0,this.DoHint(g.string.GameOver_SwipeNoSign),Or["int"]("EndGameState",2),this.counting=!1,this.info.set_text(Nr.AddCommasi(P.score))},CountScore:function(t){null==t&&(t=!1),this.DelayMove(.5),P.canMove=!1,this.counting=!0,P.score=0,this.info.set_text("0"),this.info.set_visible(!0),this.done.color.a=0,this.counted=!0,this.countFaster=!1;for(var e=-1,i=[],s=0,n=P.gridLength;n>s;){var r=s++,o=this.grid[r].clone();if(o.value>=3)i[r]=o,e=C["int"](Math.max(e,P.GetRank(i[r].value)));else{var l=o.tile;null!=l&&l.Flip(o.value,!0)}}i=N.SortSlots(i),null!=this._count_timer&&this._count_timer.stop(),this._count_timer=null,this._count_i=-1,this._count_slots=i,this._count_next(t)},ShowTutorial:function(){this.HideMainMenu(),this.showthrees(!0),P.SetInProgress(!1),this.threes_title_main_t.color.a=this.threes_title_main_h.color.a=this.threes_title_main_rees.color.a=0,U.I.Prep(!0),Or["int"]("EndGameState",0),U.I.Begin()},SaveScore:function(){this.curScore.name="High Score";var t=P.leaderboard.AddScore(this.curScore);P.SetInProgress(!1),this.info.set_text(""),this.HideHint(),t?(z.update_score(this.curScore),k.state.set("menu")):(k.state.set("game"),this.ShowMainMenu())},BuildBoard:function(){this.stopBuilding=!1,P.shortBoard=!0,this.StartGame(!1),P.doSpawn=!1,P.noGold=!0,P.canMove=!1;var t=P.leaderboard.GetHighRank();Or["int"]("CelebrateRank",t);for(var e=0,i=0,s=3,n=.075;t>e&&e<P.kMaxSupportedTiles;){P.canMove=!1;var r=P.GetSlot(i,s);if(r.IsEmpty()){r.type=Z.NUMBER,r.value=P.GetValue(e+1);var o=[P.SpawnTile()];o[0].SetSlot(r,null,null,!0),o[0].GotoCoords(r.coords),o[0].isDead=!1;var l=o[0].sprite.get_scale(),a=l.ignore_listeners;l.ignore_listeners=!0,l.x=0,l._construct?l.x:(null==l.listen_x||l.ignore_listeners||l.listen_x(0),l.x),l.y=0,l._construct?l.y:(null==l.listen_y||l.ignore_listeners||l.listen_y(0),l.y),l.ignore_listeners=a,null==l.listen_x||l.ignore_listeners||l.listen_x(l.x),null==l.listen_y||l.ignore_listeners||l.listen_y(l.y),m.timer.schedule(n*e,function(t){return function(){t[0].Appear()}}(o)),e++,e==t&&(P.noGold=!1,this.FindGold()),P.refreshPreview=!0,i++,i>=4&&(i=0,s--)}}P.canMove=!0},DoStartText:function(){("android"==m.core.app.os||"ios"==m.core.app.os?0:1)&&(this.startText.set_text("press spacebar to begin"),this.startText.color.a=0,this.startText.set_visible(!0),this.startText.set_pos(this.hintStart.clone()),is.tween(this.startText.color,.4,{a:1}),is.tween(this.startText.get_pos(),.4,{x:this.hintStart.x+50}))},HideStartText:function(){is.tween(this.startText.color,.4,{a:0})},ShowMainMenu:function(){this.HideHint(),this.DoStartText(),P.SetInProgress(!1),this.threes_title_main_t.set_visible(!0),this.threes_title_main_h.set_visible(!0),this.threes_title_main_rees.set_visible(!0),this.topmenu(1),this.main_menu_play.set_visible(!0);var t=this.main_menu_play._components.get("button",!1);t.text.set_visible(!0),this.BuildBoard()},HideMainMenu:function(){this.HideStartText(),P.shortBoard=!1,this.refresh_outline(),this.topmenu(0),this.threes_title_main_t.set_visible(!1),this.threes_title_main_h.set_visible(!1),this.threes_title_main_rees.set_visible(!1),this.main_menu_play.set_visible(!1);var t=this.main_menu_play._components.get("button",!1);t.text.set_visible(!1)},FindHighestRank:function(){for(var t=P.highestRank,e=0,i=P.kMaxGridLength;i>e;){var s=e++,n=this.grid[s];n.value>=3&&(P.highestRank=C["int"](Math.max(P.GetRank(n.value),P.highestRank)))}return P.highestRank>t},RecountScore:function(){P.score=0;for(var t=0,e=P.kMaxGridLength;e>t;){var i=t++,s=this.grid[i];s.value>=3&&(P.score+=P.GetScore(s.value))}},FindGold:function(){for(var t=0,e=0,i=P.kMaxGridLength;i>e;){var s=e++,n=this.grid[s];n.IsThree()&&n.value>=3&&(t=C["int"](Math.max(t,n.value)))}for(var r=0,o=P.kMaxGridLength;o>r;){var l=r++,a=this.grid[l];a.gold=a.IsThree()&&a.value>=3,a.gold&&a.tile.MakeGold(a.value==t&&!P.disableGold)}return t},PredictFuture:function(t){if(null==t&&(t=-1),P.doSpawn&&P.state!=q.LOST){this.futureValue=0>=t?this.GetNextValue():t,Or["int"]("NextValue",this.futureValue);for(var e=0;3>e;){var i=e++;this.preview_tiles[i].set_visible(!1),this.preview_shadows[i].set_visible(!1),this.preview_numbers[i].set_visible(!1)}if(this.futureValue<=3)this.preview_tiles[0].set_visible(this.preview_shadows[0].set_visible(!0)),this.preview_tiles[0].get_pos().set_x(320),this.preview_tiles[0].set_texture(m.resources.cache.get("assets/preview_"+this.futureValue+".png")),this.preview_numbers[0].set_visible(!1);else for(var s=P.GetRank(this.futureValue),n=Math.min(s-1,3),r=0;3>r;){var o=r++;this.preview_tiles[o].set_texture(m.resources.cache.get("assets/preview_3.png")),this.preview_tiles[o].set_visible(this.preview_shadows[o].set_visible(n>o)),this.preview_numbers[o].set_visible(this.preview_tiles[o].visible),this.preview_tiles[o].get_pos().set_x(320+(35*(n-1)-70*o));var l=Cs.clampi(s-1-o,1,P.kMaxSupportedTiles-1),a=""+P.GetValue(l+1);this.preview_numbers[o].set_text(a),this.preview_numbers[o].set_point_size(function(t){var e,i=a.length;return e=function(){var t;switch(i){case 3:t=28;break;default:t=32}return t}(t)}(this))}}},RandomRange:function(t,e){return t+Math.random()*(e-t)},RandomRangei:function(t,e){var i=e-t;return t+C.random(i)},GetNextValue:function(){if((P.numMoves>21||this.forceSpecial)&&(1==this.special.GetNext()||this.forceSpecial)){var t=C["int"](Math.max(this.GetHighestRank()-P.settings.kSpecialDemotion,0));return 2>t?this.numbers.GetNext():P.GetValue(4>t?t:this.RandomRangei(4,t+1))}return this.numbers.GetNext()},AllowPause:function(t){},RefreshAll:function(){for(var t=0,e=P.kMaxGridLength;e>t;){var i=t++,s=this.grid[i].tile;null!=s&&s.Refresh({fileName:"Threes.hx",lineNumber:1003,className:"Threes",methodName:"RefreshAll"})}},DelayMove:function(t){null==t&&(t=.05);var e=this;this.moveDelayIgnore||(this.moveDelay=!0,null!=this.move_delay_timer&&this.move_delay_timer.stop(),this.move_delay_timer=m.timer.schedule(t,function(){e.moveDelay=!1}))},refresh_outline:function(){var t,e=500,i=P.shortBoard;switch(i){case!0:t=510;break;case!1:t=670}this.outline.set_pos(new y(320,544)),this.outline.set_size(new y(e,t)),this.outline.geometry.transform.set_origin(new y(e/2,t/2+(P.shortBoard?P.kSlotHeight/2:0)))},create_top_menu:function(){var t=this;this.top_0=[],this.top_01=[],this.top_1=[],this.top_transform=new gn,this.top_transform.id="top_transform",this.top_transform.local.pos.set_x(-640);var e=m.resources.cache.get("assets/preview_bg.png"),i=new pi({no_scene:!0,origin:new y(e.width/2,e.height),pos:new y(320,161),name:"preview_bg",texture:e,depth:1}),s=m.resources.cache.get("assets/preview_3.png"),n=50,r=70;t.preview_tiles=[],t.preview_shadows=[],t.preview_numbers=[];var o=new pi({no_scene:!0,texture:s,pos:new y(320,105),size:new y(n,r),name:"preview_tile_0",depth:3,visible:!0}),l=new pi({no_scene:!0,texture:s,pos:new y(320,105),size:new y(n,r),name:"preview_tile_1",depth:3,visible:!1}),a=new pi({no_scene:!0,texture:s,pos:new y(320,105),size:new y(n,r),name:"preview_tile_2",depth:3,visible:!1});t.preview_tiles.push(o),t.preview_tiles.push(l),t.preview_tiles.push(a);var _=4,u=new mi({batcher:k.batch_t,no_scene:!0,text:"",color:new F(0,0,0,1),pos:new y(n/2,r/2-_),name:"preview_number_0",font:k.font_numbers,sdf:!0,depth:3.0001,align:2,align_vertical:2,point_size:32,parent:t.preview_tiles[0],visible:!1}),c=new mi({batcher:k.batch_t,no_scene:!0,text:"",color:new F(0,0,0,1),pos:new y(n/2,r/2-_),name:"preview_number_1",font:k.font_numbers,sdf:!0,depth:3.0001,align:2,align_vertical:2,point_size:32,parent:t.preview_tiles[1],visible:!1}),d=new mi({batcher:k.batch_t,no_scene:!0,text:"",color:new F(0,0,0,1),pos:new y(n/2,r/2-_),name:"preview_number_2",font:k.font_numbers,sdf:!0,depth:3.0001,align:2,align_vertical:2,point_size:32,parent:t.preview_tiles[2],visible:!1});t.preview_numbers.push(u),t.preview_numbers.push(c),t.preview_numbers.push(d);var f=new pi({no_scene:!0,texture:m.resources.cache.get("assets/preview_shadow.png"),pos:new y(n/2,r/2),parent:o,size:new y(60,80),name:"preview_tile_0_shadow",depth:2,visible:!0}),p=new pi({no_scene:!0,texture:m.resources.cache.get("assets/preview_shadow.png"),pos:new y(n/2,r/2),parent:l,size:new y(60,80),name:"preview_tile_1_shadow",depth:2,visible:!1}),g=new pi({no_scene:!0,texture:m.resources.cache.get("assets/preview_shadow.png"),pos:new y(n/2,r/2),parent:a,size:new y(60,80),name:"preview_tile_2_shadow",depth:2,visible:!1});t.preview_shadows.push(f),t.preview_shadows.push(p),t.preview_shadows.push(g),i.get_transform().set_parent(t.top_transform),o.get_transform().set_parent(t.top_transform),l.get_transform().set_parent(t.top_transform),a.get_transform().set_parent(t.top_transform),t.top_0.push(f),t.top_0.push(o),t.top_0.push(i);var v=960,w=new pi({texture:m.resources.cache.get("assets/btns.png"),pos:new y(v-250+50,95),size:new y(100,70),name:"btn_menu_main",depth:3}),x=new pi({texture:m.resources.cache.get("assets/btns.png"),pos:new y(v+250-50,95),size:new y(100,70),name:"btn_tut",depth:3});t.top_1.push(w),t.top_1.push(x),w.add(new h({texid:"btn_menu_up",onclick:function(){t.push_menu()}})),x.add(new h({texid:"btn_tut_up",onclick:function(){t.ShowTutorial()}})),w.get_transform().set_parent(t.top_transform),x.get_transform().set_parent(t.top_transform),v=320;var b=new pi({texture:m.resources.cache.get("assets/btns.png"),pos:new y(v-250+50,95),size:new y(100,70),name:"btn_menu",depth:3}),z=new pi({texture:m.resources.cache.get("assets/btns.png"),pos:new y(v+250-50,95),size:new y(100,70),name:"btn_credits",depth:3});b.add(new h({texid:"btn_menu_up",onclick:function(){k.state.set("menu"),t.SaveGameForReal()}})),z.add(new h({texid:"btn_menu_up",onclick:function(){t.show_credits(!0),t.move(1)}})),b.get_transform().set_parent(t.top_transform),z.get_transform().set_parent(t.top_transform),t.top_01.push(b),t.top_01.push(z);var S=960,T=30,A=new mi({batcher:k.batch_t,no_scene:!0,name:"txt_menu_main",text:"menu",point_size:T,font:k.font_lettersi,sdf:!0,color:(new F).rgb(7831180),pos:new y(S-250,156),align:0,align_vertical:2,depth:4}),I=new mi({batcher:k.batch_t,no_scene:!0,name:"txt_tutorial",text:"tutorial",font:k.font_lettersi,sdf:!0,point_size:T,color:(new F).rgb(7831180),pos:new y(S+250,156),align:1,align_vertical:2,depth:4});t.threes_title_main_t=new mi({batcher:k.batch_t,no_scene:!0,name:"txt_threes_t",text:"T",point_size:56,font:k.font_letters,sdf:!0,color:(new F).rgb(7391986),pos:new y(S-107,115),letter_spacing:4,align:0,align_vertical:2,depth:4.1}),t.threes_title_main_h=new mi({batcher:k.batch_t,no_scene:!0,name:"txt_threes_h",text:"H",point_size:56,font:k.font_letters,sdf:!0,color:(new F).rgb(15820416),pos:new y(S-74,115),letter_spacing:4,align:0,align_vertical:2,depth:4.1}),t.threes_title_main_rees=new mi({batcher:k.batch_t,no_scene:!0,name:"txt_threes_rees",text:"REES",point_size:56,font:k.font_letters,sdf:!0,color:(new F).rgb(7831180),pos:new y(S-33,115),letter_spacing:4,align:0,align_vertical:2,depth:4}),A.get_transform().set_parent(t.top_transform),I.get_transform().set_parent(t.top_transform),t.threes_title_main_t.get_transform().set_parent(t.top_transform),t.threes_title_main_h.get_transform().set_parent(t.top_transform),t.threes_title_main_rees.get_transform().set_parent(t.top_transform),t.top_1.push(A),t.top_1.push(I),t.top_1.push(t.threes_title_main_t),t.top_1.push(t.threes_title_main_h),t.top_1.push(t.threes_title_main_rees),S=320;var E=30,M=new mi({batcher:k.batch_t,no_scene:!0,name:"txt_menu",text:"menu",font:k.font_lettersi,sdf:!0,point_size:E,color:(new F).rgb(7831180),pos:new y(S-250,156),align:0,align_vertical:2,depth:4}),C=new mi({batcher:k.batch_t,no_scene:!0,name:"txt_btn_credits",text:"credits",font:k.font_lettersi,sdf:!0,point_size:E,color:(new F).rgb(7831180),pos:new y(S+250,156),align:1,align_vertical:2,depth:4}),R=new mi({batcher:k.batch_t,no_scene:!0,name:"txt_preview",text:"next",font:k.font_lettersi,sdf:!0,point_size:E,color:(new F).rgb(7831180),pos:new y(S,185),align:2,align_vertical:2,depth:4});M.get_transform().set_parent(t.top_transform),C.get_transform().set_parent(t.top_transform),R.get_transform().set_parent(t.top_transform),t.top_0.push(R),t.top_01.push(M),t.top_01.push(C)},create_info:function(){var t=0,e=0;this.done=new mi({no_scene:!0,name:"txt_menu_done",text:"",font:k.font_lettersi,sdf:!0,point_size:56,color:(new F).rgb(7831180),pos:new y(e+320+250,t+160),align:1,align_vertical:4,batcher:k.batch_t,depth:10}),this.info=new mi({no_scene:!0,name:"txt_menu_info",text:"",point_size:96,font:k.font_numbers,sdf:!0,color:(new F).rgb(197379),pos:new y(e+320,t+160),align:2,align_vertical:4,batcher:k.batch_t,depth:10})},create_stamps:function(){this.stamps=[];for(var t=0,e=P.kMaxGridLength;e>t;){var i=t++;this.stamps[i]=new M(P.TwoDee(i)),this.stamps[i].sprite.set_parent(this.outline)
}},create_hint:function(){this.hints=["Tutorial_16_Footer","Tutorial_Hint_02","Tutorial_Hint_01"],this.hintStart=new y(270,928),this.hintText=new mi({batcher:k.batch_t,no_scene:!0,name:"txt_hint",text:"",point_size:30,font:k.font_letters,sdf:!0,color:(new F).rgb(7831180),pos:this.hintStart.clone().add_xyz(50,0,0),letter_spacing:0,align:2,align_vertical:2,depth:4}),this.startText=new mi({batcher:k.batch_t,no_scene:!0,name:"txt_hint_start",text:"",point_size:30,font:k.font_lettersi,sdf:!0,color:new F(0,0,0,0).rgb(7831180),pos:this.hintStart.clone().add_xyz(50,0,0),letter_spacing:0,align:2,align_vertical:2,depth:4})},create_board:function(){var t,e=this,i=500,s=P.shortBoard;switch(s){case!0:t=510;break;case!1:t=670}this.outline=new si({no_scene:!0,texture:m.resources.cache.get("assets/board.png"),name:"board_bg",bottom:25,right:30,depth:1,left:30,top:40}),this.outline.create(new y(0,0),i,t),this.refresh_outline(),this.slotspack=new In({id:"slotspack",texture:m.resources.cache.get("assets/tile_slot.png"),batcher:m.renderer.batcher,depth:2}),this.slotspack.transform.set_parent(this.outline.get_transform()),e.grid=[],e.scratchGrid=[],e.tiles=[];for(var n=0,r=P.kMaxGridLength;r>n;){{var o=n++;e.grid[o]=new E(o,P.TwoDee(o))}e.scratchGrid[o]=new E(o,P.TwoDee(o),!1)}for(var l=0,a=P.kMaxTiles;a>l;){var h=l++,_=e.tiles[h]=new O(h);_.Hide(),_.name="Tile "+h}},push_playthrees:function(){this.HideMainMenu(),this.StartGame(!0),P.SetInProgress(!0),this.SaveGameForReal()},create_main_menu:function(){var t=0,e=0;this.main_menu_play=new pi({texture:m.resources.cache.get("assets/btns.png"),pos:new y(t+320,e+960-120),name:"btn_play",depth:3,visible:!1});var i=this.main_menu_play.add(new h({texid:"btn_big_up",batcher:k.batch_t,onclick:n(this,this.push_playthrees),text:"PLAY THREES"}));i.text.set_visible(!1)},show_credits:function(t){this.showing_credits=t,this.back_credits.set_visible(t),this.txt_back_credits.set_visible(t),this.cr_three_people.set_visible(t),this.cr_designed.set_visible(t),this.cr_illustrated.set_visible(t),this.cr_ported.set_visible(t),this.cr_three_text.set_visible(t),this.cr_designed_text0.set_visible(t),this.cr_designed_text1.set_visible(t),this.cr_illustrated_text0.set_visible(t),this.cr_illustrated_text1.set_visible(t),this.cr_ported_text0.set_visible(t),this.cr_ported_text1.set_visible(t),this.cr_title_text.set_visible(t),this.cr_btn_design_twitter.set_visible(t),this.cr_btn_design_web.set_visible(t),this.cr_btn_ill_twitter.set_visible(t),this.cr_btn_ill_web.set_visible(t),this.cr_btn_port_twitter.set_visible(t),this.cr_btn_port_web.set_visible(t)},create_credits:function(){var t=this,e=710,i=240,s=500,r=65;t.back_credits=new pi({texture:m.resources.cache.get("assets/btns.png"),pos:new y(760,95),size:new y(100,70),name:"btn_back_credits",depth:3,visible:!1}),t.back_credits.add(new h({texid:"btn_back_up",onclick:function(){t.move(0,function(){t.show_credits(!1)})}})),t.txt_back_credits=new mi({batcher:k.batch_t,no_scene:!0,name:"txt_back_credits",text:"back",font:k.font_lettersi,sdf:!0,point_size:30,color:(new F).rgb(7831180),pos:new y(710,156),align:0,align_vertical:2,depth:4,visible:!1}),t.cr_three_people=new si({no_scene:!0,texture:m.resources.cache.get("assets/board.png"),name:"three_people",bottom:25,right:30,depth:1,left:30,top:40}),t.cr_designed=new si({no_scene:!0,texture:m.resources.cache.get("assets/board.png"),name:"designed",bottom:25,right:30,depth:1,left:30,top:40}),t.cr_illustrated=new si({no_scene:!0,texture:m.resources.cache.get("assets/board.png"),name:"illustrated",bottom:25,right:30,depth:1,left:30,top:40}),t.cr_ported=new si({no_scene:!0,texture:m.resources.cache.get("assets/board.png"),name:"ported",bottom:25,right:30,depth:1,left:30,top:40}),t.cr_three_people.create(new y(e,i),s,130),t.cr_designed.create(new y(e,i+210),s,r),t.cr_illustrated.create(new y(e,i+355),s,r),t.cr_ported.create(new y(e,i+500),s,r);var o=1040,l=1160,a=0,_=480;t.cr_btn_design_twitter=new pi({texture:m.resources.cache.get("assets/btns.png"),pos:new y(o,a+_),size:new y(100,70),name:"btn_design_twitter",depth:3}),t.cr_btn_design_web=new pi({texture:m.resources.cache.get("assets/btns.png"),pos:new y(l,a+_),name:"btn_design_web",size:new y(100,70),depth:3}),t.cr_btn_design_twitter.add(new h({texid:"btn_twitter_up",onclick:function(t,e){return function(){t(e)}}(n(t,t.url_click),"https://twitter.com/AsherVo")})),t.cr_btn_design_web.add(new h({texid:"btn_web_up",onclick:function(t,e){return function(){t(e)}}(n(t,t.url_click),"http://asherv.com/")}));var u=625;t.cr_btn_ill_twitter=new pi({texture:m.resources.cache.get("assets/btns.png"),pos:new y(o,a+u),size:new y(100,70),name:"btn_illustration_twitter",depth:3}),t.cr_btn_ill_web=new pi({texture:m.resources.cache.get("assets/btns.png"),pos:new y(l,a+u),size:new y(100,70),name:"btn_illustration_web",depth:3}),t.cr_btn_ill_twitter.add(new h({texid:"btn_twitter_up",onclick:function(t,e){return function(){t(e)}}(n(t,t.url_click),"https://twitter.com/aeiowu")})),t.cr_btn_ill_web.add(new h({texid:"btn_web_up",onclick:function(t,e){return function(){t(e)}}(n(t,t.url_click),"http://aeiowu.com/")}));var c=770;t.cr_btn_port_twitter=new pi({texture:m.resources.cache.get("assets/btns.png"),pos:new y(o,a+c),size:new y(100,70),name:"btn_port_twitter",depth:3}),t.cr_btn_port_web=new pi({texture:m.resources.cache.get("assets/btns.png"),pos:new y(l,a+c),size:new y(100,70),name:"btn_port_web",depth:3}),t.cr_btn_port_twitter.add(new h({texid:"btn_twitter_up",onclick:function(t,e){return function(){t(e)}}(n(t,t.url_click),"https://twitter.com/___discovery")})),t.cr_btn_port_web.add(new h({texid:"btn_web_up",onclick:function(t,e){return function(){t(e)}}(n(t,t.url_click),"http://luxeengine.com/docs/")}));var d=10;t.cr_three_text=new mi({batcher:k.batch_t,no_scene:!0,name:"txt_credits",text:"Three people made this game.\nFind out more and follow us!",point_size:32,line_spacing:-4,font:k.font_lettersi,sdf:!0,color:(new F).rgb(7831180),bounds:new on(e,i+10,s,130),align:2,align_vertical:2,depth:2}),t.cr_designed_text0=new mi({batcher:k.batch_t,no_scene:!0,name:"txt_credits_design",text:"Asher Vollmer",point_size:32,font:k.font_lettersi,sdf:!0,color:(new F).rgb(7831180),bounds:new on(e+30,i+220,s,r),align:0,align_vertical:2,depth:2}),t.cr_designed_text1=new mi({batcher:k.batch_t,no_scene:!0,name:"txt_credits_design_title",text:"Designed by",point_size:28,font:k.font_lettersi,sdf:!0,color:(new F).rgb(11982293),pos:new y(e,i+220-d,s,r),align:0,align_vertical:4,depth:2}),t.cr_illustrated_text0=new mi({batcher:k.batch_t,no_scene:!0,name:"txt_credits_illustration",text:"Greg Wohlwend",point_size:32,font:k.font_lettersi,sdf:!0,color:(new F).rgb(7831180),bounds:new on(e+30,i+365,s,r),align:0,align_vertical:2,depth:2}),t.cr_illustrated_text1=new mi({batcher:k.batch_t,no_scene:!0,name:"txt_credits_illustration_title",text:"Illustrated by",point_size:28,font:k.font_lettersi,sdf:!0,color:(new F).rgb(11982293),pos:new y(e,i+365-d,s,r),align:0,align_vertical:4,depth:2}),t.cr_ported_text0=new mi({batcher:k.batch_t,no_scene:!0,name:"txt_credits_other",text:"Sven Bergstrom",point_size:32,font:k.font_lettersi,sdf:!0,color:(new F).rgb(7831180),bounds:new on(e+30,i+510,s,r),align:0,align_vertical:2,depth:2}),t.cr_ported_text1=new mi({batcher:k.batch_t,no_scene:!0,name:"txt_credits_other_title",text:"Port to luxe engine by",point_size:28,font:k.font_lettersi,sdf:!0,color:(new F).rgb(11982293),pos:new y(e,i+510-d,s,r),align:0,align_vertical:4,depth:2}),t.cr_title_text=new mi({batcher:k.batch_t,no_scene:!0,name:"txt_credits_title",text:"Credits",point_size:56,font:k.font_lettersi,sdf:!0,color:(new F).rgb(7831180),pos:new y(1220,160),align:1,align_vertical:4,depth:4}),this.show_credits(!1)},RigPreview:function(t){this.rigPreview=t,this.previewX=t,this.previewY=0},UnrigPreview:function(){P.previewP=this.rigPreview,this.rigPreview=-1},GetHighestRank:function(){for(var t=0,e=0,i=P.kMaxGridLength;i>e;){var s=e++,n=this.grid[s];t=C["int"](Math.max(t,P.GetRank(n.value)))}return t},CountRanks:function(t){for(var e=0,i=0,s=P.kMaxGridLength;s>i;){var n=i++,r=this.grid[n];0!=r.value&&P.GetRank(r.value)==t&&e++}return e},CountTiles:function(){for(var t=0,e=0,i=P.kMaxGridLength;i>e;){var s=e++,n=this.grid[s];0!=n.value&&t++}return t},GetSlotsWithRank:function(t){for(var e=this.CountRanks(t),i=[],s=0;e>s;){{s++}i.push(null)}for(var n=0,r=0,o=P.kMaxGridLength;o>r;){var l=r++,a=this.grid[l];0!=a.value&&P.GetRank(a.value)==t&&(i[n]=a,n++)}return i},GetRandomRankedSlot:function(){for(var t=!1,e=0,i=P.gridLength;i>e;){var s=e++;if(this.grid[s].value>=3){t=!0;break}}if(!t)return null;for(;;){var n=this.grid[this.RandomRangei(0,P.gridLength)];if(n.value>=3)return n}},GetBoard:function(){for(var t=[],e=0,i=P.gridLength;i>e;){var s=e++;t.push(this.grid[s].value)}return t},AdjacentRanks:function(t){if(this.CountRanks(t)<2)return!1;for(var e=P.GetValue(t),i=0,s=P.gridLength;s>i;){var n=i++,r=P.TwoDee(n),o=P.GetSlot(r.x,r.y);if(o.value==e){var l=new y(r.x-P.vec_right.x,r.y-P.vec_right.y);if(P.InBounds(l.x,l.y)&&P.GetSlot(l.x,l.y).value==e)return!0;var a=new y(r.x+P.vec_right.x,r.y+P.vec_right.y);if(P.InBounds(a.x,a.y)&&P.GetSlot(a.x,a.y).value==e)return!0;var h=new y(r.x-P.vec_up.x,r.y-P.vec_up.y);if(P.InBounds(h.x,h.y)&&P.GetSlot(h.x,h.y).value==e)return!0;var _=new y(r.x+P.vec_up.x,r.y+P.vec_up.y);if(P.InBounds(_.x,_.y)&&P.GetSlot(_.x,_.y).value==e)return!0}}return!1},ShowGrid:function(t){for(var e=0,i=P.kMaxGridLength;i>e;){var s=e++;this.grid[s].set_vis(t)}},SetGridSize:function(t){P.gridSize=t,P.gridLength=t*t;for(var e=0,i=P.kMaxGridSize;i>e;)for(var s=e++,n=0,r=P.kMaxGridSize;r>n;){var o=n++,l=P.OneDee(s,o);this.grid[l].set_pos(P.InBounds(s,o)?P.CoordsToWorld(s,o):w.kVeryFarAway)}},onwindowsized:function(){},move:function(t,e){var i=this;this.moving=!0;var s=640*t+k.view_x;is.tween(m.camera.get_pos(),.5,{x:s}).onComplete(function(){i.moving=!1,null!=e&&e()})},topmenu:function(t){var e=this;switch(this.top_transform.local.pos.set_y(0),t){case 0:for(var i=0,s=this.top_0;i<s.length;){var n=s[i];++i,n.set_visible(!0)}for(var r=0,o=this.top_01;r<o.length;){var l=o[r];++r,l.set_visible(!0)}break;case 1:for(var a=0,h=this.top_1;a<h.length;){var _=h[a];++a,_.set_visible(!0)}}var u=-(640*t);is.tween(this.top_transform.local.pos,.5,{x:u}).onComplete(function(){switch(t){case 0:for(var i=0,s=e.top_1;i<s.length;){var n=s[i];++i,n.set_visible(!1)}break;case 1:for(var r=0,o=e.top_0;r<o.length;){var l=o[r];++r,l.set_visible(!1)}for(var a=0,h=e.top_01;a<h.length;){var _=h[a];++a,_.set_visible(!1)}}})},showtop:function(t){for(var e=0,i=this.top_1;e<i.length;){var s=i[e];++e,s.set_visible(t)}for(var n=0,r=this.top_0;n<r.length;){var o=r[n];++n,o.set_visible(t)}for(var l=0,a=this.top_01;l<a.length;){var h=a[l];++l,h.set_visible(t)}},showthrees:function(t){this.topmenu(1),this.showtop(!1),this.threes_title_main_t.set_visible(t),this.threes_title_main_h.set_visible(t),this.threes_title_main_rees.set_visible(t)},topmenu_tut:function(){var t=this;is.tween(this.top_transform.local.pos,.5,{x:0}).onComplete(function(){t.showtop(!1),t.showthrees(!0),t.top_transform.local.pos.set_x(-640),t.threes_title_main_t.color.a=0,t.threes_title_main_h.color.a=0,t.threes_title_main_rees.color.a=0,t.fadethrees(1)})},fadethrees:function(t){null==t&&(t=0);var e=this;this.threes_title_main_t.color.tween(.4,{a:t}),this.threes_title_main_h.color.tween(.4,{a:t}),this.threes_title_main_rees.color.tween(.4,{a:t}).onComplete(function(){0==t&&(e.threes_title_main_t.color.a=1,e.threes_title_main_h.color.a=1,e.threes_title_main_rees.color.a=1,e.showthrees(!1))})},shownext:function(){this.showtop(!1);for(var t=0,e=this.top_0;t<e.length;){var i=e[t];++t,i.set_visible(!0)}var s=this.top_transform.local.pos,n=s.ignore_listeners;s.ignore_listeners=!0,s.x=0,s._construct?s.x:(null==s.listen_x||s.ignore_listeners||s.listen_x(0),s.x),s.y=-200,s._construct?s.y:(null==s.listen_y||s.ignore_listeners||s.listen_y(-200),s.y),s.ignore_listeners=n,null==s.listen_x||s.ignore_listeners||s.listen_x(s.x),null==s.listen_y||s.ignore_listeners||s.listen_y(s.y),is.tween(this.top_transform.local.pos,.5,{y:0})},shownext2:function(){for(var t=0,e=this.top_01;t<e.length;){var i=e[t];++t,i.set_visible(!0)}var s=this.top_01[0],n=this.top_01[1],r=this.top_01[2],o=this.top_01[3],l=s.get_pos().x,a=r.get_pos().x,h=n.get_pos().x,_=o.get_pos().x,u=s.get_pos();u.set_x(u.x-500);var c=r.get_pos();c.set_x(c.x-500);var d=n.get_pos();d.set_x(d.x+500);var f=o.get_pos();f.set_x(f.x+500),is.tween(s.get_pos(),.5,{x:l}),is.tween(r.get_pos(),.5,{x:a}),is.tween(n.get_pos(),.5,{x:h}),is.tween(o.get_pos(),.5,{x:_})},topmenuflee:function(t){null==t&&(t=!1);var e=this;this.fleeing||(this.fleeing=!0,t?(this.showtop(!1),this.fleeing=!1):is.tween(this.top_transform.local.pos,.5,{y:-200}).onComplete(function(){e.showtop(!1),e.fleeing=!1}))},onkeydown:function(t){if("android"==m.core.app.os||"ios"==m.core.app.os?0:1){var e=t.keycode;switch(e){case tr.from_scan($n.left):case tr.from_scan($n.right):case tr.from_scan($n.up):case tr.from_scan($n.down):case 27:case 13:case 32:P.any_key=!0}}},push_menu:function(){k.state.set("menu")},onkeyup:function(t){var e=this;if("android"==m.core.app.os||"ios"==m.core.app.os?0:1){if(!this.moving){var i=t.keycode;switch(i){case 32:case 13:var s=P.state;switch(s[1]){case 0:this.showing_credits?this.move(0,function(){e.show_credits(!1)}):U.IsActive()||(P.InProgress()?this.push_menu():this.push_playthrees())}}}P.any_key=!1}},onmouseup:function(t){if(!P.InProgress()&&!U.IsActive())for(var e=0,i=P.kMaxGridLength;i>e;){var s=e++,n=this.grid[s];if(null!=n.tile){var r=m.camera.screen_point_to_world(t.pos);n.tile.sprite.point_inside(r)&&1==t.button&&(n.tile.Flip(n.value,!1),this.HideStartText(),S.show(P.GetRank(n.value),.2))}}},onmousemove:function(){"android"==m.core.app.os||"ios"==m.core.app.os?!0:!1},leftAction:function(){return this.showing_credits?!1:-1==k.touch_dir_x?(k.touch_dir_x=0,!0):("android"==m.core.app.os||"ios"==m.core.app.os?0:1)?m.input.keypressed(tr.left):!1},upAction:function(){return this.showing_credits?!1:-1==k.touch_dir_y?(k.touch_dir_y=0,!0):("android"==m.core.app.os||"ios"==m.core.app.os?0:1)?m.input.keypressed(tr.up):!1},rightAction:function(){return this.showing_credits?!1:1==k.touch_dir_x?(k.touch_dir_x=0,!0):("android"==m.core.app.os||"ios"==m.core.app.os?0:1)?m.input.keypressed(tr.right):!1},downAction:function(){return this.showing_credits?!1:1==k.touch_dir_y?(k.touch_dir_y=0,!0):("android"==m.core.app.os||"ios"==m.core.app.os?0:1)?m.input.keypressed(tr.down):!1},update:function(t){for(var e=0,i=this.tiles;e<i.length;){var s=i[e];++e,s.update(t)}if(P.newCards.length>0||this.refreshTiles){this.randomCards.Clear();for(var n=0,r=P.kMaxGridLength;r>n;){var o=n++,l=this.grid[o];l.value<3||this.randomCards.Add(l.tile)}this.randomCards.Shuffle(),this.refreshTiles=!1}if(P.newCards=P.newCards.splice(0,P.newCards.length),P.didNope=!1,P.state!=q.HOLD){if(P.state==q.LOST){var a=P.kCycleGames||P.any_key;P.any_key=!1,a&&!this.moveDelay&&(this.counting?this.countFaster||(this.countFaster=!0,this._count_next(!1),this.DelayMove()):this.counted?(this.SetGridSize(P.settings.kStartSize),this.EndGame()):(this.moveDelayIgnore=!1,this.CountScore()))}else if(P.state==q.PLAYING){""!=this.info.get_text()&&this.info.set_text("");var h;h=P.previewP*P.tweaks.slideMod>.3&&this.saveResult.changedGrid?1.2:1,this.previewScale=Cs.lerp(this.previewScale,h,10*t),this.preview_tiles[0].set_scale(new y(this.previewScale,this.previewScale,this.previewScale)),Nn.core.timestamp()-this.lastHintTime>=this.hintDelay&&!P.shortBoard&&P.canMove&&!U.IsActive()&&!S.activated&&(Or["int"]("GamesSinceTutorial")<3||Or["int"]("RecordRank")<5)&&P.completedTutorial&&this.DoHint()}if(P.state!=q.MENU){for(var _=!1,u=new y,d=0,f=P.kMaxGridLength;f>d;){var p=d++;this.grid[p].type!=Z.EMPTY&&null==this.grid[p].tile}if(P.canMove&&!this.moveDelay||!(this.rigPreview<0)){this.leftAction()?(u.x=-1,u._construct?u.x:(null==u.listen_x||u.ignore_listeners||u.listen_x(-1),u.x),_=!0):this.rightAction()?(u.x=1,u._construct?u.x:(null==u.listen_x||u.ignore_listeners||u.listen_x(1),u.x),_=!0):this.upAction()?(u.y=1,u._construct?u.y:(null==u.listen_y||u.ignore_listeners||u.listen_y(1),u.y),_=!0):this.downAction()&&(u.y=-1,u._construct?u.y:(null==u.listen_y||u.ignore_listeners||u.listen_y(-1),u.y),_=!0);var g=!1;if(this.rigPreview>=0&&(this.previewX=this.rigPreview,this.previewY=0,_=!1),!_&&P.state!=q.LOST&&(P.previewP=Math.max(Math.abs(this.previewX),Math.abs(this.previewY)),P.previewP=Cs.clamp(P.previewP,0,1),u=new y(0,0,0),Math.abs(this.previewX)>Math.abs(this.previewY)?u.set_x(this.previewX>=0?1:-1):u.set_y(this.previewY>=0?1:-1),(null==this.saveResult||!function(t){var e,i=t.saveResult.moveDir,s=(0|i.x)==(0|u.x),n=(0|i.y)==(0|u.y);return e=s&&n}(this)||P.refreshPreview)&&(this.saveResult=this.ShiftGrid(this.grid,u,{fileName:"Threes.hx",lineNumber:2859,className:"Threes",methodName:"update"}),P.refreshPreview=!1),0!=P.previewP))for(var m=this.saveResult.clone(),v=m.totalSlots-1;v>=0;){var w=m.slots[v],x=this.grid[P.OneDeev(w.coords)],b=x.tile;null!=b&&(b.Shift(u,w.move,P.previewP*P.tweaks.slideMod,!1),g=g||w.move==j.SQUISH),v--}if(_&&(P.lastMoveDir=new y(u.x,u.y,u.z,u.w)),P.state!=q.LOST&&P.canMove&&_){for(var k=this.ShiftGrid(this.grid,u,{fileName:"Threes.hx",lineNumber:2899,className:"Threes",methodName:"update"}),z=[],T=0,A=k.totalSlots;A>T;){var I=T++,E=k.slots[I];z[I]=this.grid[P.OneDeev(E.coords)].tile}for(var M=0,R=k.totalSlots;R>M;){var B=M++,F=k.slots[B].clone(),N=this.grid[P.OneDeev(F.coords)],G=this.grid[P.OneDeev(P.Wrap(F.coords,u))];this.ApplyShift(F,N,G)}var D,L=[],O=0,H=[],V=0;D=0==u.x?1:-(0|u.x);var K;K=0==u.y?1:-(0|u.y);var Q;for(Q=u.x>0?P.gridSize-1:0;Q>=0&&Q<P.gridSize;){var X;for(X=u.y>0?P.gridSize-1:0;X>=0&&X<P.gridSize;){var W=this.grid[P.OneDee(Q,X)];if(this.IsEffectedSlot(k,W)){var Y=this.GetEffect(k,W.coords);W.tile.Shift(u,Y.move,P.previewP*P.tweaks.slideMod,!0),Y.move==j.MERGE_SQUISH&&(L[O]=W,O++),Y.move==j.SQUISH&&P.InBounds(Q+u.x,X+u.y)&&(W.value==P.validNope||W.value==2*P.validNope)&&(H[V]=W,V++)}else null!=W.tile&&W.tile.Shift(u,j.SQUISH,P.previewP*P.tweaks.slideMod,!0);X+=K}Q+=D}P.lastHighestMerge=-1;for(var J=[],$=0;O>$;){var te=$++,ee=L[te];P.lastHighestMerge=C["int"](Math.max(P.lastHighestMerge,P.GetRank(ee.value))),J[te]=P.GetRank(ee.value)}V>0&&(P.didNope=!0);var ie=this.FindHighestRank();if(ie){if(P.highestRank>Or["int"]("RecordRank")&&(Or["int"]("RecordRank",P.highestRank),P.highestRank<=P.kMaxSupportedTiles)){"Make"+P.GetValue(P.highestRank)}P.highestRank>Or["int"]("CelebrateRank")&&(Or["int"]("CelebrateRank",P.highestRank),P.highestRank<=P.kMaxSupportedTiles&&!P.shortBoard&&(this.HideHint(),S.HandleUpgrade(P.highestRank)))}else this.PlayMerge(J);var se=P.lastHighestMerge>12;if(se&&(P.doSpawn=!1,P.canMove=!1,c.LockIn()),P.lastHighestMerge==P.highestRank&&P.highestRank>1&&!se)for(var ne=this.GetGoldSlots(),re=0;re<ne.length;){var oe=ne[re];++re,oe.tile.Bounce()}if(k.changedGrid?(this.previewScale=1.4,this.DoSpawn(k)):P.doSpawn,!se){for(var le=!0,ae=1;4>=ae;){var he=this.ShiftGrid(this.grid,P.IdToDir(ae),{fileName:"Threes.hx",lineNumber:3064,className:"Threes",methodName:"update"});if(he.changedGrid||he.emptySlots>0){le=!1;break}ae++}this.FindGold();var _e=U.IsActive()&&U.allowNoSpawn;le?(P.finishTime=(new Date).getTime(),this.EndGamePreCount()):(k.changedGrid||_e)&&(P.numMoves++,P.state==q.LOST||le||this.PredictFuture(),this.SaveGameForReal())}for(var ue=0,ce=0,de=P.kMaxGridLength;de>ce;){var fe=ce++;6144==this.grid[fe].value&&ue++}ue>=2&&c.GetReady(),this.sliding=!1,this.saveResult=null,P.previewP=0,this.previewX=0,this.previewY=0,this.DelayMove(),this.SaveGameForReal(),U.IsActive()&&U.I.Update()}}}}},EndGamePreCount:function(t){null==t&&(t=!1);var e=this;this.DelayMove(1.3),P.state=q.LOST,this.counted=!1,this.moveDelayIgnore=!0,t?this.topmenuflee(!0):this.topmenuflee(),this.info.set_text(""),this.done.set_visible(!0),this.done.set_text(g.string.GameOver_Title),this.done.color.a=1;for(var i=1;6>=i;){var s=this.CountRanks(i);if(s>=8){for(var n=0,r=P.gridLength;r>n;){var o=n++;this.grid[o].tile.rank=P.GetRank(this.grid[o].value),this.grid[o].tile.MakeGold(this.grid[o].tile.rank==i,!0)}switch(z.particles.start(),i){case 1:this.done.set_text("THREELOCK!");break;case 2:this.done.set_text("SIXLOCK!");break;case 3:this.done.set_text("TWELVELOCK!");break;case 4:this.done.set_text("TWENTY-FOURLOCK!");break;case 5:this.done.set_text("FORTY-EIGHTLOCK!");break;case 6:this.done.set_text("NINETY-SIXLOCK!")}break}i++}m.timer.schedule(1,function(){e.DoHint(g.string.GameOver_SwipeScore)}),Or["int"]("EndGameState",1)},StopGame:function(){},PlayMerge:function(){},DoSpawn:function(t){var e=!1,i=P.lastMoveDir.clone();if(P.doSpawn)for(var s=this.GetEmptySlots(),n=s.length,r=this.GetSpawnSlots(i,t),o=r.length,l=0,a=P.DirToId(i)-1;l<P.spawnAmount&&n>l&&o>l;){var h=r[this.RandomRangei(0,o)];if(h.type==Z.EMPTY){var _=this.futureValue;if(_>3){var u=P.GetRank(_),c=C["int"](Math.max(2,u-P.settings.kSpecialDemotion+1));_=P.GetValue(this.RandomRangei(c,u+1))}h.type=Z.NUMBER,h.value=_,l++,e=!0;var d=P.SpawnTile();d.SetSlot(h,null,null,!0),d.GotoCoords(h.coords),d.Spawn(i),h.tile=d}else a++,a>=P.gridSize&&(a=0)}return e},SaveGame:function(){P.desireToSave=!0},SaveGameForReal:function(){if(!c.isLocked&&(P.desireToSave=!1,!U.IsActive()&&!P.shortBoard)){var t="";P.SetInProgress(!0),Or["int"](t+"NumMoves",P.numMoves);for(var e=0,i=P.gridLength;i>e;){var s=e++,n=this.grid[s];Or["int"](t+"Grid"+s,n.type==Z.EMPTY?0:n.value)}Or.psuedolist(t+"SpawnNumbers",this.numbers),Or.psuedolist(t+"SpawnSpecial",this.special)}},LoadGame:function(){this.StartGame(!1),P.numMoves=Or["int"]("NumMoves"),this.SetGridSize(4),this.ShowGrid(!0);for(var t=0,e=0,i=P.gridLength;i>e;){var s=e++,n=Or["int"]("Grid"+s);if(n>0){var r=this.grid[s];r.type=Z.NUMBER,r.value=n;var o=P.SpawnTile();o.SetSlot(r,null,null,!0),o.GotoCoords(r.coords),r.tile=o,6144==n&&t++}}t>=2&&c.GetReady(),this.PredictFuture(Or["int"]("NextValue")),this.numbers=Or.psuedolist("SpawnNumbers"),this.special=Or.psuedolist("SpawnSpecial"),this.numbers.GetList().length<3&&this.CreateNumbers(),this.FindHighestRank(),this.RecountScore(),this.RefreshAll(),this.FindGold();var l=Or["int"]("EndGameState");if(0!=l){for(var a=!1,h=!1,_=0,u=P.gridLength;u>_;){var d=_++,f=this.grid[d];a=a||0==f.value,h=h||f.value>6144}a&&!h&&(l=0,Or["int"]("EndGameState",0))}switch(l){case 0:break;case 1:this.EndGamePreCount(!0);break;case 2:P.state=q.LOST,this.topmenuflee(!0),this.CountScore(!0)}},GetEmptySlots:function(){return this.GetSlotsOfType(Z.EMPTY)},GetSlotsOfType:function(t){for(var e=0,i=[],s=0,n=P.gridLength;n>s;){{s++}i.push(new y)}for(var r=0,o=P.gridSize;o>r;)for(var l=r++,a=0,h=P.gridSize;h>a;){var _=a++;this.grid[P.OneDee(l,_)].type==t&&(i[e].set_x(l),i[e].set_y(_),e++)}for(var u=[],c=0;e>c;){var d=c++;u[d]=this.grid[P.OneDeev(i[d])]}return u},GetSpawnSlots:function(t,e){for(var i=0,s=[],n=0,r=P.gridLength;r>n;){{n++}s.push(new y)}var o=new y;if(0==t.x){o.set_y(t.y>0?0:P.gridSize-1);for(var l=0,a=P.gridSize;a>l;){var h=l++;if(null!=e){for(var _=!1,u=0,c=P.gridSize;c>u;){var d=u++;if(this.IsEffectedAndMoving(e,P.GetSlot(h,d))){_=!0;break}}if(!_)continue}o.x=h,o._construct?o.x:(null==o.listen_x||o.ignore_listeners||o.listen_x(h),o.x),s[i]=new y(o.x,o.y,o.z,o.w),i++}}else{o.set_x(t.x>0?0:P.gridSize-1);for(var f=0,p=P.gridSize;p>f;){var g=f++;if(null!=e){for(var m=!1,v=0,w=P.gridSize;w>v;){var x=v++;if(this.IsEffectedAndMoving(e,P.GetSlot(x,g))){m=!0;break}}if(!m)continue}o.y=g,o._construct?o.y:(null==o.listen_y||o.ignore_listeners||o.listen_y(g),o.y),s[i]=new y(o.x,o.y,o.z,o.w),i++}}for(var b=[],k=0;i>k;){var z=k++;b[z]=this.grid[P.OneDeev(s[z])]}return b},onrender:function(){},DisableCenter:function(t){P.disableCenter=t;for(var e=0,i=P.gridSize;i>e;)for(var s=(e++,1),n=P.gridSize-1;n>s;){s++}},GetGoldSlots:function(){for(var t=this.GetHighestRank(),e=0,i=[],s=0,n=P.gridLength;n>s;){{s++}i.push(new y)}for(var r=0,o=P.gridSize;o>r;)for(var l=r++,a=0,h=P.gridSize;h>a;){var _=a++;P.GetRank(this.grid[P.OneDee(l,_)].value)==t&&(i[e].set_x(l),i[e].set_y(_),e++)}for(var u=[],c=0;e>c;){var d=c++;u[d]=this.grid[P.OneDeev(i[d])]}return u},ShiftGrid:function(t,e){for(var i=[],s=0,n=P.gridLength;n>s;){{s++}i.push(new y)}var r,o=0;r=0|(0==e.x?1:-e.x);var l;l=0|(0==e.y?1:-e.y);var a;for(a=e.x>0?P.gridSize-1:0;a>=0&&a<P.gridSize;){var h;for(h=e.y>0?P.gridSize-1:0;h>=0&&h<P.gridSize;)i[o]=this.grid[P.OneDee(a,h)].coords.clone(),o++,h+=l;a+=r}return this._ShiftGrid(this.grid,e,i.slice())},_ShiftGrid:function(t,e,i){var s=new D;s.moveDir=new y(e.x,e.y,e.z,e.w),s.changedGrid=!1,s.slots=[];for(var n=0,r=P.kMaxGridLength+1;r>n;){{n++}s.slots.push(new G)}s.totalSlots=0,s.emptySlots=0;for(var o=0,l=P.kMaxGridLength;l>o;){var a=o++;this.scratchGrid[a].Copy(t[a])}for(var h=0,_=i.length;_>h;){var u=h++,c=this.scratchGrid[P.OneDeev(i[u])];if(!c.IsEmpty()&&!this.IsEffectedAndMoving(s,c)){for(var d=i[u].clone(),f=[],p=0,g=P.gridLength;g>p;){{p++}f.push(new y)}var m=1;for(f[0]=d;;){var v=this.scratchGrid[P.OneDeev(d)],w=this.scratchGrid[P.OneDeev(P.Wrap(d,e))];if(!P.InBounds(d.x+e.x,d.y+e.y)){for(var x=0;m>x;){var b=x++,k=this.scratchGrid[P.OneDeev(f[b])].value;this.EffectSlot(s,f[b],k,j.SQUISH),this.kVerbose}break}if(w.IsEmpty()||this.IsEffectedAndMoving(s,w)){for(var z=0;m>z;){var S=z++,T=this.scratchGrid[P.OneDeev(f[S])].value;this.EffectSlot(s,f[S],T,j.SHIFT),this.kVerbose}s.changedGrid=!0;break}if(E.CanMerge(v,w)){for(var A=0,I=m-1;I>A;){var M=A++,C=this.scratchGrid[P.OneDeev(f[M])].value;this.EffectSlot(s,f[M],C,j.SHIFT),this.kVerbose}this.EffectSlot(s,v.coords,v.value,j.MERGE_SHIFT),this.EffectSlot(s,w.coords,w.value,j.MERGE_SQUISH),this.kVerbose,s.changedGrid=!0;break}var R=!1,B=this.GetEffectIndex(s,w.coords);if(-1!=B&&(R=R||s.slots[B].move==j.SQUISH),R){for(var F=0;m>F;){var N=F++;if(-1==this.GetEffectIndex(s,f[N])){var L=this.scratchGrid[P.OneDeev(f[N])].value;this.EffectSlot(s,f[N],L,j.SQUISH),this.kVerbose}}break}if(d=P.Wrap(d,e),f[m]=d,m++,m>=P.kMaxGridLength)break}}}for(var O=0,U=P.gridLength;U>O;){var H=O++;s.emptySlots+=this.scratchGrid[H].IsEmpty()?1:0}for(var V=[],q=0,Z=P.kMaxGridLength;Z>q;){{q++}V.push(new G)}var K,Q=0;K=0==e.x?1:-(0|e.x);var X;X=0==e.y?1:-(0|e.y);var W;for(W=e.x>0?P.gridSize-1:0;W>=0&&W<P.gridSize;){var Y;for(Y=e.y>0?P.gridSize-1:0;Y>=0&&Y<P.gridSize;){for(var J=0,$=s.totalSlots;$>J;){var te=J++,ee=s.slots[te];(0|ee.coords.x)==W&&(0|ee.coords.y)==Y&&(this.kVerbose,V[Q]=s.slots[te],Q++)}Y+=X}W+=K}return s.slots=V.slice(),s},EffectSlot:function(t,e,i,s){var n=t.slots[t.totalSlots].clone();n.coords=new y(e.x,e.y,e.z,e.w),n.move=s,n.value=i;var r=this.GetEffectIndex(t,e);r>=0&&s==j.SQUISH||(t.slots[r>=0?r:t.totalSlots]=n,t.totalSlots+=r>=0?0:1,s!=j.SQUISH&&s!=j.MERGE_SQUISH&&(this.scratchGrid[P.OneDeev(e)].type=Z.EMPTY,this.scratchGrid[P.OneDeev(e)].value=0))},IsEffectedSlot:function(t,e){return-1!=this.GetEffectIndex(t,e.coords)},IsEffectedAndMoving:function(t,e){var i=this.GetEffectIndex(t,e.coords);return-1==i?!1:t.slots[i].move!=j.SQUISH&&t.slots[i].move!=j.MERGE_SQUISH},GetEffect:function(t,e){var i=this.GetEffectIndex(t,e);return t.slots[i]},GetEffectIndex:function(t,e){for(var i=0,s=t.totalSlots;s>i;){var n=i++;if((0|t.slots[n].coords.x)==(0|e.x)&&(0|t.slots[n].coords.y)==(0|e.y))return n}return-1},ApplyShift:function(t,e,i){var s=!1;return(t.move==j.SHIFT||t.move==j.MERGE_SHIFT)&&(i.type==Z.EMPTY?(i.type=e.type,i.value=e.value):E.CanMerge(e,i)&&(i.value=i.value>=3&&e.value>=3?i.value+e.value:3,s=!0),e.Clear()),s},__class__:P});var N=function(){};r.Hack=N,N.__name__=["Hack"],N.SortSlots=function(t){return t.sort(function(t,e){return null==t?1:null==e?-1:null!=t.tile&&t.tile.isGold?1:null!=e.tile&&e.tile.isGold?-1:t.value<e.value?-1:t.value>e.value?1:0}),t};var G=function(){this.coords=new y,this.move=j.SHIFT,this.value=0};r.SlotEffect=G,G.__name__=["SlotEffect"],G.prototype={clone:function(){var t=new G;return t.coords=this.coords.clone(),t.move=this.move,t.value=this.value,t},__class__:G};var D=function(){};r.ShiftResult=D,D.__name__=["ShiftResult"],D.MoveToInt=function(t){switch(t[1]){case 0:return 0;case 1:return 1;case 2:return 2;case 3:return 3}},D.IntToMove=function(t){switch(t){case 1:return j.SQUISH;case 2:return j.MERGE_SHIFT;case 3:return j.MERGE_SQUISH;default:return j.SHIFT}},D.Load=function(t){if(!Or.bool(t+"Exists"))return null;var e=new D;e.moveDir=new y(Or["int"](t+"MoveDirX"),Or["int"](t+"MoveDirY")),e.totalSlots=Or["int"](t+"TotalSlots"),e.emptySlots=Or["int"](t+"EmptySlots"),e.changedGrid=Or.bool(t+"ChangedGrid"),e.slots=[];for(var i=0,s=e.totalSlots;s>i;){{i++}e.slots.push(new G)}for(var n=0,r=e.totalSlots;r>n;){var o=n++;e.slots[o]=new G,e.slots[o].coords=new y(Or["int"](t+"Slot"+o+"CoordsX"),Or["int"](t+"Slot"+o+"CoordsY")),e.slots[o].move=D.IntToMove(Or["int"](t+"Slot"+o+"Move")),e.slots[o].value=Or["int"](t+"Slot"+o+"Value")}return e},D.Clear=function(t){Or.bool(t+"Exists",!1)},D.prototype={clone:function(){var t=new D;t.moveDir=this.moveDir.clone(),t.slots=[];for(var e=0,i=this.slots.length;i>e;){var s=e++;t.slots[s]=this.slots[s].clone()}return t.totalSlots=this.totalSlots,t.emptySlots=this.emptySlots,t.changedGrid=this.changedGrid,t},Save:function(t){Or.bool(t+"Exists",!0),Or["int"](t+"MoveDirX",0|this.moveDir.x),Or["int"](t+"MoveDirY",0|this.moveDir.y),Or["int"](t+"TotalSlots",this.totalSlots),Or["int"](t+"EmptySlots",this.emptySlots),Or.bool(t+"ChangedGrid",this.changedGrid);for(var e=0,i=this.totalSlots;i>e;){var s=e++;Or["int"](t+"Slot"+s+"CoordsX",0|this.slots[s].coords.x),Or["int"](t+"Slot"+s+"CoordsY",0|this.slots[s].coords.y),Or["int"](t+"Slot"+s+"Move",D.MoveToInt(this.slots[s].move)),Or["int"](t+"Slot"+s+"Value",this.slots[s].value)}},__class__:D};var L=function(){this.tileDrop=6,this.squishScale=.95,this.squishDistInternal=5,this.squishDistRank=6,this.exitDistV=1e3,this.exitDistH=600,this.exitDist=200,this.holeTime=.025,this.moveTime=.125,this.appearTime=.25,this.bounceAmnt=1.15,this.bounceDownTime=.05,this.bounceUpTime=.15,this.bounceHeight=20};r["_Tile.TileTweak"]=L,L.__name__=["_Tile","TileTweak"],L.prototype={__class__:L};var O=function(t){this.bouncing=!1,this.flipTime=.05,this.burnt=!1,this.nonrank=0,this.oldV=-1,this.scale=1,this.faceHeight=40,this.flipping=!1,this.endingPiece=!1,this.isDead=!1,this.isGold=!1,this.artTile=!0,this.rank=0,this.counting=!1,this.useHoleLogic=!1,this.shrinkOnMove=!1,this.hideAfterMove=!1,this.inUse=!1,this.id=0,this.kFrontArmDepth=-90,this.kBackArmDepth=5,this.kShadowDepth=10,this.kDepth=-20,this.name="Tile",this.tweaks=new L,this.slot=null,this.id=t,this.name="Tile"+this.id,this.scale=k.card_scale,this.sprite=new pi({no_scene:!0,name:this.name,texture:m.resources.cache.get("assets/cards.png"),centered:!0,depth:10,scale:new y(this.scale,this.scale),size:k.cards.frame("1").size,uv:k.cards.frame("1").uv,parent:P.I.outline});var e=k.cards.frame("shadow");this.shadow=new pi({no_scene:!0,name:""+this.name+".shadow",texture:m.resources.cache.get("assets/cards.png"),size:e.size,uv:e.uv,parent:this.sprite,depth:9})};r.Tile=O,O.__name__=["Tile"],O.prototype={render:function(){this.inUse&&!this.sprite.visible},update:function(t){if(this.inUse&&this.moveTimeLeft>0){var e=.5*this.tweaks.moveTime;if(this.moveTimeLeft-=t,this.moveTimeLeft=Cs.clamp(this.moveTimeLeft,0,this.tweaks.moveTime),this.moveType==j.MERGE_SHIFT&&this.moveTimeLeft<e)this.Move(this.moveType,1,O.kNonCoord,this.moveTo,null!=this.slot,!1),this.Flip(this.slot.value),this.moveTimeLeft=0;else if(this.moveType==j.MERGE_SQUISH&&this.moveTimeLeft<e)this.Hide(),this.moveTimeLeft=0;else{var i=Cs.clamp(1-this.moveTimeLeft/this.tweaks.moveTime,0,1);this.Move(this.moveType,i,O.kNonCoord,this.moveTo,null!=this.slot,!1)}}},SetPosition:function(t){var e=new y(t.x,t.y,t.z,t.w);this.sprite.set_depth(this.GetDepth(e)),this.sprite.set_pos(e),this.shadow.set_depth(this.sprite.depth-.001)},StartCount:function(t,e){this.counting=!0,this.countAt=t,this.countGoal=e
},GotoCoords:function(t){this.SetPosition(P.CoordsToWorld(t.x,t.y))},SetSlot:function(t,e,i,s){null==s&&(s=!1),null==e&&(e=0),null==i&&(i=Z.EMPTY),null!=this.slot&&this.slot.tile==this&&(this.slot.tile=null),null!=t.tile&&(t.tile!=this&&t.tile.Shrink(),t.tile=null),this.slot=t,this.counting=!1;var n=Z.EMPTY,r=0;null!=this.slot?(r=this.slot.value,n=this.slot.type,this.slot.tile=this):0!=e&&(r=e,n=i==Z.EMPTY?Z.NUMBER:i),n==Z.NUMBER&&(this.SetValue(r),s&&this.SetSprite())},Refresh:function(){null!=this.slot&&this.SetSlot(this.slot)},MakeGold:function(t,e){null==e&&(e=!1),this.isGold=t&&!P.noGold&&(this.rank>1||e)},GetDepth:function(t){var e=this.kDepth+Nr.Delerp(P.bottomLeft.x,P.topRight.x,t.x)+20*Nr.Delerp(P.bottomLeft.y,P.topRight.y,t.y)-this.rank;return null!=this.slot&&(e+=P.OneDee(0|this.slot.coords.x,0|this.slot.coords.y)),this.endingPiece&&(e+=4e3),e=10+Math.abs(e)},HideVisual:function(){this.sprite.set_visible(this.shadow.set_visible(!1))},UnhideVisual:function(){this.sprite.set_visible(this.shadow.set_visible(!0))},Hide:function(){this.inUse=!1,this.SetPosition(w.kVeryFarAway),this.sprite.set_scale(new y(this.scale,this.scale,this.scale)),this.hideAfterMove=!1,this.shrinkOnMove=!1,this.useHoleLogic=!1,this.SetAlpha(1),this.moveTimeLeft=0,this.moveType=j.SQUISH,this.moveTo=O.kNonCoord,this.endingPiece=!1},Unhide:function(){this.sprite.set_scale(new y(this.scale,this.scale,this.scale))},SetAlpha:function(){},Shift:function(t,e,i,s){var n=this.slot,r=this.slot;this.moveDir=t;var o=e==j.MERGE_SQUISH||e==j.MERGE_SHIFT,l=e==j.SQUISH||e==j.SHIFT||e==j.MERGE_SHIFT;e!=j.SQUISH&&e!=j.MERGE_SQUISH&&(r=P.GetSlotv(P.Wrap(n.coords,t))),s?(this.moveTimeLeft=this.tweaks.moveTime,this.moveType=e,this.moveTo=r.coords.clone(),n.tile=null,this.slot=null,this.bouncing&&(null!=this.bounce_timer&&this.bounce_timer.stop(),this.bounce_timer=null,this.bouncing=!1,null!=this.slot&&this.SetPosition(P.CoordsToWorld(this.slot.coords.x,this.slot.coords.y))),l&&(this.slot=r,this.slot.tile=this,o||this.Refresh({fileName:"Tile.hx",lineNumber:397,className:"Tile",methodName:"Shift"}))):this.Move(e,i,n.coords,r.coords,l,!0)},RefreshTexture:function(){var t;t=this.isDead?".dead":"";var e=""+this.slot.value+t;if(12288==this.slot.value&&(e="6144.dead"),0==this.slot.value)throw new Ie(ei.assertion("slot.value != 0"));if(null==this.sprite)throw new Ie(ei.null_assertion("sprite was null"));var i=k.cards.frame(e);this.sprite.set_uv(i.uv),this.sprite.set_size(i.size),this.sprite.set_origin(new y(this.sprite.size.x/2,this.sprite.size.y/2)),this.sprite.geometry.transform.origin.set_x(0),this.sprite.geometry.transform.origin.set_y(0);var s=this.slot.value;switch(s){case 384:this.sprite.geometry.transform.origin.set_y(5/this.scale);break;case 768:this.sprite.geometry.transform.origin.set_y(15/this.scale);break;case 3072:this.sprite.geometry.transform.origin.set_x(-5/this.scale),this.sprite.geometry.transform.origin.set_y(20/this.scale);break;case 6144:this.sprite.geometry.transform.origin.set_y(15/this.scale);break;case 12288:this.sprite.geometry.transform.origin.set_y(20/this.scale)}this.shadow.set_pos(this.sprite.size.clone().divideScalar(2).add_xyz(0,10/this.scale,null))},SetSprite:function(){null!=this.slot&&-1!=d.indexOf(O.valid,this.slot.value,0)&&this.RefreshTexture()},SetValue:function(t){t!=this.oldV&&(1==t?(this.rank=0,this.nonrank=1,this.isGold=!1):2==t?(this.rank=0,this.nonrank=2,this.isGold=!1):(this.rank=P.GetRank(t),this.nonrank=0,this.rank>P.kMaxSupportedTiles),this.oldV=t)},AppearDelay:function(t){m.timer.schedule(t,function(t,e){return function(){t(e)}}(n(this,this.Appear),1))},Appear:function(t){null==t&&(t=1);var e=this;if(this.inUse){this.sprite.set_visible(!0),this.shadow.set_visible(!0),null!=this.appear_timer&&this.appear_timer.stop(),this.appear_timer=null;var i=0,s=.016666666666666666*m.core.timescale;this.appear_timer=m.timer.schedule(s,function(){if(!e.inUse)return null!=e.appear_timer&&e.appear_timer.stop(),void(e.appear_timer=null);if(i<e.tweaks.appearTime){i+=s;var n=Cs.clamp(i/e.tweaks.appearTime,0,1),r=Nr.Blerp(0,1,n,0,e.tweaks.bounceAmnt,0,.7);e.sprite.set_scale(new y(r,r,r).multiplyScalar(t).multiplyScalar(e.scale))}else e.sprite.set_scale(new y(t,t,t).multiplyScalar(e.scale)),e.appear_timer.stop(),e.appear_timer=null},!0)}},Shrink:function(){var t=this;null!=this.shrink_timer&&this.shrink_timer.stop(),this.shrink_timer=null,this.shadow.set_pos(w.kVeryFarAway);var e=.1,i=0,s=.016666666666666666*m.core.timescale;this.shrink_timer=m.timer.schedule(s,function(){if(!t.inUse)return null!=t.shrink_timer&&t.shrink_timer.stop(),void(t.shrink_timer=null);if(e>i){i+=s;var n=1-Math.sin(Cs.clamp(i/e,0,1)*Math.PI*.5);t.sprite.get_scale().set_x(n*t.scale),t.sprite.get_scale().set_y(n*t.scale)}else P.HideTile(t),null!=t.shrink_timer&&t.shrink_timer.stop(),t.shrink_timer=null},!0)},viewport_pos:function(t){var e=m.camera.world_point_to_screen(t);return e.add_xyz(k.view_x,k.view_y,null),e},Spawn:function(t,e){null==e&&(e=!1);var i=this;null!=this.spawn_timer&&this.spawn_timer.stop(),this.spawn_timer=null;var s=P.CoordsToWorld(this.slot.coords.x,this.slot.coords.y),n=new y(t.x,t.y,t.z,t.w).multiplyScalar(this.tweaks.exitDist);n.set_y(0-n.y);for(var r=new y(s.x,s.y,s.z,s.w).subtract(n),o=0,l=this.viewport_pos(r),a=0-.1*m.core.screen.get_w(),h=m.core.screen.get_w()+.2*m.core.screen.get_w(),_=0-.1*m.core.screen.get_h(),u=m.core.screen.get_h()+.2*m.core.screen.get_h();l.x>a&&l.x<h&&l.y>_&&l.y<u;){var c=r;c.set_x(c.x-t.x*this.tweaks.exitDist);var d=r;if(d.set_y(d.y+t.y*this.tweaks.exitDist),l=this.viewport_pos(r),++o>10)break}this.Unhide();var f=.92;if(e){var p=s;s=r,r=p,f=1-f}this.SetPosition(r),this.sprite.set_scale(new y(this.scale,this.scale,this.scale));var g=0,v=.016666666666666666*m.core.timescale;this.spawn_timer=m.timer.schedule(v,function(){if(g<i.tweaks.moveTime){i.inUse||(null!=i.spawn_timer&&i.spawn_timer.stop(),i.spawn_timer=null),g+=v;var t,n=Cs.clamp(g/i.tweaks.moveTime,0,1);t=f>n&&!e||n>f&&e?new y(0,i.tweaks.tileDrop,0):new y(0,0,0),i.SetPosition(new y(r.x,r.y,r.z,r.w).lerp(s,n).subtract(t))}else e&&P.HideTile(i),i.sprite.set_scale(new y(i.scale,i.scale,i.scale)),null!=i.spawn_timer&&i.spawn_timer.stop(),i.spawn_timer=null},!0)},Flip:function(t,e){null==e&&(e=!1);var i=this;this.endingPiece&&(c.Begin(),this.endingPiece=!1,this.burnt=!0,this.SetPosition(P.CoordsToWorld(this.slot.coords.x,this.slot.coords.y)),this.sprite.set_depth(999)),null!=this.flip_timer&&this.flip_timer.stop(),this.flip_timer=null,this.flipping=!0;var s=0,n=.016666666666666666*m.core.timescale,r=0;this.flip_timer=m.timer.schedule(n,function(){if(i.inUse||(null!=i.flip_timer&&i.flip_timer.stop(),i.flip_timer=null),0==r)if(s<i.flipTime){s+=n;var o=Cs.smoothstep(s/i.flipTime,0,1);i.sprite.get_scale().set_x((1-o)*i.scale)}else r++;else if(1==r)s=0,i.isDead=e,i.oldV=-1,i.SetValue(t),i.SetSprite(),P.noGold||i.isDead||i.MakeGold(P.I.GetHighestRank()==P.GetRank(t)),i.isDead||P.newCards.push(i),r++;else if(2==r)if(s<i.flipTime){s+=n;var l=Cs.smoothstep(s/i.flipTime,0,1);i.sprite.get_scale().set_x(l*i.scale)}else r++;else i.flipping=!1,null!=i.flip_timer&&i.flip_timer.stop(),i.flip_timer=null},!0)},Move:function(t,e,i,s,n,r){var o=e>=1,l=t==j.MERGE_SQUISH||t==j.MERGE_SHIFT;if(t==j.SQUISH&&r){if(i!=O.kNonCoord){var a=.5*Math.PI,h=1-Math.sin(a+e*a);if(t!=j.MERGE_SQUISH){var _=this.sprite.get_scale();0!=this.moveDir.x?(_.set_x(Cs.lerp(1,this.tweaks.squishScale,h)),_.set_y(Cs.lerp(1,Cs.lerp(1,1/this.tweaks.squishScale,.5),h))):(_.set_x(Cs.lerp(1,Cs.lerp(1,1/this.tweaks.squishScale,.5),h)),_.set_y(Cs.lerp(1,this.tweaks.squishScale,h))),this.sprite.set_scale(new y(1,1,1).lerp(new y(1/_.x,1/_.y,1),h));var u;u=this.rank>P.kMaxSupportedTiles?.5:1;var c=P.GetSlotv(i).pos.clone(),d=new y(c.x,c.y,c.z,c.w).add(this.moveDir).multiplyScalar(this.tweaks.squishDistInternal);this.SetPosition(new y(c.x,c.y,c.z,c.w).lerp(d,h))}}}else if(s!=O.kNonCoord){var f,p=t==j.MERGE_SQUISH,g=this.moveDir.clone().multiplyScalar(p?-1:1),m=Math.abs(g.x)>Math.abs(g.y);f=i!=O.kNonCoord?P.GetSlotv(i).pos:this.sprite.get_pos(),f=new y(f.x,f.y,f.z,f.w);var v=P.GetSlotv(s).pos;if(v=new y(v.x,v.y,v.z,v.w),l&&r)if(0==this.rank)if(m){var w=P.kSlotWidth;v.add(this.moveDir.clone().multiplyScalar(.075*w*e)),e=Math.min(e,.95)}else e=Math.min(e,.925),v.add(this.moveDir.clone().multiplyScalar(12.5*e));else if(m){var x=P.kSlotWidth;v.add(this.moveDir.clone().multiplyScalar(.075*x*e)),e=Math.min(e,.95)}else g.y<0&&v.add(new y(0,1,0).multiplyScalar(.5*this.faceHeight*e));var b=new y(f.x,f.y,f.z,f.w).lerp(v,e);this.SetPosition(b),this.sprite.set_scale(this.sprite.get_scale().clone().lerp(new y(this.scale,this.scale,this.scale),e)),l&&0!=this.rank?g.y<0?(this.sprite.set_depth(this.GetDepth(new y(f.x,f.y,f.z,f.w).subtract(new y(1,1,1).multiplyScalar(2*P.kSlotHeight)))),this.shadow.set_depth(this.sprite.depth-.001)):0==g.y&&t==j.MERGE_SHIFT&&(this.sprite.set_depth(this.GetDepth(new y(f.x,f.y,f.z,f.w).subtract(new y(1,1,1).multiplyScalar(2*P.kSlotHeight)))),this.shadow.set_depth(this.sprite.depth-.001)):l&&0==this.rank&&n&&!this.flipping}this.endingPiece=12==this.rank&&(t==j.MERGE_SQUISH||t==j.MERGE_SHIFT),this.endingPiece,o&&!r&&(n?l||this.Refresh({fileName:"Tile.hx",lineNumber:1058,className:"Tile",methodName:"Move"}):this.Hide())},cancel_bounce:function(){this.bouncing&&(null!=this.bounce_timer&&this.bounce_timer.stop(),this.bounce_timer=null,this.bouncing=!1,null!=this.slot&&this.SetPosition(P.CoordsToWorld(this.slot.coords.x,this.slot.coords.y)))},Bounce:function(){var t=this;if(this.inUse&&!this.bouncing&&!c.isLocked){var e=0;null!=this.bounce_timer&&this.bounce_timer.stop(),this.bounce_timer=null;var i=.1+.3*Math.random(),s=.016666666666666666*m.core.timescale,n=!0,r=0,o=this.tweaks.bounceHeight/this.tweaks.bounceUpTime,l=this.tweaks.bounceHeight/this.tweaks.bounceDownTime;this.bouncing=!0,m.timer.schedule(i,function(){t.bounce_timer=m.timer.schedule(s,function(){if(!t.inUse||!t.bouncing)return void(t.bouncing&&(null!=t.bounce_timer&&t.bounce_timer.stop(),t.bounce_timer=null,t.bouncing=!1,null!=t.slot&&t.SetPosition(P.CoordsToWorld(t.slot.coords.x,t.slot.coords.y))));if(t.sprite.depth<1e3){var i=t.sprite;i.set_depth(i.depth+1e3)}if(n){var a=o*s,h=t.sprite.get_pos();h.set_y(h.y-a),e+=a,e>=t.tweaks.bounceHeight&&(e=0,n=!1,r++)}else{var _=l*s,u=t.sprite.get_pos();u.set_y(u.y+_),e+=_,e>=t.tweaks.bounceHeight&&(e=0,n=!0,r++)}r>=4&&t.bouncing&&(null!=t.bounce_timer&&t.bounce_timer.stop(),t.bounce_timer=null,t.bouncing=!1,null!=t.slot&&t.SetPosition(P.CoordsToWorld(t.slot.coords.x,t.slot.coords.y)))},!0)})}},__class__:O};var U=function(){this.numMoves=0,this.equation=0,this.numNopes=0,this.textDisappearTime=.25,this.botAppearTime=1,this.botAppearDelay=.5,this.topAppearTime=1,this.lastNumMoves=0,this.numMovesTilNext=-1,this.onTutorial=0,this.create_texts(),this.create_walls()};r.Tutorial=U,U.__name__=["Tutorial"],U.IsActive=function(){return U.isActive},U.prototype={texture:function(t,e){return null==e&&(e="png"),m.resources.cache.get("assets/"+t+"."+e)},create_walls:function(){var t=520,e=680;this.walls=new si({no_scene:!0,texture:m.resources.cache.get("assets/walls.png"),name:"walls",bottom:40,right:40,depth:1,left:40,top:40}),this.walls.create(new y(60,200),t,e),this.walltext=[new mi({batcher:k.batch_t,no_scene:!0,name:"walls_txt_left",text:g.string.Tutorial_05_Wall,point_size:30,font:k.font_letters,sdf:!0,color:(new F).rgb(16737920),pos:new y(65,535),letter_spacing:0,align:1,align_vertical:4,depth:4}),new mi({batcher:k.batch_t,no_scene:!0,name:"walls_txt_right",text:g.string.Tutorial_05_Wall,point_size:30,font:k.font_letters,sdf:!0,color:(new F).rgb(16737920),pos:new y(575,535),letter_spacing:0,align:1,align_vertical:4,depth:4})],this.walltext[0].set_rotation((new nn).setFromEuler(new y(0,0,-90).radians())),this.walltext[1].set_rotation((new nn).setFromEuler(new y(0,0,90).radians())),this.showwalls(!1)},showwalls:function(t){this.walls.set_visible(t);for(var e=0,i=this.walltext;e<i.length;){var s=i[e];++e,s.set_visible(t)}},create_texts:function(){this.align=2;var t=30,e=new on(t,0,640-2*t,210);this.topText=new mi({no_scene:!0,name:"tutorial_top",text:"",font:k.font_lettersi,sdf:!0,point_size:56,color:this.gray,bounds:e,bounds_wrap:!0,letter_spacing:-.5,line_spacing:-20,align:2,align_vertical:2,batcher:k.batch_t,depth:4}),this.topNum=new mi({no_scene:!0,name:"tutorial_top_num",text:"",font:k.font_numbers,sdf:!0,point_size:56,color:this.gray,bounds:e,bounds_wrap:!0,line_spacing:-20,align:2,align_vertical:2,batcher:k.batch_t,depth:4}),this.bottomText=new mi({batcher:k.batch_t,no_scene:!0,name:"tutorial_bottom",text:"",point_size:30,font:k.font_letters,sdf:!0,color:(new F).rgb(7831180),pos:new y(320,928),letter_spacing:0,align:2,align_vertical:2,depth:4})},Prep:function(t){null==t&&(t=!1),this.firstRun=t,this.red=(new F).rgb(16737920),this.blue=(new F).rgb(7391986),this.gray=(new F).rgb(7831180),P.I.StartGame(!1),P.doSpawn=!1,P.canMove=!1,P.noGold=!0,this.onTutorial=-1;var e="Tutorial_01_Footer",i="Tutorial_02_Footer";("android"==m.core.app.os||"ios"==m.core.app.os?0:1)||(e+="M",i+="M"),this.parts=[{name:"010Welcome",bottom:e},{name:"020OneTwo",top:"Tutorial_02_Header",bottom:i},{name:"030Swiping",top:"Tutorial_03_Header"},{name:"040Rearrange",top:"Tutorial_04_Header"},{name:"050Add",top:"Tutorial_05_Header"},{name:"060Auspicious",top:"Tutorial_06_Header",bottom:"Tutorial_06_Footer"},{name:"070Spawn",top:"Tutorial_07_Header",bottom:"Tutorial_07_Footer"},{name:"080Make6",top:"Tutorial_08_Equation"},{name:"085Grow",top:"Tutorial_08_Header",bottom:"Tutorial_08_Footer"},{name:"090Twins",top:"Tutorial_09_Header",bottom:"Tutorial_09_Footer_A"},{name:"095Twins",bottom:"Tutorial_09_Footer_B"},{name:"100Fantastic",top:"Tutorial_10_Header",bottom:"Tutorial_10_Footer"},{name:"110Ones",top:"Tutorial_11_Header_A"},{name:"120Twos",top:"Tutorial_11_Header_B"},{name:"125Make24",top:"Tutorial_12_Header",bottom:""},{name:"140Threes",top:"Tutorial_13_Header",bottom:"Tutorial_13_Footer"},{name:"145Goal",top:"Tutorial_14_Header",bottom:"Tutorial_14_Footer"},{name:"150Next",top:"",bottom:"Tutorial_15_Footer"}]},Begin:function(){var t=this;P.I.topmenu_tut(),m.timer.schedule(.75,function(){t.onTutorial=-1,t.Next(),U.isActive=!0,U.allowNoSpawn=!0,P.canMove=!0,P.disableGold=!0})},End:function(){P.completedTutorial=!0,Or.bool("CompletedTutorial",!0),Or["int"]("GamesSinceTutorial",0),P.I.DoHint(),this.firstRun,this.bottomText.set_text(""),this.topText.set_text(""),U.isActive=!1,P.canMove=!0,P.disableGold=!1,P.I.shownext2(),Or["int"]("CelebrateRank",0)},TopAppear:function(t){var e=this,i=g.get(t),s=(this.red.tween(this.textDisappearTime,{a:0}),this.blue.tween(this.textDisappearTime,{a:0}),this.gray.tween(this.textDisappearTime,{a:0})),n=this.topText;1==this.equation&&(n=this.topNum,this.topNum.color.tween(this.topAppearTime,{a:1}),this.equation++),2==this.equation&&(this.equation=0,this.topNum.color.tween(this.textDisappearTime,{a:0})),s.onComplete(function(){if(e.topText.set_text(""),e.topNum.set_text(""),n.set_align(e.align),n.set_text(i),n.set_color(e.gray),""!=n.get_text()){if(null!=e.ranges)for(var t=n.geom.cache,s=0,r=e.ranges;s<r.length;){var o=r[s];++s;for(var l=o.start,a=o.start+o.len;a>l;)for(var h=l++,_=t[h],u=0;u<_.length;){var c=_[u];++u;var d=o.color;switch(d){case 1:c.color=e.blue;break;case 2:c.color=e.red;break;default:c.color=e.gray}}}e.ranges=null,e.red.tween(e.topAppearTime,{a:1}),e.blue.tween(e.topAppearTime,{a:1}),e.gray.tween(e.topAppearTime,{a:1})}})},BottomAppear:function(t,e){var i=this,s=g.get(t);this.bottomText.color.tween(this.textDisappearTime,{a:0}).onComplete(function(){i.bottomText.set_text(s),i.bottomText.color.tween(e?i.topAppearTime:.25*i.topAppearTime,{a:1})})},Next:function(){if(P.fleeBoard=!1,this.numMovesTilNext=-1,this.onTutorial++,!(this.onTutorial>=this.parts.length)){var t=this.parts[this.onTutorial];this.pageName=t.name,null!=t.top&&this.TopAppear(t.top),null!=t.bottom&&this.BottomAppear(t.bottom,0==this.onTutorial),this.lastNumMoves=P.numMoves,this.numMovesTilNext=1;var e=this.pageName;switch(e){case"010Welcome":break;case"020OneTwo":this.ranges=[{start:4,len:1,color:1},{start:6,len:1,color:2}],this.align=1,P.I.fadethrees(0);var i=[0,0,0,0,0,1,0,0,0,0,2,0,0,0,0,0];this.AppearGrid(i,!0),U.allowNoSpawn=!1;break;case"030Swiping":this.ranges=null,this.align=2,this.numMovesTilNext=-1;break;case"040Rearrange":this.numMovesTilNext=-1;break;case"050Add":this.numMovesTilNext=-1,this.ranges=[{start:16,len:1,color:1},{start:18,len:1,color:2}];break;case"060Auspicious":this.ranges=null,this.align=1,this.showwalls(!1);break;case"070Spawn":this.align=2,P.canMove=!0,P.doSpawn=!0,P.disableGold=!0,P.I.PredictFuture(3),this.equation=1;break;case"080Make6":P.doSpawn=!1,this.numMovesTilNext=-1;break;case"085Grow":this.align=1,P.doSpawn=!0,P.I.PredictFuture(3);break;case"090Twins":this.ranges=[{start:36,len:15,color:2}],this.align=2,P.validNope=3,P.doSpawn=!1,this.numMovesTilNext=-1;break;case"095Twins":this.ranges=null,P.doSpawn=!0,P.I.PredictFuture(3),this.numMovesTilNext=-1;break;case"100Fantastic":this.align=1,P.doSpawn=!0,P.I.PredictFuture(1);break;case"110Ones":this.ranges=[{start:0,len:1,color:1},{start:16,len:1,color:2}],this.align=2,P.validNope=1,P.doSpawn=!0,P.I.PredictFuture(1),this.numMovesTilNext=-1,this.numNopes=0;break;case"120Twos":this.ranges=[{start:0,len:1,color:2},{start:16,len:1,color:1}],P.validNope=2,P.doSpawn=!0,P.I.PredictFuture(2),this.numMovesTilNext=-1,this.numNopes=0;break;case"125Make24":this.ranges=null,P.doSpawn=!0,P.I.PredictFuture(1),this.numMovesTilNext=-1,this.numNopes=0;break;case"140Threes":this.ranges=[{start:6,len:1,color:1},{start:7,len:1,color:2}],this.align=1,P.doSpawn=!0,P.noGold=!1,P.disableGold=!1,P.I.FindGold();break;case"145Goal":this.ranges=null,this.align=2,P.disableGold=!1,P.I.FindGold();break;case"150Next":P.I.shownext(),this.numMovesTilNext=4}}},Update:function(){this.onTutorial>=this.parts.length&&this.End();var t=this.numMoves!=P.numMoves;if(this.numMoves=P.numMoves,this.numMovesTilNext>0&&P.numMoves>=this.lastNumMoves+this.numMovesTilNext)return this.numMovesTilNext=-1,void this.Next();if(P.canMove){var e=this.pageName;switch(e){case"030Swiping":for(var i=new y,s=new y,n=0,r=P.gridSize;r>n;)for(var o=n++,l=0,a=P.gridSize;a>l;){var h=l++;if(1==P.GetSlot(o,h).value){var _=i.ignore_listeners;i.ignore_listeners=!0,i.x=o,i._construct?i.x:(null==i.listen_x||i.ignore_listeners||i.listen_x(o),i.x),i.y=h,i._construct?i.y:(null==i.listen_y||i.ignore_listeners||i.listen_y(h),i.y),i.ignore_listeners=_,null==i.listen_x||i.ignore_listeners||i.listen_x(i.x),null==i.listen_y||i.ignore_listeners||i.listen_y(i.y)}if(2==P.GetSlot(o,h).value){var u=s.ignore_listeners;s.ignore_listeners=!0,s.x=o,s._construct?s.x:(null==s.listen_x||s.ignore_listeners||s.listen_x(o),s.x),s.y=h,s._construct?s.y:(null==s.listen_y||s.ignore_listeners||s.listen_y(h),s.y),s.ignore_listeners=u,null==s.listen_x||s.ignore_listeners||s.listen_x(s.x),null==s.listen_y||s.ignore_listeners||s.listen_y(s.y)}}P.numMoves>this.lastNumMoves&&(this.showwalls(!0),(i.x==s.x||i.y==s.y)&&this.onTutorial++,this.Next());break;case"040Rearrange":for(var c=new y,d=new y,f=0,p=P.gridSize;p>f;)for(var g=f++,m=0,v=P.gridSize;v>m;){var w=m++;if(1==P.GetSlot(g,w).value){var x=c.ignore_listeners;c.ignore_listeners=!0,c.x=g,c._construct?c.x:(null==c.listen_x||c.ignore_listeners||c.listen_x(g),c.x),c.y=w,c._construct?c.y:(null==c.listen_y||c.ignore_listeners||c.listen_y(w),c.y),c.ignore_listeners=x,null==c.listen_x||c.ignore_listeners||c.listen_x(c.x),null==c.listen_y||c.ignore_listeners||c.listen_y(c.y)}if(2==P.GetSlot(g,w).value){var b=d.ignore_listeners;d.ignore_listeners=!0,d.x=g,d._construct?d.x:(null==d.listen_x||d.ignore_listeners||d.listen_x(g),d.x),d.y=w,d._construct?d.y:(null==d.listen_y||d.ignore_listeners||d.listen_y(w),d.y),d.ignore_listeners=b,null==d.listen_x||d.ignore_listeners||d.listen_x(d.x),null==d.listen_y||d.ignore_listeners||d.listen_y(d.y)}}P.numMoves>this.lastNumMoves&&(c.x==d.x||c.y==d.y)&&this.Next();break;case"050Add":1==P.I.GetHighestRank()&&this.Next();break;case"080Make6":2==P.I.GetHighestRank()&&this.Next();break;case"090Twins":P.numMoves==this.lastNumMoves+1&&(P.doSpawn=!1),(P.didNope||P.numMoves>=this.lastNumMoves+3)&&(P.doSpawn=!0,P.I.PredictFuture(3),P.I.DoSpawn(),this.Next());break;case"095Twins":if(P.numMoves==this.lastNumMoves+1&&(P.doSpawn=!1),3==P.I.CountTiles()&&2==P.I.CountRanks(2)){var k=P.I.GetSlotsWithRank(2),z=k[0].coords.clone().add(k[1].coords).multiplyScalar(.5),S=k[0].coords.clone().subtract(k[1].coords);2==Math.sqrt(S.x*S.x+S.y*S.y+S.z*S.z)&&3==P.GetSlotv(z).value&&(P.doSpawn=!0,P.I.PredictFuture(6),P.I.DoSpawn(),P.doSpawn=!1)}3==P.I.GetHighestRank()&&this.Next();break;case"110Ones":P.numMoves>=this.lastNumMoves+3?(P.doSpawn=!1,P.didNope&&this.numNopes++,P.numMoves>=this.lastNumMoves+4&&(P.doSpawn=!0,P.I.PredictFuture(2),P.I.DoSpawn(),this.Next())):P.I.PredictFuture(1);break;case"120Twos":P.numMoves<this.lastNumMoves+4?P.I.PredictFuture(2):(P.doSpawn=!1,1==P.lastHighestMerge&&P.numMoves>=this.lastNumMoves+4?(P.doSpawn=!0,P.I.PredictFuture(1),P.I.DoSpawn(),this.Next()):4==P.I.GetHighestRank()&&this.Next());break;case"125Make24":P.numMoves>this.lastNumMoves&&P.I.PredictFuture(3),P.numMoves>this.lastNumMoves+1&&(P.doSpawn=!1),P.doSpawn||!t||9!=P.I.CountTiles()&&8!=P.I.CountTiles()&&6!=P.I.CountTiles()&&4!=P.I.CountTiles()||P.I.AdjacentRanks(1)||P.I.AdjacentRanks(2)||P.I.AdjacentRanks(3)||(P.doSpawn=!0,P.I.PredictFuture(P.I.CountRanks(2)>P.I.CountRanks(1)?6:3),P.I.DoSpawn(),P.doSpawn=!1),4==P.I.GetHighestRank()&&this.Next()}}},AppearGrid:function(t,e){null==e&&(e=!1),null==t&&(t=[]);for(var i=t.length,s=0;i>s;){var r=s++,o=P.TwoDee(r);o.set_y(P.gridSize-o.y-1),this.AppearTile(o.x,o.y,t[r])}P.I.FindGold(),P.I.ResetPreviews(),e&&m.timer.schedule(.5,n(this,this.AllowMove))},AppearTile:function(t,e,i){var s=P.GetSlot(t,e);if(-1!=i){if(0==i)return s.type=Z.EMPTY,void(s.value=0);s.type=Z.NUMBER,s.value=i;var n=P.SpawnTile();n.SetSlot(s,null,null,!0),n.GotoCoords(s.coords),n.Spawn(P.lastMoveDir)}},DisappearTile:function(t,e){var i=P.GetSlot(t,e);i.IsEmpty()||(i.tile.Shrink(),i.type=Z.EMPTY,i.value=0,i.tile=null)},AllowMove:function(){P.canMove=!0},__class__:U};var H=r.ValueType={__ename__:["ValueType"],__constructs__:["TNull","TInt","TFloat","TBool","TObject","TFunction","TClass","TEnum","TUnknown"]};H.TNull=["TNull",0],H.TNull.toString=o,H.TNull.__enum__=H,H.TInt=["TInt",1],H.TInt.toString=o,H.TInt.__enum__=H,H.TFloat=["TFloat",2],H.TFloat.toString=o,H.TFloat.__enum__=H,H.TBool=["TBool",3],H.TBool.toString=o,H.TBool.__enum__=H,H.TObject=["TObject",4],H.TObject.toString=o,H.TObject.__enum__=H,H.TFunction=["TFunction",5],H.TFunction.toString=o,H.TFunction.__enum__=H,H.TClass=function(t){var e=["TClass",6,t];return e.__enum__=H,e.toString=o,e},H.TEnum=function(t){var e=["TEnum",7,t];return e.__enum__=H,e.toString=o,e},H.TUnknown=["TUnknown",8],H.TUnknown.toString=o,H.TUnknown.__enum__=H;var V=function(){};r.Type=V,V.__name__=["Type"],V.getClass=function(t){return null==t?null:Ee.getClass(t)},V.getClassName=function(t){var e=t.__name__;return null==e?null:e.join(".")},V.getEnumName=function(t){var e=t.__ename__;return e.join(".")},V.resolveClass=function(t){var e=r[t];return null!=e&&e.__name__?e:null},V.resolveEnum=function(t){var e=r[t];return null!=e&&e.__ename__?e:null},V.createInstance=function(t,e){var i=e.length;switch(i){case 0:return new t;case 1:return new t(e[0]);case 2:return new t(e[0],e[1]);case 3:return new t(e[0],e[1],e[2]);case 4:return new t(e[0],e[1],e[2],e[3]);case 5:return new t(e[0],e[1],e[2],e[3],e[4]);case 6:return new t(e[0],e[1],e[2],e[3],e[4],e[5]);case 7:return new t(e[0],e[1],e[2],e[3],e[4],e[5],e[6]);case 8:return new t(e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7]);default:throw new Ie("Too many arguments")}return null},V.createEmptyInstance=function(t){function e(){}return e.prototype=t.prototype,new e},V.createEnum=function(t,e,i){var s=I.field(t,e);if(null==s)throw new Ie("No such constructor "+e);if(I.isFunction(s)){if(null==i)throw new Ie("Constructor "+e+" need parameters");return I.callMethod(t,s,i)}if(null!=i&&0!=i.length)throw new Ie("Constructor "+e+" does not need parameters");return s},V.getEnumConstructs=function(t){var e=t.__constructs__;return e.slice()},V["typeof"]=function(t){var e=typeof t;switch(e){case"boolean":return H.TBool;case"string":return H.TClass(String);case"number":return Math.ceil(t)==t%2147483648?H.TInt:H.TFloat;case"object":if(null==t)return H.TNull;var i=t.__enum__;if(null!=i)return H.TEnum(i);var s=Ee.getClass(t);return null!=s?H.TClass(s):H.TObject;case"function":return t.__name__||t.__ename__?H.TObject:H.TFunction;case"undefined":return H.TNull;default:return H.TUnknown}};var q=r.GameState={__ename__:["GameState"],__constructs__:["PLAYING","LOST","MENU","HOLD"]};q.PLAYING=["PLAYING",0],q.PLAYING.toString=o,q.PLAYING.__enum__=q,q.LOST=["LOST",1],q.LOST.toString=o,q.LOST.__enum__=q,q.MENU=["MENU",2],q.MENU.toString=o,q.MENU.__enum__=q,q.HOLD=["HOLD",3],q.HOLD.toString=o,q.HOLD.__enum__=q;var j=r.MoveResult={__ename__:["MoveResult"],__constructs__:["SHIFT","SQUISH","MERGE_SHIFT","MERGE_SQUISH"]};j.SHIFT=["SHIFT",0],j.SHIFT.toString=o,j.SHIFT.__enum__=j,j.SQUISH=["SQUISH",1],j.SQUISH.toString=o,j.SQUISH.__enum__=j,j.MERGE_SHIFT=["MERGE_SHIFT",2],j.MERGE_SHIFT.toString=o,j.MERGE_SHIFT.__enum__=j,j.MERGE_SQUISH=["MERGE_SQUISH",3],j.MERGE_SQUISH.toString=o,j.MERGE_SQUISH.__enum__=j;var Z=r.SlotType={__ename__:["SlotType"],__constructs__:["EMPTY","NUMBER"]};Z.EMPTY=["EMPTY",0],Z.EMPTY.toString=o,Z.EMPTY.__enum__=Z,Z.NUMBER=["NUMBER",1],Z.NUMBER.toString=o,Z.NUMBER.__enum__=Z;var K=function(){};r.Types=K,K.__name__=["Types"];var Q={};r["_UInt.UInt_Impl_"]=Q,Q.__name__=["_UInt","UInt_Impl_"],Q.toFloat=function(t){var e=t;return 0>e?4294967296+e:e+0};var X=r["haxe.StackItem"]={__ename__:["haxe","StackItem"],__constructs__:["CFunction","Module","FilePos","Method","LocalFunction"]};X.CFunction=["CFunction",0],X.CFunction.toString=o,X.CFunction.__enum__=X,X.Module=function(t){var e=["Module",1,t];return e.__enum__=X,e.toString=o,e},X.FilePos=function(t,e,i){var s=["FilePos",2,t,e,i];return s.__enum__=X,s.toString=o,s},X.Method=function(t,e){var i=["Method",3,t,e];return i.__enum__=X,i.toString=o,i},X.LocalFunction=function(t){var e=["LocalFunction",4,t];return e.__enum__=X,e.toString=o,e};var W=function(){};r["haxe.CallStack"]=W,W.__name__=["haxe","CallStack"],W.getStack=function(t){if(null==t)return[];var e=Error.prepareStackTrace;Error.prepareStackTrace=function(t,e){for(var i=[],s=0;s<e.length;){var n=e[s];++s,null!=W.wrapCallSite&&(n=W.wrapCallSite(n));var r=null,o=n.getFunctionName();if(null!=o){var l=o.lastIndexOf(".");if(l>=0){var a=d.substr(o,0,l),h=d.substr(o,l+1,null);r=X.Method(a,h)}}i.push(X.FilePos(r,n.getFileName(),n.getLineNumber()))}return i};var i=W.makeStack(t.stack);return Error.prepareStackTrace=e,i},W.callStack=function(){try{throw new Error}catch(t){t instanceof Ie&&(t=t.val);var e=W.getStack(t);return e.shift(),e}},W.makeStack=function(t){if(null==t)return[];if("string"==typeof t){var e=t.split("\n");"Error"==e[0]&&e.shift();for(var i=[],s=new _("^   at ([A-Za-z0-9_. ]+) \\(([^)]+):([0-9]+):([0-9]+)\\)$",""),n=0;n<e.length;){var r=e[n];if(++n,s.match(r)){var o=s.matched(1).split("."),l=o.pop(),a=s.matched(2),h=C.parseInt(s.matched(3));i.push(X.FilePos("Anonymous function"==l?X.LocalFunction():"Global code"==l?null:X.Method(o.join("."),l),a,h))}else i.push(X.Module(B.trim(r)))}return i}return t};var Y=function(){};r["haxe.IMap"]=Y,Y.__name__=["haxe","IMap"],Y.prototype={__class__:Y};var J=function(t,e){this.high=t,this.low=e};r["haxe._Int64.___Int64"]=J,J.__name__=["haxe","_Int64","___Int64"],J.prototype={__class__:J};var $=function(){};r["haxe.Log"]=$,$.__name__=["haxe","Log"],$.trace=function(t,e){Ee.__trace(t,e)};var te=function(){};r["haxe.Resource"]=te,te.__name__=["haxe","Resource"],te.getString=function(t){for(var e=0,i=te.content;e<i.length;){var s=i[e];if(++e,s.name==t){if(null!=s.str)return s.str;var n=le.decode(s.data);return n.toString()}}return null};var ee=function(){this.buf=new R,this.cache=[],this.useCache=ee.USE_CACHE,this.useEnumIndex=ee.USE_ENUM_INDEX,this.shash=new de,this.scount=0};r["haxe.Serializer"]=ee,ee.__name__=["haxe","Serializer"],ee.run=function(t){var e=new ee;return e.serialize(t),e.toString()},ee.prototype={toString:function(){return this.buf.b},serializeString:function(t){var e=this.shash.get(t);return null!=e?(this.buf.b+="R",void(this.buf.b+=null==e?"null":""+e)):(this.shash.set(t,this.scount++),this.buf.b+="y",t=encodeURIComponent(t),this.buf.b+=null==t.length?"null":""+t.length,this.buf.b+=":",void(this.buf.b+=null==t?"null":""+t))},serializeRef:function(t){for(var e=typeof t,i=0,s=this.cache.length;s>i;){var n=i++,r=this.cache[n];if(typeof r==e&&r==t)return this.buf.b+="r",this.buf.b+=null==n?"null":""+n,!0}return this.cache.push(t),!1},serializeFields:function(t){for(var e=0,i=I.fields(t);e<i.length;){var s=i[e];++e,this.serializeString(s),this.serialize(I.field(t,s))}this.buf.b+="g"},serialize:function(t){var e=V["typeof"](t);switch(e[1]){case 0:this.buf.b+="n";break;case 1:var i=t;if(0==i)return void(this.buf.b+="z");this.buf.b+="i",this.buf.b+=null==i?"null":""+i;break;case 2:var s=t;isNaN(s)?this.buf.b+="k":isFinite(s)?(this.buf.b+="d",this.buf.b+=null==s?"null":""+s):this.buf.b+=0>s?"m":"p";break;case 3:this.buf.b+=t?"t":"f";break;case 6:var n=e[2];if(n==String)return void this.serializeString(t);if(this.useCache&&this.serializeRef(t))return;switch(n){case Array:var r=0;this.buf.b+="a";for(var o=t.length,l=0;o>l;){var a=l++;null==t[a]?r++:(r>0&&(1==r?this.buf.b+="n":(this.buf.b+="u",this.buf.b+=null==r?"null":""+r),r=0),this.serialize(t[a]))}r>0&&(1==r?this.buf.b+="n":(this.buf.b+="u",this.buf.b+=null==r?"null":""+r)),this.buf.b+="h";break;case p:this.buf.b+="l";for(var h=t,_=h.h,u=null;null!=_;){var c;u=_[0],_=_[1],c=u,this.serialize(c)}this.buf.b+="h";break;case Date:var d=t;this.buf.b+="v",this.buf.add(d.getTime());break;case de:this.buf.b+="b";for(var f=t,g=f.keys();g.hasNext();){var m=g.next();this.serializeString(m),this.serialize(null!=Xr[m]?f.getReserved(m):f.h[m])}this.buf.b+="h";break;case _e:this.buf.b+="q";for(var v=t,y=v.keys();y.hasNext();){var w=y.next();this.buf.b+=":",this.buf.b+=null==w?"null":""+w,this.serialize(v.h[w])}this.buf.b+="h";break;case ue:this.buf.b+="M";for(var x=t,b=x.keys();b.hasNext();){var k=b.next(),z=I.field(k,"__id__");I.deleteField(k,"__id__"),this.serialize(k),k.__id__=z,this.serialize(x.h[k.__id__])}this.buf.b+="h";break;case oe:for(var S=t,T=0,A=S.length-2,E=new R,M=ee.BASE64;A>T;){var B=S.get(T++),F=S.get(T++),P=S.get(T++);E.add(M.charAt(B>>2)),E.add(M.charAt(63&(B<<4|F>>4))),E.add(M.charAt(63&(F<<2|P>>6))),E.add(M.charAt(63&P))}if(T==A){var N=S.get(T++),G=S.get(T++);E.add(M.charAt(N>>2)),E.add(M.charAt(63&(N<<4|G>>4))),E.add(M.charAt(G<<2&63))}else if(T==A+1){var D=S.get(T++);E.add(M.charAt(D>>2)),E.add(M.charAt(D<<4&63))}var L=E.b;this.buf.b+="s",this.buf.b+=null==L.length?"null":""+L.length,this.buf.b+=":",this.buf.b+=null==L?"null":""+L;break;default:this.useCache&&this.cache.pop(),null!=t.hxSerialize?(this.buf.b+="C",this.serializeString(V.getClassName(n)),this.useCache&&this.cache.push(t),t.hxSerialize(this),this.buf.b+="g"):(this.buf.b+="c",this.serializeString(V.getClassName(n)),this.useCache&&this.cache.push(t),this.serializeFields(t))}break;case 4:if(Ee.__instanceof(t,Kr)){var O=V.getClassName(t);this.buf.b+="A",this.serializeString(O)}else if(Ee.__instanceof(t,Qr))this.buf.b+="B",this.serializeString(V.getEnumName(t));else{if(this.useCache&&this.serializeRef(t))return;this.buf.b+="o",this.serializeFields(t)}break;case 7:var U=e[2];if(this.useCache){if(this.serializeRef(t))return;this.cache.pop()}this.buf.b+=this.useEnumIndex?"j":"w",this.serializeString(V.getEnumName(U)),this.useEnumIndex?(this.buf.b+=":",this.buf.b+=C.string(t[1])):this.serializeString(t[0]),this.buf.b+=":";
var H=t.length;this.buf.b+=C.string(H-2);for(var q=2;H>q;){var j=q++;this.serialize(t[j])}this.useCache&&this.cache.push(t);break;case 5:throw new Ie("Cannot serialize function");default:throw new Ie("Cannot serialize "+C.string(t))}},__class__:ee};var ie=function(){};r["haxe.Timer"]=ie,ie.__name__=["haxe","Timer"],ie.stamp=function(){return(new Date).getTime()/1e3};var se=function(t){this.buf=t,this.length=t.length,this.pos=0,this.scache=[],this.cache=[];var e=se.DEFAULT_RESOLVER;null==e&&(e=V,se.DEFAULT_RESOLVER=e),this.setResolver(e)};r["haxe.Unserializer"]=se,se.__name__=["haxe","Unserializer"],se.initCodes=function(){for(var t=[],e=0,i=se.BASE64.length;i>e;){var s=e++;t[se.BASE64.charCodeAt(s)]=s}return t},se.run=function(t){return new se(t).unserialize()},se.prototype={setResolver:function(t){this.resolver=null==t?{resolveClass:function(){return null},resolveEnum:function(){return null}}:t},get:function(t){return this.buf.charCodeAt(t)},readDigits:function(){for(var t=0,e=!1,i=this.pos;;){var s=this.buf.charCodeAt(this.pos);if(s!=s)break;if(45!=s){if(48>s||s>57)break;t=10*t+(s-48),this.pos++}else{if(this.pos!=i)break;e=!0,this.pos++}}return e&&(t*=-1),t},readFloat:function(){for(var t=this.pos;;){var e=this.buf.charCodeAt(this.pos);if(!(e>=43&&58>e||101==e||69==e))break;this.pos++}return C.parseFloat(d.substr(this.buf,t,this.pos-t))},unserializeObject:function(t){for(;;){if(this.pos>=this.length)throw new Ie("Invalid object");if(103==this.buf.charCodeAt(this.pos))break;var e=this.unserialize();if("string"!=typeof e)throw new Ie("Invalid object key");var i=this.unserialize();t[e]=i}this.pos++},unserializeEnum:function(t,e){if(58!=this.get(this.pos++))throw new Ie("Invalid enum format");var i=this.readDigits();if(0==i)return V.createEnum(t,e);for(var s=[];i-->0;)s.push(this.unserialize());return V.createEnum(t,e,s)},unserialize:function(){var t=this.get(this.pos++);switch(t){case 110:return null;case 116:return!0;case 102:return!1;case 122:return 0;case 105:return this.readDigits();case 100:return this.readFloat();case 121:var e=this.readDigits();if(58!=this.get(this.pos++)||this.length-this.pos<e)throw new Ie("Invalid string length");var i=d.substr(this.buf,this.pos,e);return this.pos+=e,i=decodeURIComponent(i.split("+").join(" ")),this.scache.push(i),i;case 107:return 0/0;case 109:return-1/0;case 112:return 1/0;case 97:var s=(this.buf,[]);for(this.cache.push(s);;){var n=this.buf.charCodeAt(this.pos);if(104==n){this.pos++;break}if(117==n){this.pos++;var r=this.readDigits();s[s.length+r-1]=null}else s.push(this.unserialize())}return s;case 111:var o={};return this.cache.push(o),this.unserializeObject(o),o;case 114:var l=this.readDigits();if(0>l||l>=this.cache.length)throw new Ie("Invalid reference");return this.cache[l];case 82:var a=this.readDigits();if(0>a||a>=this.scache.length)throw new Ie("Invalid string reference");return this.scache[a];case 120:throw new Ie(this.unserialize());case 99:var h=this.unserialize(),_=this.resolver.resolveClass(h);if(null==_)throw new Ie("Class not found "+h);var u=V.createEmptyInstance(_);return this.cache.push(u),this.unserializeObject(u),u;case 119:var c=this.unserialize(),f=this.resolver.resolveEnum(c);if(null==f)throw new Ie("Enum not found "+c);var g=this.unserializeEnum(f,this.unserialize());return this.cache.push(g),g;case 106:var m=this.unserialize(),v=this.resolver.resolveEnum(m);if(null==v)throw new Ie("Enum not found "+m);this.pos++;var y=this.readDigits(),w=V.getEnumConstructs(v)[y];if(null==w)throw new Ie("Unknown enum index "+m+"@"+y);var x=this.unserializeEnum(v,w);return this.cache.push(x),x;case 108:var b=new p;this.cache.push(b);for(this.buf;104!=this.buf.charCodeAt(this.pos);)b.add(this.unserialize());return this.pos++,b;case 98:var k=new de;this.cache.push(k);for(this.buf;104!=this.buf.charCodeAt(this.pos);){var z=this.unserialize();k.set(z,this.unserialize())}return this.pos++,k;case 113:var S=new _e;this.cache.push(S);for(var T=(this.buf,this.get(this.pos++));58==T;){var A=this.readDigits();S.set(A,this.unserialize()),T=this.get(this.pos++)}if(104!=T)throw new Ie("Invalid IntMap format");return S;case 77:var I=new ue;this.cache.push(I);for(this.buf;104!=this.buf.charCodeAt(this.pos);){var E=this.unserialize();I.set(E,this.unserialize())}return this.pos++,I;case 118:var M;if(this.buf.charCodeAt(this.pos)>=48&&this.buf.charCodeAt(this.pos)<=57&&this.buf.charCodeAt(this.pos+1)>=48&&this.buf.charCodeAt(this.pos+1)<=57&&this.buf.charCodeAt(this.pos+2)>=48&&this.buf.charCodeAt(this.pos+2)<=57&&this.buf.charCodeAt(this.pos+3)>=48&&this.buf.charCodeAt(this.pos+3)<=57&&45==this.buf.charCodeAt(this.pos+4)){var C=d.substr(this.buf,this.pos,19);M=d.strDate(C),this.pos+=19}else{var R=this.readFloat(),F=new Date;F.setTime(R),M=F}return this.cache.push(M),M;case 115:var P=this.readDigits(),N=this.buf;if(58!=this.get(this.pos++)||this.length-this.pos<P)throw new Ie("Invalid bytes length");var G=se.CODES;null==G&&(G=se.initCodes(),se.CODES=G);var D,L=this.pos,O=3&P;D=3*(P>>2)+(O>=2?O-1:0);for(var U=L+(P-O),H=oe.alloc(D),q=0;U>L;){var j=G[B.fastCodeAt(N,L++)],Z=G[B.fastCodeAt(N,L++)];H.set(q++,j<<2|Z>>4);var K=G[B.fastCodeAt(N,L++)];H.set(q++,Z<<4|K>>2);var Q=G[B.fastCodeAt(N,L++)];H.set(q++,K<<6|Q)}if(O>=2){var X=G[B.fastCodeAt(N,L++)],W=G[B.fastCodeAt(N,L++)];if(H.set(q++,X<<2|W>>4),3==O){var Y=G[B.fastCodeAt(N,L++)];H.set(q++,W<<4|Y>>2)}}return this.pos+=P,this.cache.push(H),H;case 67:var J=this.unserialize(),$=this.resolver.resolveClass(J);if(null==$)throw new Ie("Class not found "+J);var te=V.createEmptyInstance($);if(this.cache.push(te),te.hxUnserialize(this),103!=this.get(this.pos++))throw new Ie("Invalid custom data");return te;case 65:var ee=this.unserialize(),ie=this.resolver.resolveClass(ee);if(null==ie)throw new Ie("Class not found "+ee);return ie;case 66:var ne=this.unserialize(),re=this.resolver.resolveEnum(ne);if(null==re)throw new Ie("Enum not found "+ne);return re}throw this.pos--,new Ie("Invalid char "+this.buf.charAt(this.pos)+" at position "+this.pos)},__class__:se};var ne=function(){this.__b=""};r["haxe.Utf8"]=ne,ne.__name__=["haxe","Utf8"],ne.prototype={__class__:ne};var re=function(){this.a1=1,this.a2=0};r["haxe.crypto.Adler32"]=re,re.__name__=["haxe","crypto","Adler32"],re.read=function(t){var e=new re,i=t.readByte(),s=t.readByte(),n=t.readByte(),r=t.readByte();return e.a1=n<<8|r,e.a2=i<<8|s,e},re.prototype={update:function(t,e,i){for(var s=this.a1,n=this.a2,r=e,o=e+i;o>r;){var l=r++,a=t.b[l];s=(s+a)%65521,n=(n+s)%65521}this.a1=s,this.a2=n},equals:function(t){return t.a1==this.a1&&t.a2==this.a2},__class__:re};var oe=function(t){this.length=t.byteLength,this.b=new Yr(t),this.b.bufferValue=t,t.hxBytes=this,t.bytes=this.b};r["haxe.io.Bytes"]=oe,oe.__name__=["haxe","io","Bytes"],oe.alloc=function(t){return new oe(new Wr(t))},oe.ofString=function(t){for(var e=[],i=0;i<t.length;){var s=B.fastCodeAt(t,i++);s>=55296&&56319>=s&&(s=s-55232<<10|1023&B.fastCodeAt(t,i++)),127>=s?e.push(s):2047>=s?(e.push(192|s>>6),e.push(128|63&s)):65535>=s?(e.push(224|s>>12),e.push(128|s>>6&63),e.push(128|63&s)):(e.push(240|s>>18),e.push(128|s>>12&63),e.push(128|s>>6&63),e.push(128|63&s))}return new oe(new Yr(e).buffer)},oe.prototype={get:function(t){return this.b[t]},set:function(t,e){this.b[t]=255&e},blit:function(t,e,i,s){if(0>t||0>i||0>s||t+s>this.length||i+s>e.length)throw new Ie(ve.OutsideBounds);0==i&&s==e.length?this.b.set(e.b,t):this.b.set(e.b.subarray(i,i+s),t)},getString:function(t,e){if(0>t||0>e||t+e>this.length)throw new Ie(ve.OutsideBounds);for(var i="",s=this.b,n=String.fromCharCode,r=t,o=t+e;o>r;){var l=s[r++];if(128>l){if(0==l)break;i+=n(l)}else if(224>l)i+=n((63&l)<<6|127&s[r++]);else if(240>l){var a=s[r++];i+=n((31&l)<<12|(127&a)<<6|127&s[r++])}else{var h=s[r++],_=s[r++],u=(15&l)<<18|(127&h)<<12|(127&_)<<6|127&s[r++];i+=n((u>>10)+55232),i+=n(1023&u|56320)}}return i},toString:function(){return this.getString(0,this.length)},__class__:oe};var le=function(){};r["haxe.crypto.Base64"]=le,le.__name__=["haxe","crypto","Base64"],le.decode=function(t,e){if(null==e&&(e=!0),e)for(;61==d.cca(t,t.length-1);)t=d.substr(t,0,-1);return new ae(le.BYTES).decodeBytes(oe.ofString(t))};var ae=function(t){for(var e=t.length,i=1;e>1<<i;)i++;if(i>8||e!=1<<i)throw new Ie("BaseCode : base length must be a power of two.");this.base=t,this.nbits=i};r["haxe.crypto.BaseCode"]=ae,ae.__name__=["haxe","crypto","BaseCode"],ae.prototype={initTable:function(){for(var t=[],e=0;256>e;){var i=e++;t[i]=-1}for(var s=0,n=this.base.length;n>s;){var r=s++;t[this.base.b[r]]=r}this.tbl=t},decodeBytes:function(t){{var e=this.nbits;this.base}null==this.tbl&&this.initTable();for(var i=this.tbl,s=t.length*e>>3,n=oe.alloc(s),r=0,o=0,l=0,a=0;s>a;){for(;8>o;){o+=e,r<<=e;var h=i[t.get(l++)];if(-1==h)throw new Ie("BaseCode : invalid encoded char");r|=h}o-=8,n.set(a++,r>>o&255)}return n},__class__:ae};var he=function(){};r["haxe.crypto.Md5"]=he,he.__name__=["haxe","crypto","Md5"],he.encode=function(t){var e=new he,i=e.doEncode(he.str2blks(t));return e.hex(i)},he.str2blks=function(t){for(var e=(t.length+8>>6)+1,i=[],s=16*e,n=0;s>n;){var r=n++;i[r]=0}for(var o=0;o<t.length;)i[o>>2]|=d.cca(t,o)<<(8*t.length+o)%4*8,o++;i[o>>2]|=128<<(8*t.length+o)%4*8;var l=8*t.length,a=16*e-2;return i[a]=255&l,i[a]|=(l>>>8&255)<<8,i[a]|=(l>>>16&255)<<16,i[a]|=(l>>>24&255)<<24,i},he.prototype={bitOR:function(t,e){var i=1&t|1&e,s=t>>>1|e>>>1;return s<<1|i},bitXOR:function(t,e){var i=1&t^1&e,s=t>>>1^e>>>1;return s<<1|i},bitAND:function(t,e){var i=1&t&(1&e),s=t>>>1&e>>>1;return s<<1|i},addme:function(t,e){var i=(65535&t)+(65535&e),s=(t>>16)+(e>>16)+(i>>16);return s<<16|65535&i},hex:function(t){for(var e="",i="0123456789abcdef",s=0;s<t.length;){var n=t[s];++s;for(var r=0;4>r;){var o=r++;e+=i.charAt(n>>8*o+4&15)+i.charAt(n>>8*o&15)}}return e},rol:function(t,e){return t<<e|t>>>32-e},cmn:function(t,e,i,s,n,r){return this.addme(this.rol(this.addme(this.addme(e,t),this.addme(s,r)),n),i)},ff:function(t,e,i,s,n,r,o){return this.cmn(this.bitOR(this.bitAND(e,i),this.bitAND(~e,s)),t,e,n,r,o)},gg:function(t,e,i,s,n,r,o){return this.cmn(this.bitOR(this.bitAND(e,s),this.bitAND(i,~s)),t,e,n,r,o)},hh:function(t,e,i,s,n,r,o){return this.cmn(this.bitXOR(this.bitXOR(e,i),s),t,e,n,r,o)},ii:function(t,e,i,s,n,r,o){return this.cmn(this.bitXOR(i,this.bitOR(e,~s)),t,e,n,r,o)},doEncode:function(t){for(var e,i=1732584193,s=-271733879,n=-1732584194,r=271733878,o=0;o<t.length;){var l=i,a=s,h=n,_=r;e=0,i=this.ff(i,s,n,r,t[o],7,-680876936),r=this.ff(r,i,s,n,t[o+1],12,-389564586),n=this.ff(n,r,i,s,t[o+2],17,606105819),s=this.ff(s,n,r,i,t[o+3],22,-1044525330),i=this.ff(i,s,n,r,t[o+4],7,-176418897),r=this.ff(r,i,s,n,t[o+5],12,1200080426),n=this.ff(n,r,i,s,t[o+6],17,-1473231341),s=this.ff(s,n,r,i,t[o+7],22,-45705983),i=this.ff(i,s,n,r,t[o+8],7,1770035416),r=this.ff(r,i,s,n,t[o+9],12,-1958414417),n=this.ff(n,r,i,s,t[o+10],17,-42063),s=this.ff(s,n,r,i,t[o+11],22,-1990404162),i=this.ff(i,s,n,r,t[o+12],7,1804603682),r=this.ff(r,i,s,n,t[o+13],12,-40341101),n=this.ff(n,r,i,s,t[o+14],17,-1502002290),s=this.ff(s,n,r,i,t[o+15],22,1236535329),i=this.gg(i,s,n,r,t[o+1],5,-165796510),r=this.gg(r,i,s,n,t[o+6],9,-1069501632),n=this.gg(n,r,i,s,t[o+11],14,643717713),s=this.gg(s,n,r,i,t[o],20,-373897302),i=this.gg(i,s,n,r,t[o+5],5,-701558691),r=this.gg(r,i,s,n,t[o+10],9,38016083),n=this.gg(n,r,i,s,t[o+15],14,-660478335),s=this.gg(s,n,r,i,t[o+4],20,-405537848),i=this.gg(i,s,n,r,t[o+9],5,568446438),r=this.gg(r,i,s,n,t[o+14],9,-1019803690),n=this.gg(n,r,i,s,t[o+3],14,-187363961),s=this.gg(s,n,r,i,t[o+8],20,1163531501),i=this.gg(i,s,n,r,t[o+13],5,-1444681467),r=this.gg(r,i,s,n,t[o+2],9,-51403784),n=this.gg(n,r,i,s,t[o+7],14,1735328473),s=this.gg(s,n,r,i,t[o+12],20,-1926607734),i=this.hh(i,s,n,r,t[o+5],4,-378558),r=this.hh(r,i,s,n,t[o+8],11,-2022574463),n=this.hh(n,r,i,s,t[o+11],16,1839030562),s=this.hh(s,n,r,i,t[o+14],23,-35309556),i=this.hh(i,s,n,r,t[o+1],4,-1530992060),r=this.hh(r,i,s,n,t[o+4],11,1272893353),n=this.hh(n,r,i,s,t[o+7],16,-155497632),s=this.hh(s,n,r,i,t[o+10],23,-1094730640),i=this.hh(i,s,n,r,t[o+13],4,681279174),r=this.hh(r,i,s,n,t[o],11,-358537222),n=this.hh(n,r,i,s,t[o+3],16,-722521979),s=this.hh(s,n,r,i,t[o+6],23,76029189),i=this.hh(i,s,n,r,t[o+9],4,-640364487),r=this.hh(r,i,s,n,t[o+12],11,-421815835),n=this.hh(n,r,i,s,t[o+15],16,530742520),s=this.hh(s,n,r,i,t[o+2],23,-995338651),i=this.ii(i,s,n,r,t[o],6,-198630844),r=this.ii(r,i,s,n,t[o+7],10,1126891415),n=this.ii(n,r,i,s,t[o+14],15,-1416354905),s=this.ii(s,n,r,i,t[o+5],21,-57434055),i=this.ii(i,s,n,r,t[o+12],6,1700485571),r=this.ii(r,i,s,n,t[o+3],10,-1894986606),n=this.ii(n,r,i,s,t[o+10],15,-1051523),s=this.ii(s,n,r,i,t[o+1],21,-2054922799),i=this.ii(i,s,n,r,t[o+8],6,1873313359),r=this.ii(r,i,s,n,t[o+15],10,-30611744),n=this.ii(n,r,i,s,t[o+6],15,-1560198380),s=this.ii(s,n,r,i,t[o+13],21,1309151649),i=this.ii(i,s,n,r,t[o+4],6,-145523070),r=this.ii(r,i,s,n,t[o+11],10,-1120210379),n=this.ii(n,r,i,s,t[o+2],15,718787259),s=this.ii(s,n,r,i,t[o+9],21,-343485551),i=this.addme(i,l),s=this.addme(s,a),n=this.addme(n,h),r=this.addme(r,_),o+=16}return[i,s,n,r]},__class__:he};var _e=function(){this.h={}};r["haxe.ds.IntMap"]=_e,_e.__name__=["haxe","ds","IntMap"],_e.__interfaces__=[Y],_e.prototype={set:function(t,e){this.h[t]=e},get:function(t){return this.h[t]},exists:function(t){return this.h.hasOwnProperty(t)},remove:function(t){return this.h.hasOwnProperty(t)?(delete this.h[t],!0):!1},keys:function(){var t=[];for(var e in this.h)this.h.hasOwnProperty(e)&&t.push(0|e);return d.iter(t)},iterator:function(){return{ref:this.h,it:this.keys(),hasNext:function(){return this.it.hasNext()},next:function(){var t=this.it.next();return this.ref[t]}}},__class__:_e};var ue=function(){this.h={},this.h.__keys__={}};r["haxe.ds.ObjectMap"]=ue,ue.__name__=["haxe","ds","ObjectMap"],ue.__interfaces__=[Y],ue.prototype={set:function(t,e){var i=t.__id__||(t.__id__=++ue.count);this.h[i]=e,this.h.__keys__[i]=t},get:function(t){return this.h[t.__id__]},exists:function(t){return null!=this.h.__keys__[t.__id__]},remove:function(t){var e=t.__id__;return null==this.h.__keys__[e]?!1:(delete this.h[e],delete this.h.__keys__[e],!0)},keys:function(){var t=[];for(var e in this.h.__keys__)this.h.hasOwnProperty(e)&&t.push(this.h.__keys__[e]);return d.iter(t)},iterator:function(){return{ref:this.h,it:this.keys(),hasNext:function(){return this.it.hasNext()},next:function(){var t=this.it.next();return this.ref[t.__id__]}}},__class__:ue};var ce=function(t,e){this.map=t,this.keys=e,this.index=0,this.count=e.length};r["haxe.ds._StringMap.StringMapIterator"]=ce,ce.__name__=["haxe","ds","_StringMap","StringMapIterator"],ce.prototype={hasNext:function(){return this.index<this.count},next:function(){return this.map.get(this.keys[this.index++])},__class__:ce};var de=function(){this.h={}};r["haxe.ds.StringMap"]=de,de.__name__=["haxe","ds","StringMap"],de.__interfaces__=[Y],de.prototype={set:function(t,e){null!=Xr[t]?this.setReserved(t,e):this.h[t]=e},get:function(t){return null!=Xr[t]?this.getReserved(t):this.h[t]},exists:function(t){return null!=Xr[t]?this.existsReserved(t):this.h.hasOwnProperty(t)},setReserved:function(t,e){null==this.rh&&(this.rh={}),this.rh["$"+t]=e},getReserved:function(t){return null==this.rh?null:this.rh["$"+t]},existsReserved:function(t){return null==this.rh?!1:this.rh.hasOwnProperty("$"+t)},remove:function(t){return null!=Xr[t]?(t="$"+t,null!=this.rh&&this.rh.hasOwnProperty(t)?(delete this.rh[t],!0):!1):this.h.hasOwnProperty(t)?(delete this.h[t],!0):!1},keys:function(){var t=this.arrayKeys();return d.iter(t)},arrayKeys:function(){var t=[];for(var e in this.h)this.h.hasOwnProperty(e)&&t.push(e);if(null!=this.rh)for(var e in this.rh)36==e.charCodeAt(0)&&t.push(e.substr(1));return t},iterator:function(){return new ce(this,this.arrayKeys())},__class__:de};var fe=function(){this.b=[]};r["haxe.io.BytesBuffer"]=fe,fe.__name__=["haxe","io","BytesBuffer"],fe.prototype={addBytes:function(t,e,i){if(0>e||0>i||e+i>t.length)throw new Ie(ve.OutsideBounds);for(var s=(this.b,t.b),n=e,r=e+i;r>n;){var o=n++;this.b.push(s[o])}},getBytes:function(){var t=new oe(new Yr(this.b).buffer);return this.b=null,t},__class__:fe};var pe=function(){};r["haxe.io.Input"]=pe,pe.__name__=["haxe","io","Input"],pe.prototype={readByte:function(){throw new Ie("Not implemented")},readBytes:function(t,e,i){var s=i,n=t.b;if(0>e||0>i||e+i>t.length)throw new Ie(ve.OutsideBounds);for(;s>0;)n[e]=this.readByte(),e++,s--;return i},read:function(t){for(var e=oe.alloc(t),i=0;t>0;){var s=this.readBytes(e,i,t);if(0==s)throw new Ie(ve.Blocked);i+=s,t-=s}return e},readUInt16:function(){var t=this.readByte(),e=this.readByte();return this.bigEndian?e|t<<8:t|e<<8},__class__:pe};var ge=function(t,e,i){if(null==e&&(e=0),null==i&&(i=t.length-e),0>e||0>i||e+i>t.length)throw new Ie(ve.OutsideBounds);this.b=t.b,this.pos=e,this.len=i,this.totlen=i};r["haxe.io.BytesInput"]=ge,ge.__name__=["haxe","io","BytesInput"],ge.__super__=pe,ge.prototype=i(pe.prototype,{readByte:function(){if(0==this.len)throw new Ie(new me);return this.len--,this.b[this.pos++]},readBytes:function(t,e,i){if(0>e||0>i||e+i>t.length)throw new Ie(ve.OutsideBounds);if(0==this.len&&i>0)throw new Ie(new me);this.len<i&&(i=this.len);for(var s=this.b,n=t.b,r=0;i>r;){var o=r++;n[e+o]=s[this.pos+o]}return this.pos+=i,this.len-=i,i},__class__:ge});var me=function(){};r["haxe.io.Eof"]=me,me.__name__=["haxe","io","Eof"],me.prototype={toString:function(){return"Eof"},__class__:me};var ve=r["haxe.io.Error"]={__ename__:["haxe","io","Error"],__constructs__:["Blocked","Overflow","OutsideBounds","Custom"]};ve.Blocked=["Blocked",0],ve.Blocked.toString=o,ve.Blocked.__enum__=ve,ve.Overflow=["Overflow",1],ve.Overflow.toString=o,ve.Overflow.__enum__=ve,ve.OutsideBounds=["OutsideBounds",2],ve.OutsideBounds.toString=o,ve.OutsideBounds.__enum__=ve,ve.Custom=function(t){var e=["Custom",3,t];return e.__enum__=ve,e.toString=o,e};var ye=function(){};r["haxe.io.FPHelper"]=ye,ye.__name__=["haxe","io","FPHelper"],ye.i32ToFloat=function(t){var e=1-(t>>>31<<1),i=t>>>23&255,s=8388607&t;return 0==s&&0==i?0:e*(1+Math.pow(2,-23)*s)*Math.pow(2,i-127)},ye.floatToI32=function(t){if(0==t)return 0;var e;e=0>t?-t:t;var i=Math.floor(Math.log(e)/.6931471805599453);-127>i?i=-127:i>128&&(i=128);var s=8388607&Math.round(8388608*(e/Math.pow(2,i)-1));return(0>t?-2147483648:0)|i+127<<23|s},ye.i64ToDouble=function(t,e){var i=1-(e>>>31<<1),s=(e>>20&2047)-1023,n=4294967296*(1048575&e)+2147483648*(t>>>31)+(2147483647&t);return 0==n&&-1023==s?0:i*(1+Math.pow(2,-52)*n)*Math.pow(2,s)},ye.doubleToI64=function(t){var e=ye.i64tmp;if(0==t)e.low=0,e.high=0;else{var i;i=0>t?-t:t;var s,n=Math.floor(Math.log(i)/.6931471805599453),r=4503599627370496*(i/Math.pow(2,n)-1);s=Math.round(r);var o=0|s,l=s/4294967296|0;e.low=o,e.high=(0>t?-2147483648:0)|n+1023<<20|l}return e};var we=function(t){switch(t){case".":case"..":return this.dir=t,void(this.file="")}var e=t.lastIndexOf("/"),i=t.lastIndexOf("\\");i>e?(this.dir=d.substr(t,0,i),t=d.substr(t,i+1,null),this.backslash=!0):e>i?(this.dir=d.substr(t,0,e),t=d.substr(t,e+1,null)):this.dir=null;var s=t.lastIndexOf(".");-1!=s?(this.ext=d.substr(t,s+1,null),this.file=d.substr(t,0,s)):(this.ext=null,this.file=t)};r["haxe.io.Path"]=we,we.__name__=["haxe","io","Path"],we.withoutExtension=function(t){var e=new we(t);return e.ext=null,e.toString()},we.withoutDirectory=function(t){var e=new we(t);return e.dir=null,e.toString()},we.directory=function(t){var e=new we(t);return null==e.dir?"":e.dir},we.extension=function(t){var e=new we(t);return null==e.ext?"":e.ext},we.join=function(t){var e=t.filter(function(t){return null!=t&&""!=t});if(0==e.length)return"";for(var i=e[0],s=1,n=e.length;n>s;){var r=s++;i=we.addTrailingSlash(i),i+=e[r]}return we.normalize(i)},we.normalize=function(t){var e="/";if(t=t.split("\\").join("/"),null==t||t==e)return e;for(var i=[],s=0,n=t.split(e);s<n.length;){var r=n[s];++s,".."==r&&i.length>0&&".."!=i[i.length-1]?i.pop():"."!=r&&i.push(r)}for(var o=i.join(e),l=new _("([^:])/+","g"),a=(l.replace(o,"$1"+e),new R),h=!1,u=!1,c=0,f=o.length;f>c;){var p=c++,g=d.cca(o,p),m=g;if(null!=g)switch(g){case 58:a.b+=":",h=!0;break;case 47:0==h?u=!0:(h=!1,u&&(a.b+="/",u=!1),a.add(String.fromCharCode(m)));break;default:h=!1,u&&(a.b+="/",u=!1),a.add(String.fromCharCode(m))}else h=!1,u&&(a.b+="/",u=!1),a.add(String.fromCharCode(m))}var v=a.b;return v},we.addTrailingSlash=function(t){if(0==t.length)return"/";var e=t.lastIndexOf("/"),i=t.lastIndexOf("\\");return i>e?i!=t.length-1?t+"\\":t:e!=t.length-1?t+"/":t},we.prototype={toString:function(){return(null==this.dir?"":this.dir+(this.backslash?"\\":"/"))+this.file+(null==this.ext?"":"."+this.ext)},__class__:we};var xe=function(){};r["haxe.zip.Compress"]=xe,xe.__name__=["haxe","zip","Compress"],xe.run=function(){throw new Ie("Not implemented for this platform")};var be=r["haxe.zip.Huffman"]={__ename__:["haxe","zip","Huffman"],__constructs__:["Found","NeedBit","NeedBits"]};be.Found=function(t){var e=["Found",0,t];return e.__enum__=be,e.toString=o,e},be.NeedBit=function(t,e){var i=["NeedBit",1,t,e];return i.__enum__=be,i.toString=o,i},be.NeedBits=function(t,e){var i=["NeedBits",2,t,e];return i.__enum__=be,i.toString=o,i};var ke=function(){};r["haxe.zip.HuffTools"]=ke,ke.__name__=["haxe","zip","HuffTools"],ke.prototype={treeDepth:function(t){switch(t[1]){case 0:return 0;case 2:throw new Ie("assert");case 1:var e=t[3],i=t[2],s=this.treeDepth(i),n=this.treeDepth(e);return 1+(n>s?s:n)}},treeCompress:function(t){var e=this.treeDepth(t);if(0==e)return t;if(1==e)switch(t[1]){case 1:var i=t[3],s=t[2];return be.NeedBit(this.treeCompress(s),this.treeCompress(i));default:throw new Ie("assert")}for(var n=1<<e,r=[],o=0;n>o;){{o++}r.push(be.Found(-1))}return this.treeWalk(r,0,0,e,t),be.NeedBits(e,r)},treeWalk:function(t,e,i,s,n){switch(n[1]){case 1:var r=n[3],o=n[2];s>0?(this.treeWalk(t,e,i+1,s-1,o),this.treeWalk(t,e|1<<i,i+1,s-1,r)):t[e]=this.treeCompress(n);break;default:t[e]=this.treeCompress(n)}},treeMake:function(t,e,i,s){if(s>e)throw new Ie("Invalid huffman");var n=i<<5|s;return t.h.hasOwnProperty(n)?be.Found(t.h[n]):(i<<=1,s+=1,be.NeedBit(this.treeMake(t,e,i,s),this.treeMake(t,e,1|i,s)))},make:function(t,e,i,s){var n=[],r=[];if(s>32)throw new Ie("Invalid huffman");for(var o=0;s>o;){{o++}n.push(0),r.push(0)}for(var l=0;i>l;){var a=l++,h=t[a+e];if(h>=s)throw new Ie("Invalid huffman");n[h]++}for(var _=0,u=1,c=s-1;c>u;){var d=u++;_=_+n[d]<<1,r[d]=_}for(var f=new _e,p=0;i>p;){var g=p++,m=t[g+e];if(0!=m){var v=r[m-1];r[m-1]=v+1,f.h[v<<5|m]=g}}return this.treeCompress(be.NeedBit(this.treeMake(f,s,0,1),this.treeMake(f,s,1,1)))},__class__:ke};var ze=function(t){this.buffer=oe.alloc(65536),this.pos=0,t&&(this.crc=new re)};r["haxe.zip._InflateImpl.Window"]=ze,ze.__name__=["haxe","zip","_InflateImpl","Window"],ze.prototype={slide:function(){null!=this.crc&&this.crc.update(this.buffer,0,32768);var t=oe.alloc(65536);this.pos-=32768,t.blit(0,this.buffer,32768,this.pos),this.buffer=t},addBytes:function(t,e,i){this.pos+i>65536&&this.slide(),this.buffer.blit(this.pos,t,e,i),this.pos+=i},addByte:function(t){65536==this.pos&&this.slide(),this.buffer.b[this.pos]=255&t,this.pos++},getLastChar:function(){return this.buffer.b[this.pos-1]},available:function(){return this.pos},checksum:function(){return null!=this.crc&&this.crc.update(this.buffer,0,this.pos),this.crc},__class__:ze};var Se=r["haxe.zip._InflateImpl.State"]={__ename__:["haxe","zip","_InflateImpl","State"],__constructs__:["Head","Block","CData","Flat","Crc","Dist","DistOne","Done"]};Se.Head=["Head",0],Se.Head.toString=o,Se.Head.__enum__=Se,Se.Block=["Block",1],Se.Block.toString=o,Se.Block.__enum__=Se,Se.CData=["CData",2],Se.CData.toString=o,Se.CData.__enum__=Se,Se.Flat=["Flat",3],Se.Flat.toString=o,Se.Flat.__enum__=Se,Se.Crc=["Crc",4],Se.Crc.toString=o,Se.Crc.__enum__=Se,Se.Dist=["Dist",5],Se.Dist.toString=o,Se.Dist.__enum__=Se,Se.DistOne=["DistOne",6],Se.DistOne.toString=o,Se.DistOne.__enum__=Se,Se.Done=["Done",7],Se.Done.toString=o,Se.Done.__enum__=Se;var Te=function(t,e,i){null==i&&(i=!0),null==e&&(e=!0),this["final"]=!1,this.htools=new ke,this.huffman=this.buildFixedHuffman(),this.huffdist=null,this.len=0,this.dist=0,this.state=e?Se.Head:Se.Block,this.input=t,this.bits=0,this.nbits=0,this.needed=0,this.output=null,this.outpos=0,this.lengths=[];for(var s=0;19>s;){{s++}this.lengths.push(-1)}this.window=new ze(i)};r["haxe.zip.InflateImpl"]=Te,Te.__name__=["haxe","zip","InflateImpl"],Te.run=function(t,e){null==e&&(e=65536);for(var i=oe.alloc(e),s=new fe,n=new Te(t);;){var r=n.readBytes(i,0,e);if(s.addBytes(i,0,r),e>r)break}return s.getBytes()},Te.prototype={buildFixedHuffman:function(){if(null!=Te.FIXED_HUFFMAN)return Te.FIXED_HUFFMAN;for(var t=[],e=0;288>e;){var i=e++;t.push(143>=i?8:255>=i?9:279>=i?7:8)}return Te.FIXED_HUFFMAN=this.htools.make(t,0,288,10),Te.FIXED_HUFFMAN},readBytes:function(t,e,i){if(this.needed=i,this.outpos=e,this.output=t,i>0)for(;this.inflateLoop(););return i-this.needed},getBits:function(t){for(;this.nbits<t;)this.bits|=this.input.readByte()<<this.nbits,this.nbits+=8;var e=this.bits&(1<<t)-1;return this.nbits-=t,this.bits>>=t,e},getBit:function(){0==this.nbits&&(this.nbits=8,this.bits=this.input.readByte());var t=1==(1&this.bits);return this.nbits--,this.bits>>=1,t},getRevBits:function(t){return 0==t?0:this.getBit()?1<<t-1|this.getRevBits(t-1):this.getRevBits(t-1)},resetBits:function(){this.bits=0,this.nbits=0},addBytes:function(t,e,i){this.window.addBytes(t,e,i),this.output.blit(this.outpos,t,e,i),this.needed-=i,this.outpos+=i},addByte:function(t){this.window.addByte(t),this.output.b[this.outpos]=255&t,this.needed--,this.outpos++},addDistOne:function(t){for(var e=this.window.getLastChar(),i=0;t>i;){{i++}this.addByte(e)}},addDist:function(t,e){this.addBytes(this.window.buffer,this.window.pos-t,e)},applyHuffman:function(t){switch(t[1]){case 0:var e=t[2];return e;case 1:var i=t[3],s=t[2];return this.applyHuffman(this.getBit()?i:s);case 2:var n=t[3],r=t[2];return this.applyHuffman(n[this.getBits(r)])}},inflateLengths:function(t,e){for(var i=0,s=0;e>i;){var n=this.applyHuffman(this.huffman);switch(n){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 8:case 9:case 10:case 11:case 12:case 13:case 14:case 15:s=n,t[i]=n,i++;break;case 16:var r=i+3+this.getBits(2);if(r>e)throw new Ie("Invalid data");for(;r>i;)t[i]=s,i++;break;case 17:if(i+=3+this.getBits(3),i>e)throw new Ie("Invalid data");break;case 18:if(i+=11+this.getBits(7),i>e)throw new Ie("Invalid data");break;default:throw new Ie("Invalid data")}}},inflateLoop:function(){var t=this.state;switch(t[1]){case 0:var e=this.input.readByte(),i=15&e;if(8!=i)throw new Ie("Invalid data");var s=this.input.readByte(),n=0!=(32&s);if(((e<<8)+s)%31!=0)throw new Ie("Invalid data");if(n)throw new Ie("Unsupported dictionary");return this.state=Se.Block,!0;case 4:var r=this.window.checksum();if(null==r)return this.state=Se.Done,!0;var o=re.read(this.input);if(!r.equals(o))throw new Ie("Invalid CRC");return this.state=Se.Done,!0;case 7:return!1;case 1:this["final"]=this.getBit();var l=this.getBits(2);switch(l){case 0:this.len=this.input.readUInt16();var a=this.input.readUInt16();if(a!=65535-this.len)throw new Ie("Invalid data");this.state=Se.Flat;var h=this.inflateLoop();return this.resetBits(),h;case 1:return this.huffman=this.buildFixedHuffman(),this.huffdist=null,this.state=Se.CData,!0;case 2:for(var _=this.getBits(5)+257,u=this.getBits(5)+1,c=this.getBits(4)+4,d=0;c>d;){var f=d++;this.lengths[Te.CODE_LENGTHS_POS[f]]=this.getBits(3)}for(var p=c;19>p;){var g=p++;this.lengths[Te.CODE_LENGTHS_POS[g]]=0}this.huffman=this.htools.make(this.lengths,0,19,8);for(var m=[],v=0,y=_+u;y>v;){{v++}m.push(0)}return this.inflateLengths(m,_+u),this.huffdist=this.htools.make(m,_,u,16),this.huffman=this.htools.make(m,0,_,16),this.state=Se.CData,!0;default:throw new Ie("Invalid data")}break;case 3:var w;w=this.len<this.needed?this.len:this.needed;var x=this.input.read(w);return this.len-=w,this.addBytes(x,0,w),0==this.len&&(this.state=this["final"]?Se.Crc:Se.Block),this.needed>0;case 6:var b;return b=this.len<this.needed?this.len:this.needed,this.addDistOne(b),this.len-=b,0==this.len&&(this.state=Se.CData),this.needed>0;case 5:for(;this.len>0&&this.needed>0;){var k;k=this.len<this.dist?this.len:this.dist;var z;z=this.needed<k?this.needed:k,this.addDist(this.dist,z),this.len-=z}return 0==this.len&&(this.state=Se.CData),this.needed>0;case 2:var S=this.applyHuffman(this.huffman);if(256>S)return this.addByte(S),this.needed>0;if(256==S)return this.state=this["final"]?Se.Crc:Se.Block,!0;S-=257;var T=Te.LEN_EXTRA_BITS_TBL[S];if(-1==T)throw new Ie("Invalid data");this.len=Te.LEN_BASE_VAL_TBL[S]+this.getBits(T);var A;if(A=null==this.huffdist?this.getRevBits(5):this.applyHuffman(this.huffdist),T=Te.DIST_EXTRA_BITS_TBL[A],-1==T)throw new Ie("Invalid data");if(this.dist=Te.DIST_BASE_VAL_TBL[A]+this.getBits(T),this.dist>this.window.available())throw new Ie("Invalid data");return this.state=1==this.dist?Se.DistOne:Se.Dist,!0}},__class__:Te};var Ae=function(){};r["haxe.zip.Uncompress"]=Ae,Ae.__name__=["haxe","zip","Uncompress"],Ae.run=function(t,e){return Te.run(new ge(t),e)};var Ie=function(t){Error.call(this),this.val=t,this.message=String(t),Error.captureStackTrace&&Error.captureStackTrace(this,Ie)};r["js._Boot.HaxeError"]=Ie,Ie.__name__=["js","_Boot","HaxeError"],Ie.__super__=Error,Ie.prototype=i(Error.prototype,{__class__:Ie});var Ee=function(){};r["js.Boot"]=Ee,Ee.__name__=["js","Boot"],Ee.__unhtml=function(t){return t.split("&").join("&amp;").split("<").join("&lt;").split(">").join("&gt;")},Ee.__trace=function(e,i){var s;if(s=null!=i?i.fileName+":"+i.lineNumber+": ":"",s+=Ee.__string_rec(e,""),null!=i&&null!=i.customParams)for(var n=0,r=i.customParams;n<r.length;){var o=r[n];++n,s+=","+Ee.__string_rec(o,"")}var l;"undefined"!=typeof document&&null!=(l=document.getElementById("haxe:trace"))?l.innerHTML+=Ee.__unhtml(s)+"<br/>":"undefined"!=typeof t&&null!=t.log&&t.log(s)},Ee.getClass=function(t){if(t instanceof Array&&null==t.__enum__)return Array;var e=t.__class__;if(null!=e)return e;var i=Ee.__nativeClassName(t);return null!=i?Ee.__resolveNativeClass(i):null},Ee.__string_rec=function(t,e){if(null==t)return"null";if(e.length>=5)return"<...>";var i=typeof t;switch("function"==i&&(t.__name__||t.__ename__)&&(i="object"),i){case"object":if(t instanceof Array){if(t.__enum__){if(2==t.length)return t[0];var s=t[0]+"(";e+="	";for(var n=2,r=t.length;r>n;){var o=n++;s+=2!=o?","+Ee.__string_rec(t[o],e):Ee.__string_rec(t[o],e)}return s+")"}var l=t.length,a="[";e+="	";for(var h=0;l>h;){var _=h++;a+=(_>0?",":"")+Ee.__string_rec(t[_],e)}return a+="]"}var u;try{u=t.toString}catch(c){return c instanceof Ie&&(c=c.val),"???"}if(null!=u&&u!=Object.toString&&"function"==typeof u){var d=t.toString();if("[object Object]"!=d)return d}var f=null,p="{\n";e+="	";var g=null!=t.hasOwnProperty;for(var f in t)(!g||t.hasOwnProperty(f))&&"prototype"!=f&&"__class__"!=f&&"__super__"!=f&&"__interfaces__"!=f&&"__properties__"!=f&&(2!=p.length&&(p+=", \n"),p+=e+f+" : "+Ee.__string_rec(t[f],e));return e=e.substring(1),p+="\n"+e+"}";case"function":return"<function>";case"string":return t;default:return String(t)}},Ee.__interfLoop=function(t,e){if(null==t)return!1;if(t==e)return!0;var i=t.__interfaces__;if(null!=i)for(var s=0,n=i.length;n>s;){var r=s++,o=i[r];if(o==e||Ee.__interfLoop(o,e))return!0}return Ee.__interfLoop(t.__super__,e)},Ee.__instanceof=function(t,e){if(null==e)return!1;switch(e){case Vr:return(0|t)===t;case jr:return"number"==typeof t;case Zr:return"boolean"==typeof t;case String:return"string"==typeof t;case Array:return t instanceof Array&&null==t.__enum__;case qr:return!0;default:if(null==t)return!1;if("function"==typeof e){if(t instanceof e)return!0;if(Ee.__interfLoop(Ee.getClass(t),e))return!0}else if("object"==typeof e&&Ee.__isNativeObj(e)&&t instanceof e)return!0;return e==Kr&&null!=t.__name__?!0:e==Qr&&null!=t.__ename__?!0:t.__enum__==e}},Ee.__cast=function(t,e){if(Ee.__instanceof(t,e))return t;
throw new Ie("Cannot cast "+C.string(t)+" to "+C.string(e))},Ee.__nativeClassName=function(t){var e=Ee.__toStr.call(t).slice(8,-1);return"Object"==e||"Function"==e||"Math"==e||"JSON"==e?null:e},Ee.__isNativeObj=function(t){return null!=Ee.__nativeClassName(t)},Ee.__resolveNativeClass=function(t){return e[t]};var Me=function(){};r["js.html._CanvasElement.CanvasUtil"]=Me,Me.__name__=["js","html","_CanvasElement","CanvasUtil"],Me.getContextWebGL=function(t,e){for(var i=0,s=["webgl","experimental-webgl"];i<s.length;){var n=s[i];++i;var r=t.getContext(n,e);if(null!=r)return r}return null};var Ce=function(t){if(t instanceof Array&&null==t.__enum__)this.a=t,this.byteLength=t.length;else{var e=t;this.a=[];for(var i=0;e>i;){var s=i++;this.a[s]=0}this.byteLength=e}};r["js.html.compat.ArrayBuffer"]=Ce,Ce.__name__=["js","html","compat","ArrayBuffer"],Ce.sliceImpl=function(t,e){var i=new Yr(this,t,null==e?null:e-t),s=new Wr(i.byteLength),n=new Yr(s);return n.set(i),s},Ce.prototype={slice:function(t,e){return new Ce(this.a.slice(t,e))},__class__:Ce};var Re=function(t,e,i){if(this.buf=t,this.offset=null==e?0:e,this.length=null==i?t.byteLength-this.offset:i,this.offset<0||this.length<0||this.offset+this.length>t.byteLength)throw new Ie(ve.OutsideBounds)};r["js.html.compat.DataView"]=Re,Re.__name__=["js","html","compat","DataView"],Re.prototype={getInt8:function(t){var e=this.buf.a[this.offset+t];return e>=128?e-256:e},getUint8:function(t){return this.buf.a[this.offset+t]},getInt16:function(t,e){var i=this.getUint16(t,e);return i>=32768?i-65536:i},getUint16:function(t,e){return e?this.buf.a[this.offset+t]|this.buf.a[this.offset+t+1]<<8:this.buf.a[this.offset+t]<<8|this.buf.a[this.offset+t+1]},getInt32:function(t,e){var i=this.offset+t,s=this.buf.a[i++],n=this.buf.a[i++],r=this.buf.a[i++],o=this.buf.a[i++];return e?s|n<<8|r<<16|o<<24:o|r<<8|n<<16|s<<24},getUint32:function(t,e){var i=this.getInt32(t,e);return 0>i?i+4294967296:i},getFloat32:function(t,e){return ye.i32ToFloat(this.getInt32(t,e))},getFloat64:function(t,e){var i=this.getInt32(t,e),s=this.getInt32(t+4,e);return ye.i64ToDouble(e?i:s,e?s:i)},setInt8:function(t,e){this.buf.a[t+this.offset]=0>e?e+128&255:255&e},setUint8:function(t,e){this.buf.a[t+this.offset]=255&e},setInt16:function(t,e,i){this.setUint16(t,0>e?e+65536:e,i)},setUint16:function(t,e,i){var s=t+this.offset;i?(this.buf.a[s]=255&e,this.buf.a[s++]=e>>8&255):(this.buf.a[s++]=e>>8&255,this.buf.a[s]=255&e)},setInt32:function(t,e,i){this.setUint32(t,e,i)},setUint32:function(t,e,i){var s=t+this.offset;i?(this.buf.a[s++]=255&e,this.buf.a[s++]=e>>8&255,this.buf.a[s++]=e>>16&255,this.buf.a[s++]=e>>>24):(this.buf.a[s++]=e>>>24,this.buf.a[s++]=e>>16&255,this.buf.a[s++]=e>>8&255,this.buf.a[s++]=255&e)},setFloat32:function(t,e,i){this.setUint32(t,ye.floatToI32(e),i)},setFloat64:function(t,e,i){var s=ye.doubleToI64(e);i?(this.setUint32(t,s.low),this.setUint32(t,s.high)):(this.setUint32(t,s.high),this.setUint32(t,s.low))},__class__:Re};var Be=function(){};r["js.html.compat.Uint8Array"]=Be,Be.__name__=["js","html","compat","Uint8Array"],Be._new=function(t,e,i){var s;if("number"==typeof t){s=[];for(var n=0;t>n;){var r=n++;s[r]=0}s.byteLength=s.length,s.byteOffset=0,s.buffer=new Ce(s)}else if(Ee.__instanceof(t,Ce)){var o=t;null==e&&(e=0),null==i&&(i=o.byteLength-e),s=0==e?o.a:o.a.slice(e,e+i),s.byteLength=s.length,s.byteOffset=e,s.buffer=o}else{if(!(t instanceof Array&&null==t.__enum__))throw new Ie("TODO "+C.string(t));s=t.slice(),s.byteLength=s.length,s.byteOffset=0,s.buffer=new Ce(s)}return s.subarray=Be._subarray,s.set=Be._set,s},Be._set=function(t,e){var i=this;if(Ee.__instanceof(t.buffer,Ce)){var s=t;if(t.byteLength+e>i.byteLength)throw new Ie("set() outside of range");for(var n=0,r=t.byteLength;r>n;){var o=n++;i[o+e]=s[o]}}else{if(!(t instanceof Array&&null==t.__enum__))throw new Ie("TODO");var l=t;if(l.length+e>i.byteLength)throw new Ie("set() outside of range");for(var a=0,h=l.length;h>a;){var _=a++;i[_+e]=l[_]}}},Be._subarray=function(t,e){var i=this,s=Be._new(i.slice(t,e));return s.byteOffset=t,s};var Fe=function(t){this.core=t};r["luxe.Audio"]=Fe,Fe.__name__=["luxe","Audio"],Fe.prototype={init:function(){},destroy:function(){},create:function(t,e,i){return null==i&&(i=!1),null==e&&(e=""),this.core.app.audio.create(t,e,i)},create_from_bytes:function(t,e,i){return null==t&&(t=""),this.core.app.audio.create_from_bytes(t,e,i)},uncreate:function(t){this.core.app.audio.uncreate(t)},add:function(t){this.core.app.audio.add(t)},on:function(t,e,i){this.core.app.audio.on(t,e,i)},off:function(t,e,i){this.core.app.audio.off(t,e,i)},get:function(t){return this.core.app.audio.get(t)},exists:function(t){return null!=this.get(t)},loop:function(t){this.core.app.audio.loop(t)},stop:function(t){this.core.app.audio.stop(t)},play:function(t){this.core.app.audio.play(t)},pause:function(t){this.core.app.audio.pause(t)},toggle:function(t){this.core.app.audio.toggle(t)},volume:function(t,e){return this.core.app.audio.volume(t,e)},pan:function(t,e){return this.core.app.audio.pan(t,e)},pitch:function(t,e){return this.core.app.audio.pitch(t,e)},position:function(t,e){return this.core.app.audio.position(t,e)},duration:function(t){return this.core.app.audio.duration(t)},process:function(){},__class__:Fe};var Pe=r["luxe.SizeMode"]={__ename__:["luxe","SizeMode"],__constructs__:["fit","cover","contain"]};Pe.fit=["fit",0],Pe.fit.toString=o,Pe.fit.__enum__=Pe,Pe.cover=["cover",1],Pe.cover.toString=o,Pe.cover.__enum__=Pe,Pe.contain=["contain",2],Pe.contain.toString=o,Pe.contain.__enum__=Pe;var Ne=function(t,e){null==e&&(e=""),null==t&&(t=""),this.name="",this.id="",x.call(this),this.set_name(t),this.set_id(""==e?m.utils.uniqueid():e)};r["luxe.Objects"]=Ne,Ne.__name__=["luxe","Objects"],Ne.__super__=x,Ne.prototype=i(x.prototype,{set_name:function(t){return this.name=t},set_id:function(t){return this.id=t},get_name:function(){return this.name},get_id:function(){return this.id},__class__:Ne,__properties__:{set_name:"set_name",get_name:"get_name",set_id:"set_id",get_id:"get_id"}});var Ge=function(t){this.component_count=0,this.active=!0,this.fixed_rate=0,this.started=!1,this.inited=!1,this.destroyed=!1,Ne.call(this,"entity");var e=this;if(e.set_name(e.get_name()+("."+this.get_id())),this.options=t,this._components=new yi(this),this.children=[],this.events=new qe,this.set_transform(null!=this.options&&null!=this.options.transform?this.options.transform:new gn),this.get_transform().listen_pos(n(this,this.set_pos_from_transform)),this.get_transform().listen_scale(n(this,this.set_scale_from_transform)),this.get_transform().listen_origin(n(this,this.set_origin_from_transform)),this.get_transform().listen_parent(n(this,this.set_parent_from_transform)),this.get_transform().listen_rotation(n(this,this.set_rotation_from_transform)),null!=this.options){if(null==this.options.name_unique&&(this.options.name_unique=!1),this.options.name_unique,null!=this.options.name&&(this.set_name(this.options.name),this.options.name_unique)){var i=this;i.set_name(i.get_name()+("."+this.get_id()))}if(null!=this.options.pos){var s=this.options.pos;this.set_pos(new y(s.x,s.y,s.z,s.w))}if(null!=this.options.scale){var r=this.options.scale;this.set_scale(new y(r.x,r.y,r.z,r.w))}var o=!0;null!=this.options.no_scene&&1==this.options.no_scene&&(o=!1),null!=this.options.parent&&(o=!1,this.set_parent(this.options.parent)),o&&this.set_scene(null!=this.options.scene?this.options.scene:m.scene)}else this.set_scene(m.scene);null!=this.get_scene()&&this.get_scene().add(this)};r["luxe.Entity"]=Ge,Ge.__name__=["luxe","Entity"],Ge.__super__=Ne,Ge.prototype=i(Ne.prototype,{init:function(){},update:function(){},onfixedupdate:function(){},onreset:function(){},ondestroy:function(){},onkeyup:function(){},onkeydown:function(){},ontextinput:function(){},oninputdown:function(){},oninputup:function(){},onmousedown:function(){},onmouseup:function(){},onmousemove:function(){},onmousewheel:function(){},ontouchdown:function(){},ontouchup:function(){},ontouchmove:function(){},ongamepadup:function(){},ongamepaddown:function(){},ongamepadaxis:function(){},ongamepaddevice:function(){},onwindowmoved:function(){},onwindowresized:function(){},onwindowsized:function(){},onwindowminimized:function(){},onwindowrestored:function(){},add:function(t){return this.component_count++,this._components.add(t)},remove:function(t){return this.component_count--,this._components.remove(t)},get:function(t,e){return null==e&&(e=!1),this._components.get(t,e)},get_any:function(t,e,i){return null==i&&(i=!0),null==e&&(e=!1),this._components.get_any(t,e,i)},has:function(t){return this._components.has(t)},_init:function(){if(this.init(),this.emit(2),this.component_count>0)for(var t=0,e=this._components.components;t<e._keys.length;){var i=e.get(e._keys[t++]);i.init()}if(this.children.length>0)for(var s=0,n=this.children;s<n.length;){var r=n[s];++s,r._init()}this.inited=!0},_reset:function(t){if(this.onreset(),this.emit(3),this.component_count>0)for(var e=0,i=this._components.components;e<i._keys.length;){var s=i.get(i._keys[e++]);s.onreset()}if(this.children.length>0)for(var n=0,r=this.children;n<r.length;){var o=r[n];++n,o._reset(t)}this._set_fixed_rate_timer(this.fixed_rate),this.started=!0},destroy:function(t){if(null==t&&(t=!1),this.children.length>0)for(var e=0,i=this.children;e<i.length;){var s=i[e];++e,s.destroy(!0)}if(this.children=null,this.children=[],this.component_count>0)for(var n=0,r=this._components.components;n<r._keys.length;){var o=r.get(r._keys[n++]);o.onremoved(),o.ondestroy()}this.emit(8),this.ondestroy(),null==this.get_parent()||t||this.get_parent()._remove_child(this),null!=this.fixed_rate_timer&&(this.fixed_rate_timer.stop(),this.fixed_rate_timer=null),this.destroyed=!0,this.inited=!1,this.started=!1,null!=this.get_scene()&&this.get_scene().remove(this),null!=this.events&&(this.events.destroy(),this.events=null)},_update:function(t){if(!this.destroyed&&this.get_active()&&this.inited&&this.started){var e=this.get_transform();if(null!=e.parent&&e.parent.dirty){var i=e.parent;i.dirty&&(i._cleaning=!0,i._pos_matrix.makeTranslation(i.local.pos.x,i.local.pos.y,i.local.pos.z),i._rotation_matrix.makeRotationFromQuaternion(i.local.rotation),i._origin_undo_matrix.makeTranslation(-i.origin.x,-i.origin.y,-i.origin.z),i.local.matrix.makeTranslation(i.origin.x,i.origin.y,i.origin.z),i.local.matrix.multiply(i._rotation_matrix),i.local.matrix.scale(i.local.scale),i.local.matrix.setPosition(i.local.pos),i.local.matrix.multiply(i._origin_undo_matrix),i.get_world().set_matrix(null!=i.parent?i.get_world().get_matrix().multiplyMatrices(i.parent.get_world().get_matrix(),i.local.matrix):i.local.matrix.clone()),i.get_world().decompose(!1),i.dirty=!1,i.dirty&&!i._setup&&null!=i._dirty_handlers&&i._dirty_handlers.length>0&&i.propagate_dirty(),i.dirty,i._cleaning=!1,null!=i._clean_handlers&&i._clean_handlers.length>0&&i.propagate_clean())}if(e.dirty&&!e._cleaning&&e.dirty&&(e._cleaning=!0,e._pos_matrix.makeTranslation(e.local.pos.x,e.local.pos.y,e.local.pos.z),e._rotation_matrix.makeRotationFromQuaternion(e.local.rotation),e._origin_undo_matrix.makeTranslation(-e.origin.x,-e.origin.y,-e.origin.z),e.local.matrix.makeTranslation(e.origin.x,e.origin.y,e.origin.z),e.local.matrix.multiply(e._rotation_matrix),e.local.matrix.scale(e.local.scale),e.local.matrix.setPosition(e.local.pos),e.local.matrix.multiply(e._origin_undo_matrix),e.get_world().set_matrix(null!=e.parent?e.get_world().get_matrix().multiplyMatrices(e.parent.get_world().get_matrix(),e.local.matrix):e.local.matrix.clone()),e.get_world().decompose(!1),e.dirty=!1,e.dirty&&!e._setup&&null!=e._dirty_handlers&&e._dirty_handlers.length>0&&e.propagate_dirty(),e.dirty,e._cleaning=!1,null!=e._clean_handlers&&e._clean_handlers.length>0&&e.propagate_clean()),this.update(t),null!=this.events&&this.events.process(),this.component_count>0)for(var s=0,n=this._components.components;s<n._keys.length;){var r=n.get(n._keys[s++]);r.update(t)}if(this.children.length>0)for(var o=0,l=this.children;o<l.length;){var a=l[o];++o,a._update(t)}}},_fixed_update:function(){if(!this.destroyed&&this.get_active()&&this.inited&&this.started){if(this.emit(7),this.onfixedupdate(this.fixed_rate),this.component_count>0)for(var t=0,e=this._components.components;t<e._keys.length;){var i=e.get(e._keys[t++]);i.onfixedupdate(this.fixed_rate)}if(this.children.length>0)for(var s=0,n=this.children;s<n.length;){var r=n[s];++s,r._fixed_update()}}},_find_emit_source:function(t){null==t&&(t=!1);var e=null;if(null!=this.get_scene())e=this.get_scene();else if(null!=this.get_parent())for(var i=!0,s=this.get_parent();i;){if(null!=s.get_scene()){e=s.get_scene(),i=!1;break}if(null==s.get_parent()){i=!1;break}s=s.get_parent()}return e},_listen:function(t,e,i){null==i&&(i=!1),i||this.on(t,e);var s=this._find_emit_source(null);if(null!=s)switch(t){case 13:s.on(t,n(this,this._keyup));break;case 12:s.on(t,n(this,this._keydown));break;case 14:s.on(t,n(this,this._textinput));break;case 17:s.on(t,n(this,this._mousedown));break;case 18:s.on(t,n(this,this._mouseup));break;case 19:s.on(t,n(this,this._mousemove));break;case 20:s.on(t,n(this,this._mousewheel));break;case 21:s.on(t,n(this,this._touchdown));break;case 22:s.on(t,n(this,this._touchup));break;case 23:s.on(t,n(this,this._touchmove));break;case 16:s.on(t,n(this,this._inputup));break;case 15:s.on(t,n(this,this._inputdown));break;case 25:s.on(t,n(this,this._gamepaddown));break;case 26:s.on(t,n(this,this._gamepadup));break;case 24:s.on(t,n(this,this._gamepadaxis));break;case 27:s.on(t,n(this,this._gamepaddevice));break;case 29:s.on(t,n(this,this._windowmoved));break;case 30:s.on(t,n(this,this._windowresized));break;case 31:s.on(t,n(this,this._windowsized));break;case 32:s.on(t,n(this,this._windowminimized));break;case 33:s.on(t,n(this,this._windowrestored))}},_unlisten:function(t,e,i){null==i&&(i=!1);var s=this._find_emit_source(!0);if(i||this.off(t,e),null!=s)switch(t){case 13:s.off(t,n(this,this._keyup));break;case 12:s.off(t,n(this,this._keydown));break;case 14:s.off(t,n(this,this._textinput));break;case 17:s.off(t,n(this,this._mousedown));break;case 18:s.off(t,n(this,this._mouseup));break;case 19:s.off(t,n(this,this._mousemove));break;case 20:s.off(t,n(this,this._mousewheel));break;case 21:s.off(t,n(this,this._touchdown));break;case 22:s.off(t,n(this,this._touchup));break;case 23:s.off(t,n(this,this._touchmove));break;case 16:s.off(t,n(this,this._inputup));break;case 15:s.off(t,n(this,this._inputdown));break;case 25:s.off(t,n(this,this._gamepaddown));break;case 26:s.off(t,n(this,this._gamepadup));break;case 24:s.off(t,n(this,this._gamepadaxis));break;case 27:s.off(t,n(this,this._gamepaddevice));break;case 29:s.off(t,n(this,this._windowmoved));break;case 30:s.off(t,n(this,this._windowresized));break;case 31:s.off(t,n(this,this._windowsized));break;case 32:s.off(t,n(this,this._windowminimized));break;case 33:s.off(t,n(this,this._windowrestored))}},_detach_scene:function(){null!=this.get_scene()&&(this.get_scene().off(3,n(this,this._reset)),this.get_scene().off(8,n(this,this.destroy)),this.get_scene().off(13,n(this,this._keyup)),this.get_scene().off(12,n(this,this._keydown)),this.get_scene().off(14,n(this,this._textinput)),this.get_scene().off(17,n(this,this._mousedown)),this.get_scene().off(18,n(this,this._mouseup)),this.get_scene().off(19,n(this,this._mousemove)),this.get_scene().off(20,n(this,this._mousewheel)),this.get_scene().off(21,n(this,this._touchdown)),this.get_scene().off(22,n(this,this._touchup)),this.get_scene().off(23,n(this,this._touchmove)),this.get_scene().off(16,n(this,this._inputup)),this.get_scene().off(15,n(this,this._inputdown)),this.get_scene().off(25,n(this,this._gamepaddown)),this.get_scene().off(26,n(this,this._gamepadup)),this.get_scene().off(24,n(this,this._gamepadaxis)),this.get_scene().off(27,n(this,this._gamepaddevice)),this.get_scene().off(29,n(this,this._windowmoved)),this.get_scene().off(30,n(this,this._windowresized)),this.get_scene().off(31,n(this,this._windowsized)),this.get_scene().off(32,n(this,this._windowminimized)),this.get_scene().off(33,n(this,this._windowrestored)))},_attach_scene:function(){null!=this.get_scene()&&(this.get_scene().on(3,n(this,this._reset)),this.get_scene().on(8,n(this,this.destroy)))},_keyup:function(t){this.get_active()&&this.inited&&this.started&&(this.onkeyup(t),this.emit(13,t))},_keydown:function(t){this.get_active()&&this.inited&&this.started&&(this.onkeydown(t),this.emit(12,t))},_textinput:function(t){this.get_active()&&this.inited&&this.started&&(this.ontextinput(t),this.emit(14,t))},_mousedown:function(t){this.get_active()&&this.inited&&this.started&&(this.onmousedown(t),this.emit(17,t))},_mouseup:function(t){this.get_active()&&this.inited&&this.started&&(this.onmouseup(t),this.emit(18,t))},_mousewheel:function(t){this.get_active()&&this.inited&&this.started&&(this.onmousewheel(t),this.emit(20,t))},_mousemove:function(t){this.get_active()&&this.inited&&this.started&&(this.onmousemove(t),this.emit(19,t))},_touchdown:function(t){this.get_active()&&this.inited&&this.started&&(this.ontouchdown(t),this.emit(21,t))},_touchup:function(t){this.get_active()&&this.inited&&this.started&&(this.ontouchup(t),this.emit(22,t))},_touchmove:function(t){this.get_active()&&this.inited&&this.started&&(this.ontouchmove(t),this.emit(23,t))},_gamepadaxis:function(t){this.get_active()&&this.inited&&this.started&&(this.ongamepadaxis(t),this.emit(24,t))},_gamepaddown:function(t){this.get_active()&&this.inited&&this.started&&(this.ongamepaddown(t),this.emit(25,t))},_gamepadup:function(t){this.get_active()&&this.inited&&this.started&&(this.ongamepadup(t),this.emit(26,t))},_gamepaddevice:function(t){this.get_active()&&this.inited&&this.started&&(this.ongamepaddevice(t),this.emit(27,t))},_windowmoved:function(t){this.get_active()&&this.inited&&this.started&&(this.onwindowmoved(t),this.emit(29,t))},_windowresized:function(t){this.get_active()&&this.inited&&this.started&&(this.onwindowresized(t),this.emit(30,t))},_windowsized:function(t){this.get_active()&&this.inited&&this.started&&(this.onwindowsized(t),this.emit(31,t))},_windowminimized:function(t){this.get_active()&&this.inited&&this.started&&(this.onwindowminimized(t),this.emit(32,t))},_windowrestored:function(t){this.get_active()&&this.inited&&this.started&&(this.onwindowrestored(t),this.emit(33,t))},_inputdown:function(t){this.get_active()&&this.inited&&this.started&&(this.oninputdown(t.name,t.event),this.emit(15,t))},_inputup:function(t){this.get_active()&&this.inited&&this.started&&(this.oninputup(t.name,t.event),this.emit(16,t))},get_fixed_rate:function(){return this.fixed_rate},set_fixed_rate:function(t){return this.fixed_rate=t,this.started&&(null!=this.fixed_rate_timer&&(this.fixed_rate_timer.stop(),this.fixed_rate_timer=null),0==t||null!=this.get_parent()||this.destroyed||(this.fixed_rate_timer=new qn(t),this.fixed_rate_timer.run=n(this,this._fixed_update))),this.fixed_rate},_stop_fixed_rate_timer:function(){null!=this.fixed_rate_timer&&(this.fixed_rate_timer.stop(),this.fixed_rate_timer=null)},_set_fixed_rate_timer:function(t){null!=this.fixed_rate_timer&&(this.fixed_rate_timer.stop(),this.fixed_rate_timer=null),0==t||null!=this.get_parent()||this.destroyed||(this.fixed_rate_timer=new qn(t),this.fixed_rate_timer.run=n(this,this._fixed_update))},get_components:function(){return this._components.components},_add_child:function(t){if(this.children.push(t),null!=t.get_scene()){t.get_scene().remove(t)}},_remove_child:function(t){d.remove(this.children,t)},set_pos_from_transform:function(t){if(this.component_count>0)for(var e=0,i=this._components.components;e<i._keys.length;){var s=i.get(i._keys[e++]);s.entity_pos_change(t)}},set_rotation_from_transform:function(t){if(this.component_count>0)for(var e=0,i=this._components.components;e<i._keys.length;){var s=i.get(i._keys[e++]);s.entity_rotation_change(t)}},set_scale_from_transform:function(t){if(this.component_count>0)for(var e=0,i=this._components.components;e<i._keys.length;){var s=i.get(i._keys[e++]);s.entity_scale_change(t)}},set_origin_from_transform:function(t){if(this.component_count>0)for(var e=0,i=this._components.components;e<i._keys.length;){var s=i.get(i._keys[e++]);s.entity_origin_change(t)}},set_parent_from_transform:function(t){if(this.component_count>0)for(var e=0,i=this._components.components;e<i._keys.length;){var s=i.get(i._keys[e++]);s.entity_parent_change(t)}},set_pos:function(t){return this.get_transform().set_pos(t)},get_pos:function(){return this.get_transform().get_pos()},set_rotation:function(t){return this.get_transform().set_rotation(t)},get_rotation:function(){return this.get_transform().get_rotation()},set_scale:function(t){return this.get_transform().set_scale(t)},get_scale:function(){return this.get_transform().get_scale()},set_origin:function(t){return this.get_transform().set_origin(t)},get_origin:function(){return this.get_transform().get_origin()},set_transform:function(t){return this.transform=t},get_transform:function(){return this.transform},set_parent:function(t){if(t==this)throw new Ie(ei.assertion("other != this ( Entity setting itself as parent makes no sense )"));return null!=this.get_parent()&&this.get_parent()._remove_child(this),this.parent=t,null!=this.get_parent()?(this.get_parent()._add_child(this),this.get_transform().set_parent(this.get_parent().get_transform())):this.get_transform().set_parent(null),this.get_parent()},get_parent:function(){return this.parent},set_scene:function(t){return this._detach_scene(),this.scene=t,this._attach_scene(),this.get_scene()},get_scene:function(){return this.scene},set_name:function(t){if(null==t)throw new Ie(ei.null_assertion("_name was null"));var e=this.get_scene();if(null!=e){var i=this.get_name();e.entities.remove(i),e.entities.exists(t),e.entities.set(t,this),e._has_changed=!0}return this.name=t},set_active:function(t){return this.active=t},get_active:function(){return this.active},__class__:Ge,__properties__:i(Ne.prototype.__properties__,{set_origin:"set_origin",get_origin:"get_origin",set_scale:"set_scale",get_scale:"get_scale",set_rotation:"set_rotation",get_rotation:"get_rotation",set_pos:"set_pos",get_pos:"get_pos",set_transform:"set_transform",get_transform:"get_transform",set_active:"set_active",get_active:"get_active",set_scene:"set_scene",get_scene:"get_scene",set_parent:"set_parent",get_parent:"get_parent",set_fixed_rate:"set_fixed_rate",get_fixed_rate:"get_fixed_rate",get_components:"get_components"})});var De=function(t){this._connected=!1,this.minimum_shake=.1,this.shaking=!1,this._size_factor=new y,this._rotation_radian=new y,this._rotation_cache=new nn,this.set_size_mode(Pe.fit);var e="untitled camera";null!=t?null!=t.name&&(e=t.name,t.camera_name=""+e+".view"):t={no_scene:!1},null==t.view&&(t.view=new Ws(t)),this.view=t.view,Ge.call(this,{name:e,no_scene:t.no_scene}),this._final_pos=this.view.get_pos()};r["luxe.Camera"]=De,De.__name__=["luxe","Camera"],De.__super__=Ge,De.prototype=i(Ge.prototype,{get_viewport:function(){return this.view.get_viewport()},set_viewport:function(t){return this.view.set_viewport(t)},get_center:function(){return this.view.get_center()},set_center:function(t){return this.set_pos(new y(t.x-this.get_viewport().w/2,t.y-this.get_viewport().h/2)),this.view.set_center(t)},get_minimum_zoom:function(){return this.view.minimum_zoom},set_minimum_zoom:function(t){return this.view.minimum_zoom=t},get_zoom:function(){return this.view.zoom},set_zoom:function(t){if(this.view.set_zoom(t),null!=this.get_size()){var e=this.view.get_scale();e.set_x(e.x*(1/this._size_factor.x));var i=this.view.get_scale();i.set_y(i.y*(1/this._size_factor.y))}return this.view.zoom},get_size:function(){return this.size},get_size_mode:function(){return this.size_mode},set_size_mode:function(t){return null!=this.get_size_mode()&&(this.size_mode=t,null!=this.get_size()&&this.set_size(this.get_size())),this.size_mode=t},_onwindowsized:function(t){null!=this.get_size()&&(this.set_viewport(new on(this.get_viewport().x,this.get_viewport().y,t.event.x,t.event.y)),this.set_size(this.get_size()))},set_size:function(t){if(null==t)return this.set_center(new y(this.get_viewport().w/2,this.get_viewport().h/2)),this.size=t,this._size_factor.set_x(this._size_factor.set_y(1)),this.set_zoom(this.get_zoom()),this._connected=!1,m.off(31,n(this,this._onwindowsized)),this.get_size();this._connected||(m.on(31,n(this,this._onwindowsized)),this._connected=!0);var e=this.get_viewport().w/t.x,i=this.get_viewport().h/t.y,s=Math.max(e,i),r=Math.min(e,i),o=this.get_size_mode();switch(o[1]){case 0:e=i=r;break;case 1:e=i=s;break;case 2:}return this._size_factor.set_x(e),this._size_factor.set_y(i),this.view.get_scale().set_x(1/(this._size_factor.x*this.get_zoom())),this.view.get_scale().set_y(1/(this._size_factor.y*this.get_zoom())),this.set_center(new y(t.x/2,t.y/2)),this.size=new y(t.x,t.y,t.z,t.w)},focus:function(t,e,i){null==e&&(e=.6);var s=this;is.tween(this.view.get_center(),e,{x:t.x,y:t.y},!0).onComplete(i).ease($i.get_easeInOut()).onUpdate(function(){var t=s.get_transform().get_pos(),e=s.view.get_pos().x,i=s.view.get_pos().y,n=t.ignore_listeners;t.ignore_listeners=!0,t.x=e,t._construct?t.x:(null==t.listen_x||t.ignore_listeners||t.listen_x(e),t.x),t.y=i,t._construct?t.y:(null==t.listen_y||t.ignore_listeners||t.listen_y(i),t.y),t.ignore_listeners=n,null==t.listen_x||t.ignore_listeners||t.listen_x(t.x),null==t.listen_y||t.ignore_listeners||t.listen_y(t.y)})},screen_point_to_world:function(t){return this.view.screen_point_to_world(t)},world_point_to_screen:function(t,e){return this.view.world_point_to_screen(t,e)},set_pos_from_transform:function(t){var e=this.view.get_viewport().w,i=this.view.get_viewport().h,s=e/2,n=i/2,r=t.x,o=t.y;null!=this.bounds&&(r<this.bounds.x&&(r=this.bounds.x),o<this.bounds.y&&(o=this.bounds.y),r+s>this.bounds.w-e&&(r=this.bounds.w-e-s),o+n>this.bounds.h-i&&(o=this.bounds.h-i-n));var l=t.ignore_listeners;t.ignore_listeners=!0;var a=t.ignore_listeners;t.ignore_listeners=!0,t.x=r,t._construct?t.x:(null==t.listen_x||t.ignore_listeners||t.listen_x(r),t.x),t.y=o,t._construct?t.y:(null==t.listen_y||t.ignore_listeners||t.listen_y(o),t.y),t.ignore_listeners=a,null==t.listen_x||t.ignore_listeners||t.listen_x(t.x),null==t.listen_y||t.ignore_listeners||t.listen_y(t.y),t.ignore_listeners=l,Ge.prototype.set_pos_from_transform.call(this,t),this.update_view_pos=t},set_rotation_from_transform:function(t){Ge.prototype.set_rotation_from_transform.call(this,t),null!=this.view&&this.view.set_rotation(t)},set_scale_from_transform:function(t){Ge.prototype.set_scale_from_transform.call(this,t),null!=this.view&&this.view.set_scale(t)},shake:function(t){this.shake_amount=t,this.shaking=!0},update:function(){if(this.shaking){var t=this._final_pos,e=this.get_transform().get_pos().x,i=this.get_transform().get_pos().y,s=this.get_transform().get_pos().z,n=t.ignore_listeners;t.ignore_listeners=!0,t.x=e,t._construct?t.x:(null==t.listen_x||t.ignore_listeners||t.listen_x(e),t.x),t.y=i,t._construct?t.y:(null==t.listen_y||t.ignore_listeners||t.listen_y(i),t.y),t.z=s,t._construct?t.z:(null==t.listen_z||t.ignore_listeners||t.listen_z(s),t.z),t.ignore_listeners=n,null==t.listen_x||t.ignore_listeners||t.listen_x(t.x),null==t.listen_y||t.ignore_listeners||t.listen_y(t.y),null==t.listen_z||t.ignore_listeners||t.listen_z(t.z),this.shake_vector=m.utils.geometry.random_point_in_unit_circle();var r=this.shake_vector;r.set_x(r.x*this.shake_amount);var o=this.shake_vector;o.set_y(o.y*this.shake_amount);var l=this.shake_vector;l.set_z(l.z*this.shake_amount),this.shake_amount*=.9,this.shake_amount<=this.minimum_shake&&(this.shake_amount=0,this.shaking=!1);var a=this._final_pos,h=this._final_pos.x+this.shake_vector.x,_=this._final_pos.y+this.shake_vector.y,u=this._final_pos.z+this.shake_vector.z,c=a.ignore_listeners;a.ignore_listeners=!0,a.x=h,a._construct?a.x:(null==a.listen_x||a.ignore_listeners||a.listen_x(h),a.x),a.y=_,a._construct?a.y:(null==a.listen_y||a.ignore_listeners||a.listen_y(_),a.y),a.z=u,a._construct?a.z:(null==a.listen_z||a.ignore_listeners||a.listen_z(u),a.z),a.ignore_listeners=c,null==a.listen_x||a.ignore_listeners||a.listen_x(a.x),null==a.listen_y||a.ignore_listeners||a.listen_y(a.y),null==a.listen_z||a.ignore_listeners||a.listen_z(a.z),this.update_view_pos=this._final_pos}null!=this.update_view_pos&&null!=this.view&&(this.view.set_pos(this.update_view_pos.clone()),this.update_view_pos=null)},init:function(){Ge.prototype.init.call(this)},ondestroy:function(){Ge.prototype.ondestroy.call(this)},__class__:De,__properties__:i(Ge.prototype.__properties__,{set_size_mode:"set_size_mode",get_size_mode:"get_size_mode",set_size:"set_size",get_size:"get_size",set_minimum_zoom:"set_minimum_zoom",get_minimum_zoom:"get_minimum_zoom",set_zoom:"set_zoom",get_zoom:"get_zoom",set_center:"set_center",get_center:"get_center",set_viewport:"set_viewport",get_viewport:"get_viewport"})});var Le=function(){this.next_render=0,this.next_tick=0,this.alpha=1,this.cur_frame_start=0,this.current_time=0,this.last_frame_start=0,this.delta_sim=.016666666666666666,this.delta_time=.016666666666666666,this.max_frame_time=.25,this.update_rate=0,this.render_rate=-1,this.fixed_delta=0,this.timescale=1};r["snow.App"]=Le,Le.__name__=["snow","App"],Le.prototype={config:function(t){return t},ready:function(){},update:function(){},ondestroy:function(){},onevent:function(){},ontickstart:function(){},ontickend:function(){},onkeydown:function(){},onkeyup:function(){},ontextinput:function(){},onmousedown:function(){},onmouseup:function(){},onmousewheel:function(){},onmousemove:function(){},ontouchdown:function(){},ontouchup:function(){},ontouchmove:function(){},ongamepadaxis:function(){},ongamepaddown:function(){},ongamepadup:function(){},ongamepaddevice:function(){},on_internal_init:function(){this.cur_frame_start=Nn.core.timestamp(),this.last_frame_start=this.cur_frame_start,this.current_time=0,this.delta_time=.016},on_internal_update:function(){if(0!=this.update_rate){if(Nn.core.timestamp()<this.next_tick)return;this.next_tick=Nn.core.timestamp()+this.update_rate}this.cur_frame_start=Nn.core.timestamp(),this.delta_time=this.cur_frame_start-this.last_frame_start,this.last_frame_start=this.cur_frame_start,this.delta_time>this.max_frame_time&&(this.delta_time=this.max_frame_time);var t;t=0==this.fixed_delta?this.delta_time:this.fixed_delta,t*=this.timescale,this.delta_sim=t,this.current_time+=t,this.app.do_internal_update(t)},on_internal_render:function(){0!=this.render_rate&&(this.render_rate<0||this.next_render<Nn.core.timestamp())&&(this.app.render(),this.next_render+=this.render_rate)},__class__:Le};var Oe=function(t,e){this.inited=!1,this.has_shutdown=!1,this.shutting_down=!1,this.headless=!1,this.console_visible=!1,Le.call(this),this.init_config=e,this.game=t,this.game.app=this,this.emitter=new x,m.core=this,m.utils=new Bs(this)};r["luxe.Core"]=Oe,Oe.__name__=["luxe","Core"],Oe.__super__=Le,Oe.prototype=i(Le.prototype,{ready:function(){m.version=te.getString("version"),m.build=m.version+te.getString("build"),this.headless=null==this.app.window,this.init(null)},ondestroy:function(){this.shutting_down=!0,this.game.ondestroy(),this.emitter.emit(8),null!=this.renderer&&this.renderer.destroy(),this.physics.destroy(),this.input.destroy(),this.audio.destroy(),this.timer.destroy(),this.events.destroy(),this.debug.destroy(),this.emitter=null,this.input=null,this.audio=null,this.events=null,this.timer=null,this.debug=null,m.utils=null,this.has_shutdown=!0},init:function(t){m.debug=this.debug=new He(this),m.io=this.io=new Ke(this),this.draw=new Ve(this),this.timer=new vi(this),this.events=new qe,this.audio=new Fe(this),this.input=new Je(this),this.physics=new ai(this),this.resources=new _i,m.resources=this.resources,this.headless||(this.app.window.onevent=n(this,this.window_event),this.renderer=new un(this,t),m.renderer=this.renderer);var e=0,i=0;null!=this.app.window&&(e=this.app.window.width,i=this.app.window.height),this.screen=new di(this,e,i),this.debug.init(),this.io.init(),this.timer.init(),this.audio.init(),this.input.init(),this.headless||this.renderer.init(),this.physics.init(),m.audio=this.audio,m.draw=this.draw,m.events=this.events,m.timer=this.timer,m.input=this.input,this.headless||(m.camera=new De({name:"default camera",view:this.renderer.camera})),m.physics=this.physics,this.scene=new ci("default scene"),m.scene=this.scene,this.headless||(this.scene.add(m.camera),this.debug.create_debug_console()),this.internal_pre_ready()
},internal_pre_ready:function(){if(this.headless)this.internal_ready(null);else{var t=new ni({id:"default_parcel",system:this.resources,bytes:this.appconfig.preload.bytes,texts:this.appconfig.preload.texts,jsons:this.appconfig.preload.jsons,textures:this.appconfig.preload.textures,fonts:this.appconfig.preload.fonts,shaders:this.appconfig.preload.shaders,sounds:this.appconfig.preload.sounds,oncomplete:n(this,this.internal_ready),onfailed:function(t){throw new Ie(br.error(t))}});t.load()}},internal_ready:function(){null==this.app.window||this.headless||(this.app.window.onrender=n(this,this.render),this.debug.start(Ue.update,50),this.debug.start(Ue.renderdt,50)),this.game.ready(),this.shutting_down||(this.emitter.emit(2),this.inited=!0,this.physics.reset(),this.app.snow_config.has_loop||this.shutdown())},shutdown:function(){this.shutting_down=!0,m.next((Ur=this.app,n(Ur,Ur.shutdown)))},on:function(t,e){this.emitter.on(t,e)},off:function(t,e){return this.emitter.off(t,e)},emit:function(t,e){this.emitter.emit(t,e)},ontickstart:function(){this.has_shutdown||this.emitter.emit(4)},ontickend:function(){this.has_shutdown||this.emitter.emit(5)},onevent:function(t){this.game.onevent(t)},update:function(t){this.has_shutdown||this.inited&&(this.debug.end(Ue.update),this.debug.start(Ue.update),this.timer.process(),this.input.process(),this.audio.process(),this.events.process(),this.physics.process(),this.debug.start(Ue.updates),this.emitter.emit(6,t),this.debug.end(Ue.updates),this.debug.start(Ue.game_update),this.game.update(t),this.debug.end(Ue.game_update),this.debug.process())},window_event:function(t){if(!this.shutting_down&&this.inited){this.emitter.emit(28,t);var e=t.type;if(null!=e)switch(e){case 5:this.emitter.emit(29,t),this.game.onwindowmoved(t);break;case 6:this.screen.internal_resized(t.event.x,t.event.y),this.renderer.internal_resized(t.event.x,t.event.y),this.emitter.emit(30,t),this.game.onwindowresized(t);break;case 7:this.screen.internal_resized(t.event.x,t.event.y),this.renderer.internal_resized(t.event.x,t.event.y),this.emitter.emit(31,t),this.game.onwindowsized(t);break;case 8:this.emitter.emit(32,t),this.game.onwindowminimized(t);break;case 10:this.emitter.emit(33,t),this.game.onwindowrestored(t)}}},render:function(){this.shutting_down||this.inited&&(this.debug.end(Ue.renderdt),this.debug.start(Ue.renderdt),this.headless||(this.debug.start(Ue.render),this.emitter.emit(9),this.game.onprerender(),this.emitter.emit(10),this.game.onrender(),this.renderer.process(),this.emitter.emit(11),this.game.onpostrender(),this.debug.end(Ue.render)))},show_console:function(t){null==t&&(t=!0),this.console_visible=t,this.debug.show_console(this.console_visible)},onkeydown:function(t,e,i,s,n,r){if(this.inited){var o={scancode:e,keycode:t,state:Qe.down,mod:s,repeat:i,timestamp:n,window_id:r};this.shutting_down||(this.input.check_named_keys(o,!0),this.emitter.emit(12,o),this.game.onkeydown(o),e==$n.grave&&this.show_console(!this.console_visible))}},onkeyup:function(t,e,i,s,n,r){if(this.inited){var o={scancode:e,keycode:t,state:Qe.up,mod:s,repeat:i,timestamp:n,window_id:r};this.shutting_down||(this.input.check_named_keys(o),this.emitter.emit(13,o),this.game.onkeyup(o))}},ontextinput:function(t,e,i,s,n,r){if(this.inited){var o=Xe.unknown;switch(s){case 1:o=Xe.edit;break;case 2:o=Xe.input;break;default:return}var l={text:t,start:e,length:i,type:o,timestamp:n,window_id:r};this.shutting_down||(this.emitter.emit(14,l),this.game.ontextinput(l))}},oninputdown:function(t,e){this.inited&&(this.shutting_down||(this.emitter.emit(15,{name:t,event:e}),this.game.oninputdown(t,e)))},oninputup:function(t,e){this.inited&&(this.shutting_down||(this.emitter.emit(16,{name:t,event:e}),this.game.oninputup(t,e)))},onmousedown:function(t,e,i,s,n){if(this.inited){this.screen.cursor.set_internal(new y(t,e));var r={timestamp:s,window_id:n,state:Qe.down,button:i,x:t,y:e,xrel:t,yrel:e,pos:this.screen.cursor.get_pos()};this.shutting_down||(this.input.check_named_mouse(r,!0),this.emitter.emit(17,r),this.game.onmousedown(r))}},onmouseup:function(t,e,i,s,n){if(this.inited){this.screen.cursor.set_internal(new y(t,e));var r={timestamp:s,window_id:n,state:Qe.up,button:i,x:t,y:e,xrel:t,yrel:e,pos:this.screen.cursor.get_pos()};this.shutting_down||(this.input.check_named_mouse(r),this.emitter.emit(18,r),this.game.onmouseup(r))}},onmousemove:function(t,e,i,s,n,r){if(this.inited){this.screen.cursor.set_internal(new y(t,e));var o={timestamp:n,window_id:r,state:Qe.move,button:0,x:t,y:e,xrel:i,yrel:s,pos:this.screen.cursor.get_pos()};this.shutting_down||(this.emitter.emit(19,o),this.game.onmousemove(o))}},onmousewheel:function(t,e,i,s){if(this.inited){var n={timestamp:i,window_id:s,state:Qe.wheel,button:0,x:t,y:e,xrel:t,yrel:e,pos:this.screen.cursor.get_pos()};this.shutting_down||(this.input.check_named_mouse(n,!1),this.emitter.emit(20,n),this.game.onmousewheel(n))}},ontouchdown:function(t,e,i,s){if(this.inited){this._touch_pos=new y(t,e);var n={state:Qe.down,timestamp:s,touch_id:i,x:t,y:e,dx:t,dy:e,pos:this._touch_pos};this.shutting_down||(this.emitter.emit(21,n),this.game.ontouchdown(n))}},ontouchup:function(t,e,i,s){if(this.inited){this._touch_pos=new y(t,e);var n={state:Qe.up,timestamp:s,touch_id:i,x:t,y:e,dx:t,dy:e,pos:this._touch_pos};this.shutting_down||(this.emitter.emit(22,n),this.game.ontouchup(n))}},ontouchmove:function(t,e,i,s,n,r){if(this.inited){this._touch_pos=new y(t,e);var o={state:Qe.move,timestamp:r,touch_id:n,x:t,y:e,dx:i,dy:s,pos:this._touch_pos};this.shutting_down||(this.emitter.emit(23,o),this.game.ontouchmove(o))}},ongamepadaxis:function(t,e,i,s){if(this.inited){var n={timestamp:s,type:We.axis,state:Qe.axis,gamepad:t,button:-1,axis:e,value:i,id:null};this.shutting_down||(this.emitter.emit(24,n),this.game.ongamepadaxis(n))}},ongamepaddown:function(t,e,i,s){if(this.inited){var n={timestamp:s,type:We.button,state:Qe.down,gamepad:t,button:e,axis:-1,value:i,id:null};this.shutting_down||(this.input.check_named_gamepad_buttons(n,!0),this.emitter.emit(25,n),this.game.ongamepaddown(n))}},ongamepadup:function(t,e,i,s){if(this.inited){var n={timestamp:s,type:We.button,state:Qe.up,gamepad:t,button:e,axis:-1,value:i,id:null};this.shutting_down||(this.input.check_named_gamepad_buttons(n,!1),this.emitter.emit(26,n),this.game.ongamepadup(n))}},ongamepaddevice:function(t,e,i,s){if(this.inited){var n=We.unknown;switch(i){case 1:n=We.device_added;break;case 2:n=We.device_removed;break;case 3:n=We.device_remapped}var r={timestamp:s,type:n,state:Qe.none,gamepad:t,button:-1,axis:-1,value:0,id:e};this.shutting_down||this.game.ongamepaddevice(r)}},config:function(t){return this.appconfig=t,this.appconfig.window.width=this.init_config.window.width,this.appconfig.window.height=this.init_config.window.height,this.appconfig.window.fullscreen=this.init_config.window.fullscreen,this.appconfig.window.borderless=this.init_config.window.borderless,this.appconfig.window.resizable=this.init_config.window.resizable,this.appconfig.window.title=this.init_config.window.title,this.appconfig.preload={bytes:[],texts:[],jsons:[],textures:[],fonts:[],shaders:[],sounds:[]},this.appconfig=this.game.config(this.appconfig),this.appconfig},runtime_info:function(){return""+m.build+" / debug:"+C.string(this.app.debug)+" / os:"+this.app.os+" / platform:"+this.app.platform},__class__:Oe});var Ue=function(){};r["luxe.Tag"]=Ue,Ue.__name__=["luxe","Tag"];var He=function(t){this.last_cursor_grab=!1,this.last_cursor_shown=!0,this.profiling=!1,this.profile_path="profile.txt",this.started=!1,this.last_view_index=0,this.current_view_index=0,this.dt_average_count=0,this.dt_average_span=60,this.dt_average_accum=0,this.dt_average=0,this.visible=!1,this.core=t};r["luxe.Debug"]=He,He.__name__=["luxe","Debug"],He.internal_trace=function(e,i){var s=B.rpad(null==i.lineNumber?"null":""+i.lineNumber," ",4);if(t.log(""+i.fileName+"::"+s+" "+C.string(e)),!He.shut_down)for(var n=He.trace_callbacks.iterator();n.hasNext();){var r=n.next();r(e,i)}},He.prototype={init:function(){He.trace_callbacks=new de,He.views=[],$.trace=He.internal_trace},get_view:function(t){for(var e=0,i=He.views;e<i.length;){var s=i[e];if(++e,s.get_name()==t)return s}return null},start:function(){},end:function(){},remove_trace_listener:function(t){He.trace_callbacks.remove(t)},add_trace_listener:function(t,e){He.trace_callbacks.set(t,e)},create_debug_console:function(){},mouseup:function(t){if(this.visible)for(var e=0,i=He.views;e<i.length;){var s=i[e];++e,s.onmouseup(t)}},mousedown:function(t){if(this.visible)for(var e=0,i=He.views;e<i.length;){var s=i[e];++e,s.onmousedown(t)}},mousewheel:function(t){if(this.visible)for(var e=0,i=He.views;e<i.length;){var s=i[e];++e,s.onmousewheel(t)}},mousemove:function(t){if(this.visible)for(var e=0,i=He.views;e<i.length;){var s=i[e];++e,s.onmousemove(t)}},keyup:function(t){if(this.visible)for(var e=0,i=He.views;e<i.length;){var s=i[e];++e,s.onkeyup(t)}},keydown:function(t){if(this.visible){t.keycode==tr.key_1&&this.core.console_visible&&this.switch_view();for(var e=0,i=He.views;e<i.length;){var s=i[e];++e,s.onkeydown(t)}}},refresh:function(){null!=this.current_view&&this.current_view.refresh()},switch_view:function(){this.last_view_index=this.current_view_index,this.current_view_index++,this.current_view_index>He.views.length-1&&(this.current_view_index=0),He.views[this.last_view_index].hide(),this.current_view=He.views[this.current_view_index],this.current_view.show()},show_console:function(t){null==t&&(t=!0)},destroy:function(){this.core.emitter.off(13,n(this,this.keyup)),this.core.emitter.off(12,n(this,this.keydown)),this.core.emitter.off(18,n(this,this.mouseup)),this.core.emitter.off(17,n(this,this.mousedown)),this.core.emitter.off(19,n(this,this.mousemove)),this.core.emitter.off(20,n(this,this.mousewheel)),He.shut_down=!0},process:function(){if(this.dt_average_accum+=m.core.delta_time,this.dt_average_count++,this.dt_average_count==this.dt_average_span-1&&(this.dt_average=this.dt_average_accum/this.dt_average_span,this.dt_average_accum=this.dt_average,this.dt_average_count=0),this.visible){this.inspector.title.set_text("["+this.current_view.get_name()+"] / "+Math.round(1/this.dt_average)+" / "+Cs.fixed(m.core.delta_time,5)+" / "+Cs.fixed(this.dt_average,5));for(var t=0,e=He.views;t<e.length;){var i=e[t];++t,i.process()}}},__class__:He};var Ve=function(t){this.core=t};r["luxe.Draw"]=Ve,Ve.__name__=["luxe","Draw"],Ve.prototype={line:function(t){if(null==t.p0)throw new Ie(ei.null_assertion("options.p0 was null ( draw.line requires p0:Vector, and p1:Vector )"));if(null==t.p1)throw new Ie(ei.null_assertion("options.p1 was null ( draw.line requires p0:Vector, and p1:Vector )"));return null==t.id&&(t.id="line.geometry"),t.id,null==t.batcher&&(t.batcher=m.renderer.batcher),t.batcher,new Sn(t)},rectangle:function(t){return null==t.id&&(t.id="rectangle.geometry"),t.id,null==t.batcher&&(t.batcher=m.renderer.batcher),t.batcher,new En(t)},box:function(t){return null==t.id&&(t.id="quad.geometry"),t.id,null==t.batcher&&(t.batcher=m.renderer.batcher),t.batcher,new An(t)},ring:function(t){return null==t.id&&(t.id="ring.geometry"),t.id,null==t.batcher&&(t.batcher=m.renderer.batcher),t.batcher,new xn(t)},circle:function(t){return null==t.id&&(t.id="circle.geometry"),t.id,null==t.batcher&&(t.batcher=m.renderer.batcher),t.batcher,new wn(t)},arc:function(t){return null==t.id&&(t.id="arc.geometry"),t.id,null==t.batcher&&(t.batcher=m.renderer.batcher),t.batcher,new bn(t)},ngon:function(t){null==t.id&&(t.id="ngon.geometry"),t.id,null==t.batcher&&(t.batcher=m.renderer.batcher),t.batcher;var e=3,i=64,s=!1,n=0,r=0,o=0;null!=t.sides&&(e=t.sides),null!=t.r&&(i=t.r),null!=t.x&&(n=t.x),null!=t.y&&(r=t.y),null!=t.angle&&(o=t.angle),null!=t.solid&&(s=t.solid),t.primitive_type=s?6:1;var l=new yn(t),a=2*Math.PI,h=Math.PI/e,_=a/e,u=.017453292519943278*o,c=t.color;s&&l.add(new Bn(new y(n,r),c));var d;d=0==s?e:e+1;for(var f=[],p=0;d>p;){var g=p++,v=i*Math.sin(u+h+g*_),w=i*Math.cos(u+h+g*_),x=new y(n+v,r+w,0);if(l.add(new Bn(x,c)),!s&&g>0){{f[g-1]}l.add(new Bn(x,c))}f.push(x)}return s||l.add(new Bn(f[0],c)),l},poly:function(t){null==t.id&&(t.id="poly.geometry"),t.id,null==t.batcher&&(t.batcher=m.renderer.batcher),t.batcher,null==t.solid&&(t.solid=!0),t.solid,null==t.close&&(t.close=!1),t.close;var e=null,i=null!=t.colors;if(i||(null==t.color&&(t.color=new F),e=t.color),t.solid){null==t.primitive_type&&(t.primitive_type=6),t.primitive_type;for(var s=new yn(t),n=0,r=(t.points.length,0),o=t.points;r<o.length;){var l=o[r];++r;var a;a=i?t.colors[n]:e,s.add(new Bn(l,a)),++n}return s}null==t.primitive_type&&(t.primitive_type=1),t.primitive_type;for(var h=new yn(t),_=0,u=t.points.length,c=0,d=t.points;c<d.length;){var f=d[c];++c;var p;if(p=i?t.colors[_]:e,h.add(new Bn(f,p)),u-2>_){var g;g=i?t.colors[_+1]:e,h.add(new Bn(t.points[_+1],g))}++_}if(t.close){var v,y=t.points.length-1;v=i?t.colors[0]:e;var w;w=i?t.colors[y]:e,h.add(new Bn(t.points[y],v)),h.add(new Bn(t.points[0],w))}return h},texture:function(t){null==t.id&&(t.id="texture.geometry"),t.id,null==t.batcher&&(t.batcher=m.renderer.batcher),t.batcher;var e=0,i=0,s=0,n=0,r=64,o=64;null!=t.texture&&(r=t.texture.width,o=t.texture.height,null==t.size&&(s=r,n=o)),null!=t.pos&&(e=t.pos.x,i=t.pos.y),null!=t.size&&(s=t.size.x,n=t.size.y),null==t.x&&(t.x=e),t.x,null==t.y&&(t.y=i),t.y,null==t.w&&(t.w=s),t.w,null==t.h&&(t.h=n),t.h;var l=new An(t),a=0,h=0,_=r,u=o;return null!=t.uv&&(a=t.uv.x,h=t.uv.y,_=t.uv.w,u=t.uv.h),l.uv(new on(a,h,_,u)),l},text:function(t){return null==t.batcher&&(t.batcher=m.renderer.batcher),t.batcher,new Mn(t)},plane:function(t){return null==t.id&&(t.id="plane.geometry"),t.id,null==t.batcher&&(t.batcher=m.renderer.batcher),t.batcher,new Tn(t)},__class__:Ve};var qe=function(){this.listen_count=0,this.event_connections=new de,this.event_slots=new de,this.event_filters=new de,this.event_queue=new de,this.event_schedules=new de};r["luxe.Events"]=qe,qe.__name__=["luxe","Events"],qe.prototype={destroy:function(){this.clear()},clear:function(){for(var t=this.event_schedules.iterator();t.hasNext();){var e=t.next();e.stop(),e=null}for(var i=this.event_connections.keys();i.hasNext();){var s=i.next();this.event_connections.remove(s)}for(var n=this.event_filters.keys();n.hasNext();){var r=n.next();this.event_filters.remove(r)}for(var o=this.event_slots.keys();o.hasNext();){var l=o.next();this.event_slots.remove(l)}for(var a=this.event_queue.keys();a.hasNext();){var h=a.next();this.event_queue.remove(h)}},does_filter_event:function(t,e){var i=new _("\\*","gi"),s=i.replace(t,".*?"),n=new _(s,"gi");return n.match(e)},listen:function(t,e){this.listen_count++;var i=m.utils.uniqueid(),s=new je(i,t,e);this.event_connections.set(i,s);var n=new _("\\*","gi");return n.match(t)?(this.event_filters.exists(t)||this.event_filters.set(t,[]),this.event_filters.get(t).push(s)):(this.event_slots.exists(t)||this.event_slots.set(t,[]),this.event_slots.get(t).push(s)),i},unlisten:function(t){if(this.listen_count--,this.event_connections.exists(t)){var e=this.event_connections.get(t),i=this.event_slots.get(e.event_name);if(null!=i)return d.remove(i,e),!0;var s=this.event_filters.get(e.event_name);return null!=s?(d.remove(s,e),!0):!1}return!1},queue:function(t,e){var i=m.utils.uniqueid(),s=new Ze(i,t,e);return this.event_queue.set(i,s),i},dequeue:function(t){if(this.event_queue.exists(t)){var e=this.event_queue.get(t);return e=null,this.event_queue.remove(t),!0}return!1},process:function(){if(0!=this.listen_count){for(var t=this.event_queue.iterator();t.hasNext();){var e=t.next();this.fire(e.name,e.properties)}this.event_queue.keys().hasNext()&&(this.event_queue=null,this.event_queue=new de)}},fire:function(t,e,i){null==i&&(i=!1);for(var s=!1,n=this.event_filters.iterator();n.hasNext();){var r=n.next();if(r.length>0){var o=r[0].event_name;if(this.does_filter_event(o,t)){i&&(e=this.tag_properties(e,t,r.length));for(var l=0;l<r.length;){var a=r[l];++l,a.listener(e)}s=!0}}}if(this.event_slots.exists(t)){var h=this.event_slots.get(t);i&&(e=this.tag_properties(e,t,h.length));for(var _=0;_<h.length;){var u=h[_];++_,u.listener(e)}s=!0}return s},schedule:function(t,e,i){var s=m.utils.uniqueid(),r=m.timer.schedule(t,function(t,e,i){return function(){return t(e,i)}}(n(this,this.fire),e,i));return this.event_schedules.set(s,r),s},unschedule:function(t){if(this.event_schedules.exists(t)){var e=this.event_schedules.get(t);return e.stop(),this.event_schedules.remove(t),!0}return!1},tag_properties:function(t,e,i){return null==t&&(t={}),t._event_name_=e,t._event_connection_count_=i,t},__class__:qe};var je=function(t,e,i){this.id=t,this.listener=i,this.event_name=e};r["luxe._Events.EventConnection"]=je,je.__name__=["luxe","_Events","EventConnection"],je.prototype={__class__:je};var Ze=function(t,e,i){this.id=t,this.name=e,this.properties=i};r["luxe._Events.EventObject"]=Ze,Ze.__name__=["luxe","_Events","EventObject"],Ze.prototype={__class__:Ze};var Ke=function(t){this.core=t};r["luxe.IO"]=Ke,Ke.__name__=["luxe","IO"],Ke.prototype={url_open:function(t){this.core.app.io.module.url_open(t)},string_save:function(t,e,i){return null==i&&(i=0),this.core.app.io.string_save(t,e,i)},string_load:function(t,e){return null==e&&(e=0),this.core.app.io.string_load(t,e)},string_destroy:function(t){return null==t&&(t=0),this.core.app.io.string_destroy(t)},init:function(){},__class__:Ke};var Qe=r["luxe.InteractState"]={__ename__:["luxe","InteractState"],__constructs__:["unknown","none","down","up","move","wheel","axis"]};Qe.unknown=["unknown",0],Qe.unknown.toString=o,Qe.unknown.__enum__=Qe,Qe.none=["none",1],Qe.none.toString=o,Qe.none.__enum__=Qe,Qe.down=["down",2],Qe.down.toString=o,Qe.down.__enum__=Qe,Qe.up=["up",3],Qe.up.toString=o,Qe.up.__enum__=Qe,Qe.move=["move",4],Qe.move.toString=o,Qe.move.__enum__=Qe,Qe.wheel=["wheel",5],Qe.wheel.toString=o,Qe.wheel.__enum__=Qe,Qe.axis=["axis",6],Qe.axis.toString=o,Qe.axis.__enum__=Qe;var Xe=r["luxe.TextEventType"]={__ename__:["luxe","TextEventType"],__constructs__:["unknown","edit","input"]};Xe.unknown=["unknown",0],Xe.unknown.toString=o,Xe.unknown.__enum__=Xe,Xe.edit=["edit",1],Xe.edit.toString=o,Xe.edit.__enum__=Xe,Xe.input=["input",2],Xe.input.toString=o,Xe.input.__enum__=Xe;var We=r["luxe.GamepadEventType"]={__ename__:["luxe","GamepadEventType"],__constructs__:["unknown","axis","button","device_added","device_removed","device_remapped"]};We.unknown=["unknown",0],We.unknown.toString=o,We.unknown.__enum__=We,We.axis=["axis",1],We.axis.toString=o,We.axis.__enum__=We,We.button=["button",2],We.button.toString=o,We.button.__enum__=We,We.device_added=["device_added",3],We.device_added.toString=o,We.device_added.__enum__=We,We.device_removed=["device_removed",4],We.device_removed.toString=o,We.device_removed.__enum__=We,We.device_remapped=["device_remapped",5],We.device_remapped.toString=o,We.device_remapped.__enum__=We;var Ye=r["luxe.InputType"]={__ename__:["luxe","InputType"],__constructs__:["mouse","touch","keys","gamepad"]};Ye.mouse=["mouse",0],Ye.mouse.toString=o,Ye.mouse.__enum__=Ye,Ye.touch=["touch",1],Ye.touch.toString=o,Ye.touch.__enum__=Ye,Ye.keys=["keys",2],Ye.keys.toString=o,Ye.keys.__enum__=Ye,Ye.gamepad=["gamepad",3],Ye.gamepad.toString=o,Ye.gamepad.__enum__=Ye;var Je=function(t){this.core=t};r["luxe.Input"]=Je,Je.__name__=["luxe","Input"],Je.prototype={init:function(){this.key_bindings=new de,this.mouse_bindings=new de,this.gamepad_bindings=new de,this._named_input_down=new de,this._named_input_pressed=new de,this._named_input_released=new de},destroy:function(){},process:function(){for(var t=this._named_input_pressed.keys();t.hasNext();){var e=t.next();this._named_input_pressed.get(e)?this._named_input_pressed.remove(e):this._named_input_pressed.set(e,!0)}for(var i=this._named_input_released.keys();i.hasNext();){var s=i.next();this._named_input_released.get(s)?this._named_input_released.remove(s):this._named_input_released.set(s,!0)}},inputpressed:function(t){return this._named_input_pressed.exists(t)},inputreleased:function(t){return this._named_input_released.exists(t)},inputdown:function(t){return this._named_input_down.exists(t)},keypressed:function(t){return this.core.app.input.keypressed(t)},keyreleased:function(t){return this.core.app.input.keyreleased(t)},keydown:function(t){return this.core.app.input.keydown(t)},scanpressed:function(t){return this.core.app.input.scanpressed(t)},scanreleased:function(t){return this.core.app.input.scanreleased(t)},scandown:function(t){return this.core.app.input.scandown(t)},mousepressed:function(t){return this.core.app.input.mousepressed(t)},mousereleased:function(t){return this.core.app.input.mousereleased(t)},mousedown:function(t){return this.core.app.input.mousedown(t)},gamepadpressed:function(t,e){return this.core.app.input.gamepadpressed(t,e)},gamepadreleased:function(t,e){return this.core.app.input.gamepadreleased(t,e)},gamepaddown:function(t,e){return this.core.app.input.gamepaddown(t,e)},gamepadaxis:function(t,e){return this.core.app.input.gamepadaxis(t,e)},bind_key:function(t,e){if(!this.key_bindings.exists(t)){var i=new _e;this.key_bindings.set(t,i)}var s=this.key_bindings.get(t);s.h[e]=!0},bind_mouse:function(t,e){if(!this.mouse_bindings.exists(t)){var i=new _e;this.mouse_bindings.set(t,i)}var s=this.mouse_bindings.get(t);s.h[e]=!0},bind_gamepad:function(t,e,i){if(!this.gamepad_bindings.exists(t)){var s=new _e;this.gamepad_bindings.set(t,s)}var n=this.gamepad_bindings.get(t);n.h[e]=i},check_named_keys:function(t,e){null==e&&(e=!1);for(var i=[],s=this.key_bindings.keys();s.hasNext();){var n=s.next(),r=this.key_bindings.get(n),o=e&&t.repeat;r.h.hasOwnProperty(t.keycode)&&!o&&(f.has(i,n)||i.push(n))}for(var l=0;l<i.length;){var a=i[l];++l,e?(this._named_input_pressed.set(a,!1),this._named_input_down.set(a,!0),this.core.oninputdown(a,{name:a,type:Ye.keys,state:Qe.down,key_event:t})):(this._named_input_released.set(a,!1),this._named_input_down.remove(a),this.core.oninputup(a,{name:a,type:Ye.keys,state:Qe.up,key_event:t}))}},check_named_mouse:function(t,e){null==e&&(e=!1);for(var i=[],s=this.mouse_bindings.keys();s.hasNext();){var n=s.next(),r=this.mouse_bindings.get(n);r.h.hasOwnProperty(t.button)&&(f.has(i,n)||i.push(n))}for(var o=0;o<i.length;){var l=i[o];++o,e?(this._named_input_pressed.set(l,!1),this._named_input_down.set(l,!0),this.core.oninputdown(l,{name:l,type:Ye.mouse,state:Qe.down,mouse_event:t})):(this._named_input_released.set(l,!1),this._named_input_down.remove(l),this.core.oninputup(l,{name:l,type:Ye.mouse,state:Qe.up,mouse_event:t}))}},check_named_gamepad_buttons:function(t,e){null==e&&(e=!1);for(var i=[],s=this.gamepad_bindings.keys();s.hasNext();){var n=s.next(),r=this.gamepad_bindings.get(n);if(r.h.hasOwnProperty(t.button)){var o=r.h[t.button],l=null==o||o==t.gamepad;!f.has(i,n)&&l&&i.push(n)}}for(var a=0;a<i.length;){var h=i[a];++a,e?(this._named_input_pressed.set(h,!1),this._named_input_down.set(h,!0),this.core.oninputdown(h,{name:h,type:Ye.gamepad,state:Qe.down,gamepad_event:t})):(this._named_input_released.set(h,!1),this._named_input_down.remove(h),this.core.oninputup(h,{name:h,type:Ye.gamepad,state:Qe.up,gamepad_event:t}))}},__class__:Je};var $e=r["luxe._Log.LogError"]={__ename__:["luxe","_Log","LogError"],__constructs__:["RequireString"]};$e.RequireString=function(t){var e=["RequireString",0,t];return e.__enum__=$e,e.toString=o,e};var ti=function(){};r["luxe.Log"]=ti,ti.__name__=["luxe","Log"],ti._get_spacing=function(t){var e="",i=t.length+4,s=ti._log_width-i;if(s>0)for(var n=0;s>n;){{n++}e+=" "}return e};var ei=r["luxe.DebugError"]={__ename__:["luxe","DebugError"],__constructs__:["assertion","null_assertion"]};ei.assertion=function(t){var e=["assertion",0,t];return e.__enum__=ei,e.toString=o,e},ei.null_assertion=function(t){var e=["null_assertion",1,t];return e.__enum__=ei,e.toString=o,e};var ii=function(t){if(this.ignore_texture_on_geometry_change=!1,this._creating_geometry=!1,this._has_custom_origin=!1,this.radians=0,this.depth=0,this.visible=!0,this.locked=!1,null==t)throw new Ie(ei.null_assertion("_options was null ( Visual requires non-null options )"));this._rotation_euler=new y,this._rotation_quat=new nn,Ge.call(this,t),this.set_color(new F),this.set_size(new y),null!=this.options.texture&&this.set_texture(this.options.texture),null!=this.options.shader&&this.set_shader(this.options.shader),null!=this.options.color&&this.set_color(this.options.color),null!=this.options.depth&&this.set_depth(this.options.depth),null!=this.options.visible&&this.set_visible(this.options.visible),null!=this.options.size?(this.set_size(this.options.size),this._create_geometry()):null!=this.texture?(this.set_size(new y(this.texture.width,this.texture.height)),this._create_geometry()):(this.set_size(new y(64,64)),this._create_geometry())};r["luxe.Visual"]=ii,ii.__name__=["luxe","Visual"],ii.__super__=Ge,ii.prototype=i(Ge.prototype,{_create_geometry:function(){if(null==this.options.geometry){if(null==this.options.no_geometry||0==this.options.no_geometry){this._creating_geometry=!0;var t=null;(null==this.options.no_batcher_add||0==this.options.no_batcher_add)&&(t=null!=this.options.batcher?this.options.batcher:m.renderer.batcher),this.set_geometry(new An({id:this.get_name()+".visual",x:0,y:0,w:this.size.x,h:this.size.y,scale:new y(1,1,1),texture:this.texture,color:this.color,shader:this.shader,batcher:t,depth:null==this.options.depth?0:this.options.depth,visible:null==this.options.visible?this.visible:this.options.visible})),this._creating_geometry=!1,this.on_geometry_created()}}else this.set_geometry(this.options.geometry);null!=this.geometry&&(this.geometry.id=this.get_name()+".visual",this.geometry.transform.id=this.get_name()+".visual.transform"),null!=this.options.origin&&(this._has_custom_origin=!0,this.set_origin(this.options.origin)),null!=this.options.rotation_z&&this.set_rotation_z(this.options.rotation_z)},ondestroy:function(){null!=this.geometry&&this.geometry.added&&this.geometry.drop(!0),this.set_geometry(null),this.set_texture(null)},on_geometry_created:function(){},set_visible:function(t){return this.visible=t,null!=this.geometry&&this.geometry.set_visible(this.visible),this.visible},set_depth:function(t){return null!=this.geometry&&this.geometry.set_depth(t),this.depth=t},set_color:function(t){return null!=this.color&&null!=this.geometry&&this.geometry.set_color(t),this.color=t},set_texture:function(t){return null!=this.geometry&&this.geometry.state.texture!=t&&this.geometry.set_texture(t),this.texture=t},set_shader:function(t){return null!=this.geometry&&this.geometry.state.shader!=t&&this.geometry.set_shader(t),this.shader=t},set_geometry:function(t){return this.geometry==t?this.geometry:(null!=this.geometry&&this.geometry.drop(),this.geometry=t,null!=this.geometry&&(this.geometry.transform.set_parent(this.get_transform()),0==this._creating_geometry&&(this.geometry.set_color(this.color),this.geometry.set_depth(this.depth),this.geometry.set_visible(this.visible),!this.ignore_texture_on_geometry_change)),this.geometry)},set_parent_from_transform:function(t){Ge.prototype.set_parent_from_transform.call(this,t),null!=this.geometry&&this.geometry.transform.set_parent(this.get_transform())},set_rotation_from_transform:function(t){Ge.prototype.set_rotation_from_transform.call(this,t),this._rotation_euler.setEulerFromQuaternion(t,null),this._rotation_quat.copy(t)},set_size:function(t){return this.size=t,null!=this.size&&y.Listen(this.size,n(this,this._size_change)),this.size},get_rotation_z:function(){return Cs.degrees(this.get_radians())},set_rotation_z:function(t){return this.set_radians(.017453292519943278*t),t},set_radians:function(t){return this._rotation_euler.set_z(t),this._rotation_quat.setFromEuler(this._rotation_euler),this.set_rotation(this._rotation_quat.clone()),this.radians=t},get_radians:function(){return this.radians},set_locked:function(t){return null!=this.geometry&&this.geometry.set_locked(t),this.locked=t},set_clip_rect:function(t){return null!=this.geometry&&this.geometry.set_clip_rect(t),this.clip_rect=t},_size_change:function(){this.set_size(this.size)},init:function(){Ge.prototype.init.call(this)},__class__:ii,__properties__:i(Ge.prototype.__properties__,{set_rotation_z:"set_rotation_z",get_rotation_z:"get_rotation_z",set_radians:"set_radians",get_radians:"get_radians",set_clip_rect:"set_clip_rect",set_depth:"set_depth",set_visible:"set_visible",set_color:"set_color",set_shader:"set_shader",set_texture:"set_texture",set_locked:"set_locked",set_geometry:"set_geometry",set_size:"set_size"})});var si=function(t){this.added=!1,this.midheight=0,this.midwidth=0,this.is_set=!1,this.source_h=0,this.source_w=0,this.source_y=0,this.source_x=0,this.height=0,this.bottom=32,this.width=0,this.right=32,this.left=32,this.top=32,this.slices=[],null==t?t={no_geometry:!0}:t.no_geometry=!0,this.nineslice_options=t,this._batcher=null!=t.batcher?t.batcher:m.renderer.batcher,ii.call(this,t),null!=t.top&&(this.top=t.top),null!=t.left&&(this.left=t.left),null!=t.right&&(this.right=t.right),null!=t.bottom&&(this.bottom=t.bottom),null!=t.source_x&&(this.source_x=t.source_x),null!=t.source_y&&(this.source_y=t.source_y),this.source_w=null!=t.source_w?t.source_w:this.texture.width,this.source_h=null!=t.source_h?t.source_h:this.texture.height,this.set_geometry(null)};r["luxe.NineSlice"]=si,si.__name__=["luxe","NineSlice"],si.__super__=ii,si.prototype=i(ii.prototype,{lock:function(){this.is_set&&null!=this._geometry&&this._geometry.set_locked(!0)},dirty:function(){this.is_set&&null!=this._geometry&&this._geometry.set_dirty(!0)},update_size:function(t,e){this.width=t,this.height=e,this.midwidth=Math.abs(this.width-this.left-this.right),this.midheight=Math.abs(this.height-this.top-this.bottom),this.slices[0].source_width=this.left,this.slices[0].source_height=this.top,this.slices[0].source_x=this.source_x,this.slices[0].source_y=this.source_y;var i=this.slices[0].pos,s=i.ignore_listeners;i.ignore_listeners=!0,i.x=0,i._construct?i.x:(null==i.listen_x||i.ignore_listeners||i.listen_x(0),i.x),i.y=0,i._construct?i.y:(null==i.listen_y||i.ignore_listeners||i.listen_y(0),i.y),i.ignore_listeners=s,null==i.listen_x||i.ignore_listeners||i.listen_x(i.x),null==i.listen_y||i.ignore_listeners||i.listen_y(i.y),this.slices[0].width=this.left,this.slices[0].height=this.top,this.slices[1].source_width=this.source_w-this.left-this.right,this.slices[1].source_height=this.top,this.slices[1].source_x=this.source_x+this.left,this.slices[1].source_y=this.source_y;var n=this.slices[1].pos,r=this.left,o=n.ignore_listeners;n.ignore_listeners=!0,n.x=r,n._construct?n.x:(null==n.listen_x||n.ignore_listeners||n.listen_x(r),n.x),n.y=0,n._construct?n.y:(null==n.listen_y||n.ignore_listeners||n.listen_y(0),n.y),n.ignore_listeners=o,null==n.listen_x||n.ignore_listeners||n.listen_x(n.x),null==n.listen_y||n.ignore_listeners||n.listen_y(n.y),this.slices[1].width=this.width-this.left-this.right,this.slices[1].height=this.top,this.slices[2].source_width=this.right,this.slices[2].source_height=this.top,this.slices[2].source_x=this.source_x+(this.source_w-this.right),this.slices[2].source_y=this.source_y;var l=this.slices[2].pos,a=this.left+this.midwidth,h=l.ignore_listeners;l.ignore_listeners=!0,l.x=a,l._construct?l.x:(null==l.listen_x||l.ignore_listeners||l.listen_x(a),l.x),l.y=0,l._construct?l.y:(null==l.listen_y||l.ignore_listeners||l.listen_y(0),l.y),l.ignore_listeners=h,null==l.listen_x||l.ignore_listeners||l.listen_x(l.x),null==l.listen_y||l.ignore_listeners||l.listen_y(l.y),this.slices[2].width=this.right,this.slices[2].height=this.top,this.slices[3].source_width=this.left,this.slices[3].source_height=this.source_h-this.top-this.bottom,this.slices[3].source_x=this.source_x,this.slices[3].source_y=this.source_y+this.top;var _=this.slices[3].pos,u=this.top,c=_.ignore_listeners;_.ignore_listeners=!0,_.x=0,_._construct?_.x:(null==_.listen_x||_.ignore_listeners||_.listen_x(0),_.x),_.y=u,_._construct?_.y:(null==_.listen_y||_.ignore_listeners||_.listen_y(u),_.y),_.ignore_listeners=c,null==_.listen_x||_.ignore_listeners||_.listen_x(_.x),null==_.listen_y||_.ignore_listeners||_.listen_y(_.y),this.slices[3].width=this.left,this.slices[3].height=this.height-this.top-this.bottom,this.slices[4].source_width=this.source_w-this.left-this.right,this.slices[4].source_height=this.source_h-this.top-this.bottom,this.slices[4].source_x=this.source_x+this.left,this.slices[4].source_y=this.source_y+this.top;
var d=this.slices[4].pos,f=this.left,p=this.top,g=d.ignore_listeners;d.ignore_listeners=!0,d.x=f,d._construct?d.x:(null==d.listen_x||d.ignore_listeners||d.listen_x(f),d.x),d.y=p,d._construct?d.y:(null==d.listen_y||d.ignore_listeners||d.listen_y(p),d.y),d.ignore_listeners=g,null==d.listen_x||d.ignore_listeners||d.listen_x(d.x),null==d.listen_y||d.ignore_listeners||d.listen_y(d.y),this.slices[4].width=this.width-this.left-this.right,this.slices[4].height=this.height-this.top-this.bottom,this.slices[5].source_width=this.right,this.slices[5].source_height=this.source_h-this.top-this.bottom,this.slices[5].source_x=this.source_x+(this.source_w-this.right),this.slices[5].source_y=this.source_y+this.top;var m=this.slices[5].pos,v=this.left+this.midwidth,y=this.top,w=m.ignore_listeners;m.ignore_listeners=!0,m.x=v,m._construct?m.x:(null==m.listen_x||m.ignore_listeners||m.listen_x(v),m.x),m.y=y,m._construct?m.y:(null==m.listen_y||m.ignore_listeners||m.listen_y(y),m.y),m.ignore_listeners=w,null==m.listen_x||m.ignore_listeners||m.listen_x(m.x),null==m.listen_y||m.ignore_listeners||m.listen_y(m.y),this.slices[5].width=this.right,this.slices[5].height=this.height-this.top-this.bottom,this.slices[6].source_width=this.left,this.slices[6].source_height=this.bottom,this.slices[6].source_x=this.source_x,this.slices[6].source_y=this.source_y+(this.source_h-this.bottom);var x=this.slices[6].pos,b=this.top+this.midheight,k=x.ignore_listeners;x.ignore_listeners=!0,x.x=0,x._construct?x.x:(null==x.listen_x||x.ignore_listeners||x.listen_x(0),x.x),x.y=b,x._construct?x.y:(null==x.listen_y||x.ignore_listeners||x.listen_y(b),x.y),x.ignore_listeners=k,null==x.listen_x||x.ignore_listeners||x.listen_x(x.x),null==x.listen_y||x.ignore_listeners||x.listen_y(x.y),this.slices[6].width=this.left,this.slices[6].height=this.bottom,this.slices[7].source_width=this.source_w-this.left-this.right,this.slices[7].source_height=this.bottom,this.slices[7].source_x=this.source_x+this.left,this.slices[7].source_y=this.source_y+(this.source_h-this.bottom);var z=this.slices[7].pos,S=this.left,T=this.top+this.midheight,A=z.ignore_listeners;z.ignore_listeners=!0,z.x=S,z._construct?z.x:(null==z.listen_x||z.ignore_listeners||z.listen_x(S),z.x),z.y=T,z._construct?z.y:(null==z.listen_y||z.ignore_listeners||z.listen_y(T),z.y),z.ignore_listeners=A,null==z.listen_x||z.ignore_listeners||z.listen_x(z.x),null==z.listen_y||z.ignore_listeners||z.listen_y(z.y),this.slices[7].width=this.width-this.left-this.right,this.slices[7].height=this.bottom,this.slices[8].source_width=this.right,this.slices[8].source_height=this.bottom,this.slices[8].source_x=this.source_x+(this.source_w-this.right),this.slices[8].source_y=this.source_y+(this.source_h-this.bottom);var I=this.slices[8].pos,E=this.left+this.midwidth,M=this.top+this.midheight,C=I.ignore_listeners;I.ignore_listeners=!0,I.x=E,I._construct?I.x:(null==I.listen_x||I.ignore_listeners||I.listen_x(E),I.x),I.y=M,I._construct?I.y:(null==I.listen_y||I.ignore_listeners||I.listen_y(M),I.y),I.ignore_listeners=C,null==I.listen_x||I.ignore_listeners||I.listen_x(I.x),null==I.listen_y||I.ignore_listeners||I.listen_y(I.y),this.slices[8].width=this.right,this.slices[8].height=this.bottom},set:function(t,e){this.added&&(this._geometry.drop(),this.added=!1),this.slices.splice(0,this.slices.length),this.width=t,this.height=e,this.midwidth=Math.abs(this.width-this.left-this.right),this.midheight=Math.abs(this.height-this.top-this.bottom),this.slices.push({source_width:this.left,source_height:this.top,source_x:this.source_x,source_y:this.source_y,pos:new y(0,0),width:this.left,height:this.top,geometry_id:0}),this.slices.push({source_width:this.source_w-this.left-this.right,source_height:this.top,source_x:this.source_x+this.left,source_y:this.source_y,pos:new y(this.left,0),width:this.width-this.left-this.right,height:this.top,geometry_id:0}),this.slices.push({source_width:this.right,source_height:this.top,source_x:this.source_x+(this.source_w-this.right),source_y:this.source_y,pos:new y(this.left+this.midwidth,0),width:this.right,height:this.top,geometry_id:0}),this.slices.push({source_width:this.left,source_height:this.source_h-this.top-this.bottom,source_x:this.source_x,source_y:this.source_y+this.top,pos:new y(0,this.top),width:this.left,height:this.height-this.top-this.bottom,geometry_id:0}),this.slices.push({source_width:this.source_w-this.left-this.right,source_height:this.source_h-this.top-this.bottom,source_x:this.source_x+this.left,source_y:this.source_y+this.top,pos:new y(this.left,this.top),width:this.width-this.left-this.right,height:this.height-this.top-this.bottom,geometry_id:0}),this.slices.push({source_width:this.right,source_height:this.source_h-this.top-this.bottom,source_x:this.source_x+(this.source_w-this.right),source_y:this.source_y+this.top,pos:new y(this.left+this.midwidth,this.top),width:this.right,height:this.height-this.top-this.bottom,geometry_id:0}),this.slices.push({source_width:this.left,source_height:this.bottom,source_x:this.source_x,source_y:this.source_y+(this.source_h-this.bottom),pos:new y(0,this.top+this.midheight),width:this.left,height:this.bottom,geometry_id:0}),this.slices.push({source_width:this.source_w-this.left-this.right,source_height:this.bottom,source_x:this.source_x+this.left,source_y:this.source_y+(this.source_h-this.bottom),pos:new y(this.left,this.top+this.midheight),width:this.width-this.left-this.right,height:this.bottom,geometry_id:0}),this.slices.push({source_width:this.right,source_height:this.bottom,source_x:this.source_x+(this.source_w-this.right),source_y:this.source_y+(this.source_h-this.bottom),pos:new y(this.left+this.midwidth,this.top+this.midheight),width:this.right,height:this.bottom,geometry_id:0}),this.is_set=!0},set_size:function(t){if(!this.is_set)return t;this.update_size(t.x,t.y);for(var e=0,i=this.slices;e<i.length;){var s=i[e];++e,null!=this._geometry&&this._geometry.quad_resize(s.geometry_id,new on(s.pos.x,s.pos.y,s.width,s.height))}return t},_create:function(t,e,i,s){null==s&&(s=!1),(!this.is_set||s)&&this.set(e,i);var n=new F;this._geometry=new In({texture:this.texture,color:n,depth:this.nineslice_options.depth,visible:this.nineslice_options.visible,batcher:this._batcher});for(var r=0,o=this.slices;r<o.length;){var l=o[r];++r,l.geometry_id=this._geometry.quad_add({x:l.pos.x,y:l.pos.y,w:l.width,h:l.height,color:this.nineslice_options.color,uv:new on(l.source_x,l.source_y,l.source_width,l.source_height)})}this._geometry.id=this.get_name()+".NineSlice."+this._geometry.id,this.set_geometry(this._geometry),this.set_pos(t),this.added=!0,this.is_set=!0},create:function(t,e,i,s){null==s&&(s=!1),null!=this.texture&&this._create(t,e,i,s)},init:function(){ii.prototype.init.call(this)},ondestroy:function(){ii.prototype.ondestroy.call(this)},__class__:si});var ni=function(t){this.load_start_delay=.2,this.load_time_spacing=.05,this.start_load=0,this.time_to_load=0,null==t&&(t={}),null==t.system&&(t.system=m.resources),t.system,null==t.id&&(t.id=m.utils.uniqueid()),t.id,null!=t.oncomplete&&(this.oncomplete=t.oncomplete),null!=t.onprogress&&(this.onprogress=t.onprogress),null!=t.onfailed&&(this.onfailed=t.onfailed),null!=t.load_time_spacing&&(this.load_time_spacing=t.load_time_spacing),null!=t.load_start_delay&&(this.load_start_delay=t.load_start_delay),this.state=0,this.loaded=[],this.emitter=new x,this.system=t.system,this.id=t.id,this.list=this.empty_list(),null!=t.bytes&&(this.list.bytes=t.bytes),null!=t.texts&&(this.list.texts=t.texts),null!=t.jsons&&(this.list.jsons=t.jsons),null!=t.textures&&(this.list.textures=t.textures),null!=t.fonts&&(this.list.fonts=t.fonts),null!=t.shaders&&(this.list.shaders=t.shaders),null!=t.sounds&&(this.list.sounds=t.sounds),this.system.track(this)};r["luxe.Parcel"]=ni,ni.__name__=["luxe","Parcel"],ni.prototype={on:function(t,e){this.emitter.on(t,e)},off:function(t,e){this.emitter.off(t,e)},emit:function(t,e){this.emitter.emit(t,e)},is_loaded:function(t){return-1!=d.indexOf(this.loaded,t,0)},load:function(t){var e=this;this.state=1,m.timer.schedule(this.load_start_delay,function(){if(e.start_load=Nn.core.timestamp(),null==t&&(t=e.id),e.list.bytes.length+e.list.texts.length+e.list.jsons.length+e.list.textures.length+e.list.shaders.length+e.list.fonts.length+e.list.sounds.length==0)return e.state=2,e.time_to_load=Nn.core.timestamp()-e.start_load,e.emitter.emit(2,e),void(null!=e.oncomplete&&e.oncomplete(e));for(var i=0,s=0,n=e.list.bytes;s<n.length;){var r=[n[s]];++s,-1==d.indexOf(e.loaded,r[0].id,0)?(e.loaded.push(r[0].id),m.timer.schedule(e.load_time_spacing,function(s){return function(){var n=s[0].id,r=e.system.load_bytes(s[0].id);r.then(function(){return function(s){e.one_loaded(n,t,s,++i,e.list.bytes.length+e.list.texts.length+e.list.jsons.length+e.list.textures.length+e.list.shaders.length+e.list.fonts.length+e.list.sounds.length)}}(),function(){return function(s){e.one_failed(n,t,s,++i,e.list.bytes.length+e.list.texts.length+e.list.jsons.length+e.list.textures.length+e.list.shaders.length+e.list.fonts.length+e.list.sounds.length)}}())}}(r))):e.one_loaded(r[0].id,t,e.system.cache.get(r[0].id),++i,e.list.bytes.length+e.list.texts.length+e.list.jsons.length+e.list.textures.length+e.list.shaders.length+e.list.fonts.length+e.list.sounds.length)}for(var o=0,l=e.list.texts;o<l.length;){var a=[l[o]];++o,-1==d.indexOf(e.loaded,a[0].id,0)?(e.loaded.push(a[0].id),m.timer.schedule(e.load_time_spacing*i,function(s){return function(){var n=s[0].id,r=e.system.load_text(s[0].id);r.then(function(){return function(s){e.one_loaded(n,t,s,++i,e.list.bytes.length+e.list.texts.length+e.list.jsons.length+e.list.textures.length+e.list.shaders.length+e.list.fonts.length+e.list.sounds.length)}}(),function(){return function(s){e.one_failed(n,t,s,++i,e.list.bytes.length+e.list.texts.length+e.list.jsons.length+e.list.textures.length+e.list.shaders.length+e.list.fonts.length+e.list.sounds.length)}}())}}(a))):e.one_loaded(a[0].id,t,e.system.cache.get(a[0].id),++i,e.list.bytes.length+e.list.texts.length+e.list.jsons.length+e.list.textures.length+e.list.shaders.length+e.list.fonts.length+e.list.sounds.length)}for(var h=0,_=e.list.jsons;h<_.length;){var u=[_[h]];++h,-1==d.indexOf(e.loaded,u[0].id,0)?(e.loaded.push(u[0].id),m.timer.schedule(e.load_time_spacing*i,function(s){return function(){var n=s[0].id,r=e.system.load_json(s[0].id);r.then(function(){return function(s){e.one_loaded(n,t,s,++i,e.list.bytes.length+e.list.texts.length+e.list.jsons.length+e.list.textures.length+e.list.shaders.length+e.list.fonts.length+e.list.sounds.length)}}(),function(){return function(s){e.one_failed(n,t,s,++i,e.list.bytes.length+e.list.texts.length+e.list.jsons.length+e.list.textures.length+e.list.shaders.length+e.list.fonts.length+e.list.sounds.length)}}())}}(u))):e.one_loaded(u[0].id,t,e.system.cache.get(u[0].id),++i,e.list.bytes.length+e.list.texts.length+e.list.jsons.length+e.list.textures.length+e.list.shaders.length+e.list.fonts.length+e.list.sounds.length)}for(var c=0,f=e.list.textures;c<f.length;){var p=[f[c]];++c,-1==d.indexOf(e.loaded,p[0].id,0)?(e.loaded.push(p[0].id),m.timer.schedule(e.load_time_spacing*i,function(s){return function(){var n=e.system.load_texture(s[0].id,{load_premultiply_alpha:s[0].load_premultiply_alpha,filter_min:s[0].filter_min,filter_mag:s[0].filter_mag,clamp_s:s[0].clamp_s,clamp_t:s[0].clamp_t}),r=s[0].id;n.then(function(){return function(s){e.one_loaded(r,t,s,++i,e.list.bytes.length+e.list.texts.length+e.list.jsons.length+e.list.textures.length+e.list.shaders.length+e.list.fonts.length+e.list.sounds.length)}}(),function(){return function(s){e.one_failed(r,t,s,++i,e.list.bytes.length+e.list.texts.length+e.list.jsons.length+e.list.textures.length+e.list.shaders.length+e.list.fonts.length+e.list.sounds.length)}}())}}(p))):e.one_loaded(p[0].id,t,e.system.cache.get(p[0].id),++i,e.list.bytes.length+e.list.texts.length+e.list.jsons.length+e.list.textures.length+e.list.shaders.length+e.list.fonts.length+e.list.sounds.length)}for(var g=0,v=e.list.fonts;g<v.length;){var y=[v[g]];++g,-1==d.indexOf(e.loaded,y[0].id,0)?(e.loaded.push(y[0].id),m.timer.schedule(e.load_time_spacing*i,function(s){return function(){var n=e.system.load_font(s[0].id,{texture_path:s[0].texture_path}),r=s[0].id;n.then(function(){return function(s){e.one_loaded(r,t,s,++i,e.list.bytes.length+e.list.texts.length+e.list.jsons.length+e.list.textures.length+e.list.shaders.length+e.list.fonts.length+e.list.sounds.length)}}(),function(){return function(s){e.one_failed(r,t,s,++i,e.list.bytes.length+e.list.texts.length+e.list.jsons.length+e.list.textures.length+e.list.shaders.length+e.list.fonts.length+e.list.sounds.length)}}())}}(y))):e.one_loaded(y[0].id,t,e.system.cache.get(y[0].id),++i,e.list.bytes.length+e.list.texts.length+e.list.jsons.length+e.list.textures.length+e.list.shaders.length+e.list.fonts.length+e.list.sounds.length)}for(var w=0,x=e.list.shaders;w<x.length;){var b=[x[w]];++w,-1==d.indexOf(e.loaded,b[0].id,0)?(e.loaded.push(b[0].id),m.timer.schedule(e.load_time_spacing*i,function(s){return function(){var n=e.system.load_shader(s[0].id,{frag_id:s[0].frag_id,vert_id:s[0].vert_id}),r=s[0].id;n.then(function(){return function(s){e.one_loaded(r,t,s,++i,e.list.bytes.length+e.list.texts.length+e.list.jsons.length+e.list.textures.length+e.list.shaders.length+e.list.fonts.length+e.list.sounds.length)}}(),function(){return function(s){e.one_failed(r,t,s,++i,e.list.bytes.length+e.list.texts.length+e.list.jsons.length+e.list.textures.length+e.list.shaders.length+e.list.fonts.length+e.list.sounds.length)}}())}}(b))):e.one_loaded(b[0].id,t,e.system.cache.get(b[0].id),++i,e.list.bytes.length+e.list.texts.length+e.list.jsons.length+e.list.textures.length+e.list.shaders.length+e.list.fonts.length+e.list.sounds.length)}for(var k=0,z=e.list.sounds;k<z.length;){var S=[z[k]];++k,m.audio.exists(S[0].name)?e.one_loaded(S[0].id,t,null,++i,e.list.bytes.length+e.list.texts.length+e.list.jsons.length+e.list.textures.length+e.list.shaders.length+e.list.fonts.length+e.list.sounds.length):m.timer.schedule(e.load_time_spacing*i,function(s){return function(){var n=m.audio.create(s[0].id,s[0].name,s[0].is_stream);n.then(function(s){return function(){e.one_loaded(s[0].id,t,null,++i,e.list.bytes.length+e.list.texts.length+e.list.jsons.length+e.list.textures.length+e.list.shaders.length+e.list.fonts.length+e.list.sounds.length)}}(s),function(s){return function(n){e.one_failed(s[0].id,t,n,++i,e.list.bytes.length+e.list.texts.length+e.list.jsons.length+e.list.textures.length+e.list.shaders.length+e.list.fonts.length+e.list.sounds.length)}}(s))}}(S))}})},unload:function(t){null==t&&(t=!1);for(var e=this,i=0,s=this.list.bytes;i<s.length;){var n=s[i];++i;var r=n.id;e.system.destroy(r),d.remove(e.loaded,r)}for(var o=0,l=this.list.texts;o<l.length;){var a=l[o];++o;var h=a.id;e.system.destroy(h),d.remove(e.loaded,h)}for(var _=0,u=this.list.jsons;_<u.length;){var c=u[_];++_;var f=c.id;e.system.destroy(f),d.remove(e.loaded,f)}for(var p=0,g=this.list.textures;p<g.length;){var v=g[p];++p;var y=v.id;e.system.destroy(y),d.remove(e.loaded,y)}for(var w=0,x=this.list.fonts;w<x.length;){var b=x[w];++w;var k=b.id;e.system.destroy(k),d.remove(e.loaded,k)}for(var z=0,S=this.list.shaders;z<S.length;){var T=S[z];++z;var A=T.id;e.system.destroy(A),d.remove(e.loaded,A)}for(var I=0,E=this.list.sounds;I<E.length;){var M=E[I];++I,m.audio.uncreate(M.name)}t&&(this.list=null,this.list=this.empty_list()),this.state=0},from_json:function(t){if(null==t)throw new Ie(ei.null_assertion("_json_object was null"));if(null!=t.bytes)for(var e=t.bytes,i=0;i<e.length;){var s=e[i];if(++i,null!=s){if(null==s)throw new Ie(ei.null_assertion("item was null"));if(null==s.id)throw new Ie(ei.null_assertion("item.id was null"));this.list.bytes.push(s)}}if(null!=t.text)for(var n=t.text,r=0;r<n.length;){var o=n[r];if(++r,null!=o){if(null==o)throw new Ie(ei.null_assertion("item was null"));if(null==o.id)throw new Ie(ei.null_assertion("item.id was null"));this.list.texts.push(o)}}if(null!=t.json)for(var l=t.json,a=0;a<l.length;){var h=l[a];if(++a,null!=h){if(null==h)throw new Ie(ei.null_assertion("item was null"));if(null==h.id)throw new Ie(ei.null_assertion("item.id was null"));this.list.jsons.push(h)}}if(null!=t.textures)for(var _=t.textures,u=0;u<_.length;){var c=_[u];if(++u,null==c)throw new Ie(ei.null_assertion("item was null"));if(null==c.id)throw new Ie(ei.null_assertion("item.id was null"));this.list.textures.push({id:c.id,filter_min:function(t){var e,i=c.filter_min;return e=null==i?null:function(t){var e;if("nearest"!=i&&"linear"!=i)throw new Ie(ei.assertion("_filter_type == 'nearest' || _filter_type == 'linear'"));return e=function(){var t;switch(i){case"nearest":t=9728;break;case"linear":t=9729;break;default:t=null}return t}(t)}(t)}(this),filter_mag:function(t){var e,i=c.filter_mag;return e=null==i?null:function(t){var e;if("nearest"!=i&&"linear"!=i)throw new Ie(ei.assertion("_filter_type == 'nearest' || _filter_type == 'linear'"));return e=function(){var t;switch(i){case"nearest":t=9728;break;case"linear":t=9729;break;default:t=null}return t}(t)}(t)}(this),clamp_s:function(t){var e,i=c.clamp_s;return e=null==i?null:function(t){var e;if("edge"!=i&&"repeat"!=i&&"mirror"!=i)throw new Ie(ei.assertion("_clamp_type == 'edge' || _clamp_type == 'repeat' || _clamp_type == 'mirror'"));return e=function(){var t;switch(i){case"edge":t=33071;break;case"mirror":t=33648;break;case"repeat":t=10497;break;default:t=null}return t}(t)}(t)}(this),clamp_t:function(t){var e,i=c.clamp_t;return e=null==i?null:function(t){var e;if("edge"!=i&&"repeat"!=i&&"mirror"!=i)throw new Ie(ei.assertion("_clamp_type == 'edge' || _clamp_type == 'repeat' || _clamp_type == 'mirror'"));return e=function(){var t;switch(i){case"edge":t=33071;break;case"mirror":t=33648;break;case"repeat":t=10497;break;default:t=null}return t}(t)}(t)}(this),load_premultiply_alpha:c.load_premultiply_alpha})}if(null!=t.fonts)for(var d=t.fonts,f=0;f<d.length;){var p=d[f];if(++f,null!=p){if(null==p)throw new Ie(ei.null_assertion("item was null"));if(null==p.id)throw new Ie(ei.null_assertion("item.id was null"));this.list.fonts.push(p)}}if(null!=t.shaders)for(var g=t.shaders,m=0;m<g.length;){var v=g[m];if(++m,null!=v){if(null==v)throw new Ie(ei.null_assertion("item was null"));if(null==v.id)throw new Ie(ei.null_assertion("item.id was null"));if(null==v.frag_id)throw new Ie(ei.null_assertion("item.frag_id was null"));if(null==v.vert_id)throw new Ie(ei.null_assertion("item.vert_id was null"));this.list.shaders.push(v)}}if(null!=t.sounds)for(var y=t.sounds,w=0;w<y.length;){var x=y[w];if(++w,null!=x){if(null==x)throw new Ie(ei.null_assertion("item was null"));if(null==x.id)throw new Ie(ei.null_assertion("item.id was null"));if(null==x.name)throw new Ie(ei.null_assertion("item.name was null"));this.list.sounds.push(x)}}},one_loaded:function(t,e,i,s,n){var r={id:t,load_id:e,resource:i,index:s,total:n};this.emitter.emit(1,r),null!=this.onprogress&&this.onprogress(r),s==n&&(this.state=2,this.time_to_load=Nn.core.timestamp()-this.start_load,this.emitter.emit(2,this),null!=this.oncomplete&&this.oncomplete(this))},one_failed:function(t,e,i,s,n){var r={id:t,load_id:e,error:i,index:s,total:n};this.emitter.emit(3,r),null!=this.onfailed&&this.onfailed(r)},get_listed:function(){for(var t=[],e=0,i=this.list.bytes;e<i.length;){var s=i[e];++e,t.push(s.id)}for(var n=0,r=this.list.texts;n<r.length;){var o=r[n];++n,t.push(o.id)}for(var l=0,a=this.list.jsons;l<a.length;){var h=a[l];++l,t.push(h.id)}for(var _=0,u=this.list.textures;_<u.length;){var c=u[_];++_,t.push(c.id)}for(var d=0,f=this.list.fonts;d<f.length;){var p=f[d];++d,t.push(p.id)}for(var g=0,m=this.list.shaders;g<m.length;){var v=m[g];++g,t.push(v.id)}return t},get_length:function(){return this.list.bytes.length+this.list.texts.length+this.list.jsons.length+this.list.textures.length+this.list.shaders.length+this.list.fonts.length+this.list.sounds.length},do_complete:function(){this.state=2,this.time_to_load=Nn.core.timestamp()-this.start_load,this.emitter.emit(2,this),null!=this.oncomplete&&this.oncomplete(this)},empty_list:function(){return{bytes:[],texts:[],jsons:[],textures:[],fonts:[],shaders:[],sounds:[]}},__class__:ni,__properties__:{get_length:"get_length",get_listed:"get_listed"}};var ri=function(t){this.enabled=!0,this.paused=!1,Ge.call(this,t)};r["luxe.ParticleSystem"]=ri,ri.__name__=["luxe","ParticleSystem"],ri.__super__=Ge,ri.prototype=i(Ge.prototype,{init:function(){null==this.emitters&&(this.emitters=new de),this.emitters},add_emitter:function(t){null==this.emitters&&(this.emitters=new de),this.emitters;var e="";e=null!=t.name?t.name:m.utils.uniqueid();var i=this.add(new oi({name:e,system:this,template:t}));this.emitters.set(e,i)},start:function(t){null==t&&(t=-1),this.enabled=!0;for(var e=this.emitters.iterator();e.hasNext();){var i=e.next();i.start(t)}for(var s=this.emitters.iterator();s.hasNext();){var n=s.next();n.paused=!1}this.paused=!1},stop:function(){this.enabled=!1;for(var t=this.emitters.iterator();t.hasNext();){var e=t.next();e.stop()}},kill:function(){this.enabled=!1;for(var t=this.emitters.iterator();t.hasNext();){var e=t.next();e.kill()}},set_paused:function(t){for(var e=this.emitters.iterator();e.hasNext();){var i=e.next();i.paused=t}return this.paused=t},ondestroy:function(){Ge.prototype.ondestroy.call(this)},__class__:ri,__properties__:i(Ge.prototype.__properties__,{set_paused:"set_paused"})});var oi=function(t){this.has_end_rotation=!1,this.finish_time=0,this.emit_timer=0,this.radius_random=50,this.radius=50,this.zrotation=0,this.particle_image=null,this.cache_index=0,this.cache_wrap=!0,this.cache_size=100,this.particle_index=0,this.emit_last=0,this.emit_next=0,this.duration=-1,this.elapsed_time=0,this.emit_count=1,this.paused=!1,this.enabled=!0,a.call(this,{name:t.name}),this.system=t.system,this.template=t.template};r["luxe.ParticleEmitter"]=oi,oi.__name__=["luxe","ParticleEmitter"],oi.__super__=a,oi.prototype=i(a.prototype,{init:function(){this.active_particles=[],this.particle_cache=[],this.dead_pool=[],this.emit_timer=0,this.emit_last=0,this.emit_next=0,this._temp_speed=new y,this._to_remove=[],null==this.template.batcher&&(this.template.batcher=m.renderer.batcher),this.template.batcher,this.apply(this.template)},apply:function(t){null==t&&(t={}),this.particle_image=null!=t.particle_image?t.particle_image:null,this.emit_time=null!=t.emit_time?t.emit_time:.1,this.cache_size=null!=t.cache_size?t.cache_size:100,this.cache_wrap=null!=t.cache_wrap?t.cache_wrap:!0,this.emit_count=null!=t.emit_count?t.emit_count:1,this.direction=null!=t.direction?t.direction:0,this.direction_random=null!=t.direction_random?t.direction_random:0,this.speed=null!=t.speed?t.speed:0,this.speed_random=null!=t.speed_random?t.speed_random:0,this.end_speed=null!=t.end_speed?t.end_speed:0,this.life=null!=t.life?t.life:1,this.life_random=null!=t.life_random?t.life_random:0,this.zrotation=null!=t.rotation?t.rotation:0,this.rotation_random=null!=t.rotation_random?t.rotation_random:0,null!=t.end_rotation?(this.end_rotation=t.end_rotation,this.has_end_rotation=!0):this.end_rotation=0,this.end_rotation_random=null!=t.end_rotation_random?t.end_rotation_random:0,this.rotation_offset=null!=t.rotation_offset?t.rotation_offset:0,this.direction_vector=null!=t.direction_vector?t.direction_vector:new y,this._position=null!=t.pos?t.pos:new y,this.pos_offset=null!=t.pos_offset?t.pos_offset:new y,this.pos_random=null!=t.pos_random?t.pos_random:new y(10,0),this.gravity=null!=t.gravity?t.gravity:new y(0,-8),this.start_size=null!=t.start_size?t.start_size:new y(48,48),this.start_size_random=null!=t.start_size_random?t.start_size_random:new y(5,5),this.end_size=null!=t.end_size?t.end_size:new y(64,64),this.end_size_random=null!=t.end_size_random?t.end_size_random:new y,this.start_color=null!=t.start_color?t.start_color:(new F).rgb(16747008),this.start_color_random=null!=t.start_color_random?t.start_color_random:new F(0,0,0,0),this.end_color=null!=t.end_color?t.end_color:new F(0,0,0,0),this.end_color_random=null!=t.end_color_random?t.end_color_random:new F(0,0,0,0),this.check_cache()},cache:function(t){var e=new li(this,t);e.sprite=new pi({name:this.name+"_particle_"+t,depth:this.template.depth,texture:this.particle_image,no_scene:!0,no_batcher_add:!0,pos:new y}),this.particle_cache[t]=e,this.dead_pool.push(t)},check_cache:function(){var t=this.cache_size;if(this.particle_cache.length>t){t=0;for(var e=0,i=this.particle_cache.length-t;i>e;){{e++}this.particle_cache.pop().destroy()}}else this.particle_cache.length<=t&&(t-=this.particle_cache.length);var s=this.particle_cache.length;if(t>0)for(var n=0;t>n;){var r=n++;this.cache(s+r)}},start:function(t){null==t&&(t=-1),this.duration=t,this.enabled=!0,this.paused=!1,this.emit_last=0,this.emit_timer=0,this.emit_next=0,this.duration>=0&&(this.finish_time=Nn.core.timestamp()+this.duration)},stop:function(){this.enabled=!1,this.elapsed_time=0,this.emit_timer=0},kill:function(){this.stop();for(var t=0,e=this.active_particles;t<e.length;){var i=e[t];++t,this.unspawn(i,!1)}this.active_particles=null,this.active_particles=[]},ondestroy:function(){if(this.active_particles=null,null!=this.particle_cache)for(;this.particle_cache.length>0;){var t=this.particle_cache.pop();t.destroy(),t=null}this.particle_cache=null},unspawn:function(t,e){null==e&&(e=!0),e&&d.remove(this.active_particles,t),this.dead_pool.push(t.index),null!=t.sprite.geometry&&this.template.batcher.remove(t.sprite.geometry)},spawn:function(){var t=!(this.active_particles.length<this.cache_size);if(t){if(!this.cache_wrap)return;this.unspawn(this.active_particles[0])}if(0==this.dead_pool.length)throw new Ie("huh, no particles in the dead_pool?!");var e=this.dead_pool.shift(),i=this.particle_cache[e];this.reset_particle(i),this.active_particles.push(i),null!=i.sprite.geometry&&this.template.batcher.add(i.sprite.geometry)},reset_particle:function(t){t.time_to_live=this.life+this.life_random*(2*Math.random()-1),t.pos.set_x(this.system.get_pos().x+this.pos_random.x*(2*Math.random()-1)+this.pos_offset.x),t.pos.set_y(this.system.get_pos().y+this.pos_random.y*(2*Math.random()-1)+this.pos_offset.y),t.rotation=this.zrotation+this.rotation_random*(2*Math.random()-1)+this.rotation_offset;var e=(this.direction+this.direction_random*(2*Math.random()-1))*(Math.PI/180),i=this.direction_vector,s=Math.cos(e),n=Math.sin(e),r=i.ignore_listeners;i.ignore_listeners=!0,i.x=s,i._construct?i.x:(null==i.listen_x||i.ignore_listeners||i.listen_x(s),i.x),i.y=n,i._construct?i.y:(null==i.listen_y||i.ignore_listeners||i.listen_y(n),i.y),i.ignore_listeners=r,null==i.listen_x||i.ignore_listeners||i.listen_x(i.x),null==i.listen_y||i.ignore_listeners||i.listen_y(i.y);var o=this.speed+this.speed_random*(2*Math.random()-1),l=t.speed,a=l.ignore_listeners;l.ignore_listeners=!0,l.x=o,l._construct?l.x:(null==l.listen_x||l.ignore_listeners||l.listen_x(o),l.x),l.y=o,l._construct?l.y:(null==l.listen_y||l.ignore_listeners||l.listen_y(o),l.y),l.ignore_listeners=a,null==l.listen_x||l.ignore_listeners||l.listen_x(l.x),null==l.listen_y||l.ignore_listeners||l.listen_y(l.y),t.direction.set_x(this.direction_vector.x),t.direction.set_y(this.direction_vector.y),t.start_size.set_x(this.start_size.x+this.start_size_random.x*(2*Math.random()-1)),t.start_size.set_y(this.start_size.y+this.start_size_random.y*(2*Math.random()-1)),t.end_size.set_x(this.end_size.x+this.end_size_random.x*(2*Math.random()-1)),t.end_size.set_y(this.end_size.y+this.end_size_random.y*(2*Math.random()-1)),t.size.set_x(t.start_size.x<0?0:Math.floor(t.start_size.x)),t.size.set_y(t.start_size.y<0?0:Math.floor(t.start_size.y)),t.speed_delta=this.end_speed-o,0!=t.speed_delta&&(t.speed_delta/=t.time_to_live),t.size_delta.set_x((this.end_size.x-this.start_size.x)/t.time_to_live),t.size_delta.set_y((this.end_size.y-this.start_size.y)/t.time_to_live);var h=t.color.set(this.start_color.r+this.start_color_random.r*(2*Math.random()-1),this.start_color.g+this.start_color_random.g*(2*Math.random()-1),this.start_color.b+this.start_color_random.b*(2*Math.random()-1),this.start_color.a+this.start_color_random.a*(2*Math.random()-1)),_=t.end_color.set(this.end_color.r+this.end_color_random.r*(2*Math.random()-1),this.end_color.g+this.end_color_random.g*(2*Math.random()-1),this.end_color.b+this.end_color_random.b*(2*Math.random()-1),this.end_color.a+this.end_color_random.a*(2*Math.random()-1));if(t.color_delta.set_r((_.r-h.r)/t.time_to_live),t.color_delta.set_g((_.g-h.g)/t.time_to_live),t.color_delta.set_b((_.b-h.b)/t.time_to_live),t.color_delta.a=(_.a-h.a)/t.time_to_live,this.has_end_rotation){var u=this.end_rotation+this.end_rotation_random*(2*Math.random()-1);t.rotation_delta=(u-t.rotation)/t.time_to_live}var c=t.sprite.size,d=t.start_size.x,f=t.start_size.y,p=c.ignore_listeners;c.ignore_listeners=!0,c.x=d,c._construct?c.x:(null==c.listen_x||c.ignore_listeners||c.listen_x(d),c.x),c.y=f,c._construct?c.y:(null==c.listen_y||c.ignore_listeners||c.listen_y(f),c.y),c.ignore_listeners=p,null==c.listen_x||c.ignore_listeners||c.listen_x(c.x),null==c.listen_y||c.ignore_listeners||c.listen_y(c.y),t.sprite.set_color(t.color),t.sprite.get_pos().copy_from(t.pos),t.sprite.set_rotation_z(t.rotation)},update:function(t){if(!this.paused){if(this.enabled){if(this.emit_timer=Nn.core.timestamp(),this.emit_timer>this.emit_next){this.emit_next=this.emit_timer+this.emit_time,this.emit_last=this.emit_timer;for(var e=0,i=this.emit_count;i>e;){{e++}this.spawn()}}this.duration>=0&&this.emit_timer>this.finish_time&&this.stop()}for(var s=this.gravity.x,n=this.gravity.y,r=0,o=this.active_particles;r<o.length;){var l=o[r];if(++r,l.time_to_live-=t,l.time_to_live>0){var a=l.speed;a.set_x(a.x+l.speed_delta);var h=l.speed;h.set_y(h.y+l.speed_delta),l.move_dir.set_x(s+l.direction.x*l.speed.x),l.move_dir.set_y(n+l.direction.y*l.speed.y);var _=l.pos;_.set_x(_.x+l.move_dir.x*t);var u=l.pos;u.set_y(u.y+l.move_dir.y*t);var c,d=l.color;c=d.set_r(d.r+l.color_delta.r*t);var f,p=l.color;f=p.set_g(p.g+l.color_delta.g*t);var g,m=l.color;g=m.set_b(m.b+l.color_delta.b*t);var v,y=l.color.a+=l.color_delta.a*t,w=l.size;v=w.set_x(w.x+l.size_delta.x*t);var x,b=l.size;x=b.set_y(b.y+l.size_delta.y*t);{l.rotation+=l.rotation_delta*t}0>c&&(c=0),0>f&&(f=0),0>g&&(g=0),0>y&&(y=0),c>1&&(c=1),f>1&&(f=1),g>1&&(g=1),y>1&&(y=1),l.draw_color.set(c,f,g,y);var k=l.draw_size,z=k.ignore_listeners;k.ignore_listeners=!0,k.x=v,k._construct?k.x:(null==k.listen_x||k.ignore_listeners||k.listen_x(v),k.x),k.y=x,k._construct?k.y:(null==k.listen_y||k.ignore_listeners||k.listen_y(x),k.y),k.ignore_listeners=z,null==k.listen_x||k.ignore_listeners||k.listen_x(k.x),null==k.listen_y||k.ignore_listeners||k.listen_y(k.y)}else this._to_remove.push(l);l.sprite.set_pos(l.pos),l.sprite.set_size(l.draw_size),l.sprite.set_rotation_z(l.rotation),l.sprite.set_color(l.draw_color)}for(var S=0,T=this._to_remove;S<T.length;){var A=T[S];++S,this.unspawn(A)}this._to_remove=null,this._to_remove=[]}},random_1_to_1:function(){return 2*Math.random()-1},onremoved:function(){a.prototype.onremoved.call(this)},__class__:oi});var li=function(t,e){this.rotation_delta=0,this.rotation=0,this.time_to_live=0,this.index=e,this.particle_emitter=t,this.system=t.system,this.direction=new y,this.move_dir=new y,this.speed=new y,this.speed_delta=0,this.size=new y,this.pos=new y,this.start_size=new y,this.end_size=new y,this.size_delta=new y,this.color_delta=new F(0,0,0,0),this.color=new F,this.end_color=new F,this.draw_color=new F,this.draw_size=new y};r["luxe.Particle"]=li,li.__name__=["luxe","Particle"],li.prototype={destroy:function(){null!=this.sprite&&(this.sprite.destroy(),this.sprite=null),this.direction=null,this.move_dir=null,this.speed=null,this.size=null,this.pos=null,this.start_size=null,this.end_size=null,this.size_delta=null,this.color_delta=null,this.color=null,this.end_color=null,this.draw_color=null,this.draw_size=null},__class__:li};var ai=function(t){this.step_delta=.016666666666666666,this.step_rate=.016666666666666666,this.core=t
};r["luxe.Physics"]=ai,ai.__name__=["luxe","Physics"],ai.prototype={init:function(){this.engines=[]},reset:function(){null!=this.timer&&(this.timer.stop(),this.timer=null),0!=this.step_rate&&(this.timer=m.timer.schedule(this.step_rate,n(this,this.fixed_update),!0))},fixed_update:function(){m.debug.start(ai.tag_physics),this.update(),m.debug.end(ai.tag_physics)},add_engine:function(t,e){var i=V.createInstance(t,[e]),s=i;return s.init(),this.engines.push(s),i},update:function(){for(var t=0,e=this.engines;t<e.length;){var i=e[t];++t,i.update()}},process:function(){for(var t=0,e=this.engines;t<e.length;){var i=e[t];++t,i.process()}},render:function(){for(var t=0,e=this.engines;t<e.length;){var i=e[t];++t,i.render()}},destroy:function(){null!=this.timer&&this.timer.stop(),this.timer=null;for(var t=0,e=this.engines;t<e.length;){var i=e[t];++t,i.destroy()}},set_step_rate:function(t){return this.step_rate=t,this.step_delta=this.step_rate,this.reset(),this.step_rate},__class__:ai,__properties__:{set_step_rate:"set_step_rate"}};var hi=function(){this.draw=!0,this.paused=!1,this.name="engine",this.set_gravity(new y(0,-9.8,0)),m.on(10,n(this,this._render))};r["luxe.PhysicsEngine"]=hi,hi.__name__=["luxe","PhysicsEngine"],hi.prototype={init:function(){},_render:function(){this.render()},process:function(){},update:function(){},render:function(){},destroy:function(){},get_paused:function(){return this.paused},set_paused:function(t){return this.paused=t},get_draw:function(){return this.draw},set_draw:function(t){return this.draw=t},get_gravity:function(){return this.gravity},set_gravity:function(t){return this.gravity=t},__class__:hi,__properties__:{set_draw:"set_draw",get_draw:"get_draw",set_gravity:"set_gravity",get_gravity:"get_gravity",set_paused:"set_paused",get_paused:"get_paused"}};var _i=function(){this.parcels=[],this.emitter=new x,this.cache=new de,this.stats=new ui};r["luxe.Resources"]=_i,_i.__name__=["luxe","Resources"],_i.prototype={track:function(t){if(null==t)throw new Ie(ei.null_assertion("_cache was null"));if(-1!=d.indexOf(this.parcels,t,0))throw new Ie(ei.assertion("parcels.indexOf(_cache) == -1"));this.parcels.push(t),this.emit(11,t)},untrack:function(t){if(null==t)throw new Ie(ei.null_assertion("_cache was null"));var e=d.remove(this.parcels,t);e&&this.emit(12,t)},add:function(t){if(this.cache.exists(t.id))throw new Ie(ei.assertion("!cache.exists(resource.id)"));this.cache.set(t.id,t),this.emit(2,t),this.update_stats(t,1)},remove:function(t){if(!this.cache.exists(t.id))throw new Ie(ei.assertion("cache.exists(resource.id)"));return this.emit(7,t),this.update_stats(t,-1),this.cache.remove(t.id)},destroy:function(t,e){null==e&&(e=!1);var i=this.cache.get(t);return null==i?!1:(i.destroy(e),!0)},invalidate:function(t){var e=this.cache.get(t);return null==e?!1:(e.invalidate(),!0)},on:function(t,e){this.emitter.on(t,e)},off:function(t,e){this.emitter.off(t,e)},emit:function(t,e){this.emitter.emit(1,e),this.emitter.emit(t,e)},load_bytes:function(t){if(null==t)throw new Ie(ei.null_assertion("_id was null"));var e=this.cache.get(t);if(null!=e){var i=e,s=i.ref;return i.set_ref(s+1),Un.resolve(e)}return e=new Gi({id:t,system:this,asset:null}),this.add(e),e.reload()},load_text:function(t){if(null==t)throw new Ie(ei.null_assertion("_id was null"));var e=this.cache.get(t);if(null!=e){var i=e,s=i.ref;return i.set_ref(s+1),Un.resolve(e)}return e=new Di({id:t,system:this,asset:null}),this.add(e),e.reload()},load_json:function(t){if(null==t)throw new Ie(ei.null_assertion("_id was null"));var e=this.cache.get(t);if(null!=e){var i=e,s=i.ref;return i.set_ref(s+1),Un.resolve(e)}return e=new Li({id:t,system:this,asset:null}),this.add(e),e.reload()},load_texture:function(t,e){if(null==t)throw new Ie(ei.null_assertion("_id was null"));var i=this.cache.get(t);if(null!=i){var s=i,n=s.ref;return s.set_ref(n+1),Un.resolve(i)}var r=null,o=null,l=null,a=null,h=null;return null!=e&&(r=e.filter_min,o=e.filter_mag,l=e.clamp_s,a=e.clamp_t,h=e.load_premultiply_alpha),i=new hn({id:t,system:this,filter_min:r,filter_mag:o,clamp_s:l,clamp_t:a,load_premultiply_alpha:h}),this.add(i),i.reload()},load_font:function(t,e){if(null==t)throw new Ie(ei.null_assertion("_id was null"));var i=this.cache.get(t);if(null!=i){var s=i,n=s.ref;return s.set_ref(n+1),Un.resolve(i)}var r=null;return null!=e&&(r=e.texture_path),i=new Qs({id:t,system:this,texture_path:r}),this.add(i),i.reload()},load_shader:function(t,e){if(null==t)throw new Ie(ei.null_assertion("_id was null"));var i=this.cache.get(t);if(null!=i){var s=i,n=s.ref;return s.set_ref(n+1),Un.resolve(i)}return i=new fn({id:t,system:this,frag_id:e.frag_id,vert_id:e.vert_id}),this.add(i),i.reload()},has:function(t){return this.cache.exists(t)},get:function(t){return this.cache.get(t)},bytes:function(t){return this.cache.get(t)},text:function(t){return this.cache.get(t)},json:function(t){return this.cache.get(t)},texture:function(t){return this.cache.get(t)},font:function(t){return this.cache.get(t)},shader:function(t){return this.cache.get(t)},fetch:function(t){return this.cache.get(t)},update_stats:function(t,e){var i=t.resource_type;switch(i){case 0:this.stats.unknown+=e;break;case 3:this.stats.bytes+=e;break;case 1:this.stats.texts+=e;break;case 2:this.stats.jsons+=e;break;case 4:this.stats.textures+=e;break;case 5:this.stats.render_textures+=e;break;case 6:this.stats.fonts+=e;break;case 7:this.stats.shaders+=e}this.stats.total+=e},__class__:_i};var ui=function(){this.unknown=0,this.bytes=0,this.jsons=0,this.texts=0,this.shaders=0,this.render_textures=0,this.textures=0,this.fonts=0,this.total=0};r["luxe.ResourceStats"]=ui,ui.__name__=["luxe","ResourceStats"],ui.prototype={toString:function(){return"Resource Statistics\n	total : "+this.total+"\n	texture : "+this.textures+" \n	render texture : "+this.render_textures+" \n	font : "+this.fonts+"\n	shader : "+this.shaders+"\n	text : "+this.texts+"\n	json : "+this.jsons+"\n	bytes : "+this.bytes+"\n	unknown : "+this.unknown},reset:function(){this.total=0,this.fonts=0,this.textures=0,this.render_textures=0,this.shaders=0,this.texts=0,this.jsons=0,this.bytes=0,this.unknown=0},__class__:ui};var ci=function(t){null==t&&(t="untitled scene"),this.entity_count=0,this._has_changed=!1,this.length=0,this.started=!1,this.inited=!1,Ne.call(this,t),this.entities=new de,this._delayed_init_entities=[],this._delayed_reset_entities=[],m.core.emitter.on(2,n(this,this.init)),m.core.emitter.on(8,n(this,this._destroy)),m.core.emitter.on(6,n(this,this.update)),m.core.emitter.on(9,n(this,this.prerender)),m.core.emitter.on(11,n(this,this.postrender)),m.core.emitter.on(10,n(this,this.render)),m.core.emitter.on(12,n(this,this.keydown)),m.core.emitter.on(13,n(this,this.keyup)),m.core.emitter.on(14,n(this,this.textinput)),m.core.emitter.on(16,n(this,this.inputup)),m.core.emitter.on(15,n(this,this.inputdown)),m.core.emitter.on(18,n(this,this.mouseup)),m.core.emitter.on(17,n(this,this.mousedown)),m.core.emitter.on(19,n(this,this.mousemove)),m.core.emitter.on(20,n(this,this.mousewheel)),m.core.emitter.on(22,n(this,this.touchup)),m.core.emitter.on(21,n(this,this.touchdown)),m.core.emitter.on(23,n(this,this.touchmove)),m.core.emitter.on(26,n(this,this.gamepadup)),m.core.emitter.on(25,n(this,this.gamepaddown)),m.core.emitter.on(24,n(this,this.gamepadaxis)),m.core.emitter.on(27,n(this,this.gamepaddevice)),m.core.emitter.on(29,n(this,this.windowmoved)),m.core.emitter.on(30,n(this,this.windowresized)),m.core.emitter.on(31,n(this,this.windowsized)),m.core.emitter.on(32,n(this,this.windowminimized)),m.core.emitter.on(33,n(this,this.windowrestored)),m.core.inited&&this.init(null);var e=m.core.debug.get_view("Scenes");null!=e&&e.add_scene(this)};r["luxe.Scene"]=ci,ci.__name__=["luxe","Scene"],ci.__super__=Ne,ci.prototype=i(Ne.prototype,{handle_duplicate_warning:function(t){this.entities.exists(t)},add:function(t){if(null==t)throw new Ie(ei.null_assertion("entity was null ( can't put entity in a scene if the entity is null. )"));this.handle_duplicate_warning(t.get_name()),t.set_scene(this);var e=t.get_name();this.entities.set(e,t),this.entity_count++,this.inited&&this._delayed_init_entities.push(t),this.started&&this._delayed_reset_entities.push(t),this._has_changed=!0},remove:function(t){if(null==t)throw new Ie(ei.null_assertion("entity was null ( can't remove entity from a scene if the entity is null. )"));if(this._has_changed=!0,t.get_scene()==this){t.set_scene(null),this.entity_count--;var e=t.get_name();return this.entities.remove(e)}return!1},get:function(t){return this.entities.get(t)},empty:function(){if(this.entity_count>0)for(var t=this.entities.iterator();t.hasNext();){var e=t.next();null!=e&&e!=m.camera&&(this.remove(e),e.destroy(),e=null)}},get_named_like:function(t,e){if(this.entity_count>0)for(var i=new _("^((?:"+t+")[.]{1})","g"),s=this.entities.iterator();s.hasNext();){var n=s.next();i.match(n.get_name())&&e.push(n)}return e},render:function(){this.emit(10)},prerender:function(){this.emit(9)},postrender:function(){this.emit(11)},keydown:function(t){this.emit(12,t)},keyup:function(t){this.emit(13,t)},textinput:function(t){this.emit(14,t)},mousedown:function(t){this.emit(17,t)},mousewheel:function(t){this.emit(20,t)},mouseup:function(t){this.emit(18,t)},mousemove:function(t){this.emit(19,t)},touchdown:function(t){this.emit(21,t)},touchup:function(t){this.emit(22,t)},touchmove:function(t){this.emit(23,t)},gamepadaxis:function(t){this.emit(24,t)},gamepadup:function(t){this.emit(26,t)},gamepaddown:function(t){this.emit(25,t)},gamepaddevice:function(t){this.emit(27,t)},windowmoved:function(t){this.emit(29,t)},windowresized:function(t){this.emit(30,t)},windowsized:function(t){this.emit(31,t)},windowminimized:function(t){this.emit(32,t)},windowrestored:function(t){this.emit(33,t)},inputdown:function(t){this.emit(15,t)},inputup:function(t){this.emit(16,t)},_destroy:function(){this.destroy()},destroy:function(){m.core.emitter.off(2,n(this,this.init)),m.core.emitter.off(8,n(this,this._destroy)),m.core.emitter.off(6,n(this,this.update)),m.core.emitter.off(9,n(this,this.prerender)),m.core.emitter.off(11,n(this,this.postrender)),m.core.emitter.off(10,n(this,this.render)),m.core.emitter.off(12,n(this,this.keydown)),m.core.emitter.off(13,n(this,this.keyup)),m.core.emitter.off(14,n(this,this.textinput)),m.core.emitter.off(16,n(this,this.inputup)),m.core.emitter.off(15,n(this,this.inputdown)),m.core.emitter.off(18,n(this,this.mouseup)),m.core.emitter.off(17,n(this,this.mousedown)),m.core.emitter.off(19,n(this,this.mousemove)),m.core.emitter.off(20,n(this,this.mousewheel)),m.core.emitter.off(22,n(this,this.touchup)),m.core.emitter.off(21,n(this,this.touchdown)),m.core.emitter.off(23,n(this,this.touchmove)),m.core.emitter.off(26,n(this,this.gamepadup)),m.core.emitter.off(25,n(this,this.gamepaddown)),m.core.emitter.off(24,n(this,this.gamepadaxis)),m.core.emitter.off(27,n(this,this.gamepaddevice)),m.core.emitter.off(29,n(this,this.windowmoved)),m.core.emitter.off(30,n(this,this.windowresized)),m.core.emitter.off(31,n(this,this.windowsized)),m.core.emitter.off(32,n(this,this.windowminimized)),m.core.emitter.off(33,n(this,this.windowrestored)),this.emit(8);var t=m.core.debug.get_view("Scenes");null!=t&&t.remove_scene(this)},_do_init:function(){var t=this.get_length();if(this.entity_count>0)for(var e=this.entities.iterator();e.hasNext();){var i=e.next();null!=i&&(i.inited||i._init())}var s=this.get_length();return t!=s},init:function(){for(var t=!0;t;)t=this._do_init();this.inited=!0,this.emit(2),this.reset()},reset:function(){this.started=!1,this.emit(3),this.started=!0},update:function(t){if(m.core.debug.start("scene."+this.get_name()),this.handle_delayed_additions(),this.emit(6,t),this.entity_count>0)for(var e=this.entities.iterator();e.hasNext();){var i=e.next();null!=i&&i._update(t)}m.core.debug.end("scene."+this.get_name())},handle_delayed_additions:function(){if(0!=this._delayed_init_entities.length||0!=this._delayed_reset_entities.length,this._delayed_init_entities.length>0){for(var t=0,e=this._delayed_init_entities;t<e.length;){var i=e[t];++t,i.inited||i._init()}this._delayed_init_entities.splice(0,this._delayed_init_entities.length)}if(this._delayed_reset_entities.length>0){for(var s=0,n=this._delayed_reset_entities;s<n.length;){var r=n[s];++s,r._reset(null)}this._delayed_reset_entities.splice(0,this._delayed_reset_entities.length)}},get_length:function(){return f.count(this.entities)},toString:function(){return"luxe Scene: "+this.get_name()+" / "+this.get_length()+" entities / id: "+this.get_id()},__class__:ci,__properties__:i(Ne.prototype.__properties__,{get_length:"get_length"})});var di=function(t,e,i){this.core=t,this.cursor=new fi(this),this.width=e,this.height=i};r["luxe.Screen"]=di,di.__name__=["luxe","Screen"],di.prototype={toString:function(){return"luxe.Screen({ w:"+this.get_w()+", h:"+this.get_h()+" })"},point_inside:function(t){return t.x<0?!1:t.y<0?!1:t.x>this.width?!1:t.y>this.height?!1:!0},point_inside_xy:function(t,e){return 0>t?!1:0>e?!1:t>this.width?!1:e>this.height?!1:!0},internal_resized:function(t,e){this.width=t,this.height=e},get_mid:function(){return new y(Math.round(this.get_w()/2),Math.round(this.get_h()/2))},get_size:function(){return new y(this.get_w(),this.get_h())},get_bounds:function(){return new on(0,0,this.get_w(),this.get_h())},get_w:function(){return 0|this.width},get_h:function(){return 0|this.height},__class__:di,__properties__:{get_h:"get_h",get_w:"get_w",get_bounds:"get_bounds",get_size:"get_size",get_mid:"get_mid"}};var fi=function(t){this.ignore=!1,this.lock=!1,this.grab=!1,this.visible=!0,this.screen=t,this.set_pos(new y)};r["luxe.Cursor"]=fi,fi.__name__=["luxe","Cursor"],fi.prototype={set_internal:function(t){this.ignore=!0,this.set_pos(t),this.ignore=!1},get_visible:function(){return this.visible},set_visible:function(t){return this.screen.core.app.windowing.enable_cursor(t),this.visible=t},get_grab:function(){return this.grab},get_lock:function(){return this.lock},set_grab:function(t){return this.screen.core.app.window.set_grab(t),this.grab=t},set_lock:function(t){return this.screen.core.app.windowing.enable_cursor_lock(t),this.lock=t},get_pos:function(){return this.pos},set_pos:function(t){return null==this.get_pos()||null==t||this.ignore||this.screen.core.app.window.set_cursor_position(0|t.x,0|t.y),this.pos=t},__class__:fi,__properties__:{set_pos:"set_pos",get_pos:"get_pos",set_lock:"set_lock",get_lock:"get_lock",set_grab:"set_grab",get_grab:"get_grab",set_visible:"set_visible",get_visible:"get_visible"}};var pi=function(t){if(this.flipy=!1,this.flipx=!1,this.centered=!0,this.set_uv(new on),null==t)throw new Ie(ei.null_assertion("options was null ( Sprite requires non-null options )"));null!=t.centered&&this.set_centered(t.centered),null!=t.flipx&&this.set_flipx(t.flipx),null!=t.flipy&&this.set_flipy(t.flipy),ii.call(this,t)};r["luxe.Sprite"]=pi,pi.__name__=["luxe","Sprite"],pi.__super__=ii,pi.prototype=i(ii.prototype,{on_geometry_created:function(){ii.prototype.on_geometry_created.call(this),null!=this.texture&&(this.set_uv(function(t){var e;return null==t.options.uv&&(t.options.uv=new on(0,0,t.texture.width,t.texture.height)),e=t.options.uv}(this)),5==this.texture.resource_type&&this.set_flipy(!0)),this.set_centered(!!this.centered),this.set_flipx(!!this.flipx),this.set_flipy(!!this.flipy)},set_geometry:function(t){return this.geometry_quad=t,ii.prototype.set_geometry.call(this,t)},point_inside:function(t){return null==this.geometry?!1:m.utils.geometry.point_in_geometry(t,this.geometry)},point_inside_AABB:function(t){if(null==this.get_pos())return!1;if(null==this.size)return!1;var e=this.size.x*this.get_scale().x,i=this.size.y*this.get_scale().y;if(this.centered){var s=e/2,n=i/2;if(t.x<this.get_pos().x-s)return!1;if(t.y<this.get_pos().y-n)return!1;if(t.x>this.get_pos().x+e-s)return!1;if(t.y>this.get_pos().y+i-n)return!1}else{if(t.x<this.get_pos().x)return!1;if(t.y<this.get_pos().y)return!1;if(t.x>this.get_pos().x+e)return!1;if(t.y>this.get_pos().y+i)return!1}return!0},set_uv:function(t){return null!=this.geometry_quad&&this.geometry_quad.uv(t),this.uv=t,on.listen(this.uv,n(this,this._uv_change)),this.uv},set_flipy:function(t){return t==this.flipy?this.flipy:(null!=this.geometry_quad&&this.geometry_quad.set_flipy(t),this.flipy=t)},set_flipx:function(t){return t==this.flipx?this.flipx:(null!=this.geometry_quad&&this.geometry_quad.set_flipx(t),this.flipx=t)},set_size:function(t){return null!=this.geometry_quad&&(this.geometry_quad.resize(new y(t.x,t.y)),this._has_custom_origin||this.centered&&this.set_origin(new y(t.x,t.y,t.z,t.w).divideScalar(2))),ii.prototype.set_size.call(this,t)},set_centered:function(t){return null!=this.size&&this.set_origin(t?new y(this.size.x/2,this.size.y/2):new y),this.centered=t},_uv_change:function(){this.set_uv(this.uv)},init:function(){ii.prototype.init.call(this)},ondestroy:function(){ii.prototype.ondestroy.call(this)},__class__:pi,__properties__:i(ii.prototype.__properties__,{set_uv:"set_uv",set_flipy:"set_flipy",set_flipx:"set_flipx",set_centered:"set_centered"})});var gi=function(t){this._state_count=0,this.active_count=0;var e="";null!=t&&null!=t.name&&(e=t.name),Ne.call(this,""==e?m.utils.uniqueid():e),this._states=new de,this.active_states=[],m.core.emitter.on(2,n(this,this.init)),m.core.emitter.on(8,n(this,this.ondestroy)),m.core.emitter.on(6,n(this,this.update)),m.core.emitter.on(9,n(this,this.prerender)),m.core.emitter.on(11,n(this,this.postrender)),m.core.emitter.on(10,n(this,this.render)),m.core.emitter.on(12,n(this,this.keydown)),m.core.emitter.on(13,n(this,this.keyup)),m.core.emitter.on(14,n(this,this.textinput)),m.core.emitter.on(16,n(this,this.inputup)),m.core.emitter.on(15,n(this,this.inputdown)),m.core.emitter.on(18,n(this,this.mouseup)),m.core.emitter.on(17,n(this,this.mousedown)),m.core.emitter.on(19,n(this,this.mousemove)),m.core.emitter.on(20,n(this,this.mousewheel)),m.core.emitter.on(22,n(this,this.touchup)),m.core.emitter.on(21,n(this,this.touchdown)),m.core.emitter.on(23,n(this,this.touchmove)),m.core.emitter.on(26,n(this,this.gamepadup)),m.core.emitter.on(25,n(this,this.gamepaddown)),m.core.emitter.on(24,n(this,this.gamepadaxis)),m.core.emitter.on(27,n(this,this.gamepaddevice)),m.core.emitter.on(29,n(this,this.windowmoved)),m.core.emitter.on(30,n(this,this.windowresized)),m.core.emitter.on(31,n(this,this.windowsized)),m.core.emitter.on(32,n(this,this.windowminimized)),m.core.emitter.on(33,n(this,this.windowrestored))};r["luxe.States"]=gi,gi.__name__=["luxe","States"],gi.__super__=Ne,gi.prototype=i(Ne.prototype,{add:function(t){return this._states.set(t.name,t),this._state_count++,t.machine=this,t.onadded(),m.core.inited&&(t.inited||(t.inited=!0,t.init())),t},remove:function(t,e){if(this._states.exists(t)){var i=this._states.get(t);return null!=i&&(i.active&&(this.leave(i,e),i==this.current_state&&(this.current_state=null)),i.enabled&&this.disable(i.name),i.onremoved(),this._states.remove(t),this._state_count--),i}return null},kill:function(t){if(this._state_count>0&&this._states.exists(t)){var e=this.remove(t);null!=e&&e.ondestroy()}},enabled:function(t){if(0==this._state_count)return!1;var e=this._states.get(t);return null!=e?e.enabled:!1},enable:function(t,e){if(0!=this._state_count){var i=this._states.get(t);null!=i&&(i.onenabled(e),i.active=!0,i.enabled=!0,this.active_states.push(i),this.active_count++)}},disable:function(t,e){if(0!=this._state_count){var i=this._states.get(t);null!=i&&(i.ondisabled(e),i.active=!1,i.enabled=!1,d.remove(this.active_states,i),this.active_count--)}},enter:function(t,e){t.onenter(e),this.active_states.push(t),this.active_count++,t.active=!0},leave:function(t,e){t.active=!1,d.remove(this.active_states,t),this.active_count--,t.onleave(e)},set:function(t,e,i){return this._states.exists(t)?(this.unset(i),this.current_state=this._states.get(t),this.enter(this.current_state,e),!0):!1},unset:function(t){null!=this.current_state&&(this.leave(this.current_state,t),this.current_state=null)},destroy:function(){if(this._state_count>0)for(var t=this._states.iterator();t.hasNext();){var e=t.next();e.destroy()}m.core.emitter.off(2,n(this,this.init)),m.core.emitter.off(8,n(this,this.ondestroy)),m.core.emitter.off(6,n(this,this.update)),m.core.emitter.off(9,n(this,this.prerender)),m.core.emitter.off(11,n(this,this.postrender)),m.core.emitter.off(10,n(this,this.render)),m.core.emitter.off(12,n(this,this.keydown)),m.core.emitter.off(13,n(this,this.keyup)),m.core.emitter.off(14,n(this,this.textinput)),m.core.emitter.off(16,n(this,this.inputup)),m.core.emitter.off(15,n(this,this.inputdown)),m.core.emitter.off(18,n(this,this.mouseup)),m.core.emitter.off(17,n(this,this.mousedown)),m.core.emitter.off(19,n(this,this.mousemove)),m.core.emitter.off(20,n(this,this.mousewheel)),m.core.emitter.off(22,n(this,this.touchup)),m.core.emitter.off(21,n(this,this.touchdown)),m.core.emitter.off(23,n(this,this.touchmove)),m.core.emitter.off(26,n(this,this.gamepadup)),m.core.emitter.off(25,n(this,this.gamepaddown)),m.core.emitter.off(24,n(this,this.gamepadaxis)),m.core.emitter.off(27,n(this,this.gamepaddevice)),m.core.emitter.off(29,n(this,this.windowmoved)),m.core.emitter.off(30,n(this,this.windowresized)),m.core.emitter.off(31,n(this,this.windowsized)),m.core.emitter.off(32,n(this,this.windowminimized)),m.core.emitter.off(33,n(this,this.windowrestored)),this.emit(8)},init:function(){if(this._state_count>0)for(var t=this._states.iterator();t.hasNext();){var e=t.next();e.inited||(e.inited=!0,e.init())}},reset:function(){if(this.active_count>0)for(var t=0,e=this.active_states;t<e.length;){var i=e[t];++t,i.onreset()}},update:function(t){if(this.active_count>0)for(var e=0,i=this.active_states;e<i.length;){var s=i[e];++e,s.update(t)}},ondestroy:function(){this.destroy()},render:function(){if(this.active_count>0)for(var t=0,e=this.active_states;t<e.length;){var i=e[t];++t,i.onrender()}},prerender:function(){if(this.active_count>0)for(var t=0,e=this.active_states;t<e.length;){var i=e[t];++t,i.onprerender()}},postrender:function(){if(this.active_count>0)for(var t=0,e=this.active_states;t<e.length;){var i=e[t];++t,i.onpostrender()}},keydown:function(t){if(this.active_count>0)for(var e=0,i=this.active_states;e<i.length;){var s=i[e];++e,s.onkeydown(t)}},keyup:function(t){if(this.active_count>0)for(var e=0,i=this.active_states;e<i.length;){var s=i[e];++e,s.onkeyup(t)}},textinput:function(t){if(this.active_count>0)for(var e=0,i=this.active_states;e<i.length;){var s=i[e];++e,s.ontextinput(t)}},inputup:function(t){if(this.active_count>0)for(var e=0,i=this.active_states;e<i.length;){var s=i[e];++e,s.oninputup(t.name,t.event)}},inputdown:function(t){if(this.active_count>0)for(var e=0,i=this.active_states;e<i.length;){var s=i[e];++e,s.oninputdown(t.name,t.event)}},mousedown:function(t){if(this.active_count>0)for(var e=0,i=this.active_states;e<i.length;){var s=i[e];++e,s.onmousedown(t)}},mousewheel:function(t){if(this.active_count>0)for(var e=0,i=this.active_states;e<i.length;){var s=i[e];++e,s.onmousewheel(t)}},mouseup:function(t){if(this.active_count>0)for(var e=0,i=this.active_states;e<i.length;){var s=i[e];++e,s.onmouseup(t)}},mousemove:function(t){if(this.active_count>0)for(var e=0,i=this.active_states;e<i.length;){var s=i[e];++e,s.onmousemove(t)}},touchdown:function(t){if(this.active_count>0)for(var e=0,i=this.active_states;e<i.length;){var s=i[e];++e,s.ontouchdown(t)}},touchup:function(t){if(this.active_count>0)for(var e=0,i=this.active_states;e<i.length;){var s=i[e];++e,s.ontouchup(t)}},touchmove:function(t){if(this.active_count>0)for(var e=0,i=this.active_states;e<i.length;){var s=i[e];++e,s.ontouchmove(t)}},gamepadaxis:function(t){if(this.active_count>0)for(var e=0,i=this.active_states;e<i.length;){var s=i[e];++e,s.ongamepadaxis(t)}},gamepadup:function(t){if(this.active_count>0)for(var e=0,i=this.active_states;e<i.length;){var s=i[e];++e,s.ongamepadup(t)}},gamepaddown:function(t){if(this.active_count>0)for(var e=0,i=this.active_states;e<i.length;){var s=i[e];++e,s.ongamepaddown(t)}},gamepaddevice:function(t){if(this.active_count>0)for(var e=0,i=this.active_states;e<i.length;){var s=i[e];++e,s.ongamepaddevice(t)}},windowmoved:function(t){if(this.active_count>0)for(var e=0,i=this.active_states;e<i.length;){var s=i[e];++e,s.onwindowmoved(t)}},windowresized:function(t){if(this.active_count>0)for(var e=0,i=this.active_states;e<i.length;){var s=i[e];++e,s.onwindowresized(t)}},windowsized:function(t){if(this.active_count>0)for(var e=0,i=this.active_states;e<i.length;){var s=i[e];++e,s.onwindowsized(t)}},windowminimized:function(t){if(this.active_count>0)for(var e=0,i=this.active_states;e<i.length;){var s=i[e];++e,s.onwindowminimized(t)}},windowrestored:function(t){if(this.active_count>0)for(var e=0,i=this.active_states;e<i.length;){var s=i[e];++e,s.onwindowrestored(t)}},__class__:gi});var mi=function(t){this.text_options=t,this.text_bounds=new on;var e=null;(null==t.no_batcher_add||0==t.no_batcher_add)&&(e=null!=t.batcher?t.batcher:m.renderer.batcher),this.geom=new Mn({batcher:e,depth:t.depth,visible:t.visible,immediate:t.immediate,color:t.color,shader:t.shader,texture:t.texture,text:t.text,font:t.font,point_size:t.point_size,line_spacing:t.line_spacing,letter_spacing:t.letter_spacing,bounds:t.bounds,bounds_wrap:t.bounds_wrap,align:t.align,align_vertical:t.align_vertical,sdf:t.sdf,smoothness:t.smoothness,thickness:t.thickness,outline:t.outline,outline_color:t.outline_color,glow_threshold:t.glow_threshold,glow_amount:t.glow_amount,glow_color:t.glow_color}),this.geom.emitter.on(1,n(this,this.on_geom_text_update)),t.geometry=this.geom,t.shader=this.geom.state.shader,ii.call(this,t),this._update_bounds()};r["luxe.Text"]=mi,mi.__name__=["luxe","Text"],mi.__super__=ii,mi.prototype=i(ii.prototype,{get_text:function(){return this.geom.text},set_text:function(t){return this.geom.set_text(t)},get_font:function(){return this.geom.font},set_font:function(t){return this.geom.font=t},get_point_size:function(){return this.geom.point_size},set_point_size:function(t){return this.geom.set_point_size(t)},get_letter_spacing:function(){return this.geom.letter_spacing},set_letter_spacing:function(t){return this.geom.set_letter_spacing(t)},get_line_spacing:function(){return this.geom.line_spacing},set_line_spacing:function(t){return this.geom.set_line_spacing(t)},get_bounds:function(){return this.geom.bounds},set_bounds:function(t){return this.geom.set_bounds(t)},get_bounds_wrap:function(){return this.geom.bounds_wrap},set_bounds_wrap:function(t){return this.geom.set_bounds_wrap(t)},get_align:function(){return this.geom.align},set_align:function(t){return this.geom.set_align(t)},get_align_vertical:function(){return this.geom.align_vertical},set_align_vertical:function(t){return this.geom.set_align_vertical(t)},get_sdf:function(){return this.geom.sdf},set_sdf:function(t){return this.geom.sdf=t},get_smoothness:function(){return this.geom.smoothness},set_smoothness:function(t){return this.geom.set_smoothness(t)},get_thickness:function(){return this.geom.thickness},set_thickness:function(t){return this.geom.set_thickness(t)},get_outline:function(){return this.geom.outline},set_outline:function(t){return this.geom.set_outline(t)},get_outline_color:function(){return this.geom.outline_color},set_outline_color:function(t){return this.geom.set_outline_color(t)},get_glow_threshold:function(){return this.geom.glow_threshold},set_glow_threshold:function(t){return this.geom.set_glow_threshold(t)},get_glow_amount:function(){return this.geom.glow_amount},set_glow_amount:function(t){return this.geom.set_glow_amount(t)},get_glow_color:function(){return this.geom.glow_color},set_glow_color:function(t){return this.geom.set_glow_color(t)},point_inside:function(t){return this._update_bounds(),this.text_bounds.point_inside(t)},set_pos_from_transform:function(t){ii.prototype.set_pos_from_transform.call(this,t),this._update_bounds(),this.text_options.pos=this.get_pos()},on_geom_text_update:function(){this._update_bounds()},_update_bounds:function(){var t=this.get_pos().x,e=this.get_pos().y,i=this.geom.text_width,s=this.geom.text_height,n=this.geom.text_width,r=this.geom.text_height;if(null!=this.get_bounds()){r=this.get_bounds().h,n=this.get_bounds().w,t=this.get_bounds().x,e=this.get_bounds().y;var o=this.get_align();switch(o){case 2:t+=i/2;break;case 1:t+=i;break;default:t+=0}var l=this.get_align_vertical();switch(l){case 2:e+=r/2-s/2;break;case 4:e+=r-s;break;default:e+=0}}else{var a=this.get_align();switch(a){case 2:t-=i/2;break;case 1:t-=i;break;default:t-=0}var h=this.get_align_vertical();switch(h){case 2:e-=s/2;break;case 4:e-=s;break;default:e-=0}}this.text_bounds.set(t,e,i,s)},init:function(){ii.prototype.init.call(this)},ondestroy:function(){ii.prototype.ondestroy.call(this)},__class__:mi,__properties__:i(ii.prototype.__properties__,{set_glow_color:"set_glow_color",get_glow_color:"get_glow_color",set_glow_amount:"set_glow_amount",get_glow_amount:"get_glow_amount",set_glow_threshold:"set_glow_threshold",get_glow_threshold:"get_glow_threshold",set_outline_color:"set_outline_color",get_outline_color:"get_outline_color",set_outline:"set_outline",get_outline:"get_outline",set_thickness:"set_thickness",get_thickness:"get_thickness",set_smoothness:"set_smoothness",get_smoothness:"get_smoothness",set_sdf:"set_sdf",get_sdf:"get_sdf",set_align_vertical:"set_align_vertical",get_align_vertical:"get_align_vertical",set_align:"set_align",get_align:"get_align",set_bounds_wrap:"set_bounds_wrap",get_bounds_wrap:"get_bounds_wrap",set_bounds:"set_bounds",get_bounds:"get_bounds",set_line_spacing:"set_line_spacing",get_line_spacing:"get_line_spacing",set_letter_spacing:"set_letter_spacing",get_letter_spacing:"get_letter_spacing",set_point_size:"set_point_size",get_point_size:"get_point_size",set_font:"set_font",get_font:"get_font",set_text:"set_text",get_text:"get_text"})});var vi=function(t){this.core=t,this.timers=[]};r["luxe.Timer"]=vi,vi.__name__=["luxe","Timer"],vi.prototype={init:function(){},destroy:function(){this.reset()},process:function(){},reset:function(){for(var t=0,e=this.timers;t<e.length;){var i=e[t];++t,i.stop(),i=null}this.timers=null,this.timers=[]},schedule:function(t,e,i){null==i&&(i=!1);var s=this,n=new qn(t);return n.run=function(){i||(n.stop(),d.remove(s.timers,n)),e()},this.timers.push(n),n},__class__:vi};var yi=function(t){var e=new de;this.components=new Xi(e),this.entity=t};r["luxe.components.Components"]=yi,yi.__name__=["luxe","components","Components"],yi.prototype={add:function(t){return null==t?t:(t.set_entity(this.entity),this.components.set(t.name,t),t.onadded(),this.entity.inited&&t.init(),this.entity.started&&t.onreset(),t)},remove:function(t){if(!this.components.map.exists(t))return!1;var e=this.components.map.get(t);return e.onremoved(),e.set_entity(null),this.components.remove(t)},get:function(t,e){if(null==e&&(e=!1),e){var i=this.components.map.get(t);if(null!=i)return i;for(var s=0,n=this.entity.children;s<n.length;){var r=n[s];++s;var o=r._components.get(t,!0);if(null!=o)return o}return null}return this.components.map.get(t)},get_any:function(t,e,i){null==i&&(i=!0),null==e&&(e=!1);var s=[];if(!e)return[this.components.map.get(t)];var n=this.components.map.get(t);if(null!=n){if(i)return[n];s.push(n)}for(var r=0,o=this.entity.children;r<o.length;){var l=o[r];++r;var a=l._components.get_any(t,!0,i);if(null!=a){if(i&&a.length>0)return[a[0]];s.concat(a)}}return s},has:function(t){return this.components.map.exists(t)},__class__:yi};var wi=function(){this.visible=!1,Ne.call(this)};r["luxe.debug.DebugView"]=wi,wi.__name__=["luxe","debug","DebugView"],wi.__super__=Ne,wi.prototype=i(Ne.prototype,{refresh:function(){},process:function(){},onmousedown:function(){},onmousewheel:function(){},onmouseup:function(){},onmousemove:function(){},onkeydown:function(){},onkeyup:function(){},onwindowsized:function(){},create:function(){},show:function(){this.visible=!0},hide:function(){this.visible=!1},__class__:wi});var xi=function(){this.as_immediate=!1,this.dragging=!1,wi.call(this),this.set_name("Batcher Debug")
};r["luxe.debug.BatcherDebugView"]=xi,xi.__name__=["luxe","debug","BatcherDebugView"],xi.__super__=wi,xi.prototype=i(wi.prototype,{create:function(){this.batcher=m.renderer.create_batcher({name:"debug_batcher_view",camera:new Ws({camera_name:"batcher_debug_view"}),layer:1e3})},refresh:function(){this.clear_batcher_tree(),this.draw_batcher_tree()},onmousedown:function(t){this.dragmstart=t.pos.clone(),this.dragstart=this.batcher.view.get_pos().clone(),this.dragging=!0},onmouseup:function(){this.dragging=!1},onmousemove:function(t){if(this.dragging){var e=y.Subtract(t.pos,this.dragmstart);this.batcher.view.set_pos(y.Subtract(this.dragstart,e))}},onmousewheel:function(t){if(t.y<0){var e=this.batcher.view;e.set_zoom(e.zoom-.1)}else{var i=this.batcher.view;i.set_zoom(i.zoom+.1)}},clear_batcher_tree:function(){if(null!=this._tree_geom){for(var t=0,e=this._tree_geom;t<e.length;){var i=e[t];++t,i.drop(),i=null}this._tree_geom=null}},keystr:function(t){return"ts: "+t.timestamp+"\nseq: "+t.sequence+"\nprimitive_type: "+function(e){var i,s=t.primitive_type;return i=function(){var t;switch(s){case 3:t="line_strip";break;case 2:t="line_loop";break;case 1:t="lines";break;case 5:t="triangle_strip";break;case 4:t="triangles";break;case 6:t="triangle_fan";break;case 0:t="points";break;default:t=""+s}return t}(e)}(this)+" "+function(e){var i,s=t.primitive_type;return i=function(){var t;switch(s){case 3:t="line_strip";break;case 2:t="line_loop";break;case 1:t="lines";break;case 5:t="triangle_strip";break;case 4:t="triangles";break;case 6:t="triangle_fan";break;case 0:t="points";break;default:t=""+s}return t}(e)}(this)+"\ntexture: "+(null==t.texture?"null":C.string(t.texture.texture))+"\ntexture id: "+(null==t.texture?"null":t.texture.id)+"\nshader: "+(null==t.shader?"null":t.shader.id)+"\ndepth: "+t.depth+"\nclip: "+(null==t.clip?"null":""+t.clip)},draw_geom_node:function(t,e,i,s){null==s&&(s=20);var n=128,r=n/2,o=128,l=e.value,a=new F(1,1,1,.4).rgb(16777215);l.dropped&&(a=new F(1,1,1,1).rgb(13369344)),this._tree_geom.push(m.draw.rectangle({immediate:this.as_immediate,x:i.x-r,y:i.y,w:n,h:o,color:a,batcher:this.batcher,depth:999.4})),this._tree_geom.push(m.draw.text({immediate:this.as_immediate,bounds:new on(i.x-r,i.y,n,o),point_size:13,color:a,batcher:this.batcher,depth:999.4,text:this.keystr(e.key,l.key),align:2,align_vertical:2}));var h,_=new y(i.x,i.y,i.z,i.w),u=i.x,c=i.y-16,d=_.ignore_listeners;_.ignore_listeners=!0,_.x=u,_._construct?_.x:(null==_.listen_x||_.ignore_listeners||_.listen_x(u),_.x),_.y=c,_._construct?_.y:(null==_.listen_y||_.ignore_listeners||_.listen_y(c),_.y),_.ignore_listeners=d,null==_.listen_x||_.ignore_listeners||_.listen_x(_.x),null==_.listen_y||_.ignore_listeners||_.listen_y(_.y),h=_;var f,p=new y(i.x,i.y,i.z,i.w),g=i.x,v=i.y+n+2,w=p.ignore_listeners;p.ignore_listeners=!0,p.x=g,p._construct?p.x:(null==p.listen_x||p.ignore_listeners||p.listen_x(g),p.x),p.y=v,p._construct?p.y:(null==p.listen_y||p.ignore_listeners||p.listen_y(v),p.y),p.ignore_listeners=w,null==p.listen_x||p.ignore_listeners||p.listen_x(p.x),null==p.listen_y||p.ignore_listeners||p.listen_y(p.y),f=p;var x=2;this._tree_geom.push(m.draw.text({immediate:this.as_immediate,pos:h,point_size:13,color:a,batcher:this.batcher,depth:999.4,text:l.id,align:x}));var b=new F(1,1,1,.4).rgb(16750916),k="none",z="none";if(null!=e.left){k="node";var S=m.renderer.batcher.compare_rule(e.key,e.left.key);k=m.renderer.batcher.compare_rule_to_string(S)}if(null!=e.right){z="node";var T=m.renderer.batcher.compare_rule(e.key,e.right.key);z=m.renderer.batcher.compare_rule_to_string(T)}this._tree_geom.push(m.draw.text({immediate:this.as_immediate,pos:f,point_size:13,color:b,batcher:this.batcher,depth:999.4,text:k+" / "+z,align:x}))},draw_geom_leaf:function(t,e,i){if(null!=e){var s=e.nodecount/20,n=25*e.nodecount,r=128,o=148,l=s/2,a=new F(1,1,1,.4).rgb(16777215);null!=e&&(this.draw_geom_node(t,e,i,s),null!=e.left&&(a=new F(1,1,1,1).rgb(m.renderer.batcher.geometry_compare(e.left.key,e.key)<0?52224:13369344),this._tree_geom.push(m.draw.line({immediate:this.as_immediate,p0:new y(i.x-l,i.y+r),p1:new y(i.x-n,i.y+o),color:a,batcher:this.batcher,depth:999.4})),this.draw_geom_leaf(!0,e.left,new y(i.x-n,i.y+o))),null!=e.right&&(a=new F(1,1,1,1).rgb(m.renderer.batcher.geometry_compare(e.right.key,e.key)>0?52224:13369344),this._tree_geom.push(m.draw.line({immediate:this.as_immediate,p0:new y(i.x+l,i.y+r),p1:new y(i.x+n,i.y+o),color:a,batcher:this.batcher,depth:999.4})),this.draw_geom_leaf(!1,e.right,new y(i.x+n,i.y+o))))}},draw_batcher_tree:function(){this._tree_geom=null,this._tree_geom=[];var t=new y(m.core.screen.get_w()/2,2*m.debug.padding.y+10),e=m.renderer.batcher.geometry.root;this.draw_geom_leaf(!0,e,t)},process:function(){this.visible&&m.renderer.batcher.tree_changed&&this.refresh()},show:function(){wi.prototype.show.call(this),this.refresh()},hide:function(){wi.prototype.hide.call(this),this.clear_batcher_tree()},__class__:xi});var bi=function(t){this.set_size(new y(C["int"](.2*m.core.screen.get_w()),C["int"](.6*m.core.screen.get_h()))),this.set_pos(new y(m.core.screen.get_w()/2-this.size.x/2,m.core.screen.get_h()/2-this.size.y/2)),this.batcher=m.renderer.batcher,null!=t&&(null!=t.batcher&&(this.batcher=t.batcher),null!=t.size&&this.set_size(t.size),null!=t.pos&&this.set_pos(t.pos))};r["luxe.debug.Inspector"]=bi,bi.__name__=["luxe","debug","Inspector"],bi.prototype={refresh:function(){null==this.window&&this.create_window(),null!=this.onrefresh&&this.onrefresh()},show:function(){this.refresh(),this.window.set_visible(!0),this.title.set_visible(!0),this.version.set_visible(!0)},hide:function(){this.window.set_visible(!1),this.title.set_visible(!1),this.version.set_visible(!1)},set_size:function(t){return null!=t&&null!=this.window&&(this.window.set_size(t),this.window.geometry.set_dirty(!0)),null!=this.version&&this.version.set_pos(new y(this.pos.x+(t.x-14),this.pos.y+6)),this.size=t},set_pos:function(t){return null!=t&&null!=this.window&&(this.window.set_pos(t),this.window.geometry.set_dirty(!0)),null!=this.title&&this.title.set_pos(new y(t.x+14,t.y+6)),null!=this.version&&this.version.set_pos(new y(t.x+(this.size.x-14),t.y+6)),this.pos=t},create_window:function(){this.window=new pi({name:"debug.window",batcher:this.batcher,no_scene:!0,depth:999.1,visible:!1,color:(new F).rgb(1447449),centered:!1,size:this.size,pos:this.pos}),this.title=new mi({name:"debug.title",batcher:this.batcher,no_scene:!0,depth:999.2,visible:!1,color:(new F).rgb(16121979),pos:new y(this.pos.x+14,this.pos.y+6),text:"Inspector",point_size:15,align:0}),this.version=new mi({name:"debug.version",batcher:this.batcher,no_scene:!0,depth:999.2,visible:!1,color:(new F).rgb(5526617),pos:new y(this.pos.x+(this.size.x-14),this.pos.y+6),text:""+m.core.runtime_info(),point_size:13,align:1}),this.window.set_locked(!0),this.window.geometry.id="debug.Inspector",this.title.geometry.id="debug.title.text",this.version.geometry.id="debug.version.text"},__class__:bi,__properties__:{set_size:"set_size",set_pos:"set_pos"}};var ki=function(){this._setup=!1,this._byte_levels=["bytes","Kb","MB","GB","TB"],this.minpeak=1,this.peak=1,this.nexttick=0,this.tickamount=.017,this.margin=32,wi.call(this),this.set_name("Profiler"),ki.lists=new de};r["luxe.debug.ProfilerDebugView"]=ki,ki.__name__=["luxe","debug","ProfilerDebugView"],ki.add_offset=function(t,e){var i=ki.lists.get(t),s=ki.lists.get(e);null!=i&&null!=s&&i.offsets.push(s)},ki.hide_item=function(t){var e=ki.lists.get(t);null!=e&&(e.hidden=!0,e.bar.hide())},ki.show_item=function(t){var e=ki.lists.get(t);null!=e&&(e.hidden=!1,e.bar.show())},ki.start=function(t,e){var i=ki.lists.get(t);null==i&&(i=new zi(t,new Ti(t,e,(new F).rgb(16121979))),i.bar.set_pos(new y(2*m.debug.padding.x,3*m.debug.padding.y+20*f.count(ki.lists))),ki.lists.set(t,i)),i.start=Nn.core.timestamp()},ki.end=function(t){var e=ki.lists.get(t);if(null==e)throw new Ie("Debug / profile end called for "+t+" but no start called");e.set()},ki.__super__=wi,ki.prototype=i(wi.prototype,{create:function(){},update_graph:function(t,e){var i=Math.floor(Math.log(e)/Math.log(1024)),s=e/Math.pow(1024,i);s>this.peak&&(this.peak=Math.ceil(s+.1*s)),s<this.minpeak&&(this.minpeak=Math.floor(s-.1*s)),t.max!=this.peak&&t.set_max(this.peak),t.set_ping(Cs.fixed(s,4))},process:function(){},show:function(){for(var t=ki.lists.iterator();t.hasNext();){var e=t.next();e.hidden||e.bar.show()}this._setup||(this._setup=!0)},hide:function(){for(var t=ki.lists.iterator();t.hasNext();){var e=t.next();e.bar.hide()}},__class__:ki});var zi=function(t,e){this.accum=0,this.count=0,this.hidden=!1,this.avg=10,this.start=0,this.name=t,this.bar=e,this.history=[],this.offsets=[]};r["luxe.debug._ProfilerDebugView.ProfilerValue"]=zi,zi.__name__=["luxe","debug","_ProfilerDebugView","ProfilerValue"],zi.prototype={set:function(){for(var t=Nn.core.timestamp()-this.start,e=0,i=this.offsets;e<i.length;){var s=i[e];++e,t-=s.history[s.history.length-1]}if(this.history.push(t),this.history.length>this.avg&&this.history.shift(),this.count++,this.count==this.avg){var n=this.accum/this.avg;this.bar.set_value(n),this.accum=0,this.count=0}this.accum+=t,this.bar.visible&&this.bar.set_text(C.string(Cs.fixed(1e3*t,4)))},__class__:zi};var Si=function(t,e){null==e&&(e=!0),this.visible=!1,this.history=33,this.height2=8,this.height=8,this.width=128,this.bg=!0,this.bg=e,this.name=t,this.color=new F,this.set_max(Cs.fixed(16.666666666666668,2))};r["luxe.debug._ProfilerDebugView.ProfilerGraph"]=Si,Si.__name__=["luxe","debug","_ProfilerDebugView","ProfilerGraph"],Si.prototype={create:function(){this.segment=this.width/this.history,this.height2=2*this.height,this.bg&&(this.graphbg_geometry=m.draw.box({color:(new F).rgb(1052688),depth:999.3,batcher:m.debug.batcher,x:0,y:0,w:this.width-this.segment,h:this.height2})),this.graph_geometry=new yn({color:this.color,depth:999.33,batcher:m.debug.batcher});for(var t=0,e=this.history;e>t;){var i=t++,s=new Bn(new y(this.segment*i,this.height2),this.color);this.graph_geometry.add(s)}this.graph_geometry.set_primitive_type(3),this.hide()},set_max:function(t){var e=this.max;if(this.max=t,null!=this.graph_geometry){var i=1;0!=e&&(i=e/t);for(var s=0,n=this.graph_geometry.vertices;s<n.length;){var r=n[s];if(++s,null!=r){var o=1-r.pos.y/this.height2,l=o*e;o=l/this.max,r.pos.set_y(this.height2*(1-o))}}}return this.max},set_ping:function(t){for(var e=Cs.fixed(t,4),i=e/this.max,s=0,n=this.history;n>s;){var r=s++,o=this.graph_geometry.vertices[r];if(r<this.history-1){var l=this.graph_geometry.vertices[r+1];null!=l&&(o.pos.set_y(Math.floor(l.pos.y)),o.color=l.color)}}return i=.001>i?.001:i>1?1:i,this.graph_geometry.vertices[this.history-1].color=i>1?ki.color_red:.2>i?ki.color_green:this.color,this.graph_geometry.vertices[this.history-1].pos.set_y(Math.floor(this.height2*(1-i))),this.ping=t},hide:function(){this.visible=!1,this.graph_geometry.set_visible(!1),null!=this.graphbg_geometry&&this.graphbg_geometry.set_visible(!1)},show:function(){this.visible=!0,this.graph_geometry.set_visible(!0),null!=this.graphbg_geometry&&this.graphbg_geometry.set_visible(!0)},set_pos:function(t){return null!=this.graphbg_geometry&&this.graphbg_geometry.transform.local.pos.copy_from(t),this.graph_geometry.transform.local.pos.copy_from(t),this.pos=t},__class__:Si,__properties__:{set_pos:"set_pos",set_ping:"set_ping",set_max:"set_max"}};var Ti=function(t,e,i){this.max=16.7,this.height=8,this.visible=!1,this.name=t,this.graph=new Si(t),this.graph.create(),null!=e&&this.graph.set_max(e),this.text_item=new mi({no_scene:!0,name:"profiler.text."+t,pos:new y(0,0),color:i,point_size:1.8*this.height,depth:999.3,text:"",batcher:m.debug.batcher}),this.bg_geometry=m.draw.box({color:(new F).rgb(592137),depth:999.3,batcher:m.debug.batcher,x:0,y:0,w:this.graph.width,h:this.graph.height}),this.bar_geometry=m.draw.box({color:i,depth:999.33,batcher:m.debug.batcher,x:1,y:1,w:this.graph.width-2,h:this.graph.height-2}),this.hide()};r["luxe.debug._ProfilerDebugView.ProfilerBar"]=Ti,Ti.__name__=["luxe","debug","_ProfilerDebugView","ProfilerBar"],Ti.prototype={hide:function(){this.visible=!1,this.bar_geometry.set_visible(!1),this.bg_geometry.set_visible(!1),this.text_item.set_visible(!1),this.graph.hide()},show:function(){this.visible=!0,this.bar_geometry.set_visible(!0),this.bg_geometry.set_visible(!0),this.text_item.set_visible(!0),this.graph.show()},set_value:function(t){if(this.graph.set_ping(1e3*t),!this.visible)return this.value=t;var e=Cs.fixed(1e3*t,4),i=e/this.max;i=.005>i?.005:i>1?1:i,this.bar_geometry.set_color(i>1?ki.color_red:.15>i?ki.color_green:ki.color_normal);var s=(this.graph.width-2)*i;return this.bar_geometry.resize_xy(s,this.graph.height-2),this.value=t},set_pos:function(t){this.bg_geometry.transform.local.set_pos(t);var e=this.bar_geometry.transform.local.pos,i=t.x+1,s=t.y+1,n=e.ignore_listeners;e.ignore_listeners=!0,e.x=i,e._construct?e.x:(null==e.listen_x||e.ignore_listeners||e.listen_x(i),e.x),e.y=s,e._construct?e.y:(null==e.listen_y||e.ignore_listeners||e.listen_y(s),e.y),e.ignore_listeners=n,null==e.listen_x||e.ignore_listeners||e.listen_x(e.x),null==e.listen_y||e.ignore_listeners||e.listen_y(e.y);var r=this.text_item.get_pos(),o=t.x+2*this.graph.width+10,l=t.y-6,a=r.ignore_listeners;return r.ignore_listeners=!0,r.x=o,r._construct?r.x:(null==r.listen_x||r.ignore_listeners||r.listen_x(o),r.x),r.y=l,r._construct?r.y:(null==r.listen_y||r.ignore_listeners||r.listen_y(l),r.y),r.ignore_listeners=a,null==r.listen_x||r.ignore_listeners||r.listen_x(r.x),null==r.listen_y||r.ignore_listeners||r.listen_y(r.y),this.graph.set_pos(new y(t.x,t.y,t.z,t.w).add_xyz(this.graph.width+2,-this.graph.height+4,null)),this.pos=t},set_text:function(t){return this.text_item.set_text(""+this.name+" ("+this.graph.max+"ms) | "+t+"ms"),this.text=t},__class__:Ti,__properties__:{set_value:"set_value",set_pos:"set_pos",set_text:"set_text"}};var Ai=function(){this.hide_ids=!0,this.font_size=15,this.margin=32,wi.call(this),this.set_name("Scenes"),this.scenes=[]};r["luxe.debug.SceneDebugView"]=Ai,Ai.__name__=["luxe","debug","SceneDebugView"],Ai.__super__=wi,Ai.prototype=i(wi.prototype,{create:function(){var t=m.debug;this.items_list=new mi({name:"debug.scene.list",depth:999.3,no_scene:!0,color:new F(0,0,0,1).rgb(16121979),pos:new y(0,0),font:m.renderer.font,text:this.get_list(),point_size:this.font_size,batcher:t.batcher,visible:!1}),this.items_list.geometry.id="debug.scene.list.geometry",this.resize()},add_scene:function(t){if(-1!=d.indexOf(this.scenes,t,0))throw new Ie(ei.assertion("scenes.indexOf(_scene) == -1"));this.scenes.push(t)},remove_scene:function(t){if(-1==d.indexOf(this.scenes,t,0))throw new Ie(ei.assertion("scenes.indexOf(_scene) != -1"));var e=d.remove(this.scenes,t);return this.refresh(),e},onkeydown:function(t){t.keycode==tr.key_2&&this.visible&&this.toggle_ids()},toggle_ids:function(){this.hide_ids=!this.hide_ids,this.refresh()},tabs:function(t){for(var e="",i=0;t>i;){{i++}e+="    "}return e},list_entity:function(t,e,i){null==i&&(i=1);var s;s=e.get_active()?"":"/ inactive";var n;n=1==i?this.tabs(i):this.tabs(i)+"> ";var r;r=this.hide_ids?"":e.get_id();var o=f.count(e._components.components),l=" "+o,a="> "+e.children.length;t+=""+n+r+" "+e.get_name()+" "+a+" "+l+" "+s+"\n";for(var h=d.iter(e._components.components._keys);h.hasNext();){var _,u=h.next(),c=e._components.components.map.get(u);_=this.hide_ids?"":" "+c.id,t+=this.tabs(i+1)+(""+_+" "+c.name+"\n")}for(var p=0,g=e.children;p<g.length;){var m=g[p];++p,t=this.list_entity(t,m,i+2)}return t},get_list:function(){for(var t="",e=0,i=this.scenes;e<i.length;){var s=i[e];++e;var n;n=this.hide_ids?"":""+s.get_id()+" ",t+=n,t+=""+s.get_name()+" ",t+="( "+s.get_length()+" )\n";for(var r=s.entities.iterator();r.hasNext();){var o=r.next();t=this.list_entity(t,o,null)}}return t},refresh:function(){this.items_list.set_text(this.get_list())},process:function(){if(this.visible){for(var t=!1,e=0,i=this.scenes;e<i.length;){var s=i[e];++e,s._has_changed&&(t=!0,s._has_changed=!1)}t&&this.refresh()}},onmousewheel:function(t){var e=this.items_list.text_bounds.h,i=m.debug.inspector.size.y-this.margin,s=e-i,n=this.items_list.get_pos().y,r=m.debug.padding.y+1.5*this.margin,o=r;s>0&&(o=r-(s+2*this.margin)),n-=this.margin/2*t.y,n=o>n?o:n>r?r:n,this.items_list.get_pos().set_y(n)},show:function(){wi.prototype.show.call(this),this.refresh(),this.items_list.set_visible(!0)},hide:function(){wi.prototype.hide.call(this),this.items_list.set_visible(!1)},resize:function(){var t=m.debug,e=new on(t.inspector.pos.x+this.margin/2,t.inspector.pos.y+1.5*this.margin,t.inspector.size.x-this.margin,t.inspector.size.y-this.margin-1.5*this.margin),i=t.padding.x+this.margin,s=t.padding.y+1.5*this.margin;null!=this.items_list&&(this.items_list.set_pos(new y(i,s)),this.items_list.set_clip_rect(e))},onwindowsized:function(){this.resize()},__class__:Ai});var Ii=function(){this.hide_debug=!0,this.margin=32,this.font_size=15,this.debug_geometry_count=13,this.debug_draw_call_count=3,wi.call(this),this.set_name("Statistics"),this._last_render_stats={batchers:0,geometry_count:0,dynamic_batched_count:0,static_batched_count:0,visible_count:0,draw_calls:0,vert_count:0},this._render_stats={batchers:0,geometry_count:0,dynamic_batched_count:0,static_batched_count:0,visible_count:0,draw_calls:0,vert_count:0}};r["luxe.debug.StatsDebugView"]=Ii,Ii.__name__=["luxe","debug","StatsDebugView"],Ii.__super__=wi,Ii.prototype=i(wi.prototype,{get_resource_stats_string:function(){return C.string(m.resources.stats)},get_render_stats_string:function(){return"Renderer Statistics\n\nbatcher count : "+this._render_stats.batchers+"\ntotal geometry : "+this._render_stats.geometry_count+"\nvisible geometry : "+this._render_stats.visible_count+"\ndynamic batch count : "+this._render_stats.dynamic_batched_count+"\nstatic batch count : "+this._render_stats.static_batched_count+"\ntotal draw calls : "+this._render_stats.draw_calls+"\ntotal vert count : "+this._render_stats.vert_count},create:function(){var t=this,e=m.debug;this.render_stats_text=new mi({name:"debug.render.stats",depth:999.3,no_scene:!0,color:new F(0,0,0,1).rgb(16121979),pos:new y(0,0),font:m.renderer.font,text:this.get_render_stats_string(),point_size:this.font_size,batcher:e.batcher,visible:!1}),this.resource_list_text=new mi({name:"debug.resource.stats",depth:999.3,no_scene:!0,color:new F(0,0,0,1).rgb(16121979),pos:new y(0,0),font:m.renderer.font,text:"",align:1,point_size:.9*this.font_size,batcher:e.batcher,visible:!1}),this.render_stats_text.geometry.id="debug.render.stats.geometry",this.render_stats_text.geometry.id="debug.resource.stats.geometry",this.resize(),m.resources.on(1,function(){t.visible&&t.refresh()})},resize:function(){if(null!=this.resource_list_text&&null!=this.render_stats_text){{var t=m.debug,e=new on(t.inspector.pos.x+this.margin/2,t.inspector.pos.y+1.5*this.margin,t.inspector.size.x-this.margin,t.inspector.size.y-this.margin-1.5*this.margin),i=t.padding.x+this.margin,s=t.padding.x+t.inspector.size.x-this.margin,n=t.padding.y+1.5*this.margin;this.render_stats_text.text_bounds.w,this.render_stats_text.text_bounds.h}null!=this.resource_list_text&&(this.resource_list_text.set_pos(new y(s,n)),this.resource_list_text.set_clip_rect(e)),null!=this.render_stats_text&&(this.render_stats_text.set_pos(new y(i,n)),this.render_stats_text.set_clip_rect(e)),this.reset_tween()}},onwindowsized:function(){this.resize()},refresh:function(){for(var t="",e="",i="",s="",n="",r="",o="",l=m.resources.cache.iterator();l.hasNext();){var a=l.next(),h=a.resource_type;switch(h){case 3:t+=""+a.id+"  "+a.ref+"	\n";break;case 1:e+=""+a.id+"  "+a.ref+"	\n";break;case 2:i+=""+a.id+"  "+a.ref+"	\n";break;case 4:var _=a;s+="("+_.width_actual+"x"+_.height_actual+" ~"+m.utils.bytes_to_string(_.memory_use())+")    "+_.id+"  "+_.ref+"	\n";break;case 5:var u=a;n+="("+u.width_actual+"x"+u.height_actual+" ~"+m.utils.bytes_to_string(u.memory_use())+")    "+u.id+"  "+u.ref+"	\n";break;case 6:r+=""+a.id+"  "+a.ref+"	\n";break;case 7:var c=a;o+="("+c.vert_id+", "+c.frag_id+")    "+c.id+"  "+c.ref+"	\n"}}var d="Resource list ("+m.resources.stats.total+")\n\n";d+="Bytes ("+m.resources.stats.bytes+")\n",d+=""==t?"-	\n":t,d+="\nText ("+m.resources.stats.texts+")\n",d+=""==e?"-	\n":e,d+="\nJSON ("+m.resources.stats.jsons+")\n",d+=""==i?"-	\n":i,d+="\nTexture ("+m.resources.stats.textures+")\n",d+=""==s?"-	\n":s,d+="\nRenderTexture ("+m.resources.stats.render_textures+")\n",d+=""==n?"-	\n":n,d+="\nFont ("+m.resources.stats.fonts+")\n",d+=""==r?"-	\n":r,d+="\nShader ("+m.resources.stats.shaders+")\n",d+=""==o?"-	\n":o;for(var p="",g=[],v=m.core.app.audio.sound_list.iterator();v.hasNext();){var y=v.next();g.push(y.name)}g.sort(function(t,e){return t==e?0:e>t?-1:1});for(var w=0;w<g.length;){var x=g[w];++w,p+=""+x+" \n"}var b=f.count(m.core.app.audio.sound_list);d+="\n\n---\nAudio list ("+b+")\n\n",d+=""==p?"-	\n":p,this.resource_list_text.set_text(d),null!=this.resource_list_text.geometry&&this.resource_list_text.geometry.set_dirty(!0),this.reset_tween()},process:function(){if(this.visible){var t=!1;this.update_render_stats(),this._last_render_stats.batchers!=this._render_stats.batchers&&(t=!0,this._last_render_stats.batchers=this._render_stats.batchers),this._last_render_stats.geometry_count!=this._render_stats.geometry_count&&(t=!0,this._last_render_stats.geometry_count=this._render_stats.geometry_count),this._last_render_stats.dynamic_batched_count!=this._render_stats.dynamic_batched_count&&(t=!0,this._last_render_stats.dynamic_batched_count=this._render_stats.dynamic_batched_count),this._last_render_stats.static_batched_count!=this._render_stats.static_batched_count&&(t=!0,this._last_render_stats.static_batched_count=this._render_stats.static_batched_count),this._last_render_stats.visible_count!=this._render_stats.visible_count&&(t=!0,this._last_render_stats.visible_count=this._render_stats.visible_count),this._last_render_stats.draw_calls!=this._render_stats.draw_calls&&(t=!0,this._last_render_stats.draw_calls=this._render_stats.draw_calls),this._last_render_stats.vert_count!=this._render_stats.vert_count&&(t=!0,this._last_render_stats.vert_count=this._render_stats.vert_count),t&&this.refresh_render_stats()}},onmousewheel:function(t){is.stop(this.resource_list_text.get_pos());var e=this.resource_list_text.text_bounds.h,i=m.debug.inspector.size.y-this.margin,s=e-i,n=this.resource_list_text.get_pos().y,r=m.debug.padding.y+1.5*this.margin,o=r;s>0&&(o=r-(s+2*this.margin)),n-=this.margin/2*t.y,n=o>n?o:n>r?r:n,this.resource_list_text.get_pos().set_y(n)},onkeydown:function(t){t.keycode==tr.key_2&&this.visible&&this.toggle_debug_stats()},show:function(){wi.prototype.show.call(this),this.refresh(),this.render_stats_text.set_visible(!0),this.resource_list_text.set_visible(!0)},hide:function(){wi.prototype.hide.call(this),this.render_stats_text.set_visible(!1),this.resource_list_text.set_visible(!1),is.stop(this.resource_list_text.get_pos())},reset_tween:function(){is.stop(this.resource_list_text.get_pos());var t=this.resource_list_text.text_bounds.h,e=m.debug.inspector.size.y-this.margin,i=t-e,s=m.debug.padding.y+1.5*this.margin;if(this.resource_list_text.get_pos().set_y(s),i>0){var n=s-(i+2*this.margin);is.tween(this.resource_list_text.get_pos(),8,{y:n}).repeat().delay(4).reflect().ease(bs.get_easeNone())}},refresh_render_stats:function(){this.visible&&(this.render_stats_text.set_text(this.get_render_stats_string()),this.render_stats_text.set_locked(!0),null!=this.render_stats_text.geometry&&this.render_stats_text.geometry.set_dirty(!0))},toggle_debug_stats:function(){this.hide_debug=!this.hide_debug},update_render_stats:function(){this.debug_geometry_count=m.debug.batcher.geometry.size(),this.debug_draw_call_count=m.debug.batcher.draw_calls,this._render_stats.batchers=m.renderer.stats.batchers,this._render_stats.geometry_count=m.renderer.stats.geometry_count,this._render_stats.visible_count=m.renderer.stats.visible_count,this._render_stats.dynamic_batched_count=m.renderer.stats.dynamic_batched_count,this._render_stats.static_batched_count=m.renderer.stats.static_batched_count,this._render_stats.draw_calls=m.renderer.stats.draw_calls,this._render_stats.vert_count=m.renderer.stats.vert_count,this.hide_debug&&(this._render_stats.geometry_count=this._render_stats.geometry_count-this.debug_geometry_count,this._render_stats.visible_count=this._render_stats.visible_count-m.debug.batcher.visible_count,this._render_stats.dynamic_batched_count=this._render_stats.dynamic_batched_count-m.debug.batcher.dynamic_batched_count,this._render_stats.static_batched_count=this._render_stats.static_batched_count-m.debug.batcher.static_batched_count,this._render_stats.draw_calls-=this.debug_draw_call_count,this._render_stats.vert_count-=m.debug.batcher.vert_count)},__class__:Ii});var Ei=function(){this._last_logged_length=0,this.max_lines=35,wi.call(this),this.set_name("Log"),m.debug.add_trace_listener("TraceDebugView",n(this,this.on_trace)),this.logged=[],this.add_line("luxe version "+m.build)};r["luxe.debug.TraceDebugView"]=Ei,Ei.__name__=["luxe","debug","TraceDebugView"],Ei.__super__=wi,Ei.prototype=i(wi.prototype,{on_trace:function(t,e){this.add_line(e.fileName+":"+e.lineNumber+" "+C.string(t))},create:function(){var t=m.debug,e=new on(t.padding.x+20,t.padding.y+40,m.core.screen.get_w()-2*t.padding.x-20,m.core.screen.get_h()-2*t.padding.y-40);this.lines=new mi({name:"debug.log.text",no_scene:!0,depth:999.3,color:(new F).rgb(8947848),bounds:e,bounds_wrap:!0,font:m.renderer.font,text:"",align_vertical:4,point_size:12,batcher:t.batcher,visible:!1}),null!=this.lines.geometry&&(this.lines.geometry.set_clip_rect(e),this.lines.geometry.set_locked(!0),this.lines.geometry.id="debug.log.text.geometry")},onwindowsized:function(){var t=m.debug,e=new on(t.padding.x+20,t.padding.y+40,m.core.screen.get_w()-2*t.padding.x-20,m.core.screen.get_h()-2*t.padding.y-40);this.lines.set_bounds(e),this.lines.set_clip_rect(e),null!=this.lines.geometry&&(this.lines.geometry.set_locked(!0),this.lines.geometry.set_dirty(!0))},add_line:function(t){null!=this.logged&&(this.logged.push(t),this.visible&&this.refresh_lines())},refresh_lines:function(){if(this._last_logged_length!=this.logged.length){var t="";if(this.logged.length<=this.max_lines)for(var e=0,i=this.logged;e<i.length;){var s=i[e];++e,t+=s+"\n"}else for(var n=this.logged.length-this.max_lines,r=(this.logged.length,n),o=this.logged.length;o>r;){var l=r++,a=this.logged[l];t+=a+"\n"}this.lines.set_text(t),null!=this.lines.geometry&&(this.lines.geometry.set_locked(!0),this.lines.geometry.set_dirty(!0)),this._last_logged_length=this.logged.length}},refresh:function(){},process:function(){},show:function(){wi.prototype.show.call(this),this.refresh_lines(),this.lines.set_visible(!0)},hide:function(){wi.prototype.hide.call(this),this.lines.set_visible(!1)},__class__:Ei});var Mi=function(){};r["luxe.importers.bitmapfont.BitmapFontParser"]=Mi,Mi.__name__=["luxe","importers","bitmapfont","BitmapFontParser"],Mi.parse=function(t){if(0==t.length)throw new Ie("BitmapFont:Parser: _font_data is 0 length");var e={face:null,chars:new _e,point_size:0,base_size:0,char_count:0,line_height:0,pages:[],kernings:new _e},i=t.split("\n");if(0==i.length)throw new Ie("BitmapFont; invalid font data specified for parser.");var s=i[0];if("info"!=function(){var t,e=B.ltrim(s);return t=d.substr(e,0,4)}(this))throw new Ie("BitmapFont; invalid font data specified for parser. Format should be plain ascii text .fnt file only currently.");for(var n=0;n<i.length;){var r=i[n];++n;for(var o=r.split(" "),l=0;l<o.length;){var a=o[l];++l,Mi.parse_token(a,o,e)}}return e},Mi.parse_token=function(t,e,i){e.shift();var s=Mi.tokenize_line(e);switch(t){case"info":i.face=Mi.unquote(null!=Xr.face?s.getReserved("face"):s.h.face),i.point_size=C.parseFloat(null!=Xr.size?s.getReserved("size"):s.h.size);break;case"common":i.line_height=C.parseFloat(null!=Xr.lineHeight?s.getReserved("lineHeight"):s.h.lineHeight),i.base_size=C.parseFloat(null!=Xr.base?s.getReserved("base"):s.h.base);break;case"page":i.pages.push({id:C.parseInt(null!=Xr.id?s.getReserved("id"):s.h.id),file:Mi.trim(Mi.unquote(null!=Xr.file?s.getReserved("file"):s.h.file))});break;case"chars":i.char_count=C.parseInt(null!=Xr.count?s.getReserved("count"):s.h.count);break;case"char":var n={id:C.parseInt(null!=Xr.id?s.getReserved("id"):s.h.id),x:C.parseFloat(null!=Xr.x?s.getReserved("x"):s.h.x),y:C.parseFloat(null!=Xr.y?s.getReserved("y"):s.h.y),width:C.parseFloat(null!=Xr.width?s.getReserved("width"):s.h.width),height:C.parseFloat(null!=Xr.height?s.getReserved("height"):s.h.height),xoffset:C.parseFloat(null!=Xr.xoffset?s.getReserved("xoffset"):s.h.xoffset),yoffset:C.parseFloat(null!=Xr.yoffset?s.getReserved("yoffset"):s.h.yoffset),xadvance:C.parseFloat(null!=Xr.xadvance?s.getReserved("xadvance"):s.h.xadvance),page:C.parseInt(null!=Xr.page?s.getReserved("page"):s.h.page)};i.chars.h[n.id]=n;break;case"kerning":var r=C.parseInt(null!=Xr.first?s.getReserved("first"):s.h.first),o=C.parseInt(null!=Xr.second?s.getReserved("second"):s.h.second),l=C.parseFloat(null!=Xr.amount?s.getReserved("amount"):s.h.amount),a=i.kernings.h[r];null==a&&(a=new _e,i.kernings.h[r]=a),a.h[o]=l}},Mi.tokenize_line=function(t){for(var e=new de,i=0;i<t.length;){var s=t[i];++i;var n=s.split("=");e.set(n[0],n[1])}return e},Mi.trim=function(t){return B.trim(t)},Mi.unquote=function(t){return-1!=t.indexOf('"')&&(t=B.replace(t,'"',"")),t};var Ci=function(t,e){this.frames=e,this.meta=t,this.frame_map=new de;for(var i=0,s=this.frames;i<s.length;){var n=s[i];++i;var r=we.withoutExtension(n.filename);this.frame_map.set(r,n)}};r["luxe.importers.texturepacker.TexturePackerData"]=Ci,Ci.__name__=["luxe","importers","texturepacker","TexturePackerData"],Ci.prototype={frame:function(t){return this.frame_map.get(t)},__class__:Ci};var Ri=r["luxe.importers.texturepacker.TexturePackerJSONType"]={__ename__:["luxe","importers","texturepacker","TexturePackerJSONType"],__constructs__:["hash","array"]};Ri.hash=["hash",0],Ri.hash.toString=o,Ri.hash.__enum__=Ri,Ri.array=["array",1],Ri.array.toString=o,Ri.array.__enum__=Ri;var Bi=function(){};r["luxe.importers.texturepacker.TexturePackerJSON"]=Bi,Bi.__name__=["luxe","importers","texturepacker","TexturePackerJSON"],Bi.parse=function(t,e){var i=null!=I.field(t,"frames"),s=null!=I.field(t,"meta");if(!i)return null;var n=null,r=null;if(s&&(n=Bi.parse_meta(t.meta)),null==e){var o=t.frames instanceof Array&&null==t.frames.__enum__;if(o)e=Ri.array;else{{Ee.__instanceof(t.frames,qr)}e=Ri.hash}}if(null!=e)switch(e[1]){case 0:r=Bi.parse_frames_hash(t.frames);break;case 1:r=Bi.parse_frames_array(t.frames)}return r.sort(function(t,e){return t.filename<e.filename?-1:1}),new Ci(n,r)},Bi.parse_frame=function(t,e){if(null==e)return null;var i=Bi.parse_rect(I.field(e,"frame")),s=Bi.parse_rect(I.field(e,"spriteSourceSize")),n=Bi.parse_size(I.field(e,"sourceSize")),r=I.field(e,"rotated"),o=I.field(e,"trimmed");return{filename:t,frame:i,sourceSize:n,spriteSourceSize:s,rotated:r,trimmed:o,uv:new on(i.x,i.y,i.w,i.h),size:new y(s.w,s.h),origin:new y(n.w-s.w,n.h-s.h)}},Bi.parse_frames_hash=function(t){if(null==t)return null;for(var e=[],i=0,s=I.fields(t);i<s.length;){var n=s[i];++i;var r=I.field(t,n);e.push(Bi.parse_frame(n,r))}return e},Bi.parse_frames_array=function(t){if(null==t)return null;for(var e=[],i=t,s=0;s<i.length;){var n=i[s];++s;var r=I.field(n,"filename");e.push(Bi.parse_frame(r,n))}return e},Bi.parse_meta=function(t){if(null==t)return null;var e=I.field(t,"app"),i=I.field(t,"version"),s=I.field(t,"image"),n=I.field(t,"format"),r=I.field(t,"size"),o=I.field(t,"scale");return{app:e,version:i,image:s,format:n,size:Bi.parse_size(r),scale:parseFloat(o)}},Bi.parse_rect=function(t){if(null==t)return null;var e=C.parseFloat(I.field(t,"x")),i=C.parseFloat(I.field(t,"y")),s=C.parseFloat(I.field(t,"w")),n=C.parseFloat(I.field(t,"h"));return{x:e,y:i,w:s,h:n}},Bi.parse_size=function(t){if(null==t)return null;
var e=C.parseFloat(I.field(t,"w")),i=C.parseFloat(I.field(t,"h"));return{w:e,h:i}};var Fi=function(){};r["luxe.macros.BuildVersion"]=Fi,Fi.__name__=["luxe","macros","BuildVersion"],Fi.try_git=function(){return""};var Pi=function(){};r["luxe.options._DrawOptions.DrawOptions"]=Pi,Pi.__name__=["luxe","options","_DrawOptions","DrawOptions"];var Ni=function(t){if(this.ref=0,null==t)throw new Ie(ei.null_assertion("_options was null"));if(null==t.id)throw new Ie(ei.null_assertion("_options.id was null"));null==t.system&&(t.system=m.resources),t.system,null==t.resource_type&&(t.resource_type=0),t.resource_type,this.id=t.id,this.system=t.system,this.resource_type=t.resource_type,this.set_state(0),this.set_ref(1)};r["luxe.resource.Resource"]=Ni,Ni.__name__=["luxe","resource","Resource"],Ni.prototype={destroy:function(t){if(null==t&&(t=!1),6==this.state)throw new Ie(ei.assertion("state != ResourceState.destroyed"));if(!t){if(!(this.ref>0))throw new Ie(ei.assertion("ref > 0"));var e=this,i=e.ref;if(e.set_ref(i-1),!(this.ref>=0))throw new Ie(ei.assertion("ref >= 0"))}(0==this.ref||t)&&(this.clear(),this.set_state(6),this.system.remove(this),this.system.emit(8,this))},invalidate:function(){if(6==this.state)throw new Ie(ei.assertion("state != ResourceState.destroyed"));this.clear(),this.set_state(5),this.system.emit(6,this)},reload:function(){return null},memory_use:function(){return 0},set_ref:function(t){var e=this.ref;return this.ref=t,this.ref>e?this.system.emit(9,this):this.ref<e&&this.system.emit(10,this),this.ref},set_state:function(t){this.state=t;var e=this.state;switch(e){case 2:this.system.emit(3,this);break;case 3:this.system.emit(4,this);break;case 4:this.system.emit(5,this)}return this.state},clear:function(){},state_string:function(){var t=this.state;switch(t){case 1:return"listed";case 2:return"loading";case 3:return"loaded";case 4:return"failed";case 5:return"invalidated";case 6:return"destroyed";default:return"unknown"}},type_string:function(){var t=this.resource_type;switch(t){case 3:return"bytes";case 1:return"text";case 2:return"json";case 4:return"texture";case 7:return"shader";case 6:return"font";default:return""+this.resource_type}},toString:function(){return"Resource(`"+this.id+"`, "+this.type_string()+", "+this.state_string()+")"},__class__:Ni,__properties__:{set_ref:"set_ref",set_state:"set_state"}};var Gi=function(t){if(null==t)throw new Ie(ei.null_assertion("_options was null"));t.resource_type=3,Ni.call(this,t),this.asset=t.asset};r["luxe.resource.BytesResource"]=Gi,Gi.__name__=["luxe","resource","BytesResource"],Gi.__super__=Ni,Gi.prototype=i(Ni.prototype,{reload:function(){var t=this;if(6==this.state)throw new Ie(ei.assertion("state != ResourceState.destroyed"));return this.clear(),new Un(function(e,i){t.set_state(2);var s=dr.load(m.core.app.assets,t.id);s.then(function(i){t.asset=i,t.set_state(3),e(t)}),s.error(function(e){t.set_state(4),i(e)})})},clear:function(){null!=this.asset&&(this.asset.destroy(),this.asset=null)},memory_use:function(){return null==this.asset?0:this.asset.bytes.byteLength},__class__:Gi});var Di=function(t){if(null==t)throw new Ie(ei.null_assertion("_options was null"));t.resource_type=1,Ni.call(this,t),this.asset=t.asset};r["luxe.resource.TextResource"]=Di,Di.__name__=["luxe","resource","TextResource"],Di.__super__=Ni,Di.prototype=i(Ni.prototype,{reload:function(){var t=this;if(6==this.state)throw new Ie(ei.assertion("state != ResourceState.destroyed"));return this.clear(),new Un(function(e,i){t.set_state(2);var s=fr.load(m.core.app.assets,t.id);s.then(function(i){t.asset=i,t.set_state(3),e(t)}),s.error(function(e){t.set_state(4),i(e)})})},clear:function(){null!=this.asset&&(this.asset.destroy(),this.asset=null)},memory_use:function(){return null==this.asset?0:this.asset.text.length},__class__:Di});var Li=function(t){if(null==t)throw new Ie(ei.null_assertion("_options was null"));t.resource_type=2,Ni.call(this,t),this.asset=t.asset};r["luxe.resource.JSONResource"]=Li,Li.__name__=["luxe","resource","JSONResource"],Li.__super__=Ni,Li.prototype=i(Ni.prototype,{reload:function(){var t=this;if(6==this.state)throw new Ie(ei.assertion("state != ResourceState.destroyed"));return this.clear(),new Un(function(e,i){t.set_state(2);var s=pr.load(m.core.app.assets,t.id);s.then(function(i){t.asset=i,t.set_state(3),e(t)}),s.error(function(e){t.set_state(4),i(e)})})},clear:function(){null!=this.asset&&(this.asset.destroy(),this.asset=null)},__class__:Li});var Oi=function(t){this.compare=t};r["luxe.structural.BalancedBST"]=Oi,Oi.__name__=["luxe","structural","BalancedBST"],Oi.prototype={size:function(){return this.node_count(this.root)},depth:function(){return this.node_depth(this.root)},insert:function(t,e){this.root=this.node_insert(this.root,t,e),this.root.color=!1},contains:function(t){return null!=this.find(t)},find:function(t){return this.node_find(this.root,t)},rank:function(t){return this.node_rank(t,this.root)},select:function(t){var e=this.node_select(this.root,t);return null!=e?e.key:null},smallest:function(){var t=this.node_smallest(this.root);return null!=t?t.key:null},largest:function(){var t=this.node_largest(this.root);return null!=t?t.key:null},remove:function(t){return this.is_red(this.root.left)||this.is_red(this.root.right)||(this.root.color=!0),this.contains(t)?(this.root=this.node_remove(this.root,t),null!=this.root&&(this.root.color=!1),!0):!1},remove_smallest:function(){return this.is_red(this.root.left)||this.is_red(this.root.right)||(this.root.color=!0),this.root=this.node_remove_smallest(this.root),null!=this.root&&(this.root.color=!1),!0},remove_largest:function(){return this.is_red(this.root.left)||this.is_red(this.root.right)||(this.root.color=!0),this.root=this.node_remove_largest(this.root),null!=this.root&&(this.root.color=!1),!0},floor:function(t){var e=this.node_floor(this.root,t);return null==e?null:e.key},ceil:function(t){var e=this.node_ceil(this.root,t);return null==e?null:e.key},toArray:function(){var t=[];return this.traverse_node(this.root,qi.order_retain,function(e){t.push(e.value)}),t},keys:function(){var t=[];return this.traverse_node(this.root,qi.order_retain,function(e){t.push(e.key)}),t},iterator:function(){return new Ui(this)},traverse_node:function(t,e,i){if(null!=t)switch(e[1]){case 0:i(t),this.traverse_node(t.left,e,i),this.traverse_node(t.right,e,i);break;case 1:this.traverse_node(t.left,e,i),i(t),this.traverse_node(t.right,e,i);break;case 2:this.traverse_node(t.left,e,i),this.traverse_node(t.right,e,i),i(t)}},get_empty:function(){return null==this.root},node_depth:function(t){if(null==t)return 0;var e=Math.max(this.node_depth(t.left),this.node_depth(t.right));return 1+(0|e)},node_count:function(t){return null==t?0:t.nodecount},node_insert:function(t,e,i){if(null==t)return new Vi(e,i,1,!0);var s=this.compare(e,t.key);return 0>s?t.left=this.node_insert(t.left,e,i):s>0?t.right=this.node_insert(t.right,e,i):t.value=i,this.is_red(t.right)&&!this.is_red(t.left)&&(t=this.rotate_left(t)),this.is_red(t.left)&&this.is_red(t.left.left)&&(t=this.rotate_right(t)),this.is_red(t.left)&&this.is_red(t.right)&&this.swap_color(t),t.nodecount=this.node_count(t.left)+this.node_count(t.right)+1,t},node_update_count:function(t){return t.nodecount=this.node_count(t.left)+this.node_count(t.right)+1,t},node_find:function(t,e){if(null==t)return null;var i=this.compare(e,t.key);return 0>i?this.node_find(t.left,e):i>0?this.node_find(t.right,e):t.value},node_rank:function(t,e){if(null==e)return 0;var i=this.compare(t,e.key);return 0>i?this.node_rank(t,e.left):i>0?1+this.node_count(e.left)+this.node_rank(t,e.right):this.node_count(e.left)},node_select:function(t,e){if(null==t)return null;var i=this.node_count(t.left);return i>e?this.node_select(t.left,e):e>i?this.node_select(t.right,e-i-1):t},node_smallest:function(t){return null==t.left?t:this.node_smallest(t.left)},node_largest:function(t){return null==t.right?t:this.node_largest(t.right)},node_floor:function(t,e){if(null==t)return null;var i=this.compare(e,t.key);if(0==i)return t;if(0>i)return this.node_floor(t.left,e);var s=this.node_floor(t.right,e);return null!=s?s:t},node_ceil:function(t,e){if(null==t)return null;var i=this.compare(e,t.key);if(0==i)return t;if(0>i){var s=this.node_ceil(t.left,e);return null!=s?s:t}return this.node_ceil(t.right,e)},node_remove_smallest:function(t){return null==t.left?null:(this.is_red(t.left)||this.is_red(t.left.left)||(t=this.move_red_left(t)),t.left=this.node_remove_smallest(t.left),t.nodecount=this.node_count(t.left)+this.node_count(t.right)+1,this.balance(t))},node_remove_largest:function(t){return this.is_red(t.left)&&(t=this.rotate_right(t)),null==t.right?null:(this.is_red(t.right)||this.is_red(t.right.left)||(t=this.move_red_right(t)),t.right=this.node_remove_largest(t.right),t.nodecount=this.node_count(t.left)+this.node_count(t.right)+1,this.balance(t))},node_remove:function(t,e){var i=this.compare(e,t.key);if(0>i)this.is_red(t.left)||this.is_red(t.left.left)||(t=this.move_red_left(t)),t.left=this.node_remove(t.left,e);else{this.is_red(t.left)&&(t=this.rotate_right(t));var s=this.compare(e,t.key);if(0==s&&null==t.right)return null;this.is_red(t.right)||this.is_red(t.right.left)||(t=this.move_red_right(t));var n=this.compare(e,t.key);if(0==n){var r=this.node_smallest(t.right);t.key=r.key,t.value=r.value,t.right=this.node_remove_smallest(t.right)}else t.right=this.node_remove(t.right,e)}return this.balance(t)},is_red:function(t){return null==t?!1:1==t.color},rotate_left:function(t){var e=t.right;return e.color=t.color,t.color=!0,t.right=e.left,e.left=t,e.nodecount=t.nodecount,t.nodecount=this.node_count(t.left)+this.node_count(t.right)+1,e},rotate_right:function(t){var e=t.left;return e.color=t.color,t.color=!0,t.left=e.right,e.right=t,e.nodecount=t.nodecount,t.nodecount=this.node_count(t.left)+this.node_count(t.right)+1,e},swap_color:function(t){t.color=!t.color,t.left.color=!t.left.color,t.right.color=!t.right.color},move_red_left:function(t){return this.swap_color(t),this.is_red(t.right.left)&&(t.right=this.rotate_right(t.right),t=this.rotate_left(t)),t},move_red_right:function(t){return this.swap_color(t),this.is_red(t.left.left)&&(t=this.rotate_right(t)),t},balance:function(t){return this.is_red(t.right)&&(t=this.rotate_left(t)),this.is_red(t.left)&&this.is_red(t.left.left)&&(t=this.rotate_right(t)),this.is_red(t.left)&&this.is_red(t.right)&&this.swap_color(t),t.nodecount=this.node_count(t.left)+this.node_count(t.right)+1,t},__class__:Oi,__properties__:{get_empty:"get_empty"}};var Ui=function(t){null!=t&&null!=t.root&&(this.tree=t,this.current=this._min(this.tree.root),this.rightest=this._max(this.tree.root))};r["luxe.structural.BalancedBSTIterator"]=Ui,Ui.__name__=["luxe","structural","BalancedBSTIterator"],Ui.prototype={hasNext:function(){return null==this.current||null==this.rightest?!1:this.tree.compare(this.current.key,this.rightest.key)<=0},next:function(){var t=this.current;return this.current=this.update_next(),t.value},update_next:function(){if(!(null==this.current||null==this.rightest?!1:this.tree.compare(this.current.key,this.rightest.key)<=0))return null;if(null!=this.current.right)return this._min(this.current.right);for(var t=null,e=this.tree.root;null!=e;){var i=this.tree.compare(this.current.key,e.key);if(0>i)t=e,e=e.left;else{if(!(i>0)){this.current=t;break}e=e.right}}return t},_min:function(t){for(;null!=t.left;)t=t.left;return t},_max:function(t){for(;null!=t.right;)t=t.right;return t},__class__:Ui};var Hi=function(){};r["luxe.structural._BalancedBST.NodeColor"]=Hi,Hi.__name__=["luxe","structural","_BalancedBST","NodeColor"];var Vi=function(t,e,i,s){this.left=null,this.right=null,this.key=t,this.value=e,this.nodecount=i,this.color=s};r["luxe.structural.BalancedBSTNode"]=Vi,Vi.__name__=["luxe","structural","BalancedBSTNode"],Vi.prototype={__class__:Vi};var qi=r["luxe.structural.BalancedBSTTraverseMethod"]={__ename__:["luxe","structural","BalancedBSTTraverseMethod"],__constructs__:["order_pre","order_retain","order_post"]};qi.order_pre=["order_pre",0],qi.order_pre.toString=o,qi.order_pre.__enum__=qi,qi.order_retain=["order_retain",1],qi.order_retain.toString=o,qi.order_retain.__enum__=qi,qi.order_post=["order_post",2],qi.order_post.toString=o,qi.order_post.__enum__=qi;var ji=function(t){null!=t&&null!=t.root&&(this.tree=t,this.current=this._min(this.tree.root),this.rightest=this._max(this.tree.root))};r["luxe.structural.BalancedBSTIterator_phoenix_geometry_GeometryKey_phoenix_geometry_Geometry"]=ji,ji.__name__=["luxe","structural","BalancedBSTIterator_phoenix_geometry_GeometryKey_phoenix_geometry_Geometry"],ji.prototype={hasNext:function(){return null==this.current||null==this.rightest?!1:this.tree.compare(this.current.key,this.rightest.key)<=0},next:function(){var t=this.current;return this.current=this.update_next(),t.value},update_next:function(){if(!(null==this.current||null==this.rightest?!1:this.tree.compare(this.current.key,this.rightest.key)<=0))return null;if(null!=this.current.right)return this._min(this.current.right);for(var t=null,e=this.tree.root;null!=e;){var i=this.tree.compare(this.current.key,e.key);if(0>i)t=e,e=e.left;else{if(!(i>0)){this.current=t;break}e=e.right}}return t},_min:function(t){for(;null!=t.left;)t=t.left;return t},_max:function(t){for(;null!=t.right;)t=t.right;return t},__class__:ji};var Zi=function(t,e,i,s){this.left=null,this.right=null,this.key=t,this.value=e,this.nodecount=i,this.color=s};r["luxe.structural.BalancedBSTNode_phoenix_geometry_GeometryKey_phoenix_geometry_Geometry"]=Zi,Zi.__name__=["luxe","structural","BalancedBSTNode_phoenix_geometry_GeometryKey_phoenix_geometry_Geometry"],Zi.prototype={__class__:Zi};var Ki=function(t){this.compare=t};r["luxe.structural.BalancedBST_phoenix_geometry_GeometryKey_phoenix_geometry_Geometry"]=Ki,Ki.__name__=["luxe","structural","BalancedBST_phoenix_geometry_GeometryKey_phoenix_geometry_Geometry"],Ki.prototype={size:function(){return this.node_count(this.root)},depth:function(){return this.node_depth(this.root)},insert:function(t,e){this.root=this.node_insert(this.root,t,e),this.root.color=!1},contains:function(t){return null!=this.find(t)},find:function(t){return this.node_find(this.root,t)},rank:function(t){return this.node_rank(t,this.root)},select:function(t){var e=this.node_select(this.root,t);return null!=e?e.key:null},smallest:function(){var t=this.node_smallest(this.root);return null!=t?t.key:null},largest:function(){var t=this.node_largest(this.root);return null!=t?t.key:null},remove:function(t){return this.is_red(this.root.left)||this.is_red(this.root.right)||(this.root.color=!0),this.contains(t)?(this.root=this.node_remove(this.root,t),null!=this.root&&(this.root.color=!1),!0):!1},remove_smallest:function(){return this.is_red(this.root.left)||this.is_red(this.root.right)||(this.root.color=!0),this.root=this.node_remove_smallest(this.root),null!=this.root&&(this.root.color=!1),!0},remove_largest:function(){return this.is_red(this.root.left)||this.is_red(this.root.right)||(this.root.color=!0),this.root=this.node_remove_largest(this.root),null!=this.root&&(this.root.color=!1),!0},floor:function(t){var e=this.node_floor(this.root,t);return null==e?null:e.key},ceil:function(t){var e=this.node_ceil(this.root,t);return null==e?null:e.key},toArray:function(){var t=[];return this.traverse_node(this.root,qi.order_retain,function(e){t.push(e.value)}),t},keys:function(){var t=[];return this.traverse_node(this.root,qi.order_retain,function(e){t.push(e.key)}),t},iterator:function(){return new ji(this)},traverse_node:function(t,e,i){if(null!=t)switch(e[1]){case 0:i(t),this.traverse_node(t.left,e,i),this.traverse_node(t.right,e,i);break;case 1:this.traverse_node(t.left,e,i),i(t),this.traverse_node(t.right,e,i);break;case 2:this.traverse_node(t.left,e,i),this.traverse_node(t.right,e,i),i(t)}},get_empty:function(){return null==this.root},node_depth:function(t){if(null==t)return 0;var e=Math.max(this.node_depth(t.left),this.node_depth(t.right));return 1+(0|e)},node_count:function(t){return null==t?0:t.nodecount},node_insert:function(t,e,i){if(null==t)return new Zi(e,i,1,!0);var s=this.compare(e,t.key);return 0>s?t.left=this.node_insert(t.left,e,i):s>0?t.right=this.node_insert(t.right,e,i):t.value=i,this.is_red(t.right)&&!this.is_red(t.left)&&(t=this.rotate_left(t)),this.is_red(t.left)&&this.is_red(t.left.left)&&(t=this.rotate_right(t)),this.is_red(t.left)&&this.is_red(t.right)&&this.swap_color(t),t.nodecount=this.node_count(t.left)+this.node_count(t.right)+1,t},node_update_count:function(t){return t.nodecount=this.node_count(t.left)+this.node_count(t.right)+1,t},node_find:function(t,e){if(null==t)return null;var i=this.compare(e,t.key);return 0>i?this.node_find(t.left,e):i>0?this.node_find(t.right,e):t.value},node_rank:function(t,e){if(null==e)return 0;var i=this.compare(t,e.key);return 0>i?this.node_rank(t,e.left):i>0?1+this.node_count(e.left)+this.node_rank(t,e.right):this.node_count(e.left)},node_select:function(t,e){if(null==t)return null;var i=this.node_count(t.left);return i>e?this.node_select(t.left,e):e>i?this.node_select(t.right,e-i-1):t},node_smallest:function(t){return null==t.left?t:this.node_smallest(t.left)},node_largest:function(t){return null==t.right?t:this.node_largest(t.right)},node_floor:function(t,e){if(null==t)return null;var i=this.compare(e,t.key);if(0==i)return t;if(0>i)return this.node_floor(t.left,e);var s=this.node_floor(t.right,e);return null!=s?s:t},node_ceil:function(t,e){if(null==t)return null;var i=this.compare(e,t.key);if(0==i)return t;if(0>i){var s=this.node_ceil(t.left,e);return null!=s?s:t}return this.node_ceil(t.right,e)},node_remove_smallest:function(t){return null==t.left?null:(this.is_red(t.left)||this.is_red(t.left.left)||(t=this.move_red_left(t)),t.left=this.node_remove_smallest(t.left),t.nodecount=this.node_count(t.left)+this.node_count(t.right)+1,this.balance(t))},node_remove_largest:function(t){return this.is_red(t.left)&&(t=this.rotate_right(t)),null==t.right?null:(this.is_red(t.right)||this.is_red(t.right.left)||(t=this.move_red_right(t)),t.right=this.node_remove_largest(t.right),t.nodecount=this.node_count(t.left)+this.node_count(t.right)+1,this.balance(t))},node_remove:function(t,e){var i=this.compare(e,t.key);if(0>i)this.is_red(t.left)||this.is_red(t.left.left)||(t=this.move_red_left(t)),t.left=this.node_remove(t.left,e);else{this.is_red(t.left)&&(t=this.rotate_right(t));var s=this.compare(e,t.key);if(0==s&&null==t.right)return null;this.is_red(t.right)||this.is_red(t.right.left)||(t=this.move_red_right(t));var n=this.compare(e,t.key);if(0==n){var r=this.node_smallest(t.right);t.key=r.key,t.value=r.value,t.right=this.node_remove_smallest(t.right)}else t.right=this.node_remove(t.right,e)}return this.balance(t)},is_red:function(t){return null==t?!1:1==t.color},rotate_left:function(t){var e=t.right;return e.color=t.color,t.color=!0,t.right=e.left,e.left=t,e.nodecount=t.nodecount,t.nodecount=this.node_count(t.left)+this.node_count(t.right)+1,e},rotate_right:function(t){var e=t.left;return e.color=t.color,t.color=!0,t.left=e.right,e.right=t,e.nodecount=t.nodecount,t.nodecount=this.node_count(t.left)+this.node_count(t.right)+1,e},swap_color:function(t){t.color=!t.color,t.left.color=!t.left.color,t.right.color=!t.right.color},move_red_left:function(t){return this.swap_color(t),this.is_red(t.right.left)&&(t.right=this.rotate_right(t.right),t=this.rotate_left(t)),t},move_red_right:function(t){return this.swap_color(t),this.is_red(t.left.left)&&(t=this.rotate_right(t)),t},balance:function(t){return this.is_red(t.right)&&(t=this.rotate_left(t)),this.is_red(t.left)&&this.is_red(t.left.left)&&(t=this.rotate_right(t)),this.is_red(t.left)&&this.is_red(t.right)&&this.swap_color(t),t.nodecount=this.node_count(t.left)+this.node_count(t.right)+1,t},__class__:Ki,__properties__:{get_empty:"get_empty"}};var Qi=function(t){this.index=0,this.map=t};r["luxe.structural.OrderedMapIterator"]=Qi,Qi.__name__=["luxe","structural","OrderedMapIterator"],Qi.prototype={hasNext:function(){return this.index<this.map._keys.length},next:function(){return this.map.get(this.map._keys[this.index++])},__class__:Qi};var Xi=function(t){this.idx=0,this._keys=[],this.map=t};r["luxe.structural.OrderedMap"]=Xi,Xi.__name__=["luxe","structural","OrderedMap"],Xi.__interfaces__=[Y],Xi.prototype={set:function(t,e){this.map.exists(t)||this._keys.push(t),this.map.set(t,e)},toString:function(){for(var t="",e=0,i=this._keys.length,s=0,n=this._keys;s<n.length;){var r=n[s];++s,t+=""+C.string(r)+" => "+C.string(this.map.get(r))+(e++<i-1?", ":"")}return"{"+t+"}"},iterator:function(){return new Qi(this)},remove:function(t){return this.map.remove(t)&&d.remove(this._keys,t)},exists:function(t){return this.map.exists(t)},get:function(t){return this.map.get(t)},keys:function(){return d.iter(this._keys)},__class__:Xi};var Wi=function(){};r["luxe.tween.actuators.IGenericActuator"]=Wi,Wi.__name__=["luxe","tween","actuators","IGenericActuator"],Wi.prototype={__class__:Wi};var Yi=function(t,e,i){this.timescaled=!1,this._autoVisible=!0,this._delay=0,this._reflect=!1,this._repeat=0,this._reverse=!1,this._smartRotation=!1,this._snapping=!1,this.special=!1,this.target=t,this.properties=i,this.duration=e,this._ease=is.defaultEase};r["luxe.tween.actuators.GenericActuator"]=Yi,Yi.__name__=["luxe","tween","actuators","GenericActuator"],Yi.__interfaces__=[Wi],Yi.prototype={apply:function(){for(var t=0,e=I.fields(this.properties);t<e.length;){var i=e[t];++t,Object.prototype.hasOwnProperty.call(this.target,i)?I.setField(this.target,i,I.field(this.properties,i)):I.setProperty(this.target,i,I.field(this.properties,i))}},autoVisible:function(t){return null==t&&(t=!0),this._autoVisible=t,this},callMethod:function(t,e){return null==e&&(e=[]),I.callMethod(t,t,e)},change:function(){null!=this._onUpdate&&this.callMethod(this._onUpdate,this._onUpdateParams)},complete:function(t){null==t&&(t=!0),t&&(this.change(),null!=this._onComplete&&this.callMethod(this._onComplete,this._onCompleteParams)),is.unload(this)},delay:function(t){return this._delay=t,this},ease:function(t){return this._ease=t,this},move:function(){},timescale:function(t){return null==t&&(t=!0),this.timescaled=t,this},onComplete:function(t,e){return this._onComplete=t,this._onCompleteParams=null==e?[]:e,0==this.duration&&this.complete(),this},onRepeat:function(t,e){return this._onRepeat=t,this._onRepeatParams=null==e?[]:e,this},onUpdate:function(t,e){return this._onUpdate=t,this._onUpdateParams=null==e?[]:e,this},pause:function(){},reflect:function(t){return null==t&&(t=!0),this._reflect=t,this.special=!0,this},repeat:function(t){return null==t&&(t=-1),this._repeat=t,this},resume:function(){},reverse:function(t){return null==t&&(t=!0),this._reverse=t,this.special=!0,this},smartRotation:function(t){return null==t&&(t=!0),this._smartRotation=t,this.special=!0,this},snapping:function(t){return null==t&&(t=!0),this._snapping=t,this.special=!0,this},stop:function(){},__class__:Yi};var Ji=function(t,e,i){this.has_timescaled_starttime=!1,this.active=!0,this.propertyDetails=[],this.sendChange=!1,this.paused=!1,this.cacheVisible=!1,this.initialized=!1,this.setVisible=!1,this.toggleVisible=!1,this.startTime=Nn.core.timestamp(),Yi.call(this,t,e,i),Ji.addedEvent||(Ji.addedEvent=!0,m.on(4,Ji.on_internal_update))};r["luxe.tween.actuators.SimpleActuator"]=Ji,Ji.__name__=["luxe","tween","actuators","SimpleActuator"],Ji.on_internal_update=function(){Ji.update_timer+=m.core.delta_time,Ji.current_time=Nn.core.timestamp();for(var t,e=Ji.current_time,i=0,s=0,n=Ji.actuatorsLength;n>s;){{s++}t=Ji.actuators[i],null!=t&&t.active?(e=t.timescaled?Ji.update_timer:Ji.current_time,t.timescaled&&!t.has_timescaled_starttime&&(t.has_timescaled_starttime=!0,t.startTime=Ji.update_timer,t.timeOffset=t.startTime),e>t.timeOffset&&t.update(e),i++):(Ji.actuators.splice(i,1),--Ji.actuatorsLength)}},Ji.__super__=Yi,Ji.prototype=i(Yi.prototype,{autoVisible:function(t){return null==t&&(t=!0),this._autoVisible=t,t||(this.toggleVisible=!1,this.setVisible&&this.setField(this.target,"visible",this.cacheVisible)),this},delay:function(t){return this._delay=t,this.timeOffset=this.startTime+t,this},getField:function(t,e){var i=null;return i=Object.prototype.hasOwnProperty.call(t,e)?I.field(t,e):I.getProperty(t,e)},initialize:function(){for(var t,e,i=0,s=I.fields(this.properties);i<s.length;){var n=s[i];++i;var r=!0;!Object.prototype.hasOwnProperty.call(this.target,n)||this.target.__properties__&&this.target.__properties__["set_"+n]?(r=!1,e=I.getProperty(this.target,n)):e=I.field(this.target,n),"number"==typeof e&&(t=new cs(this.target,n,e,this.getField(this.properties,n)-e,r),this.propertyDetails.push(t))}this.detailsLength=this.propertyDetails.length,this.initialized=!0},move:function(){this.toggleVisible=Object.prototype.hasOwnProperty.call(this.properties,"alpha")&&Object.prototype.hasOwnProperty.call(this.properties,"visible"),this.toggleVisible&&0!=this.properties.alpha&&!this.getField(this.target,"visible")&&(this.setVisible=!0,this.cacheVisible=this.getField(this.target,"visible"),this.setField(this.target,"visible",!0)),this.timeOffset=this.startTime,Ji.actuators.push(this),++Ji.actuatorsLength},onUpdate:function(t,e){return this._onUpdate=t,this._onUpdateParams=null==e?[]:e,this.sendChange=!0,this},pause:function(){this.paused=!0,this.pauseTime=this.timescaled?Ji.update_timer:Ji.current_time},resume:function(){this.paused&&(this.paused=!1,this.timeOffset+=((this.timescaled?Ji.update_timer:Ji.current_time)-this.pauseTime)/1e3)},setField:function(t,e,i){Object.prototype.hasOwnProperty.call(t,e)?t[e]=i:I.setProperty(t,e,i)},setProperty:function(t,e){t.isField?I.setProperty(t.target,t.propertyName,e):I.setProperty(t.target,t.propertyName,e)},stop:function(t,e,i){if(this.active){if(null==t)return this.active=!1,e&&this.apply(),void this.complete(i);for(var s=0,n=I.fields(t);s<n.length;){var r=n[s];if(++s,Object.prototype.hasOwnProperty.call(this.properties,r))return this.active=!1,e&&this.apply(),void this.complete(i)}}},update:function(t){if(!this.paused){var e,i,s=(t-this.timeOffset)/this.duration;if(s>1&&(s=1),this.initialized||this.initialize(),this.special){i=this._ease.calculate(this._reverse?1-s:s);for(var n,r=0,o=this.detailsLength;o>r;){var l=r++;if(e=this.propertyDetails[l],!this._smartRotation||"rotation"!=e.propertyName&&"rotationX"!=e.propertyName&&"rotationY"!=e.propertyName&&"rotationZ"!=e.propertyName)n=e.start+e.change*i;else{var a=e.change%360;a>180?a-=360:-180>a&&(a+=360),n=e.start+a*i}this._snapping?this.setProperty(e,Math.round(n)):e.isField?I.setProperty(e.target,e.propertyName,n):I.setProperty(e.target,e.propertyName,n)}}else{i=this._ease.calculate(s);for(var h=0,_=this.detailsLength;_>h;){var u=h++;e=this.propertyDetails[u],this.setProperty(e,e.start+e.change*i)}}if(1==s){if(0==this._repeat)return this.active=!1,this.toggleVisible&&0==this.getField(this.target,"alpha")&&this.setField(this.target,"visible",!1),void this.complete(!0);null!=this._onRepeat&&this.callMethod(this._onRepeat,this._onRepeatParams),this._reflect&&(this._reverse=!this._reverse),this.startTime=t,this.timeOffset=this.startTime+this._delay,this._repeat>0&&this._repeat--}this.sendChange&&this.change()}},__class__:Ji});var $i=function(){};r["luxe.tween.easing.Quad"]=$i,$i.__name__=["luxe","tween","easing","Quad"],$i.__properties__={get_easeOut:"get_easeOut",get_easeInOut:"get_easeInOut",get_easeIn:"get_easeIn"},$i.get_easeIn=function(){return new zs},$i.get_easeInOut=function(){return new Ss},$i.get_easeOut=function(){return new es};var ts=function(){};r["luxe.tween.easing.IEasing"]=ts,ts.__name__=["luxe","tween","easing","IEasing"],ts.prototype={__class__:ts};var es=function(){};r["luxe.tween.easing.QuadEaseOut"]=es,es.__name__=["luxe","tween","easing","QuadEaseOut"],es.__interfaces__=[ts],es.prototype={calculate:function(t){return-t*(t-2)},ease:function(t,e,i,s){return-i*(t/=s)*(t-2)+e},__class__:es};var is=function(){};r["luxe.tween.Actuate"]=is,is.__name__=["luxe","tween","Actuate"],is.apply=function(t,e,i){is.stop(t,e),null==i&&(i=is.defaultActuator);var s=V.createInstance(i,[t,0,e]);return s.apply(),s},is.getLibrary=function(t,e){return null==e&&(e=!0),!is.targetLibraries.exists(t)&&e&&is.targetLibraries.set(t,[]),is.targetLibraries.get(t)},is.motionPath=function(t,e,i,s){return null==s&&(s=!0),is.tween(t,e,i,s,us)},is.pause=function(t){if(Ee.__instanceof(t,Yi))Ee.__cast(t,Yi).pause();else{var e=is.getLibrary(t,!1);if(null!=e)for(var i=0;i<e.length;){var s=e[i];++i,s.pause()}}},is.pauseAll=function(){for(var t=is.targetLibraries.iterator();t.hasNext();)for(var e=t.next(),i=0;i<e.length;){var s=e[i];++i,s.pause()}},is.reset=function(){for(var t=is.targetLibraries.iterator();t.hasNext();)for(var e=t.next(),i=e.length-1;i>=0;)e[i].stop(null,!1,!1),i--;is.targetLibraries=new ue},is.resume=function(t){if(Ee.__instanceof(t,Yi))Ee.__cast(t,Yi).resume();else{var e=is.getLibrary(t,!1);if(null!=e)for(var i=0;i<e.length;){var s=e[i];++i,s.resume()}}},is.resumeAll=function(){for(var t=is.targetLibraries.iterator();t.hasNext();)for(var e=t.next(),i=0;i<e.length;){var s=e[i];++i,s.resume()}},is.stop=function(t,e,i,s){if(null==s&&(s=!0),null==i&&(i=!1),null!=t)if(Ee.__instanceof(t,Yi))Ee.__cast(t,Yi).stop(null,i,s);else{var n=is.getLibrary(t,!1);if(null!=n){if("string"==typeof e){var r={};I.setField(r,e,null),e=r}else if(e instanceof Array&&null==e.__enum__){var o,l={},a=0;for(o=Ee.__cast(e,Array);a<o.length;){var h=o[a];++a,I.setField(l,h,null)}e=l}for(var _=n.length-1;_>=0;)n[_].stop(e,i,s),_--}}},is.timer=function(t,e){return is.tween(new ss(0),t,new ss(1),!1,e)},is.tween=function(t,e,i,s,n){if(null==s&&(s=!0),null!=t){if(e>0){null==n&&(n=is.defaultActuator);var r=V.createInstance(n,[t,e,i]),o=is.getLibrary(r.target);if(s){for(var l=o.length-1;l>=0;)o[l].stop(r.properties,!1,!1),l--;o=is.getLibrary(r.target)}return o.push(r),r.move(),r}return is.apply(t,i,n)}return null},is.unload=function(t){var e=t.target;null!=is.targetLibraries.h.__keys__[e.__id__]&&(d.remove(is.targetLibraries.h[e.__id__],t),0==is.targetLibraries.h[e.__id__].length&&is.targetLibraries.remove(e))},is.update=function(t,e,i,s,n){null==n&&(n=!0);var r={start:i,end:s};return is.tween(t,e,r,n,_s)};var ss=function(t){this.progress=t};r["luxe.tween._Actuate.TweenTimer"]=ss,ss.__name__=["luxe","tween","_Actuate","TweenTimer"],ss.prototype={__class__:ss};var ns=function(){this._x=new os,this._y=new os,this._rotation=null};r["luxe.tween.MotionPath"]=ns,ns.__name__=["luxe","tween","MotionPath"],ns.prototype={bezier:function(t,e,i,s,n){return null==n&&(n=1),this._x.addPath(new ls(t,i,n)),this._y.addPath(new ls(e,s,n)),this},line:function(t,e,i){return null==i&&(i=1),this._x.addPath(new as(t,i)),this._y.addPath(new as(e,i)),this},get_rotation:function(){return null==this._rotation&&(this._rotation=new hs(this._x,this._y)),this._rotation},get_x:function(){return this._x},get_y:function(){return this._y},__class__:ns,__properties__:{get_y:"get_y",get_x:"get_x",get_rotation:"get_rotation"}};var rs=function(){};r["luxe.tween.IComponentPath"]=rs,rs.__name__=["luxe","tween","IComponentPath"],rs.prototype={__class__:rs,__properties__:{get_end:"get_end"}};var os=function(){this.paths=[],this.start=0,this.totalStrength=0};r["luxe.tween.ComponentPath"]=os,os.__name__=["luxe","tween","ComponentPath"],os.__interfaces__=[rs],os.prototype={addPath:function(t){this.paths.push(t),this.totalStrength+=t.strength},calculate:function(t){if(1==this.paths.length)return this.paths[0].calculate(this.start,t);for(var e=t*this.totalStrength,i=this.start,s=0,n=this.paths;s<n.length;){var r=n[s];if(++s,!(e>r.strength))return r.calculate(i,e/r.strength);e-=r.strength,i=r.end}return 0},get_end:function(){if(this.paths.length>0){var t=this.paths[this.paths.length-1];return t.end}return this.start},__class__:os,__properties__:{get_end:"get_end"}};var ls=function(t,e,i){this.end=t,this.control=e,this.strength=i};r["luxe.tween.BezierPath"]=ls,ls.__name__=["luxe","tween","BezierPath"],ls.prototype={calculate:function(t,e){return(1-e)*(1-e)*t+2*(1-e)*e*this.control+e*e*this.end
},__class__:ls};var as=function(t,e){ls.call(this,t,0,e)};r["luxe.tween.LinearPath"]=as,as.__name__=["luxe","tween","LinearPath"],as.__super__=ls,as.prototype=i(ls.prototype,{calculate:function(t,e){return t+e*(this.end-t)},__class__:as});var hs=function(t,e){this.step=.01,this._x=t,this._y=e,this.offset=0,this.start=this.calculate(0)};r["luxe.tween.RotationPath"]=hs,hs.__name__=["luxe","tween","RotationPath"],hs.__interfaces__=[rs],hs.prototype={calculate:function(t){var e=this._x.calculate(t)-this._x.calculate(t+this.step),i=this._y.calculate(t)-this._y.calculate(t+this.step),s=Math.atan2(i,e)*(180/Math.PI);return s=(s+this.offset)%360},get_end:function(){return this.calculate(1)},__class__:hs,__properties__:{get_end:"get_end"}};var _s=function(t,e,i){this.currentParameters=[],this.tweenProperties={},Ji.call(this,t,e,i),Object.prototype.hasOwnProperty.call(i,"start")||(this.properties.start=[]),Object.prototype.hasOwnProperty.call(i,"end")||(this.properties.end=this.properties.start);for(var s=0,n=this.properties.start.length;n>s;){{s++}this.currentParameters.push(null)}};r["luxe.tween.actuators.MethodActuator"]=_s,_s.__name__=["luxe","tween","actuators","MethodActuator"],_s.__super__=Ji,_s.prototype=i(Ji.prototype,{apply:function(){this.callMethod(this.target,this.properties.end)},complete:function(t){null==t&&(t=!0);for(var e=0,i=this.properties.start.length;i>e;){var s=e++;this.currentParameters[s]=I.field(this.tweenProperties,"param"+s)}this.callMethod(this.target,this.currentParameters),Ji.prototype.complete.call(this,t)},initialize:function(){for(var t,e,i,s=0,n=this.properties.start.length;n>s;){var r=s++;e="param"+r,i=this.properties.start[r],this.tweenProperties[e]=i,("number"==typeof i||(0|i)===i)&&(t=new cs(this.tweenProperties,e,i,this.properties.end[r]-i),this.propertyDetails.push(t))}this.detailsLength=this.propertyDetails.length,this.initialized=!0},update:function(t){if(Ji.prototype.update.call(this,t),this.active){for(var e=0,i=this.properties.start.length;i>e;){var s=e++;this.currentParameters[s]=I.field(this.tweenProperties,"param"+s)}this.callMethod(this.target,this.currentParameters)}},__class__:_s});var us=function(t,e,i){Ji.call(this,t,e,i)};r["luxe.tween.actuators.MotionPathActuator"]=us,us.__name__=["luxe","tween","actuators","MotionPathActuator"],us.__super__=Ji,us.prototype=i(Ji.prototype,{apply:function(){for(var t=0,e=I.fields(this.properties);t<e.length;){var i=e[t];++t,Object.prototype.hasOwnProperty.call(this.target,i)?I.setField(this.target,i,Ee.__cast(I.field(this.properties,i),rs).get_end()):I.setProperty(this.target,i,Ee.__cast(I.field(this.properties,i),rs).get_end())}},initialize:function(){for(var t,e,i=0,s=I.fields(this.properties);i<s.length;){var n=s[i];if(++i,e=Ee.__cast(I.field(this.properties,n),rs),null!=e){var r=!0;Object.prototype.hasOwnProperty.call(this.target,n)?e.start=I.field(this.target,n):(r=!1,e.start=I.getProperty(this.target,n)),t=new ds(this.target,n,e,r),this.propertyDetails.push(t)}}this.detailsLength=this.propertyDetails.length,this.initialized=!0},update:function(t){if(!this.paused){var e,i=(t-this.timeOffset)/this.duration;if(i>1&&(i=1),this.initialized||this.initialize(),this.special){e=this._ease.calculate(this._reverse?1-i:i);for(var s=0,n=this.propertyDetails;s<n.length;){var r=n[s];++s,this._snapping?r.isField?I.setField(r.target,r.propertyName,Math.round(Ee.__cast(r,ds).path.calculate(e))):I.setProperty(r.target,r.propertyName,Math.round(Ee.__cast(r,ds).path.calculate(e))):r.isField?I.setField(r.target,r.propertyName,Ee.__cast(r,ds).path.calculate(e)):I.setProperty(r.target,r.propertyName,Ee.__cast(r,ds).path.calculate(e))}}else{e=this._ease.calculate(i);for(var o=0,l=this.propertyDetails;o<l.length;){var a=l[o];++o,a.isField?I.setField(a.target,a.propertyName,Ee.__cast(a,ds).path.calculate(e)):I.setProperty(a.target,a.propertyName,Ee.__cast(a,ds).path.calculate(e))}}if(1==i){if(0==this._repeat)return this.active=!1,this.toggleVisible&&0==this.getField(this.target,"alpha")&&this.setField(this.target,"visible",!1),void this.complete(!0);this._reflect&&(this._reverse=!this._reverse),this.startTime=t,this.timeOffset=this.startTime+this._delay,this._repeat>0&&this._repeat--}this.sendChange&&this.change()}},__class__:us});var cs=function(t,e,i,s,n){null==n&&(n=!0),this.target=t,this.propertyName=e,this.start=i,this.change=s,this.isField=n};r["luxe.tween.actuators.PropertyDetails"]=cs,cs.__name__=["luxe","tween","actuators","PropertyDetails"],cs.prototype={__class__:cs};var ds=function(t,e,i,s){null==s&&(s=!0),cs.call(this,t,e,0,0,s),this.path=i};r["luxe.tween.actuators.PropertyPathDetails"]=ds,ds.__name__=["luxe","tween","actuators","PropertyPathDetails"],ds.__super__=cs,ds.prototype=i(cs.prototype,{__class__:ds});var fs=function(){};r["luxe.tween.easing.Back"]=fs,fs.__name__=["luxe","tween","easing","Back"],fs.__properties__={get_easeOut:"get_easeOut",get_easeInOut:"get_easeInOut",get_easeIn:"get_easeIn"},fs.get_easeIn=function(){return new ps(1.70158)},fs.get_easeInOut=function(){return new gs(1.70158)},fs.get_easeOut=function(){return new ms(1.70158)};var ps=function(t){this.s=t};r["luxe.tween.easing.BackEaseIn"]=ps,ps.__name__=["luxe","tween","easing","BackEaseIn"],ps.__interfaces__=[ts],ps.prototype={calculate:function(t){return t*t*((this.s+1)*t-this.s)},ease:function(t,e,i,s){return i*(t/=s)*t*((this.s+1)*t-this.s)+e},__class__:ps};var gs=function(t){this.s=t};r["luxe.tween.easing.BackEaseInOut"]=gs,gs.__name__=["luxe","tween","easing","BackEaseInOut"],gs.__interfaces__=[ts],gs.prototype={calculate:function(t){return(t/=.5)<1?.5*t*t*(((this.s*=1.525)+1)*t-this.s):.5*((t-=2)*t*(((this.s*=1.525)+1)*t+this.s)+2)},ease:function(t,e,i,s){return(t/=s/2)<1?i/2*t*t*(((this.s*=1.525)+1)*t-this.s)+e:i/2*((t-=2)*t*(((this.s*=1.525)+1)*t+this.s)+2)+e},__class__:gs};var ms=function(t){this.s=t};r["luxe.tween.easing.BackEaseOut"]=ms,ms.__name__=["luxe","tween","easing","BackEaseOut"],ms.__interfaces__=[ts],ms.prototype={calculate:function(t){return(t-=1)*t*((this.s+1)*t+this.s)+1},ease:function(t,e,i,s){return i*((t=t/s-1)*t*((this.s+1)*t+this.s)+1)+e},__class__:ms};var vs=function(){};r["luxe.tween.easing.Expo"]=vs,vs.__name__=["luxe","tween","easing","Expo"],vs.__properties__={get_easeOut:"get_easeOut",get_easeInOut:"get_easeInOut",get_easeIn:"get_easeIn"},vs.get_easeIn=function(){return new ys},vs.get_easeInOut=function(){return new ws},vs.get_easeOut=function(){return new xs};var ys=function(){};r["luxe.tween.easing.ExpoEaseIn"]=ys,ys.__name__=["luxe","tween","easing","ExpoEaseIn"],ys.__interfaces__=[ts],ys.prototype={calculate:function(t){return 0==t?0:Math.pow(2,10*(t-1))},ease:function(t,e,i,s){return 0==t?e:i*Math.pow(2,10*(t/s-1))+e},__class__:ys};var ws=function(){};r["luxe.tween.easing.ExpoEaseInOut"]=ws,ws.__name__=["luxe","tween","easing","ExpoEaseInOut"],ws.__interfaces__=[ts],ws.prototype={calculate:function(t){return 0==t?0:1==t?1:(t/=.5)<1?.5*Math.pow(2,10*(t-1)):.5*(2-Math.pow(2,-10*--t))},ease:function(t,e,i,s){return 0==t?e:t==s?e+i:(t/=s/2)<1?i/2*Math.pow(2,10*(t-1))+e:i/2*(2-Math.pow(2,-10*--t))+e},__class__:ws};var xs=function(){};r["luxe.tween.easing.ExpoEaseOut"]=xs,xs.__name__=["luxe","tween","easing","ExpoEaseOut"],xs.__interfaces__=[ts],xs.prototype={calculate:function(t){return 1==t?1:1-Math.pow(2,-10*t)},ease:function(t,e,i,s){return t==s?e+i:i*(1-Math.pow(2,-10*t/s))+e},__class__:xs};var bs=function(){};r["luxe.tween.easing.Linear"]=bs,bs.__name__=["luxe","tween","easing","Linear"],bs.__properties__={get_easeNone:"get_easeNone"},bs.get_easeNone=function(){return new ks};var ks=function(){};r["luxe.tween.easing.LinearEaseNone"]=ks,ks.__name__=["luxe","tween","easing","LinearEaseNone"],ks.__interfaces__=[ts],ks.prototype={calculate:function(t){return t},ease:function(t,e,i,s){return i*t/s+e},__class__:ks};var zs=function(){};r["luxe.tween.easing.QuadEaseIn"]=zs,zs.__name__=["luxe","tween","easing","QuadEaseIn"],zs.__interfaces__=[ts],zs.prototype={calculate:function(t){return t*t},ease:function(t,e,i,s){return i*(t/=s)*t+e},__class__:zs};var Ss=function(){};r["luxe.tween.easing.QuadEaseInOut"]=Ss,Ss.__name__=["luxe","tween","easing","QuadEaseInOut"],Ss.__interfaces__=[ts],Ss.prototype={calculate:function(t){return(t*=2)<1?.5*t*t:-.5*((t-1)*(t-3)-1)},ease:function(t,e,i,s){return(t/=s/2)<1?i/2*t*t+e:-i/2*((t-1)*(t-3)-1)+e},__class__:Ss};var Ts=function(){};r["luxe.tween.easing.Sine"]=Ts,Ts.__name__=["luxe","tween","easing","Sine"],Ts.__properties__={get_easeOut:"get_easeOut",get_easeInOut:"get_easeInOut",get_easeIn:"get_easeIn"},Ts.get_easeIn=function(){return new As},Ts.get_easeInOut=function(){return new Is},Ts.get_easeOut=function(){return new Es};var As=function(){};r["luxe.tween.easing.SineEaseIn"]=As,As.__name__=["luxe","tween","easing","SineEaseIn"],As.__interfaces__=[ts],As.prototype={calculate:function(t){return 1-Math.cos(t*(Math.PI/2))},ease:function(t,e,i,s){return-i*Math.cos(t/s*(Math.PI/2))+i+e},__class__:As};var Is=function(){};r["luxe.tween.easing.SineEaseInOut"]=Is,Is.__name__=["luxe","tween","easing","SineEaseInOut"],Is.__interfaces__=[ts],Is.prototype={calculate:function(t){return-(Math.cos(Math.PI*t)-1)/2},ease:function(t,e,i,s){return-i/2*(Math.cos(Math.PI*t/s)-1)+e},__class__:Is};var Es=function(){};r["luxe.tween.easing.SineEaseOut"]=Es,Es.__name__=["luxe","tween","easing","SineEaseOut"],Es.__interfaces__=[ts],Es.prototype={calculate:function(t){return Math.sin(t*(Math.PI/2))},ease:function(t,e,i,s){return i*Math.sin(t/s*(Math.PI/2))+e},__class__:Es};var Ms=function(){};r["luxe.utils.GeometryUtils"]=Ms,Ms.__name__=["luxe","utils","GeometryUtils"],Ms.prototype={segments_for_smooth_circle:function(t,e){return null==e&&(e=5),C["int"](e*Math.sqrt(t))},random_point_in_unit_circle:function(){var t=Math.sqrt(Math.random()),e=6.283185307179586*(-1+2*Math.random());return new y(t*Math.cos(e),t*Math.sin(e))},point_in_polygon:function(t,e,i){null==e&&(e=new y);for(var s=!1,n=i.length,r=n-1,o=0;n>o;){var l=o++;i[l].y+e.y>t.y!=i[r].y+e.y>t.y&&t.x<(i[r].x+e.x-(i[l].x+e.x))*(t.y-(i[l].y+e.y))/(i[r].y+e.y-(i[l].y+e.y))+(i[l].x+e.x)&&(s=!s),r=l}return s},point_in_geometry:function(t,e){for(var i=!1,s=e.vertices.length,n=s-1,r=0;s>r;){var o,l=r++,a=e.vertices[l].pos.clone(),h=e.transform.get_world().get_matrix(),_=a.x,u=a.y,c=a.z,d=h.elements,f=d[0]*_+d[4]*u+d[8]*c+d[12],p=d[1]*_+d[5]*u+d[9]*c+d[13],g=d[2]*_+d[6]*u+d[10]*c+d[14],m=a.ignore_listeners;a.ignore_listeners=!0,a.x=f,a._construct?a.x:(null==a.listen_x||a.ignore_listeners||a.listen_x(f),a.x),a.y=p,a._construct?a.y:(null==a.listen_y||a.ignore_listeners||a.listen_y(p),a.y),a.z=g,a._construct?a.z:(null==a.listen_z||a.ignore_listeners||a.listen_z(g),a.z),a.ignore_listeners=m,null==a.listen_x||a.ignore_listeners||a.listen_x(a.x),null==a.listen_y||a.ignore_listeners||a.listen_y(a.y),null==a.listen_z||a.ignore_listeners||a.listen_z(a.z),o=a;var v,y=e.vertices[n].pos.clone(),w=e.transform.get_world().get_matrix(),x=y.x,b=y.y,k=y.z,z=w.elements,S=z[0]*x+z[4]*b+z[8]*k+z[12],T=z[1]*x+z[5]*b+z[9]*k+z[13],A=z[2]*x+z[6]*b+z[10]*k+z[14],I=y.ignore_listeners;y.ignore_listeners=!0,y.x=S,y._construct?y.x:(null==y.listen_x||y.ignore_listeners||y.listen_x(S),y.x),y.y=T,y._construct?y.y:(null==y.listen_y||y.ignore_listeners||y.listen_y(T),y.y),y.z=A,y._construct?y.z:(null==y.listen_z||y.ignore_listeners||y.listen_z(A),y.z),y.ignore_listeners=I,null==y.listen_x||y.ignore_listeners||y.listen_x(y.x),null==y.listen_y||y.ignore_listeners||y.listen_y(y.y),null==y.listen_z||y.ignore_listeners||y.listen_z(y.z),v=y,o.y>t.y!=v.y>t.y&&t.x<(v.x-o.x)*(t.y-o.y)/(v.y-o.y)+o.x&&(i=!i),n=l}return i},intersect_ray_plane:function(t,e,i,s){var n=i.dot(new y(s.x-t.x,s.y-t.y,s.z-t.z)),r=i.x*e.x+i.y*e.y+i.z*e.z,o=n/r;return y.Add(t,y.Multiply(e,o))},__class__:Ms};var Cs=function(){};r["luxe.utils.Maths"]=Cs,Cs.__name__=["luxe","utils","Maths"],Cs.fixed=function(t,e){var i=Math.pow(10,e);return(t*i|0)/i},Cs.lerp=function(t,e,i){return i=0>i?0:i>1?1:i,t+i*(e-t)},Cs.weighted_avg=function(t,e,i){return 0==i&&(i=1e-8),(t*(i-1)+e)/i},Cs.clamp=function(t,e,i){return e>t?e:t>i?i:t},Cs.clampi=function(t,e,i){return e>t?e:t>i?i:t},Cs.clamp_bottom=function(t,e){return e>t?e:t},Cs.within_range=function(t,e,i){return t>=e&&i>=t},Cs.wrap_angle=function(t,e,i){var s=i-e,n=Math.floor((t-e)/s);return t-n*s},Cs.nearest_power_of_two=function(t){return t--,t|=t>>1,t|=t>>2,t|=t>>4,t|=t>>8,t|=t>>16,t++,t},Cs.map_linear=function(t,e,i,s,n){return s+(t-e)*(n-s)/(i-e)},Cs.smoothstep=function(t,e,i){return e>=t?0:t>=i?1:(t=(t-e)/(i-e),t*t*(3-2*t))},Cs.smootherstep=function(t,e,i){return e>=t?0:t>=i?1:(t=(t-e)/(i-e),t*t*t*(t*(6*t-15)+10))},Cs.sign=function(t){return t>=0?1:-1},Cs.sign0=function(t){return 0>t?-1:t>0?1:0},Cs.radians=function(t){return.017453292519943278*t},Cs.degrees=function(t){return 57.29577951308238*t},Cs.prototype={__class__:Cs};var Rs=function(t){if(!(t>0))throw new Ie(ei.assertion("_initial_seed > 0 ( initial negative seed will return negative random results, if this was intentional, define luxe_random_allow_negative_seed )"));this.initial=this.seed=t,this.seed=this.initial};r["luxe.utils.Random"]=Rs,Rs.__name__=["luxe","utils","Random"],Rs.prototype={get:function(){return(this.seed=16807*this.seed%2147483647)/2147483647+2.33e-10},"float":function(t,e){return null==e&&(e=t,t=0),((this.seed=16807*this.seed%2147483647)/2147483647+2.33e-10)*(e-t)+t},"int":function(t,e){return null==e&&(e=t,t=0),Math.floor(this["float"](t,e))},bool:function(t){return null==t&&(t=.5),(this.seed=16807*this.seed%2147483647)/2147483647+2.33e-10<t},sign:function(t){return null==t&&(t=.5),(this.seed=16807*this.seed%2147483647)/2147483647+2.33e-10<t?1:-1},bit:function(t){return null==t&&(t=.5),(this.seed=16807*this.seed%2147483647)/2147483647+2.33e-10<t?1:0},reset:function(){var t=this.seed;this.initial=this.seed=t,this.initial},set_initial:function(t){return this.initial=this.seed=t,this.initial},__class__:Rs,__properties__:{set_initial:"set_initial"}};var Bs=function(t){this.core=t,this.geometry=new Ms,this.random=new Rs(16777215*Math.random()),this._byte_levels=["bytes","Kb","MB","GB","TB"]};r["luxe.utils.Utils"]=Bs,Bs.__name__=["luxe","utils","Utils"],Bs.prototype={pos_info:function(t){return""+t.fileName+":"+t.lineNumber+":("+t.className+":"+t.methodName+")"},uniqueid:function(t){null==t&&(t=C.random(2147483647));var e=function(t){if(t>9){var e=65+(t-10);return e>90&&(e+=6),String.fromCharCode(e)}return(null==t?"null":""+t).charAt(0)},i=t%62|0,s=t/62|0;return s>0?this.uniqueid(s)+e(i):C.string(e(i))},uniquehash:function(){return this.hash(this.uniqueid())},hash:function(t){return this.hashdjb2(t)},hashdjb2:function(t){for(var e=5381,i=0,s=t.length;s>i;){var n=i++;e=(e<<5)+e+d.cca(t,n)}return e},uniqueid2:function(){return he.encode(C.string(Nn.core.timestamp()*Math.random()))},stacktrace:function(t){null==t&&(t=100);var e="\n",i=W.callStack();i.shift(),i.reverse();for(var s=C["int"](Math.min(i.length,t)),n=0;s>n;){var r=n++,o=(i[r],i[r]);switch(o[1]){case 2:var l=o[4],a=o[3],h=o[2];if(null!=h)switch(h[1]){case 3:var _=h[3],u=h[2];e+="   at "+a+":"+l+": "+u+"."+_}}r!=s-1&&(e+="\n")}return e},path_is_relative:function(t){return"#"!=t.charAt(0)&&"/"!=t.charAt(0)&&-1==t.indexOf(":\\")&&-1==t.indexOf(":/")&&(-1==t.indexOf("//")||t.indexOf("//")>t.indexOf("#")||t.indexOf("//")>t.indexOf("?"))},find_assets_sequence:function(t,e,i){null==i&&(i="1"),null==e&&(e=".png");var s=[],n="",r=null,o=t+i+e,l=new _("("+t+")(\\d\\b)","gi"),a=t+"_"+i+e,h=new _("("+t+")(_\\d\\b)","gi"),u=t+"-"+i+e,c=new _("("+t+")(-\\d\\b)","gi");if(m.resources.cache.exists(o)?(n=o,r=l):m.resources.cache.exists(a)?(n=a,r=h):m.resources.cache.exists(u)&&(n=u,r=c),""!=n){for(var d=this.core.resources.cache.iterator();d.hasNext();){var f=d.next();r.match(f.id)&&s.push(f.id)}s.sort(function(t,e){return t==e?0:e>t?-1:1})}return s},text_wrap_column_knuth_plass:function(t,e){null==e&&(e=80);var i,s=[],n=[],r=[],o=new _e;o.h[0]=0,i=o;for(var l=new _e,a=t,h=new _("(\\b[^\\s]+\\b)","gm");h.match(a);)n.push(h.matched(1)),a=h.matchedRight();0==n.length&&n.push(t),n.map(function(t){r.push(t.length)});for(var u=n.length,c=1,d=u+1;d>c;){for(var f=c++,p=new _e,g=f;function(){for(var t,e=0,i=g-1;f>i;){var s=i++;e+=r[s]}return t=e+(f-g+1)}(this)<=e&&g>0;){var m;m=e-function(){for(var t,e=0,i=g-1;f>i;){var s=i++;e+=r[s]}return t=e+(f-g+1)}(this);var v=C["int"](Math.pow(m,3)+i.h[g-1]);p.h[v]=g,g-=1}for(var y,w=1073741823,x=p.keys();x.hasNext();){var b=x.next();w>b&&(w=b)}y=w,i.h[f]=y;var k=p.h[y];l.h[f]=k}for(var z=1;u>1;)s.unshift(n.slice(l.h[u]-1,u).join(" ")),u=l.h[u]-1,z+=1;return 0==s.length&&s.push(t),s},text_wrap_column:function(t,e,i){null==i&&(i=80),null==e&&(e="\n");var s=new _("(.{1,"+i+"})(?: +|$)\n?|(.{"+i+"})","gimu").replace(t,"$1$2"+e);return B.rtrim(s)},bytes_to_string:function(t,e){null==e&&(e=3);var i=Math.floor(Math.log(t)/Math.log(1024)),s=t/Math.pow(1024,i);return s=Cs.fixed(s,e),s+" "+this._byte_levels[i]},array_to_bytes:function(t){if(null==t)return null;for(var e=oe.alloc(t.length),i=0,s=e.length;s>i;){var n=i++;e.b[n]=255&t[n]}return e},premultiply_alpha:function(t){for(var e=t.length,i=(t[0],0);e>i;){var s=t[i],n=t[i+1],r=t[i+2],o=Q.toFloat(t[i+3])/255,l=C["int"](Q.toFloat(s)*o);t[i]=l;var a=C["int"](Q.toFloat(n)*o);t[i+1]=a;var h=C["int"](Q.toFloat(r)*o);t[i+2]=h,i+=4}return t},premultiply_alpha_normalized:function(t){for(var e=t.length,i=(t[0],0);e>i;){var s=t[i],n=t[i+1],r=t[i+2],o=t[i+3];t[i]=s*o,t[i+1]=n*o,t[i+2]=r*o,i+=4}return t},__class__:Bs};var Fs={};r["luxe.utils.unifill._CodePoint.CodePoint_Impl_"]=Fs,Fs.__name__=["luxe","utils","unifill","_CodePoint","CodePoint_Impl_"],Fs.cons=function(t,e){return Gs.fromCodePoint(t)+e},Fs.snoc=function(t,e){return t+Gs.fromCodePoint(e)},Fs.addInt=function(t,e){return t+e},Fs.sub=function(t,e){return t-e},Fs.subInt=function(t,e){return t-e},Fs._new=function(t){var e;if(!(t>=0&&1114111>=t)||t>=55296&&56319>=t||t>=56320&&57343>=t)throw new Ie(Ns.InvalidCodePoint(t));return e=t},Fs.toString=function(t){return Gs.fromCodePoint(t)},Fs.toInt=function(t){return t};var Ps=function(t){this.i=0,this.string=t,this.index=0,this.endIndex=t.length};r["luxe.utils.unifill.CodePointIter"]=Ps,Ps.__name__=["luxe","utils","unifill","CodePointIter"],Ps.prototype={hasNext:function(){return this.index<this.endIndex},next:function(){return this.i=this.index,this.index+=Gs.codePointWidthAt(this.string,this.index),Us.codePointAt(this.string,this.i)},__class__:Ps};var Ns=r["luxe.utils.unifill.Exception"]={__ename__:["luxe","utils","unifill","Exception"],__constructs__:["InvalidCodePoint","InvalidCodeUnitSequence"]};Ns.InvalidCodePoint=function(t){var e=["InvalidCodePoint",0,t];return e.__enum__=Ns,e.toString=o,e},Ns.InvalidCodeUnitSequence=function(t){var e=["InvalidCodeUnitSequence",1,t];return e.__enum__=Ns,e.toString=o,e};var Gs=function(){};r["luxe.utils.unifill.InternalEncoding"]=Gs,Gs.__name__=["luxe","utils","unifill","InternalEncoding"],Gs.__properties__={get_internalEncoding:"get_internalEncoding"},Gs.get_internalEncoding=function(){return"UTF-16"},Gs.codeUnitAt=function(t,e){return t.charCodeAt(e)},Gs.codePointAt=function(t,e){return Us.codePointAt(t,e)},Gs.charAt=function(t,e){var i,s,n,r=t,o=r.charCodeAt(e);n=o>=55296&&56319>=o?2:1;var l=d.substr(r,e,n);return s=l,i=s},Gs.codePointCount=function(t,e,i){return Us.codePointCount(t,e,i)},Gs.codePointWidthAt=function(t,e){var i=t.charCodeAt(e);return i>=55296&&56319>=i?2:1},Gs.codePointWidthBefore=function(t,e){var i=t;return Hs.find_prev_code_point(function(t){return i.charCodeAt(t)},e)},Gs.offsetByCodePoints=function(t,e,i){var s=t;if(i>=0){for(var n=e,r=s.length,o=0;i>o&&r>n;){var l=s.charCodeAt(n);n+=l>=55296&&56319>=l?2:1,++o}return n}for(var a=e,h=0;-i>h&&a>0;){var _=[s];a-=Hs.find_prev_code_point(function(t){return function(e){return t[0].charCodeAt(e)}}(_),a),++h}return a},Gs.backwardOffsetByCodePoints=function(t,e,i){var s=t,n=-i;if(n>=0){for(var r=e,o=s.length,l=0;n>l&&o>r;){var a=s.charCodeAt(r);r+=a>=55296&&56319>=a?2:1,++l}return r}for(var h=e,_=0;-n>_&&h>0;){var u=[s];h-=Hs.find_prev_code_point(function(t){return function(e){return t[0].charCodeAt(e)}}(u),h),++_}return h},Gs.fromCodePoint=function(t){var e;if(65535>=t){var i,s=String.fromCharCode(t);i=s,e=i}else{var n,r=String.fromCharCode((t>>10)+55232)+String.fromCharCode(1023&t|56320);n=r,e=n}return e},Gs.fromCodePoints=function(t){for(var e,i=new R,n=s(t)();n.hasNext();){var r=n.next();Hs.encode_code_point(function(t){i.b+=String.fromCharCode(t)},r)}return e=i.b},Gs.validate=function(t){Us.validate(t)},Gs.isValidString=function(t){try{return Us.validate(t),!0}catch(e){if(e instanceof Ie&&(e=e.val),!Ee.__instanceof(e,Ns))throw e;switch(e[1]){case 1:{e[2]}return!1;default:throw new Ie(e)}}};var Ds=function(t,e,i){this.i=0,this.string=t,this.index=e,this.endIndex=i};r["luxe.utils.unifill.InternalEncodingIter"]=Ds,Ds.__name__=["luxe","utils","unifill","InternalEncodingIter"],Ds.prototype={hasNext:function(){return this.index<this.endIndex},next:function(){return this.i=this.index,this.index+=Gs.codePointWidthAt(this.string,this.index),this.i},__class__:Ds};var Ls=function(){};r["luxe.utils.unifill.Unicode"]=Ls,Ls.__name__=["luxe","utils","unifill","Unicode"],Ls.decodeSurrogate=function(t,e){return t-55232<<10|1023&e},Ls.encodeHighSurrogate=function(t){return(t>>10)+55232},Ls.encodeLowSurrogate=function(t){return 1023&t|56320},Ls.isScalar=function(t){return t>=0&&1114111>=t&&!(t>=55296&&56319>=t)&&!(t>=56320&&57343>=t)},Ls.isHighSurrogate=function(t){return t>=55296&&56319>=t},Ls.isLowSurrogate=function(t){return t>=56320&&57343>=t};var Os=function(){};r["luxe.utils.unifill.Unifill"]=Os,Os.__name__=["luxe","utils","unifill","Unifill"],Os.uLength=function(t){return Us.codePointCount(t,0,t.length)},Os.uCharAt=function(t,e){var i=Gs.offsetByCodePoints(t,0,e);return Gs.charAt(t,i)},Os.uCharCodeAt=function(t,e){var i=Gs.offsetByCodePoints(t,0,e);return Us.codePointAt(t,i)},Os.uCodePointAt=function(t,e){return Os.uCharCodeAt(t,e)},Os.uIndexOf=function(t,e,i){null==i&&(i=0);var s=t.indexOf(e,Gs.offsetByCodePoints(t,0,i));return s>=0?Us.codePointCount(t,0,s):-1},Os.uLastIndexOf=function(t,e,i){null==i&&(i=t.length-1);var s=t.lastIndexOf(e,Gs.offsetByCodePoints(t,0,i));return s>=0?Us.codePointCount(t,0,s):-1},Os.uSplit=function(t,e){if(0==e.length){for(var i=[],s=0,n=t,r=0,o=t.length;o>r;){var l;s=r,r+=Gs.codePointWidthAt(n,r),l=s,i.push(Gs.charAt(t,l))}return i}return t.split(e)},Os.uSubstr=function(t,e,i){var s,n=Gs.offsetByCodePoints(t,e>=0?0:t.length,e);return s=null==i?t.length:0>i?n:Gs.offsetByCodePoints(t,n,i),t.substring(n,s)},Os.uSubstring=function(t,e,i){var s;s=0>e?0:Gs.offsetByCodePoints(t,0,e);var n;return n=null==i?t.length:0>i?0:Gs.offsetByCodePoints(t,0,i),t.substring(s,n)},Os.uIterator=function(t){return new Ps(t)},Os.uCompare=function(t,e){for(var i=0,s=t,n=0,r=t.length,o=0,l=e,a=0,h=e.length;r>n&&h>a;){var _=Gs.codePointAt(t,function(){var t;return i=n,n+=Gs.codePointWidthAt(s,n),t=i}(this)),u=Gs.codePointAt(e,function(){var t;return o=a,a+=Gs.codePointWidthAt(l,a),t=o}(this));if(u>_)return-1;if(_>u)return 1}return h>a?-1:r>n?1:0},Os.uToString=function(t){return Gs.fromCodePoints(t)};var Us={};r["luxe.utils.unifill._Utf16.Utf16_Impl_"]=Us,Us.__name__=["luxe","utils","unifill","_Utf16","Utf16_Impl_"],Us.__properties__={get_length:"get_length"},Us.fromCodePoint=function(t){if(65535>=t){var e,i=String.fromCharCode(t);return e=i}var s,n=String.fromCharCode((t>>10)+55232)+String.fromCharCode(1023&t|56320);return s=n},Us.fromCodePoints=function(t){for(var e=new R,i=s(t)();i.hasNext();){var n=i.next();Hs.encode_code_point(function(t){e.b+=String.fromCharCode(t)},n)}return e.b},Us.fromString=function(t){return t},Us.fromArray=function(t){for(var e,i="",s=0;s<t.length;){var n=t[s];++s,i+=String.fromCharCode(n)}return e=i},Us.codeUnitAt=function(t,e){return t.charCodeAt(e)},Us.codePointAt=function(t,e){return Hs.decode_code_point(t.length,function(e){return t.charCodeAt(e)},e)},Us.charAt=function(t,e){var i,s,n=t.charCodeAt(e);s=n>=55296&&56319>=n?2:1;var r=d.substr(t,e,s);return i=r},Us.codePointCount=function(t,e,i){for(var s=e,n=0;i>s;){var r=t.charCodeAt(s);s+=r>=55296&&56319>=r?2:1,++n}return n},Us.codePointWidthAt=function(t,e){var i=t.charCodeAt(e);return i>=55296&&56319>=i?2:1},Us.codePointWidthBefore=function(t,e){return Hs.find_prev_code_point(function(e){return t.charCodeAt(e)},e)},Us.offsetByCodePoints=function(t,e,i){if(i>=0){for(var s=e,n=t.length,r=0;i>r&&n>s;){var o=t.charCodeAt(s);s+=o>=55296&&56319>=o?2:1,++r}return s}for(var l=e,a=0;-i>a&&l>0;){var h=[t];l-=Hs.find_prev_code_point(function(t){return function(e){return t[0].charCodeAt(e)}}(h),l),++a}return l},Us.substr=function(t,e,i){var s,n=d.substr(t,e,i);return s=n},Us.validate=function(t){for(var e=t.length,i=function(e){return t.charCodeAt(e)},s=0;e>s;){Hs.decode_code_point(e,i,s);var n=t.charCodeAt(s);s+=n>=55296&&56319>=n?2:1}},Us.toString=function(t){return t},Us.toArray=function(t){for(var e=0,i=t.length,s=[];i>e;)s.push(B.fastCodeAt(t,e++));return s},Us._new=function(t){return t},Us.get_length=function(t){return t.length},Us.forward_offset_by_code_points=function(t,e,i){for(var s=t.length,n=0;i>n&&s>e;){var r=t.charCodeAt(e);e+=r>=55296&&56319>=r?2:1,++n}return e},Us.backward_offset_by_code_points=function(t,e,i){for(var s=0;i>s&&e>0;){var n=[t];e-=Hs.find_prev_code_point(function(t){return function(e){return t[0].charCodeAt(e)}}(n),e),++s}return e};var Hs=function(){};r["luxe.utils.unifill._Utf16.Utf16Impl"]=Hs,Hs.__name__=["luxe","utils","unifill","_Utf16","Utf16Impl"],Hs.code_point_width=function(t){return t>=55296&&56319>=t?2:1},Hs.find_prev_code_point=function(t,e){var i=t(e-1);return i>=56320&&57343>=i?2:1},Hs.encode_code_point=function(t,e){65535>=e?t(e):(t((e>>10)+55232),t(1023&e|56320))},Hs.decode_code_point=function(t,e,i){if(0>i||i>=t)throw new Ie(Ns.InvalidCodeUnitSequence(i));var s=e(i);if(s>=55296&&56319>=s){if(0>i+1||i+1>=t)throw new Ie(Ns.InvalidCodeUnitSequence(i));var n=e(i+1);if(n>=56320&&57343>=n)return s-55232<<10|1023&n;throw new Ie(Ns.InvalidCodeUnitSequence(i))}if(s>=56320&&57343>=s)throw new Ie(Ns.InvalidCodeUnitSequence(i));return s};var Vs={};r["luxe.utils.unifill._Utf16.StringU16Buffer_Impl_"]=Vs,Vs.__name__=["luxe","utils","unifill","_Utf16","StringU16Buffer_Impl_"],Vs._new=function(){return new R},Vs.addUnit=function(t,e){t.b+=String.fromCharCode(e)},Vs.getStringU16=function(t){return t.b};var qs={};r["luxe.utils.unifill._Utf16.StringU16_Impl_"]=qs,qs.__name__=["luxe","utils","unifill","_Utf16","StringU16_Impl_"],qs.__properties__={get_length:"get_length"},qs.fromString=function(t){return t},qs.fromCodeUnit=function(t){var e=String.fromCharCode(t);return e},qs.fromTwoCodeUnits=function(t,e){var i=String.fromCharCode(t)+String.fromCharCode(e);return i},qs.ofArray=function(t){for(var e="",i=0;i<t.length;){var s=t[i];++i,e+=String.fromCharCode(s)}return e},qs.fromArray=function(t){for(var e="",i=0;i<t.length;){var s=t[i];++i,e+=String.fromCharCode(s)}return e},qs.codeUnitAt=function(t,e){return t.charCodeAt(e)},qs.substr=function(t,e,i){var s=d.substr(t,e,i);return s},qs.toString=function(t){return t},qs.toArray=function(t){for(var e=0,i=t.length,s=[];i>e;)s.push(B.fastCodeAt(t,e++));return s},qs._new=function(t){return t},qs.get_length=function(t){return t.length};var js=function(t){this.log=!1,this.batcher=t,this.geom_state=new zn,this.last_geom_state=new zn};r["phoenix.BatchState"]=js,js.__name__=["phoenix","BatchState"],js.prototype={active_shader:function(){return null!=this.geom_state.shader?this.geom_state.shader:null!=this.geom_state.texture?this.batcher.renderer.shaders.textured.shader:this.batcher.renderer.shaders.plain.shader},deactivate:function(){null!=this.last_texture_id&&m.renderer.state.bindTexture2D(null),m.renderer.state.useProgram(null),this.is_clipping&&_r.current_context.disable(3089)},str:function(){this.log&&(null!=this.last_geom_state.texture,null!=this.geom_state.texture)},__class__:js};var Zs=function(t,e){null==e&&(e=""),this.CMD_DROP="CMD_DROP",this.CMD_BATCH_GEOM="CMD_BATCH_GEOM",this.CMD_SUBMIT_STATIC="CMD_SUBMIT_STATIC",this.CMD_SUBMIT_SKIP_BUFFERBASED="CMD_SUBMIT_SKIP_BUFFERBASED",this.CMD_SUBMIT_SKIP_INVISIBLE="CMD_SUBMIT_SKIP_INVISIBLE",this.CMD_SUBMIT_BATCH="CMD_SUBMIT_BATCH",this.CMD_STATE_DEACTIVATE="CMD_STATE_DEACTIVATE",this.CMD_STATE_ACTIVATE="CMD_STATE_ACTIVATE",this.CMD_STATE_UPDATE="CMD_STATE_UPDATE",this.CMD_BATCHER_START="CMD_BATCHER_START",this.CMD_PRUNE="CMD_PRUNE",this.geom_batched_count=0,this.normal_floats=0,this.color_floats=0,this.tcoord_floats=0,this.pos_floats=0,this.sequence=-1,this.name="",this.log=!1,this.visible_count=0,this.static_batched_count=0,this.dynamic_batched_count=0,this.draw_calls=0,this.vert_count=0,this.max_floats=0,this.max_verts=0,this.tree_changed=!1,this.layer=0,this.enabled=!0,this.id=m.utils.uniqueid(),this.renderer=t,this.sequence=++Zs._sequence_key,this.geometry=new Ki(n(this,this.geometry_compare)),this.emitter=new x,this.max_verts=C["int"](Math.pow(2,16)),this.max_floats=4*this.max_verts;var i,s=this.max_floats;i=null!=s?new Float32Array(s):null,this.pos_list=i;var r,o=this.max_floats;r=null!=o?new Float32Array(o):null,this.tcoord_list=r;var l,a=this.max_floats;l=null!=a?new Float32Array(a):null,this.color_list=l,this.view=this.renderer.camera,_r.current_context.enableVertexAttribArray(0),_r.current_context.enableVertexAttribArray(1),_r.current_context.enableVertexAttribArray(2),this.name=0==e.length?m.utils.uniqueid():e,this._dropped=[]};r["phoenix.Batcher"]=Zs,Zs.__name__=["phoenix","Batcher"],Zs.prototype={on:function(t,e){this.emitter.on(t,e)},off:function(t,e){return this.emitter.off(t,e)},add:function(t,e){null==e&&(e=!1),(null==this.geometry.find(t.key)||e)&&(f.has(t.batchers,this)||t.batchers.push(this),this.geometry.insert(t.key,t),t.added=!0,this.tree_changed=!0)},empty:function(t){if(null==t&&(t=!0),t)for(var e=new ji(this.geometry);null==e.current||null==e.rightest?!1:e.tree.compare(e.current.key,e.rightest.key)<=0;){var i=e.next();i.drop(!0),i=null}else for(var s=new ji(this.geometry);null==s.current||null==s.rightest?!1:s.tree.compare(s.current.key,s.rightest.key)<=0;){var n=s.next();this.geometry.remove(n.key)}},destroy:function(t){null==t&&(t=!0),this.empty(t),this.renderer.remove_batch(this),this.emitter=null,this.geometry=null,this.pos_list=null,this.tcoord_list=null,this.color_list=null,this.normal_list=null,this.max_verts=0,this.max_floats=0,this.vert_count=0,this.renderer=null,this.view=null},remove:function(t,e){null==e&&(e=!0),e&&(d.remove(t.batchers,this),0==t.batchers.length&&(t.added=!1));this.geometry.size();this.geometry.remove(t.key);this.geometry.size();this.tree_changed=!0},batch:function(t){null==t&&(t=!1),this.dynamic_batched_count=0,this.static_batched_count=0,this.visible_count=0,this.pos_floats=0,this.tcoord_floats=0,this.color_floats=0,this.normal_floats=0,this.state=new js(this);for(var e=null,i=new ji(this.geometry);null==i.current||null==i.rightest?!1:i.tree.compare(i.current.key,i.rightest.key)<=0;){var s=i.next();if(e=s,null!=e&&!e.dropped){if(function(t){var i,s=t.state;s.geom_state.clone_onto(s.last_geom_state);var n=s.geom_state,r=e.state;return n.depth!=r.depth&&(n.depth=r.depth),n.texture!=r.texture&&(n.dirty=!0,n.texture=r.texture),n.shader!=r.shader&&(n.dirty=!0,n.shader=r.shader),n.primitive_type!=r.primitive_type&&(n.dirty=!0,n.primitive_type=r.primitive_type),n.clip!=r.clip&&(n.dirty=!0,n.clip=r.clip),n.clip_x!=r.clip_x&&(n.dirty=!0,n.clip_x=r.clip_x),n.clip_y!=r.clip_y&&(n.dirty=!0,n.clip_y=r.clip_y),n.clip_w!=r.clip_w&&(n.dirty=!0,n.clip_w=r.clip_w),n.clip_h!=r.clip_h&&(n.dirty=!0,n.clip_h=r.clip_h),s.geom_state.clip&&(s.last_clip_rect=s.clip_rect,s.clip_rect=e.clip_rect),i=s.geom_state.dirty||s.last_clip_rect!=s.clip_rect}(this))if(this.geom_batched_count=0,0==this.pos_floats);else{if(this.pos_floats>this.max_floats)throw new Ie("uh oh, somehow too many floats are being submitted (max:$max_floats, attempt:$pos_floats).");
var n,r,o=this.pos_list.buffer,l=this.pos_floats;r=null!=o?null==l?new Float32Array(o,0):new Float32Array(o,0,l):null,n=r;var a,h,_=this.tcoord_list.buffer,u=this.tcoord_floats;h=null!=_?null==u?new Float32Array(_,0):new Float32Array(_,0,u):null,a=h;var c,d,f=this.color_list.buffer,p=this.color_floats;d=null!=f?null==p?new Float32Array(f,0):new Float32Array(f,0,p):null,c=d;var g=null,v=_r.current_context.createBuffer(),y=_r.current_context.createBuffer(),w=_r.current_context.createBuffer();_r.current_context.bindBuffer(34962,v),_r.current_context.vertexAttribPointer(0,4,5126,!1,0,0),_r.current_context.bufferData(34962,n,35040),_r.current_context.bindBuffer(34962,w),_r.current_context.vertexAttribPointer(1,4,5126,!1,0,0),_r.current_context.bufferData(34962,a,35040),_r.current_context.bindBuffer(34962,y),_r.current_context.vertexAttribPointer(2,4,5126,!1,0,0),_r.current_context.bufferData(34962,c,35040),_r.current_context.drawArrays(this.state.last_geom_state.primitive_type,0,n.length/4|0),_r.current_context.deleteBuffer(v),_r.current_context.deleteBuffer(y),_r.current_context.deleteBuffer(w),this.draw_calls++,n=null,a=null,c=null,g=null,this.pos_floats=0,this.tcoord_floats=0,this.color_floats=0,this.normal_floats=0}var x=this.state;if(x.geom_state.dirty){null!=x.geom_state.texture?x.last_texture_id!=x.geom_state.texture.id&&(x.last_texture_id=x.geom_state.texture.id,null!=x.geom_state.texture.texture&&x.geom_state.texture.bind()):(m.renderer.state.bindTexture2D(null),x.last_texture_id=null);var b;b=null==this.shader?x.geom_state.shader:this.shader,null==b&&(b=null!=x.geom_state.texture?this.renderer.shaders.textured.shader:this.renderer.shaders.plain.shader),x.last_shader_id!=b.program&&(b.no_default_uniforms||(b.uniforms.set_matrix4_arr("projectionMatrix",this.view.proj_arr,b.location("projectionMatrix")),b.uniforms.set_matrix4_arr("modelViewMatrix",this.view.view_inverse_arr,b.location("modelViewMatrix"))),b.use(),b.uniforms.apply(),m.renderer.state.activeTexture(33984),x.last_shader_id=b.program)}if(x.geom_state.clip){if(x.is_clipping||(_r.current_context.enable(3089),x.is_clipping=!0),null!=x.clip_rect&&!x.clip_rect.equal(x.last_clip_rect)){var k=this.view.get_viewport().h-(x.clip_rect.y+x.clip_rect.h);_r.current_context.scissor(0|x.clip_rect.x,0|k,0|x.clip_rect.w,0|x.clip_rect.h)}}else x.is_clipping&&(_r.current_context.disable(3089),x.is_clipping=!1);if(x.geom_state.dirty=!1,e.visible){if(this.visible_count++,e.buffer_based){this.visible_count--;continue}if(e.locked){if(this.geom_batched_count=0,0==this.pos_floats);else{if(this.pos_floats>this.max_floats)throw new Ie("uh oh, somehow too many floats are being submitted (max:$max_floats, attempt:$pos_floats).");var z,S,T=this.pos_list.buffer,A=this.pos_floats;S=null!=T?null==A?new Float32Array(T,0):new Float32Array(T,0,A):null,z=S;var I,E,M=this.tcoord_list.buffer,C=this.tcoord_floats;E=null!=M?null==C?new Float32Array(M,0):new Float32Array(M,0,C):null,I=E;var R,B,F=this.color_list.buffer,P=this.color_floats;B=null!=F?null==P?new Float32Array(F,0):new Float32Array(F,0,P):null,R=B;var N=null,G=_r.current_context.createBuffer(),D=_r.current_context.createBuffer(),L=_r.current_context.createBuffer();_r.current_context.bindBuffer(34962,G),_r.current_context.vertexAttribPointer(0,4,5126,!1,0,0),_r.current_context.bufferData(34962,z,35040),_r.current_context.bindBuffer(34962,L),_r.current_context.vertexAttribPointer(1,4,5126,!1,0,0),_r.current_context.bufferData(34962,I,35040),_r.current_context.bindBuffer(34962,D),_r.current_context.vertexAttribPointer(2,4,5126,!1,0,0),_r.current_context.bufferData(34962,R,35040),_r.current_context.drawArrays(this.state.last_geom_state.primitive_type,0,z.length/4|0),_r.current_context.deleteBuffer(G),_r.current_context.deleteBuffer(D),_r.current_context.deleteBuffer(L),this.draw_calls++,z=null,I=null,R=null,N=null,this.pos_floats=0,this.tcoord_floats=0,this.color_floats=0,this.normal_floats=0}this.submit_static_geometry(e),this.vert_count+=e.vertices.length}else if(3==e.state.primitive_type||2==e.state.primitive_type||5==e.state.primitive_type||6==e.state.primitive_type){this.geom_batched_count++;var O=e.vertices.length+this.pos_floats/4;if(O>this.max_verts)if(this.geom_batched_count=0,0==this.pos_floats);else{if(this.pos_floats>this.max_floats)throw new Ie("uh oh, somehow too many floats are being submitted (max:$max_floats, attempt:$pos_floats).");var U,H,V=this.pos_list.buffer,q=this.pos_floats;H=null!=V?null==q?new Float32Array(V,0):new Float32Array(V,0,q):null,U=H;var j,Z,K=this.tcoord_list.buffer,Q=this.tcoord_floats;Z=null!=K?null==Q?new Float32Array(K,0):new Float32Array(K,0,Q):null,j=Z;var X,W,Y=this.color_list.buffer,J=this.color_floats;W=null!=Y?null==J?new Float32Array(Y,0):new Float32Array(Y,0,J):null,X=W;var $=null,te=_r.current_context.createBuffer(),ee=_r.current_context.createBuffer(),ie=_r.current_context.createBuffer();_r.current_context.bindBuffer(34962,te),_r.current_context.vertexAttribPointer(0,4,5126,!1,0,0),_r.current_context.bufferData(34962,U,35040),_r.current_context.bindBuffer(34962,ie),_r.current_context.vertexAttribPointer(1,4,5126,!1,0,0),_r.current_context.bufferData(34962,j,35040),_r.current_context.bindBuffer(34962,ee),_r.current_context.vertexAttribPointer(2,4,5126,!1,0,0),_r.current_context.bufferData(34962,X,35040),_r.current_context.drawArrays(e.state.primitive_type,0,U.length/4|0),_r.current_context.deleteBuffer(te),_r.current_context.deleteBuffer(ee),_r.current_context.deleteBuffer(ie),this.draw_calls++,U=null,j=null,X=null,$=null,this.pos_floats=0,this.tcoord_floats=0,this.color_floats=0,this.normal_floats=0}for(var se=this.pos_floats,ne=this.tcoord_floats,re=this.color_floats,oe=this.normal_floats,le=this.pos_list,ae=this.tcoord_list,he=this.color_list,_e=0,ue=e.vertices;_e<ue.length;){var ce=ue[_e];++_e;var de=e._final_vert_position,fe=ce.pos.x,pe=ce.pos.y,ge=ce.pos.z,me=de.ignore_listeners;de.ignore_listeners=!0,de.x=fe,de._construct?de.x:(null==de.listen_x||de.ignore_listeners||de.listen_x(fe),de.x),de.y=pe,de._construct?de.y:(null==de.listen_y||de.ignore_listeners||de.listen_y(pe),de.y),de.z=ge,de._construct?de.z:(null==de.listen_z||de.ignore_listeners||de.listen_z(ge),de.z),de.w=ce.pos.w,de.ignore_listeners=me,null==de.listen_x||de.ignore_listeners||de.listen_x(de.x),null==de.listen_y||de.ignore_listeners||de.listen_y(de.y),null==de.listen_z||de.ignore_listeners||de.listen_z(de.z);var ve=e._final_vert_position,ye=e.transform.get_world().get_matrix(),we=ve.x,xe=ve.y,be=ve.z,ke=ye.elements,ze=ke[0]*we+ke[4]*xe+ke[8]*be+ke[12],Se=ke[1]*we+ke[5]*xe+ke[9]*be+ke[13],Te=ke[2]*we+ke[6]*xe+ke[10]*be+ke[14],Ae=ve.ignore_listeners;ve.ignore_listeners=!0,ve.x=ze,ve._construct?ve.x:(null==ve.listen_x||ve.ignore_listeners||ve.listen_x(ze),ve.x),ve.y=Se,ve._construct?ve.y:(null==ve.listen_y||ve.ignore_listeners||ve.listen_y(Se),ve.y),ve.z=Te,ve._construct?ve.z:(null==ve.listen_z||ve.ignore_listeners||ve.listen_z(Te),ve.z),ve.ignore_listeners=Ae,null==ve.listen_x||ve.ignore_listeners||ve.listen_x(ve.x),null==ve.listen_y||ve.ignore_listeners||ve.listen_y(ve.y),null==ve.listen_z||ve.ignore_listeners||ve.listen_z(ve.z),le[se]=e._final_vert_position.x,le[se+1]=e._final_vert_position.y,le[se+2]=e._final_vert_position.z,le[se+3]=e._final_vert_position.w,se+=4;var Ee=ce.uv.uv0;ae[ne]=Ee.u,ae[ne+1]=Ee.v,ae[ne+2]=Ee.w,ae[ne+3]=Ee.t,ne+=4,he[re]=ce.color.r,he[re+1]=ce.color.g,he[re+2]=ce.color.b,he[re+3]=ce.color.a,re+=4,oe+=4}var Me=4*e.vertices.length;if(this.pos_floats+=Me,this.tcoord_floats+=Me,this.color_floats+=Me,this.normal_floats+=Me,this.geom_batched_count=0,0==this.pos_floats);else{if(this.pos_floats>this.max_floats)throw new Ie("uh oh, somehow too many floats are being submitted (max:$max_floats, attempt:$pos_floats).");var Ce,Re,Be=this.pos_list.buffer,Fe=this.pos_floats;Re=null!=Be?null==Fe?new Float32Array(Be,0):new Float32Array(Be,0,Fe):null,Ce=Re;var Pe,Ne,Ge=this.tcoord_list.buffer,De=this.tcoord_floats;Ne=null!=Ge?null==De?new Float32Array(Ge,0):new Float32Array(Ge,0,De):null,Pe=Ne;var Le,Oe,Ue=this.color_list.buffer,He=this.color_floats;Oe=null!=Ue?null==He?new Float32Array(Ue,0):new Float32Array(Ue,0,He):null,Le=Oe;var Ve=null,qe=_r.current_context.createBuffer(),je=_r.current_context.createBuffer(),Ze=_r.current_context.createBuffer();_r.current_context.bindBuffer(34962,qe),_r.current_context.vertexAttribPointer(0,4,5126,!1,0,0),_r.current_context.bufferData(34962,Ce,35040),_r.current_context.bindBuffer(34962,Ze),_r.current_context.vertexAttribPointer(1,4,5126,!1,0,0),_r.current_context.bufferData(34962,Pe,35040),_r.current_context.bindBuffer(34962,je),_r.current_context.vertexAttribPointer(2,4,5126,!1,0,0),_r.current_context.bufferData(34962,Le,35040),_r.current_context.drawArrays(e.state.primitive_type,0,Ce.length/4|0),_r.current_context.deleteBuffer(qe),_r.current_context.deleteBuffer(je),_r.current_context.deleteBuffer(Ze),this.draw_calls++,Ce=null,Pe=null,Le=null,Ve=null,this.pos_floats=0,this.tcoord_floats=0,this.color_floats=0,this.normal_floats=0}this.vert_count+=e.vertices.length}else{this.geom_batched_count++;var Ke=e.vertices.length+this.pos_floats/4;if(Ke>this.max_verts)if(this.geom_batched_count=0,0==this.pos_floats);else{if(this.pos_floats>this.max_floats)throw new Ie("uh oh, somehow too many floats are being submitted (max:$max_floats, attempt:$pos_floats).");var Qe,Xe,We=this.pos_list.buffer,Ye=this.pos_floats;Xe=null!=We?null==Ye?new Float32Array(We,0):new Float32Array(We,0,Ye):null,Qe=Xe;var Je,$e,ti=this.tcoord_list.buffer,ei=this.tcoord_floats;$e=null!=ti?null==ei?new Float32Array(ti,0):new Float32Array(ti,0,ei):null,Je=$e;var ii,si,ni=this.color_list.buffer,ri=this.color_floats;si=null!=ni?null==ri?new Float32Array(ni,0):new Float32Array(ni,0,ri):null,ii=si;var oi=null,li=_r.current_context.createBuffer(),ai=_r.current_context.createBuffer(),hi=_r.current_context.createBuffer();_r.current_context.bindBuffer(34962,li),_r.current_context.vertexAttribPointer(0,4,5126,!1,0,0),_r.current_context.bufferData(34962,Qe,35040),_r.current_context.bindBuffer(34962,hi),_r.current_context.vertexAttribPointer(1,4,5126,!1,0,0),_r.current_context.bufferData(34962,Je,35040),_r.current_context.bindBuffer(34962,ai),_r.current_context.vertexAttribPointer(2,4,5126,!1,0,0),_r.current_context.bufferData(34962,ii,35040),_r.current_context.drawArrays(e.state.primitive_type,0,Qe.length/4|0),_r.current_context.deleteBuffer(li),_r.current_context.deleteBuffer(ai),_r.current_context.deleteBuffer(hi),this.draw_calls++,Qe=null,Je=null,ii=null,oi=null,this.pos_floats=0,this.tcoord_floats=0,this.color_floats=0,this.normal_floats=0}for(var _i=this.pos_floats,ui=this.tcoord_floats,ci=this.color_floats,di=this.normal_floats,fi=this.pos_list,pi=this.tcoord_list,gi=this.color_list,mi=0,vi=e.vertices;mi<vi.length;){var yi=vi[mi];++mi;var wi=e._final_vert_position,xi=yi.pos.x,bi=yi.pos.y,ki=yi.pos.z,zi=wi.ignore_listeners;wi.ignore_listeners=!0,wi.x=xi,wi._construct?wi.x:(null==wi.listen_x||wi.ignore_listeners||wi.listen_x(xi),wi.x),wi.y=bi,wi._construct?wi.y:(null==wi.listen_y||wi.ignore_listeners||wi.listen_y(bi),wi.y),wi.z=ki,wi._construct?wi.z:(null==wi.listen_z||wi.ignore_listeners||wi.listen_z(ki),wi.z),wi.w=yi.pos.w,wi.ignore_listeners=zi,null==wi.listen_x||wi.ignore_listeners||wi.listen_x(wi.x),null==wi.listen_y||wi.ignore_listeners||wi.listen_y(wi.y),null==wi.listen_z||wi.ignore_listeners||wi.listen_z(wi.z);var Si=e._final_vert_position,Ti=e.transform.get_world().get_matrix(),Ai=Si.x,Ii=Si.y,Ei=Si.z,Mi=Ti.elements,Ci=Mi[0]*Ai+Mi[4]*Ii+Mi[8]*Ei+Mi[12],Ri=Mi[1]*Ai+Mi[5]*Ii+Mi[9]*Ei+Mi[13],Bi=Mi[2]*Ai+Mi[6]*Ii+Mi[10]*Ei+Mi[14],Fi=Si.ignore_listeners;Si.ignore_listeners=!0,Si.x=Ci,Si._construct?Si.x:(null==Si.listen_x||Si.ignore_listeners||Si.listen_x(Ci),Si.x),Si.y=Ri,Si._construct?Si.y:(null==Si.listen_y||Si.ignore_listeners||Si.listen_y(Ri),Si.y),Si.z=Bi,Si._construct?Si.z:(null==Si.listen_z||Si.ignore_listeners||Si.listen_z(Bi),Si.z),Si.ignore_listeners=Fi,null==Si.listen_x||Si.ignore_listeners||Si.listen_x(Si.x),null==Si.listen_y||Si.ignore_listeners||Si.listen_y(Si.y),null==Si.listen_z||Si.ignore_listeners||Si.listen_z(Si.z),fi[_i]=e._final_vert_position.x,fi[_i+1]=e._final_vert_position.y,fi[_i+2]=e._final_vert_position.z,fi[_i+3]=e._final_vert_position.w,_i+=4;var Pi=yi.uv.uv0;pi[ui]=Pi.u,pi[ui+1]=Pi.v,pi[ui+2]=Pi.w,pi[ui+3]=Pi.t,ui+=4,gi[ci]=yi.color.r,gi[ci+1]=yi.color.g,gi[ci+2]=yi.color.b,gi[ci+3]=yi.color.a,ci+=4,di+=4}var Ni=4*e.vertices.length;this.pos_floats+=Ni,this.tcoord_floats+=Ni,this.color_floats+=Ni,this.normal_floats+=Ni,this.dynamic_batched_count++,this.vert_count+=e.vertices.length}!t&&e.immediate&&(e.dropped=!0,this._dropped.push(e))}}}if(this.pos_floats>0&&null!=e){var Gi=this.state;Gi.geom_state.clone_onto(Gi.last_geom_state);var Di=Gi.geom_state,Li=e.state;Di.depth!=Li.depth&&(Di.depth=Li.depth),Di.texture!=Li.texture&&(Di.dirty=!0,Di.texture=Li.texture),Di.shader!=Li.shader&&(Di.dirty=!0,Di.shader=Li.shader),Di.primitive_type!=Li.primitive_type&&(Di.dirty=!0,Di.primitive_type=Li.primitive_type),Di.clip!=Li.clip&&(Di.dirty=!0,Di.clip=Li.clip),Di.clip_x!=Li.clip_x&&(Di.dirty=!0,Di.clip_x=Li.clip_x),Di.clip_y!=Li.clip_y&&(Di.dirty=!0,Di.clip_y=Li.clip_y),Di.clip_w!=Li.clip_w&&(Di.dirty=!0,Di.clip_w=Li.clip_w),Di.clip_h!=Li.clip_h&&(Di.dirty=!0,Di.clip_h=Li.clip_h),Gi.geom_state.clip&&(Gi.last_clip_rect=Gi.clip_rect,Gi.clip_rect=e.clip_rect),Gi.geom_state.dirty||Gi.last_clip_rect!=Gi.clip_rect;var Oi=this.state;if(Oi.geom_state.dirty){null!=Oi.geom_state.texture?Oi.last_texture_id!=Oi.geom_state.texture.id&&(Oi.last_texture_id=Oi.geom_state.texture.id,null!=Oi.geom_state.texture.texture&&Oi.geom_state.texture.bind()):(m.renderer.state.bindTexture2D(null),Oi.last_texture_id=null);var Ui;Ui=null==this.shader?Oi.geom_state.shader:this.shader,null==Ui&&(Ui=null!=Oi.geom_state.texture?this.renderer.shaders.textured.shader:this.renderer.shaders.plain.shader),Oi.last_shader_id!=Ui.program&&(Ui.no_default_uniforms||(Ui.uniforms.set_matrix4_arr("projectionMatrix",this.view.proj_arr,Ui.location("projectionMatrix")),Ui.uniforms.set_matrix4_arr("modelViewMatrix",this.view.view_inverse_arr,Ui.location("modelViewMatrix"))),Ui.use(),Ui.uniforms.apply(),m.renderer.state.activeTexture(33984),Oi.last_shader_id=Ui.program)}if(Oi.geom_state.clip){if(Oi.is_clipping||(_r.current_context.enable(3089),Oi.is_clipping=!0),null!=Oi.clip_rect&&!Oi.clip_rect.equal(Oi.last_clip_rect)){var Hi=this.view.get_viewport().h-(Oi.clip_rect.y+Oi.clip_rect.h);_r.current_context.scissor(0|Oi.clip_rect.x,0|Hi,0|Oi.clip_rect.w,0|Oi.clip_rect.h)}}else Oi.is_clipping&&(_r.current_context.disable(3089),Oi.is_clipping=!1);if(Oi.geom_state.dirty=!1,this.geom_batched_count=0,0==this.pos_floats);else{if(this.pos_floats>this.max_floats)throw new Ie("uh oh, somehow too many floats are being submitted (max:$max_floats, attempt:$pos_floats).");var Vi,qi,Zi=this.pos_list.buffer,Ki=this.pos_floats;qi=null!=Zi?null==Ki?new Float32Array(Zi,0):new Float32Array(Zi,0,Ki):null,Vi=qi;var Qi,Xi,Wi=this.tcoord_list.buffer,Yi=this.tcoord_floats;Xi=null!=Wi?null==Yi?new Float32Array(Wi,0):new Float32Array(Wi,0,Yi):null,Qi=Xi;var Ji,$i,ts=this.color_list.buffer,es=this.color_floats;$i=null!=ts?null==es?new Float32Array(ts,0):new Float32Array(ts,0,es):null,Ji=$i;var is=null,ss=_r.current_context.createBuffer(),ns=_r.current_context.createBuffer(),rs=_r.current_context.createBuffer();_r.current_context.bindBuffer(34962,ss),_r.current_context.vertexAttribPointer(0,4,5126,!1,0,0),_r.current_context.bufferData(34962,Vi,35040),_r.current_context.bindBuffer(34962,rs),_r.current_context.vertexAttribPointer(1,4,5126,!1,0,0),_r.current_context.bufferData(34962,Qi,35040),_r.current_context.bindBuffer(34962,ns),_r.current_context.vertexAttribPointer(2,4,5126,!1,0,0),_r.current_context.bufferData(34962,Ji,35040),_r.current_context.drawArrays(this.state.last_geom_state.primitive_type,0,Vi.length/4|0),_r.current_context.deleteBuffer(ss),_r.current_context.deleteBuffer(ns),_r.current_context.deleteBuffer(rs),this.draw_calls++,Vi=null,Qi=null,Ji=null,is=null,this.pos_floats=0,this.tcoord_floats=0,this.color_floats=0,this.normal_floats=0}}this.state.deactivate(this),this.state=null,this.prune()},log_geom:function(t){return{id:t.id,verts:t.vertices.length,type:""+function(e){var i,s=t.state.primitive_type;return i=function(){var t;switch(s){case 3:t="line_strip";break;case 2:t="line_loop";break;case 1:t="lines";break;case 5:t="triangle_strip";break;case 4:t="triangles";break;case 6:t="triangle_fan";break;case 0:t="points";break;default:t=""+s}return t}(e)}(this),depth:t.state.depth,visible:t.visible,locked:t.locked,immediate:t.immediate,shader:null==t.state.shader?"null":t.state.shader.id,texture:null==t.state.texture?"null":t.state.texture.id}},log_batch:function(t){return{type:""+function(){var e;switch(t){case 3:e="line_strip";break;case 2:e="line_loop";break;case 1:e="lines";break;case 5:e="triangle_strip";break;case 4:e="triangles";break;case 6:e="triangle_fan";break;case 0:e="points";break;default:e=""+t}return e}(this),geoms:this.geom_batched_count,pos:this.pos_floats/4,tcoord:this.tcoord_floats/4,color:this.color_floats/4,normals:this.normal_floats/4}},batch_log:function(t){null==t&&(t=!1);var e=this.renderer.cmd_log;e.push({cmd:this.CMD_BATCHER_START,name:this.name}),this.dynamic_batched_count=0,this.static_batched_count=0,this.visible_count=0,this.pos_floats=0,this.tcoord_floats=0,this.color_floats=0,this.normal_floats=0,this.state=new js(this);for(var i=null,s=new ji(this.geometry);null==s.current||null==s.rightest?!1:s.tree.compare(s.current.key,s.rightest.key)<=0;){var n=s.next();if(i=n,null!=i&&!i.dropped){var r,o=this.state;o.geom_state.clone_onto(o.last_geom_state);var l=o.geom_state,a=i.state;if(l.depth!=a.depth&&(l.depth=a.depth),l.texture!=a.texture&&(l.dirty=!0,l.texture=a.texture),l.shader!=a.shader&&(l.dirty=!0,l.shader=a.shader),l.primitive_type!=a.primitive_type&&(l.dirty=!0,l.primitive_type=a.primitive_type),l.clip!=a.clip&&(l.dirty=!0,l.clip=a.clip),l.clip_x!=a.clip_x&&(l.dirty=!0,l.clip_x=a.clip_x),l.clip_y!=a.clip_y&&(l.dirty=!0,l.clip_y=a.clip_y),l.clip_w!=a.clip_w&&(l.dirty=!0,l.clip_w=a.clip_w),l.clip_h!=a.clip_h&&(l.dirty=!0,l.clip_h=a.clip_h),o.geom_state.clip&&(o.last_clip_rect=o.clip_rect,o.clip_rect=i.clip_rect),r=o.geom_state.dirty||o.last_clip_rect!=o.clip_rect,e.push({cmd:this.CMD_STATE_UPDATE,changed:r}),r)if(this.pos_floats>0&&e.push({cmd:this.CMD_SUBMIT_BATCH,batch:this.log_batch(this.state.last_geom_state.primitive_type)}),this.geom_batched_count=0,0==this.pos_floats);else{if(this.pos_floats>this.max_floats)throw new Ie("uh oh, somehow too many floats are being submitted (max:$max_floats, attempt:$pos_floats).");var h,_,u=this.pos_list.buffer,c=this.pos_floats;_=null!=u?null==c?new Float32Array(u,0):new Float32Array(u,0,c):null,h=_;var d,f,p=this.tcoord_list.buffer,g=this.tcoord_floats;f=null!=p?null==g?new Float32Array(p,0):new Float32Array(p,0,g):null,d=f;var v,y,w=this.color_list.buffer,x=this.color_floats;y=null!=w?null==x?new Float32Array(w,0):new Float32Array(w,0,x):null,v=y;var b=null,k=_r.current_context.createBuffer(),z=_r.current_context.createBuffer(),S=_r.current_context.createBuffer();_r.current_context.bindBuffer(34962,k),_r.current_context.vertexAttribPointer(0,4,5126,!1,0,0),_r.current_context.bufferData(34962,h,35040),_r.current_context.bindBuffer(34962,S),_r.current_context.vertexAttribPointer(1,4,5126,!1,0,0),_r.current_context.bufferData(34962,d,35040),_r.current_context.bindBuffer(34962,z),_r.current_context.vertexAttribPointer(2,4,5126,!1,0,0),_r.current_context.bufferData(34962,v,35040),_r.current_context.drawArrays(this.state.last_geom_state.primitive_type,0,h.length/4|0),_r.current_context.deleteBuffer(k),_r.current_context.deleteBuffer(z),_r.current_context.deleteBuffer(S),this.draw_calls++,h=null,d=null,v=null,b=null,this.pos_floats=0,this.tcoord_floats=0,this.color_floats=0,this.normal_floats=0}var T=this.state;if(T.geom_state.dirty){null!=T.geom_state.texture?T.last_texture_id!=T.geom_state.texture.id&&(T.last_texture_id=T.geom_state.texture.id,null!=T.geom_state.texture.texture&&T.geom_state.texture.bind()):(m.renderer.state.bindTexture2D(null),T.last_texture_id=null);var A;A=null==this.shader?T.geom_state.shader:this.shader,null==A&&(A=null!=T.geom_state.texture?this.renderer.shaders.textured.shader:this.renderer.shaders.plain.shader),T.last_shader_id!=A.program&&(A.no_default_uniforms||(A.uniforms.set_matrix4_arr("projectionMatrix",this.view.proj_arr,A.location("projectionMatrix")),A.uniforms.set_matrix4_arr("modelViewMatrix",this.view.view_inverse_arr,A.location("modelViewMatrix"))),A.use(),A.uniforms.apply(),m.renderer.state.activeTexture(33984),T.last_shader_id=A.program)}if(T.geom_state.clip){if(T.is_clipping||(_r.current_context.enable(3089),T.is_clipping=!0),null!=T.clip_rect&&!T.clip_rect.equal(T.last_clip_rect)){var I=this.view.get_viewport().h-(T.clip_rect.y+T.clip_rect.h);_r.current_context.scissor(0|T.clip_rect.x,0|I,0|T.clip_rect.w,0|T.clip_rect.h)}}else T.is_clipping&&(_r.current_context.disable(3089),T.is_clipping=!1);if(T.geom_state.dirty=!1,e.push({cmd:this.CMD_STATE_ACTIVATE}),i.visible){if(this.visible_count++,i.buffer_based){e.push({cmd:this.CMD_SUBMIT_SKIP_BUFFERBASED}),this.visible_count--;continue}if(i.locked){if(this.pos_floats>0&&e.push({cmd:this.CMD_SUBMIT_BATCH,batch:this.log_batch(this.state.last_geom_state.primitive_type)}),this.geom_batched_count=0,0==this.pos_floats);else{if(this.pos_floats>this.max_floats)throw new Ie("uh oh, somehow too many floats are being submitted (max:$max_floats, attempt:$pos_floats).");var E,M,C=this.pos_list.buffer,R=this.pos_floats;M=null!=C?null==R?new Float32Array(C,0):new Float32Array(C,0,R):null,E=M;var B,F,P=this.tcoord_list.buffer,N=this.tcoord_floats;F=null!=P?null==N?new Float32Array(P,0):new Float32Array(P,0,N):null,B=F;var G,D,L=this.color_list.buffer,O=this.color_floats;D=null!=L?null==O?new Float32Array(L,0):new Float32Array(L,0,O):null,G=D;var U=null,H=_r.current_context.createBuffer(),V=_r.current_context.createBuffer(),q=_r.current_context.createBuffer();_r.current_context.bindBuffer(34962,H),_r.current_context.vertexAttribPointer(0,4,5126,!1,0,0),_r.current_context.bufferData(34962,E,35040),_r.current_context.bindBuffer(34962,q),_r.current_context.vertexAttribPointer(1,4,5126,!1,0,0),_r.current_context.bufferData(34962,B,35040),_r.current_context.bindBuffer(34962,V),_r.current_context.vertexAttribPointer(2,4,5126,!1,0,0),_r.current_context.bufferData(34962,G,35040),_r.current_context.drawArrays(this.state.last_geom_state.primitive_type,0,E.length/4|0),_r.current_context.deleteBuffer(H),_r.current_context.deleteBuffer(V),_r.current_context.deleteBuffer(q),this.draw_calls++,E=null,B=null,G=null,U=null,this.pos_floats=0,this.tcoord_floats=0,this.color_floats=0,this.normal_floats=0}e.push({cmd:this.CMD_SUBMIT_STATIC,geom:this.log_geom(i)}),this.submit_static_geometry(i),this.vert_count+=i.vertices.length}else if(3==i.state.primitive_type||2==i.state.primitive_type||5==i.state.primitive_type||6==i.state.primitive_type){e.push({cmd:this.CMD_BATCH_GEOM,geom:this.log_geom(i)}),this.geom_batched_count++;var j=i.vertices.length+this.pos_floats/4;if(j>this.max_verts)if(this.geom_batched_count=0,0==this.pos_floats);else{if(this.pos_floats>this.max_floats)throw new Ie("uh oh, somehow too many floats are being submitted (max:$max_floats, attempt:$pos_floats).");var Z,K,Q=this.pos_list.buffer,X=this.pos_floats;K=null!=Q?null==X?new Float32Array(Q,0):new Float32Array(Q,0,X):null,Z=K;var W,Y,J=this.tcoord_list.buffer,$=this.tcoord_floats;Y=null!=J?null==$?new Float32Array(J,0):new Float32Array(J,0,$):null,W=Y;var te,ee,ie=this.color_list.buffer,se=this.color_floats;ee=null!=ie?null==se?new Float32Array(ie,0):new Float32Array(ie,0,se):null,te=ee;var ne=null,re=_r.current_context.createBuffer(),oe=_r.current_context.createBuffer(),le=_r.current_context.createBuffer();_r.current_context.bindBuffer(34962,re),_r.current_context.vertexAttribPointer(0,4,5126,!1,0,0),_r.current_context.bufferData(34962,Z,35040),_r.current_context.bindBuffer(34962,le),_r.current_context.vertexAttribPointer(1,4,5126,!1,0,0),_r.current_context.bufferData(34962,W,35040),_r.current_context.bindBuffer(34962,oe),_r.current_context.vertexAttribPointer(2,4,5126,!1,0,0),_r.current_context.bufferData(34962,te,35040),_r.current_context.drawArrays(i.state.primitive_type,0,Z.length/4|0),_r.current_context.deleteBuffer(re),_r.current_context.deleteBuffer(oe),_r.current_context.deleteBuffer(le),this.draw_calls++,Z=null,W=null,te=null,ne=null,this.pos_floats=0,this.tcoord_floats=0,this.color_floats=0,this.normal_floats=0}for(var ae=this.pos_floats,he=this.tcoord_floats,_e=this.color_floats,ue=this.normal_floats,ce=this.pos_list,de=this.tcoord_list,fe=this.color_list,pe=0,ge=i.vertices;pe<ge.length;){var me=ge[pe];++pe;var ve=i._final_vert_position,ye=me.pos.x,we=me.pos.y,xe=me.pos.z,be=ve.ignore_listeners;ve.ignore_listeners=!0,ve.x=ye,ve._construct?ve.x:(null==ve.listen_x||ve.ignore_listeners||ve.listen_x(ye),ve.x),ve.y=we,ve._construct?ve.y:(null==ve.listen_y||ve.ignore_listeners||ve.listen_y(we),ve.y),ve.z=xe,ve._construct?ve.z:(null==ve.listen_z||ve.ignore_listeners||ve.listen_z(xe),ve.z),ve.w=me.pos.w,ve.ignore_listeners=be,null==ve.listen_x||ve.ignore_listeners||ve.listen_x(ve.x),null==ve.listen_y||ve.ignore_listeners||ve.listen_y(ve.y),null==ve.listen_z||ve.ignore_listeners||ve.listen_z(ve.z);var ke=i._final_vert_position,ze=i.transform.get_world().get_matrix(),Se=ke.x,Te=ke.y,Ae=ke.z,Ee=ze.elements,Me=Ee[0]*Se+Ee[4]*Te+Ee[8]*Ae+Ee[12],Ce=Ee[1]*Se+Ee[5]*Te+Ee[9]*Ae+Ee[13],Re=Ee[2]*Se+Ee[6]*Te+Ee[10]*Ae+Ee[14],Be=ke.ignore_listeners;ke.ignore_listeners=!0,ke.x=Me,ke._construct?ke.x:(null==ke.listen_x||ke.ignore_listeners||ke.listen_x(Me),ke.x),ke.y=Ce,ke._construct?ke.y:(null==ke.listen_y||ke.ignore_listeners||ke.listen_y(Ce),ke.y),ke.z=Re,ke._construct?ke.z:(null==ke.listen_z||ke.ignore_listeners||ke.listen_z(Re),ke.z),ke.ignore_listeners=Be,null==ke.listen_x||ke.ignore_listeners||ke.listen_x(ke.x),null==ke.listen_y||ke.ignore_listeners||ke.listen_y(ke.y),null==ke.listen_z||ke.ignore_listeners||ke.listen_z(ke.z),ce[ae]=i._final_vert_position.x,ce[ae+1]=i._final_vert_position.y,ce[ae+2]=i._final_vert_position.z,ce[ae+3]=i._final_vert_position.w,ae+=4;var Fe=me.uv.uv0;de[he]=Fe.u,de[he+1]=Fe.v,de[he+2]=Fe.w,de[he+3]=Fe.t,he+=4,fe[_e]=me.color.r,fe[_e+1]=me.color.g,fe[_e+2]=me.color.b,fe[_e+3]=me.color.a,_e+=4,ue+=4}var Pe=4*i.vertices.length;if(this.pos_floats+=Pe,this.tcoord_floats+=Pe,this.color_floats+=Pe,this.normal_floats+=Pe,this.pos_floats>0&&e.push({cmd:this.CMD_SUBMIT_BATCH,batch:this.log_batch(i.state.primitive_type)}),this.geom_batched_count=0,0==this.pos_floats);else{if(this.pos_floats>this.max_floats)throw new Ie("uh oh, somehow too many floats are being submitted (max:$max_floats, attempt:$pos_floats).");var Ne,Ge,De=this.pos_list.buffer,Le=this.pos_floats;Ge=null!=De?null==Le?new Float32Array(De,0):new Float32Array(De,0,Le):null,Ne=Ge;var Oe,Ue,He=this.tcoord_list.buffer,Ve=this.tcoord_floats;Ue=null!=He?null==Ve?new Float32Array(He,0):new Float32Array(He,0,Ve):null,Oe=Ue;var qe,je,Ze=this.color_list.buffer,Ke=this.color_floats;je=null!=Ze?null==Ke?new Float32Array(Ze,0):new Float32Array(Ze,0,Ke):null,qe=je;var Qe=null,Xe=_r.current_context.createBuffer(),We=_r.current_context.createBuffer(),Ye=_r.current_context.createBuffer();_r.current_context.bindBuffer(34962,Xe),_r.current_context.vertexAttribPointer(0,4,5126,!1,0,0),_r.current_context.bufferData(34962,Ne,35040),_r.current_context.bindBuffer(34962,Ye),_r.current_context.vertexAttribPointer(1,4,5126,!1,0,0),_r.current_context.bufferData(34962,Oe,35040),_r.current_context.bindBuffer(34962,We),_r.current_context.vertexAttribPointer(2,4,5126,!1,0,0),_r.current_context.bufferData(34962,qe,35040),_r.current_context.drawArrays(i.state.primitive_type,0,Ne.length/4|0),_r.current_context.deleteBuffer(Xe),_r.current_context.deleteBuffer(We),_r.current_context.deleteBuffer(Ye),this.draw_calls++,Ne=null,Oe=null,qe=null,Qe=null,this.pos_floats=0,this.tcoord_floats=0,this.color_floats=0,this.normal_floats=0}this.vert_count+=i.vertices.length}else{e.push({cmd:this.CMD_BATCH_GEOM,geom:this.log_geom(i)}),this.geom_batched_count++;var Je=i.vertices.length+this.pos_floats/4;if(Je>this.max_verts)if(this.geom_batched_count=0,0==this.pos_floats);else{if(this.pos_floats>this.max_floats)throw new Ie("uh oh, somehow too many floats are being submitted (max:$max_floats, attempt:$pos_floats).");var $e,ti,ei=this.pos_list.buffer,ii=this.pos_floats;ti=null!=ei?null==ii?new Float32Array(ei,0):new Float32Array(ei,0,ii):null,$e=ti;var si,ni,ri=this.tcoord_list.buffer,oi=this.tcoord_floats;ni=null!=ri?null==oi?new Float32Array(ri,0):new Float32Array(ri,0,oi):null,si=ni;var li,ai,hi=this.color_list.buffer,_i=this.color_floats;ai=null!=hi?null==_i?new Float32Array(hi,0):new Float32Array(hi,0,_i):null,li=ai;var ui=null,ci=_r.current_context.createBuffer(),di=_r.current_context.createBuffer(),fi=_r.current_context.createBuffer();_r.current_context.bindBuffer(34962,ci),_r.current_context.vertexAttribPointer(0,4,5126,!1,0,0),_r.current_context.bufferData(34962,$e,35040),_r.current_context.bindBuffer(34962,fi),_r.current_context.vertexAttribPointer(1,4,5126,!1,0,0),_r.current_context.bufferData(34962,si,35040),_r.current_context.bindBuffer(34962,di),_r.current_context.vertexAttribPointer(2,4,5126,!1,0,0),_r.current_context.bufferData(34962,li,35040),_r.current_context.drawArrays(i.state.primitive_type,0,$e.length/4|0),_r.current_context.deleteBuffer(ci),_r.current_context.deleteBuffer(di),_r.current_context.deleteBuffer(fi),this.draw_calls++,$e=null,si=null,li=null,ui=null,this.pos_floats=0,this.tcoord_floats=0,this.color_floats=0,this.normal_floats=0}for(var pi=this.pos_floats,gi=this.tcoord_floats,mi=this.color_floats,vi=this.normal_floats,yi=this.pos_list,wi=this.tcoord_list,xi=this.color_list,bi=0,ki=i.vertices;bi<ki.length;){var zi=ki[bi];++bi;var Si=i._final_vert_position,Ti=zi.pos.x,Ai=zi.pos.y,Ii=zi.pos.z,Ei=Si.ignore_listeners;Si.ignore_listeners=!0,Si.x=Ti,Si._construct?Si.x:(null==Si.listen_x||Si.ignore_listeners||Si.listen_x(Ti),Si.x),Si.y=Ai,Si._construct?Si.y:(null==Si.listen_y||Si.ignore_listeners||Si.listen_y(Ai),Si.y),Si.z=Ii,Si._construct?Si.z:(null==Si.listen_z||Si.ignore_listeners||Si.listen_z(Ii),Si.z),Si.w=zi.pos.w,Si.ignore_listeners=Ei,null==Si.listen_x||Si.ignore_listeners||Si.listen_x(Si.x),null==Si.listen_y||Si.ignore_listeners||Si.listen_y(Si.y),null==Si.listen_z||Si.ignore_listeners||Si.listen_z(Si.z);var Mi=i._final_vert_position,Ci=i.transform.get_world().get_matrix(),Ri=Mi.x,Bi=Mi.y,Fi=Mi.z,Pi=Ci.elements,Ni=Pi[0]*Ri+Pi[4]*Bi+Pi[8]*Fi+Pi[12],Gi=Pi[1]*Ri+Pi[5]*Bi+Pi[9]*Fi+Pi[13],Di=Pi[2]*Ri+Pi[6]*Bi+Pi[10]*Fi+Pi[14],Li=Mi.ignore_listeners;Mi.ignore_listeners=!0,Mi.x=Ni,Mi._construct?Mi.x:(null==Mi.listen_x||Mi.ignore_listeners||Mi.listen_x(Ni),Mi.x),Mi.y=Gi,Mi._construct?Mi.y:(null==Mi.listen_y||Mi.ignore_listeners||Mi.listen_y(Gi),Mi.y),Mi.z=Di,Mi._construct?Mi.z:(null==Mi.listen_z||Mi.ignore_listeners||Mi.listen_z(Di),Mi.z),Mi.ignore_listeners=Li,null==Mi.listen_x||Mi.ignore_listeners||Mi.listen_x(Mi.x),null==Mi.listen_y||Mi.ignore_listeners||Mi.listen_y(Mi.y),null==Mi.listen_z||Mi.ignore_listeners||Mi.listen_z(Mi.z),yi[pi]=i._final_vert_position.x,yi[pi+1]=i._final_vert_position.y,yi[pi+2]=i._final_vert_position.z,yi[pi+3]=i._final_vert_position.w,pi+=4;var Oi=zi.uv.uv0;wi[gi]=Oi.u,wi[gi+1]=Oi.v,wi[gi+2]=Oi.w,wi[gi+3]=Oi.t,gi+=4,xi[mi]=zi.color.r,xi[mi+1]=zi.color.g,xi[mi+2]=zi.color.b,xi[mi+3]=zi.color.a,mi+=4,vi+=4}var Ui=4*i.vertices.length;this.pos_floats+=Ui,this.tcoord_floats+=Ui,this.color_floats+=Ui,this.normal_floats+=Ui,this.dynamic_batched_count++,this.vert_count+=i.vertices.length}!t&&i.immediate&&(i.dropped=!0,this._dropped.push(i),e.push({cmd:this.CMD_DROP}))
}else e.push({cmd:this.CMD_SUBMIT_SKIP_INVISIBLE,geom:this.log_geom(i)})}}if(this.pos_floats>0&&null!=i){var Hi=this.state;Hi.geom_state.clone_onto(Hi.last_geom_state);var Vi=Hi.geom_state,qi=i.state;Vi.depth!=qi.depth&&(Vi.depth=qi.depth),Vi.texture!=qi.texture&&(Vi.dirty=!0,Vi.texture=qi.texture),Vi.shader!=qi.shader&&(Vi.dirty=!0,Vi.shader=qi.shader),Vi.primitive_type!=qi.primitive_type&&(Vi.dirty=!0,Vi.primitive_type=qi.primitive_type),Vi.clip!=qi.clip&&(Vi.dirty=!0,Vi.clip=qi.clip),Vi.clip_x!=qi.clip_x&&(Vi.dirty=!0,Vi.clip_x=qi.clip_x),Vi.clip_y!=qi.clip_y&&(Vi.dirty=!0,Vi.clip_y=qi.clip_y),Vi.clip_w!=qi.clip_w&&(Vi.dirty=!0,Vi.clip_w=qi.clip_w),Vi.clip_h!=qi.clip_h&&(Vi.dirty=!0,Vi.clip_h=qi.clip_h),Hi.geom_state.clip&&(Hi.last_clip_rect=Hi.clip_rect,Hi.clip_rect=i.clip_rect),Hi.geom_state.dirty||Hi.last_clip_rect!=Hi.clip_rect,e.push({cmd:this.CMD_STATE_UPDATE});var Zi=this.state;if(Zi.geom_state.dirty){null!=Zi.geom_state.texture?Zi.last_texture_id!=Zi.geom_state.texture.id&&(Zi.last_texture_id=Zi.geom_state.texture.id,null!=Zi.geom_state.texture.texture&&Zi.geom_state.texture.bind()):(m.renderer.state.bindTexture2D(null),Zi.last_texture_id=null);var Ki;Ki=null==this.shader?Zi.geom_state.shader:this.shader,null==Ki&&(Ki=null!=Zi.geom_state.texture?this.renderer.shaders.textured.shader:this.renderer.shaders.plain.shader),Zi.last_shader_id!=Ki.program&&(Ki.no_default_uniforms||(Ki.uniforms.set_matrix4_arr("projectionMatrix",this.view.proj_arr,Ki.location("projectionMatrix")),Ki.uniforms.set_matrix4_arr("modelViewMatrix",this.view.view_inverse_arr,Ki.location("modelViewMatrix"))),Ki.use(),Ki.uniforms.apply(),m.renderer.state.activeTexture(33984),Zi.last_shader_id=Ki.program)}if(Zi.geom_state.clip){if(Zi.is_clipping||(_r.current_context.enable(3089),Zi.is_clipping=!0),null!=Zi.clip_rect&&!Zi.clip_rect.equal(Zi.last_clip_rect)){var Qi=this.view.get_viewport().h-(Zi.clip_rect.y+Zi.clip_rect.h);_r.current_context.scissor(0|Zi.clip_rect.x,0|Qi,0|Zi.clip_rect.w,0|Zi.clip_rect.h)}}else Zi.is_clipping&&(_r.current_context.disable(3089),Zi.is_clipping=!1);if(Zi.geom_state.dirty=!1,e.push({cmd:this.CMD_STATE_ACTIVATE}),this.pos_floats>0&&e.push({cmd:this.CMD_SUBMIT_BATCH,batch:this.log_batch(i.state.primitive_type)}),this.geom_batched_count=0,0==this.pos_floats);else{if(this.pos_floats>this.max_floats)throw new Ie("uh oh, somehow too many floats are being submitted (max:$max_floats, attempt:$pos_floats).");var Xi,Wi,Yi=this.pos_list.buffer,Ji=this.pos_floats;Wi=null!=Yi?null==Ji?new Float32Array(Yi,0):new Float32Array(Yi,0,Ji):null,Xi=Wi;var $i,ts,es=this.tcoord_list.buffer,is=this.tcoord_floats;ts=null!=es?null==is?new Float32Array(es,0):new Float32Array(es,0,is):null,$i=ts;var ss,ns,rs=this.color_list.buffer,os=this.color_floats;ns=null!=rs?null==os?new Float32Array(rs,0):new Float32Array(rs,0,os):null,ss=ns;var ls=null,as=_r.current_context.createBuffer(),hs=_r.current_context.createBuffer(),_s=_r.current_context.createBuffer();_r.current_context.bindBuffer(34962,as),_r.current_context.vertexAttribPointer(0,4,5126,!1,0,0),_r.current_context.bufferData(34962,Xi,35040),_r.current_context.bindBuffer(34962,_s),_r.current_context.vertexAttribPointer(1,4,5126,!1,0,0),_r.current_context.bufferData(34962,$i,35040),_r.current_context.bindBuffer(34962,hs),_r.current_context.vertexAttribPointer(2,4,5126,!1,0,0),_r.current_context.bufferData(34962,ss,35040),_r.current_context.drawArrays(this.state.last_geom_state.primitive_type,0,Xi.length/4|0),_r.current_context.deleteBuffer(as),_r.current_context.deleteBuffer(hs),_r.current_context.deleteBuffer(_s),this.draw_calls++,Xi=null,$i=null,ss=null,ls=null,this.pos_floats=0,this.tcoord_floats=0,this.color_floats=0,this.normal_floats=0}}e.push({cmd:this.CMD_STATE_DEACTIVATE}),this.state.deactivate(this),this.state=null,e.push({cmd:this.CMD_PRUNE}),this.prune()},prune:function(){if(this._dropped.length>0){for(var t=0,e=this._dropped;t<e.length;){var i=e[t];++t,i.drop(),i=null}this._dropped=null,this._dropped=[]}},draw:function(t){null==t&&(t=!1),this.draw_calls=0,this.vert_count=0,this.emitter.emit(1,this),this.view.process(),this.renderer.state.viewport(this.view.get_viewport().x,this.view.get_viewport().y,this.view.get_viewport().w,this.view.get_viewport().h),this.renderer.logging?this.batch_log(t):this.batch(t),this.emitter.emit(2,this)},update_view:function(){this.view.process(),this.renderer.state.viewport(this.view.get_viewport().x,this.view.get_viewport().y,this.view.get_viewport().w,this.view.get_viewport().h)},apply_default_uniforms:function(t){t.no_default_uniforms||(t.uniforms.set_matrix4_arr("projectionMatrix",this.view.proj_arr,t.location("projectionMatrix")),t.uniforms.set_matrix4_arr("modelViewMatrix",this.view.view_inverse_arr,t.location("modelViewMatrix")))},submit_geometry:function(t,e){if(!t.buffer_based)throw new Ie(ei.assertion("_geom.buffer_based ( Only buffer based geometry can be submitted directly )"));if(t.visible){null==e&&(e=t.state.shader),null!=this.shader&&(e=this.shader),e.use(),e.uniforms.apply(),m.renderer.state.activeTexture(33984),e.no_default_uniforms||(e.uniforms.set_matrix4_arr("projectionMatrix",this.view.proj_arr,e.location("projectionMatrix")),e.uniforms.set_matrix4_arr("modelViewMatrix",this.view.view_inverse_arr,e.location("modelViewMatrix"))),t.uniforms.apply();var i=t.vertices.length,s=t.update_buffers();s?(_r.current_context.bindBuffer(34962,t.vb_pos),_r.current_context.vertexAttribPointer(0,4,5126,!1,0,0),_r.current_context.bufferData(34962,t.buffer_pos,t.buffer_type),_r.current_context.bindBuffer(34962,t.vb_tcoords),_r.current_context.vertexAttribPointer(1,4,5126,!1,0,0),_r.current_context.bufferData(34962,t.buffer_tcoords,t.buffer_type),_r.current_context.bindBuffer(34962,t.vb_colors),_r.current_context.vertexAttribPointer(2,4,5126,!1,0,0),_r.current_context.bufferData(34962,t.buffer_colors,t.buffer_type)):(_r.current_context.bindBuffer(34962,t.vb_pos),_r.current_context.vertexAttribPointer(0,4,5126,!1,0,0),_r.current_context.bindBuffer(34962,t.vb_tcoords),_r.current_context.vertexAttribPointer(1,4,5126,!1,0,0),_r.current_context.bindBuffer(34962,t.vb_colors),_r.current_context.vertexAttribPointer(2,4,5126,!1,0,0)),_r.current_context.drawArrays(t.state.primitive_type,0,t.buffer_pos.length/4|0);var n=this.renderer.stats;n.geometry_count++,n.visible_count++,n.draw_calls++,n.vert_count+=i}},submit_static_geometry:function(t){var e=t.vertices.length;if(0!=e){var i=t.update_buffers();i?(_r.current_context.bindBuffer(34962,t.vb_pos),_r.current_context.vertexAttribPointer(0,4,5126,!1,0,0),_r.current_context.bufferData(34962,t.buffer_pos,t.buffer_type),_r.current_context.bindBuffer(34962,t.vb_tcoords),_r.current_context.vertexAttribPointer(1,4,5126,!1,0,0),_r.current_context.bufferData(34962,t.buffer_tcoords,t.buffer_type),_r.current_context.bindBuffer(34962,t.vb_colors),_r.current_context.vertexAttribPointer(2,4,5126,!1,0,0),_r.current_context.bufferData(34962,t.buffer_colors,t.buffer_type)):(_r.current_context.bindBuffer(34962,t.vb_pos),_r.current_context.vertexAttribPointer(0,4,5126,!1,0,0),_r.current_context.bindBuffer(34962,t.vb_tcoords),_r.current_context.vertexAttribPointer(1,4,5126,!1,0,0),_r.current_context.bindBuffer(34962,t.vb_colors),_r.current_context.vertexAttribPointer(2,4,5126,!1,0,0)),_r.current_context.drawArrays(t.state.primitive_type,0,t.buffer_pos.length/4|0),this.static_batched_count++,this.draw_calls++,t.set_dirty(!1)}},set_layer:function(t){return this.layer=t,this.renderer.batchers.sort((Ur=this.renderer,n(Ur,Ur.sort_batchers))),this.layer},toString:function(){return"Batcher("+this.name+")"},compare:function(t){return this.layer==t.layer?0:this.layer<t.layer?-1:1},compare_rule_to_string:function(t){switch(t){case 0:return"same";case 1:return"depth <";case 2:return"depth >";case 3:return"shader <";case 4:return"shader >";case 5:return"shader s._ >";case 6:return"shader _.s <";case 7:return"texture <";case 8:return"texture >";case 9:return"texture t._ >";case 10:return"texture _.t <";case 11:return"primitive <";case 12:return"primitive >";case 13:return"unclipped";case 14:return"clipped";case 15:return"timestamp <";case 16:return"timestamp >";case 17:return"timestamp ==";case 18:return"sequence <";case 19:return"sequence >";case 20:return"fallback";default:return"unknown"}},compare_rule:function(t,e){if(t.uuid==e.uuid)return 0;if(t.depth<e.depth)return 1;if(t.depth>e.depth)return 2;if(null!=t.shader&&null!=e.shader){if(t.shader.id<e.shader.id)return 3;if(t.shader.id>e.shader.id)return 4}else{if(null!=t.shader&&null==e.shader)return 5;if(null==t.shader&&null!=e.shader)return 6}if(null!=t.texture&&null!=e.texture){if(t.texture.id<e.texture.id)return 7;if(t.texture.id>e.texture.id)return 8}else{if(null!=t.texture&&null==e.texture)return 9;if(null==t.texture&&null!=e.texture)return 10}var i=t.primitive_type,s=e.primitive_type;if(s>i)return 11;if(i>s)return 12;if(t.clip!=e.clip){if(0==t.clip&&1==e.clip)return 13;if(1==t.clip&&0==e.clip)return 14}return t.timestamp<e.timestamp?15:t.timestamp>e.timestamp?16:t.timestamp==e.timestamp?17:t.sequence<e.sequence?18:t.sequence>e.sequence?19:20},geometry_compare:function(t,e){if(t.uuid==e.uuid)return 0;if(t.depth<e.depth)return-1;if(t.depth>e.depth)return 1;if(null!=t.shader&&null!=e.shader){if(t.shader.id<e.shader.id)return-1;if(t.shader.id>e.shader.id)return 1}else{if(null!=t.shader&&null==e.shader)return 1;if(null==t.shader&&null!=e.shader)return-1}if(null!=t.texture&&null!=e.texture){if(t.texture.id<e.texture.id)return-1;if(t.texture.id>e.texture.id)return 1}else{if(null!=t.texture&&null==e.texture)return 1;if(null==t.texture&&null!=e.texture)return-1}var i=t.primitive_type,s=e.primitive_type;if(s>i)return-1;if(i>s)return 1;if(t.clip!=e.clip){if(0==t.clip&&1==e.clip)return 1;if(1==t.clip&&0==e.clip)return-1}return t.timestamp<e.timestamp?-1:t.timestamp>=e.timestamp?1:t.sequence<e.sequence?-1:t.sequence>e.sequence?1:1},list_geometry:function(){for(var t=new ji(this.geometry);null==t.current||null==t.rightest?!1:t.tree.compare(t.current.key,t.rightest.key)<=0;){t.next()}},__class__:Zs,__properties__:{set_layer:"set_layer"}};var Ks={};r["phoenix._Batcher.PrimitiveType_Impl_"]=Ks,Ks.__name__=["phoenix","_Batcher","PrimitiveType_Impl_"],Ks.toString=function(t){switch(t){case 3:return"line_strip";case 2:return"line_loop";case 1:return"lines";case 5:return"triangle_strip";case 4:return"triangles";case 6:return"triangle_fan";case 0:return"points";default:return""+t}};var Qs=function(t){if(null==t)throw new Ie(ei.null_assertion("_options was null"));if(t.resource_type=6,Ni.call(this,t),this.texture_path=null!=t.texture_path?t.texture_path:we.directory(this.id),this.pages=new _e,null!=t.pages&&null==t.font_data)throw new Ie(ei.null_assertion("_options.font_data was null ( BitmapFont create from pages + font_data requires both of those options )"));if(null!=t.font_data){if(null==t.pages)throw new Ie(ei.null_assertion("_options.pages was null ( BitmapFont create from pages + font_data requires both of those options )"));this.set_info(Mi.parse(t.font_data)),this.apply_pages(t.pages)}};r["phoenix.BitmapFont"]=Qs,Qs.__name__=["phoenix","BitmapFont"],Qs.__super__=Ni,Qs.prototype=i(Ni.prototype,{kerning:function(t,e){var i=this.info.kernings.h[t];return null!=i&&i.h.hasOwnProperty(e)?i.h[e]:0},wrap_string_to_bounds:function(t,e,i,s){null==s&&(s=0),null==i&&(i=1);var n=this;if(null==e)return t;for(var r=0,o=0,l="",a=n.width_of(" ",i,s,null),h=t.split(" "),_=h.length,u=0;u<h.length;){var c=h[u];if(++u,-1==Os.uIndexOf(c,"\n",null)){""==c&&(c=" ");var d=n.width_of(c,i,s,null);r+d>e.w&&(r=0,l+="\n"),r+=d,l+=c}else for(var f=0,p=c.split("\n"),g=0;g<p.length;){var m=p[g];if(++g,""!=m){var v=n.width_of(m,i,s,null);r+v>e.w&&(r=0,l+="\n"),r+=v,l+=m}else r=0;f<p.length-1&&(l+="\n",r=0),f++}_-1>o&&(l+=" ",r+=a+s),o++}return l},width_of_line:function(t,e,i){null==i&&(i=0),null==e&&(e=1);for(var s=0,n=0,r=e/this.info.point_size,o=0,l=Us.codePointCount(t,0,t.length),a=0,h=t,_=0,u=t.length;u>_;){var c;a=_,_+=Gs.codePointWidthAt(h,_),c=Us.codePointAt(h,a);var d=c,f=this.info.chars.h[d];null==f&&(f=this.space_char);var p=(f.xoffset+Math.max(f.width,f.xadvance))*r,g=s+f.xoffset*r,m=f.xadvance;if(l-1>o){var v=Os.uCharCodeAt(t,o+1);m+=this.kerning(d,v),v>=32&&(m+=i)}s+=m*r,n=Math.max(n,g+p),++o}return n},width_of:function(t,e,i,s){null==i&&(i=0),null==e&&(e=1);for(var n=0,r=null!=s,o=Os.uSplit(t,"\n"),l=0;l<o.length;){var a=o[l];++l;var h=this.width_of_line(a,e,i);n=Math.max(n,h),r&&s.push(h)}return n},height_of:function(t,e,i){return null==i&&(i=0),this.height_of_lines(t.split("\n"),e,i)},dimensions_of:function(t,e,i,s,n){null==n&&(n=0),null==s&&(s=0);var r=this.width_of(t,e,s,null),o=this.height_of_lines(t.split("\n"),e,n),l=i.ignore_listeners;return i.ignore_listeners=!0,i.x=r,i._construct?i.x:(null==i.listen_x||i.ignore_listeners||i.listen_x(r),i.x),i.y=o,i._construct?i.y:(null==i.listen_y||i.ignore_listeners||i.listen_y(o),i.y),i.ignore_listeners=l,null==i.listen_x||i.ignore_listeners||i.listen_x(i.x),null==i.listen_y||i.ignore_listeners||i.listen_y(i.y),i},height_of_lines:function(t,e,i){null==i&&(i=0);var s=e/this.info.point_size;return t.length*(this.info.line_height+i)*s},line_height_to_point_size:function(t,e){return null==e&&(e=0),t*(this.info.point_size/(this.info.line_height+e))},clear:function(){this.set_info(null);for(var t=this.pages.keys();t.hasNext();){var e=t.next(),i=this.pages.h[e];i.destroy(),this.pages.remove(e),i=null}},reload:function(){var t=this;if(6==this.state)throw new Ie(ei.assertion("state != ResourceState.destroyed"));return this.clear(),new Un(function(e,i){t.set_state(2);var s=fr.load(m.core.app.assets,t.id);s.then(function(s){if(t.set_info(Mi.parse(s.text)),null==t.info)throw new Ie(ei.null_assertion("info was null"));for(var n=[],r=0,o=t.info.pages;r<o.length;){var l=o[r];++r;var a=we.join([t.texture_path,l.file]),h=t.system.cache.get(a);n.push(null!=h?h.reload():t.system.load_texture(a))}Un.all(n).then(function(i){t.apply_pages(i),t.set_state(3),e(t)}).error(function(e){t.set_state(4),i(e)})}).error(function(e){t.set_state(4),i(e)})})},apply_pages:function(t){for(var e=0,i=0;i<t.length;){var s=t[i];++i,s.slot=e,this.pages.h[e]=s,++e}},set_info:function(t){return this.info=t,null!=this.info&&(this.space_char=this.info.chars.h[32]),this.info},toString:function(){return"BitmapFont("+this.id+")"},__class__:Qs,__properties__:i(Ni.prototype.__properties__,{set_info:"set_info"})});var Xs=r["phoenix.ProjectionType"]={__ename__:["phoenix","ProjectionType"],__constructs__:["ortho","perspective","custom"]};Xs.ortho=["ortho",0],Xs.ortho.toString=o,Xs.ortho.__enum__=Xs,Xs.perspective=["perspective",1],Xs.perspective.toString=o,Xs.perspective.__enum__=Xs,Xs.custom=["custom",2],Xs.custom.toString=o,Xs.custom.__enum__=Xs;var Ws=function(t){this._refresh_pos=!1,this._setup=!0,this.look_at_dirty=!0,this.projection_dirty=!0,this.transform_dirty=!0,this.minimum_zoom=.01,this.aspect=1.5,this.fov_type=Ys.horizontal,this.fov=60,this.far=-1e3,this.near=1e3,this.zoom=1,this.name="camera",this.transform=new gn,this.options=t,null==this.options&&(this.options=this.default_camera_options()),this.options,null!=this.options.camera_name&&(this.name=this.options.camera_name),this.projection=null!=this.options.projection?this.options.projection:Xs.ortho,this.set_center(new y(m.core.screen.get_w()/2,m.core.screen.get_h()/2)),this.set_pos(new y),this.set_viewport(null!=this.options.viewport?this.options.viewport:new on(0,0,m.core.screen.get_w(),m.core.screen.get_h())),this.up=new y(0,1,0),this.projection_matrix=new sn,this.view_matrix=new sn,this.view_matrix_inverse=new sn,this.look_at_matrix=new sn,this.transform.listen(n(this,this.on_transform_cleaned));var e=this.projection;switch(e[1]){case 0:this.set_ortho(this.options);break;case 1:this.set_perspective(this.options);break;case 2:}this.process(),this._setup=!1};r["phoenix.Camera"]=Ws,Ws.__name__=["phoenix","Camera"],Ws.prototype={set_ortho:function(t){this.projection=Xs.ortho,this._merge_options(t)},set_perspective:function(t){this.projection=Xs.perspective,this._merge_options(t);var e=this.transform.origin,i=e.ignore_listeners;e.ignore_listeners=!0,e.x=0,e._construct?e.x:(null==e.listen_x||e.ignore_listeners||e.listen_x(0),e.x),e.y=0,e._construct?e.y:(null==e.listen_y||e.ignore_listeners||e.listen_y(0),e.y),e.z=0,e._construct?e.z:(null==e.listen_z||e.ignore_listeners||e.listen_z(0),e.z),e.ignore_listeners=i,null==e.listen_x||e.ignore_listeners||e.listen_x(e.x),null==e.listen_y||e.ignore_listeners||e.listen_y(e.y),null==e.listen_z||e.ignore_listeners||e.listen_z(e.z)},project:function(t){this.update_view_matrix();var e=(new sn).multiplyMatrices(this.projection_matrix,this.view_matrix_inverse);return new y(t.x,t.y,t.z,t.w).applyProjection(e)},unproject:function(t){this.update_view_matrix();var e=(new sn).multiplyMatrices(this.projection_matrix,this.view_matrix_inverse);return new y(t.x,t.y,t.z,t.w).applyProjection(e.getInverse(e))},screen_point_to_ray:function(t){return new rn(t,this)},screen_point_to_world:function(t){return this.projection==Xs.ortho?this.ortho_screen_to_world(t):this.projection==Xs.perspective?this.screen_point_to_ray(t).end:this.ortho_screen_to_world(t)},world_point_to_screen:function(t,e){return this.projection==Xs.ortho?this.ortho_world_to_screen(t):this.projection==Xs.perspective?this.persepective_world_to_screen(t,e):this.ortho_world_to_screen(t)},process:function(){null!=this.target&&this.update_look_at(),this.update_projection_matrix(),this.update_view_matrix(),this.apply_state(2884,this.options.cull_backfaces),this.apply_state(2929,this.options.depth_test)},on_transform_cleaned:function(){this.transform_dirty=!0},update_look_at:function(){this.look_at_dirty&&null!=this.target&&(this.look_at_matrix.lookAt(this.target,this.get_pos(),this.up),this.get_rotation().setFromRotationMatrix(this.look_at_matrix))},update_view_matrix:function(){this.view_matrix=this.transform.get_world().get_matrix(),this.transform_dirty&&(this.view_matrix_inverse=this.view_matrix.inverse(),this.view_inverse_arr=this.view_matrix_inverse.float32array(),this.transform_dirty=!1)},update_projection_matrix:function(){if(this.projection_dirty){var t=this.projection;switch(t[1]){case 1:this.projection_matrix.makePerspective(this.fov_y,this.aspect,this.near,this.far);break;case 0:this.projection_matrix.makeOrthographic(0,this.get_viewport().w,0,this.get_viewport().h,this.near,this.far);break;case 2:}this.proj_arr=this.projection_matrix.float32array(),this.projection_dirty=!1}},apply_state:function(t,e){e?m.renderer.state.enable(t):m.renderer.state.disable(t)},apply_default_camera_options:function(){var t=this.projection;switch(t[1]){case 0:this.options.cull_backfaces=!1,this.options.depth_test=!1;break;case 1:this.options.cull_backfaces=!0,this.options.depth_test=!0;break;case 2:}},default_camera_options:function(){return{projection:Xs.ortho,depth_test:!1,cull_backfaces:!1,near:1e3,far:-1e3}},ortho_screen_to_world:function(t){this.update_view_matrix();var e=new y(t.x,t.y,t.z,t.w),i=e.x,s=e.y,n=e.z,r=this.view_matrix.elements,o=r[0]*i+r[4]*s+r[8]*n+r[12],l=r[1]*i+r[5]*s+r[9]*n+r[13],a=r[2]*i+r[6]*s+r[10]*n+r[14],h=e.ignore_listeners;return e.ignore_listeners=!0,e.x=o,e._construct?e.x:(null==e.listen_x||e.ignore_listeners||e.listen_x(o),e.x),e.y=l,e._construct?e.y:(null==e.listen_y||e.ignore_listeners||e.listen_y(l),e.y),e.z=a,e._construct?e.z:(null==e.listen_z||e.ignore_listeners||e.listen_z(a),e.z),e.ignore_listeners=h,null==e.listen_x||e.ignore_listeners||e.listen_x(e.x),null==e.listen_y||e.ignore_listeners||e.listen_y(e.y),null==e.listen_z||e.ignore_listeners||e.listen_z(e.z),e},ortho_world_to_screen:function(t){this.update_view_matrix();var e=new y(t.x,t.y,t.z,t.w),i=e.x,s=e.y,n=e.z,r=this.view_matrix_inverse.elements,o=r[0]*i+r[4]*s+r[8]*n+r[12],l=r[1]*i+r[5]*s+r[9]*n+r[13],a=r[2]*i+r[6]*s+r[10]*n+r[14],h=e.ignore_listeners;return e.ignore_listeners=!0,e.x=o,e._construct?e.x:(null==e.listen_x||e.ignore_listeners||e.listen_x(o),e.x),e.y=l,e._construct?e.y:(null==e.listen_y||e.ignore_listeners||e.listen_y(l),e.y),e.z=a,e._construct?e.z:(null==e.listen_z||e.ignore_listeners||e.listen_z(a),e.z),e.ignore_listeners=h,null==e.listen_x||e.ignore_listeners||e.listen_x(e.x),null==e.listen_y||e.ignore_listeners||e.listen_y(e.y),null==e.listen_z||e.ignore_listeners||e.listen_z(e.z),e},persepective_world_to_screen:function(t,e){null==e&&(e=this.get_viewport());var i=this.project(t),s=e.w/2,n=e.h/2;return new y(i.x*s+s,-(i.y*n)+n)},set_target:function(t){return null!=t&&(this.look_at_dirty=!0),this.target=t},set_fov:function(t){return this.projection_dirty=!0,this.options.fov=t,this.fov_y=this.fov_type==Ys.horizontal?180/Math.PI*2*Math.atan(Math.tan(t*(Math.PI/180)/2)*(1/this.aspect)):t,this.fov=t},set_fov_type:function(t){return this.options.fov_type=t,this.fov_type=t,this.set_fov(this.fov),this.fov_type},set_aspect:function(t){return this.projection_dirty=!0,this.options.aspect=t,this.aspect=t},set_near:function(t){return this.projection_dirty=!0,this.options.near=t,this.near=t},set_far:function(t){return this.projection_dirty=!0,this.options.far=t,this.far=t},set_zoom:function(t){var e=t;e<this.minimum_zoom&&(e=this.minimum_zoom);var i=this.projection;switch(i[1]){case 0:this.transform.local.scale.set_x(1/e),this.transform.local.scale.set_y(1/e),this.transform.local.scale.set_z(1/e);break;case 1:break;case 2:}return this.zoom=e},set_center:function(t){this.center=t;var e=this.projection;switch(e[1]){case 0:this._refresh_pos||this._setup||(this.get_pos().ignore_listeners=!0,this.get_pos().set_x(t.x-this.get_viewport().w/2),this.get_pos().set_y(t.y-this.get_viewport().h/2),this.get_pos().ignore_listeners=!1,this.transform.local.pos.copy_from(t));break;case 1:break;case 2:}return y.Listen(this.get_center(),n(this,this._center_changed)),this.get_center()},get_center:function(){return this.center},get_pos:function(){return this.pos},get_rotation:function(){return this.transform.local.rotation},get_scale:function(){return this.transform.local.scale},get_viewport:function(){return this.viewport},set_viewport:function(t){this.projection_dirty=!0,this.viewport=t;var e=this.projection;switch(e[1]){case 0:this.transform.set_origin(new y(t.w/2,t.h/2)),this.set_pos(this.get_pos());break;case 1:break;case 2:}return this.get_viewport()},set_rotation:function(t){return this.transform.local.set_rotation(t)},set_scale:function(t){return this.transform.local.set_scale(t)},set_pos:function(t){this.pos=t;var e=this.projection;switch(e[1]){case 0:var i=this.get_center().x,s=this.get_center().y;null!=this.get_viewport()&&(i=t.x+this.get_viewport().w/2,s=t.y+this.get_viewport().h/2),this._refresh_pos=!0,this.get_center().ignore_listeners=!0,this.get_center().set_x(i),this.get_center().set_y(s),this.get_center().ignore_listeners=!1,this._refresh_pos=!1,this.transform.local.pos.set_x(i),this.transform.local.pos.set_y(s);break;case 1:this.transform.set_pos(this.get_pos());break;case 2:}return y.Listen(this.get_pos(),n(this,this._pos_changed)),this.get_pos()},_merge_options:function(t){this.apply_default_camera_options(),null!=t.aspect&&(this.options.aspect=t.aspect,this.set_aspect(this.options.aspect)),null!=t.far&&(this.options.far=t.far,this.set_far(this.options.far)),null!=t.fov&&(this.options.fov=t.fov,this.set_fov(this.options.fov)),null!=t.fov_type?(this.options.fov_type=t.fov_type,this.set_fov_type(t.fov_type)):(this.options.fov_type=Ys.horizontal,this.set_fov_type(Ys.horizontal)),null!=t.near&&(this.options.near=t.near,this.set_near(this.options.near)),null!=t.viewport&&(this.options.viewport=t.viewport,this.set_viewport(this.options.viewport)),null!=t.cull_backfaces&&(this.options.cull_backfaces=t.cull_backfaces),null!=t.depth_test&&(this.options.depth_test=t.depth_test)},_pos_changed:function(){this.set_pos(this.get_pos())},_center_changed:function(){this.set_center(this.get_center())},__class__:Ws,__properties__:{set_rotation:"set_rotation",get_rotation:"get_rotation",set_scale:"set_scale",get_scale:"get_scale",set_pos:"set_pos",get_pos:"get_pos",set_target:"set_target",set_aspect:"set_aspect",set_fov_type:"set_fov_type",set_fov:"set_fov",set_far:"set_far",set_near:"set_near",set_zoom:"set_zoom",set_center:"set_center",get_center:"get_center",set_viewport:"set_viewport",get_viewport:"get_viewport"}};var Ys=r["phoenix.FOVType"]={__ename__:["phoenix","FOVType"],__constructs__:["vertical","horizontal"]};Ys.vertical=["vertical",0],Ys.vertical.toString=o,Ys.vertical.__enum__=Ys,Ys.horizontal=["horizontal",1],Ys.horizontal.toString=o,Ys.horizontal.__enum__=Ys;var Js=function(t,e,i){null==i&&(i=0),null==e&&(e=0),null==t&&(t=0),this.x=t,this.y=e,this.r=i};r["phoenix.Circle"]=Js,Js.__name__=["phoenix","Circle"],Js.prototype={toString:function(){return"{ x:"+this.x+", y:"+this.y+", r:"+this.r+" }"},point_inside:function(t){var e=new y(t.x-this.x,t.y-this.y);return Math.sqrt(e.x*e.x+e.y*e.y+e.z*e.z)<=this.r},clone:function(){return new Js(this.x,this.y,this.r)},set:function(t,e,i){var s=this.x,n=this.y,r=this.r;return null!=t&&(s=t),null!=e&&(n=e),null!=i&&(r=i),this.x=s,this.y=n,this.r=r,this},__class__:Js};var $s=function(t,e,i,s){null==s&&(s=1),null==i&&(i=1),null==e&&(e=1),null==t&&(t=0),this.l=1,this.s=1,this.h=0,F.call(this),this.is_hsl=!0,this.set_h(t),this.set_s(e),this.set_l(i),this.a=s,this._refresh()};r["phoenix.ColorHSL"]=$s,$s.__name__=["phoenix","ColorHSL"],$s.__super__=F,$s.prototype=i(F.prototype,{set_h:function(t){return this.h=t,this._refresh(),t},set_s:function(t){return this.s=t,this._refresh(),t},set_l:function(t){return this.l=t,this._refresh(),t},set:function(t,e,i,s){var n=this.h,r=this.s,o=this.l,l=this.a;return null!=t&&(n=t),null!=e&&(r=e),null!=i&&(o=i),null!=s&&(l=s),this.set_h(n),this.set_s(r),this.set_l(o),this.a=l,this._refresh(),this},tween:function(t,e,i){if(null==i&&(i=!0),null==t&&(t=.5),F.prototype.tween.call(this,t,e,i),null!=e){var s=this.h,n=this.s,r=this.l,o=this.a,l=!1,a=!1,h=!1,_=!1;Ee.__instanceof(e,$s)?(s=e.h,n=e.s,r=e.l,o=e.a,l=!0,a=!0,h=!0,_=!0):(null!=e.h&&(s=e.h,l=!0),null!=e.s&&(n=e.s,a=!0),null!=e.l&&(r=e.l,h=!0),null!=e.a&&(o=e.a,_=!0));var u={};return l&&(u.h=s),a&&(u.s=n),h&&(u.l=r),_&&(u.a=o),is.tween(this,t,u,i)}throw new Ie(" Warning: Color.tween passed a null destination ")},_refresh:function(){return this.refreshing=!0,F.prototype.fromColorHSL.call(this,this),this.refreshing=!1,this},clone:function(){return new $s(this.h,this.s,this.l,this.a)},toColor:function(){return this._refresh()},fromColor:function(t){var e=t.maxRGB(),i=t.minRGB(),s=e+i,n=e-i,r=0;e==i?r=0:e==t.r?r=(60*(t.g-t.b)/n+360)%360:e==t.g?r=60*(t.b-t.r)/n+120:e==t.b&&(r=60*(t.r-t.g)/n+240);var o,l=s/2;return o=e==i?0:this.l<=.5?n/s:n/(2-s),this.set_h(r),this.set_s(o),this.set_l(l),this.a=t.a,this},toString:function(){return"{ h:"+this.h+" , s:"+this.s+" , l:"+this.l+" , a:"+this.a+" }"},__class__:$s,__properties__:i(F.prototype.__properties__,{set_l:"set_l",set_s:"set_s",set_h:"set_h"})});var tn=function(t,e,i,s){null==s&&(s=1),null==i&&(i=1),null==e&&(e=0),null==t&&(t=0),this.v=1,this.s=0,this.h=0,F.call(this),this.is_hsv=!0,this.set_h(t),this.set_s(e),this.set_v(i),this.a=s,this._refresh()};r["phoenix.ColorHSV"]=tn,tn.__name__=["phoenix","ColorHSV"],tn.__super__=F,tn.prototype=i(F.prototype,{set_h:function(t){return this.h=t,this._refresh(),t},set_s:function(t){return this.s=t,this._refresh(),this.s},set_v:function(t){return this.v=t,this._refresh(),this.v},set:function(t,e,i,s){var n=this.h,r=this.s,o=this.v,l=this.a;return null!=t&&(n=t),null!=e&&(r=e),null!=i&&(o=i),null!=s&&(l=s),this.set_h(n),this.set_s(r),this.set_v(o),this.a=l,this._refresh(),this},tween:function(t,e,i){if(null==i&&(i=!0),null==t&&(t=.5),F.prototype.tween.call(this,t,e,i),null!=e){var s=this.h,n=this.s,r=this.v,o=this.a,l=!1,a=!1,h=!1,_=!1;Ee.__instanceof(e,tn)?(s=e.h,n=e.s,r=e.v,o=e.a,l=!0,a=!0,h=!0,_=!0):(null!=e.h&&(s=e.h,l=!0),null!=e.s&&(n=e.s,a=!0),null!=e.v&&(r=e.v,h=!0),null!=e.a&&(o=e.a,_=!0));var u={};return l&&(u.h=s),a&&(u.s=n),h&&(u.v=r),_&&(u.a=o),is.tween(this,t,u,i)}throw new Ie(" Warning: Color.tween passed a null destination ")},_refresh:function(){return this.refreshing=!0,F.prototype.fromColorHSV.call(this,this),this.refreshing=!1,this},clone:function(){return new tn(this.h,this.s,this.v,this.a)},toColor:function(){return this._refresh()},toColorHSL:function(){return this._refresh(),F.prototype.toColorHSL.call(this)},fromColorHSL:function(t){return t._refresh(),this.fromColor(t)},fromColor:function(t){var e=t.maxRGB(),i=t.minRGB(),s=e-i,n=0;e==i?n=0:e==t.r?n=(60*(t.g-t.b)/s+360)%360:e==t.g?n=60*(t.b-t.r)/s+120:e==t.b&&(n=60*(t.r-t.g)/s+240);var r;return r=0==e?0:1-i/e,this.set_h(n),this.set_s(r),this.set_v(e),this.a=t.a,this},toString:function(){return"{ h:"+this.h+" , s:"+this.s+" , v:"+this.v+" , a:"+this.a+" }"},__class__:tn,__properties__:i(F.prototype.__properties__,{set_v:"set_v",set_s:"set_s",set_h:"set_h"})});var en=function(t,e,i){this.pos=t,this.rotation=e,this.scale=i};r["phoenix.MatrixTransform"]=en,en.__name__=["phoenix","MatrixTransform"],en.prototype={destroy:function(){this.pos=null,this.rotation=null,this.scale=null},__class__:en};var sn=function(t,e,i,s,n,r,o,l,a,h,_,u,c,d,f,p){null==p&&(p=1),null==f&&(f=0),null==d&&(d=0),null==c&&(c=0),null==u&&(u=0),null==_&&(_=1),null==h&&(h=0),null==a&&(a=0),null==l&&(l=0),null==o&&(o=0),null==r&&(r=1),null==n&&(n=0),null==s&&(s=0),null==i&&(i=0),null==e&&(e=0),null==t&&(t=1),this.M44=1,this.M34=0,this.M24=0,this.M14=0,this.M43=0,this.M33=1,this.M23=0,this.M13=0,this.M42=0,this.M32=0,this.M22=1,this.M12=0,this.M41=0,this.M31=0,this.M21=0,this.M11=1,this.elements=[];for(var g=0;g++<16;)this.elements.push(0);this.set(t,e,i,s,n,r,o,l,a,h,_,u,c,d,f,p);var m,v=this.elements;m=null!=v?new Float32Array(v):null,this._float32array=m};r["phoenix.Matrix"]=sn,sn.__name__=["phoenix","Matrix"],sn.prototype={set:function(t,e,i,s,n,r,o,l,a,h,_,u,c,d,f,p){var g=this.elements;return g[0]=t,g[4]=e,g[8]=i,g[12]=s,g[1]=n,g[5]=r,g[9]=o,g[13]=l,g[2]=a,g[6]=h,g[10]=_,g[14]=u,g[3]=c,g[7]=d,g[11]=f,g[15]=p,this},toString:function(){var t=this.elements,e="{ 11:"+Cs.fixed(t[0],3)+", 12:"+Cs.fixed(t[4],3)+", 13:"+Cs.fixed(t[8],3)+", 14:"+Cs.fixed(t[12],3)+" }, { 21:"+Cs.fixed(t[1],3)+", 22:"+Cs.fixed(t[5],3)+", 23:"+Cs.fixed(t[9],3)+", 24:"+Cs.fixed(t[13],3)+" }, { 31:"+Cs.fixed(t[2],3)+", 32:"+Cs.fixed(t[6],3)+", 33:"+Cs.fixed(t[10],3)+", 34:"+Cs.fixed(t[14],3)+" }, { 41:"+Cs.fixed(t[3],3)+", 42:"+Cs.fixed(t[7],3)+", 43:"+Cs.fixed(t[11],3)+", 44:"+Cs.fixed(t[15],3)+" }";return e},get_M11:function(){return this.elements[0]},get_M12:function(){return this.elements[1]},get_M13:function(){return this.elements[2]},get_M14:function(){return this.elements[3]},get_M21:function(){return this.elements[4]},get_M22:function(){return this.elements[5]},get_M23:function(){return this.elements[6]},get_M24:function(){return this.elements[7]},get_M31:function(){return this.elements[8]},get_M32:function(){return this.elements[9]},get_M33:function(){return this.elements[10]},get_M34:function(){return this.elements[11]},get_M41:function(){return this.elements[12]},get_M42:function(){return this.elements[13]},get_M43:function(){return this.elements[14]},get_M44:function(){return this.elements[15]},set_M11:function(t){return this.elements[0]=t,t},set_M12:function(t){return this.elements[1]=t,t},set_M13:function(t){return this.elements[2]=t,t},set_M14:function(t){return this.elements[3]=t,t},set_M21:function(t){return this.elements[4]=t,t},set_M22:function(t){return this.elements[5]=t,t},set_M23:function(t){return this.elements[6]=t,t},set_M24:function(t){return this.elements[7]=t,t},set_M31:function(t){return this.elements[8]=t,t},set_M32:function(t){return this.elements[9]=t,t},set_M33:function(t){return this.elements[10]=t,t},set_M34:function(t){return this.elements[11]=t,t},set_M41:function(t){return this.elements[12]=t,t},set_M42:function(t){return this.elements[13]=t,t
},set_M43:function(t){return this.elements[14]=t,t},set_M44:function(t){return this.elements[15]=t,t},float32array:function(){for(var t=0;16>t;)this._float32array[t]=this.elements[t],++t;return this._float32array},identity:function(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this},copy:function(t){var e=t.elements;return this.set(e[0],e[4],e[8],e[12],e[1],e[5],e[9],e[13],e[2],e[6],e[10],e[14],e[3],e[7],e[11],e[15]),this},make2D:function(t,e,i,s){null==s&&(s=0),null==i&&(i=1);var n=.017453292519943278*s,r=Math.cos(n),o=Math.sin(n);return this.set(r*i,o*i,0,t,-o*i,r*i,0,e,0,0,1,0,0,0,0,1),this},copyPosition:function(t){return this.elements[12]=t.elements[12],this.elements[13]=t.elements[13],this.elements[14]=t.elements[14],this},getPosition:function(){return new y(this.elements[12],this.elements[13],this.elements[14],1)},extractRotation:function(t){var e=new y,i=t.elements,s=1/function(){var t,s=i[0],n=i[1],r=i[2],o=e.ignore_listeners;return e.ignore_listeners=!0,e.x=s,e._construct?e.x:(null==e.listen_x||e.ignore_listeners||e.listen_x(s),e.x),e.y=n,e._construct?e.y:(null==e.listen_y||e.ignore_listeners||e.listen_y(n),e.y),e.z=r,e._construct?e.z:(null==e.listen_z||e.ignore_listeners||e.listen_z(r),e.z),e.ignore_listeners=o,null==e.listen_x||e.ignore_listeners||e.listen_x(e.x),null==e.listen_y||e.ignore_listeners||e.listen_y(e.y),null==e.listen_z||e.ignore_listeners||e.listen_z(e.z),t=e}(this).get_length(),n=1/function(){var t,s=i[4],n=i[5],r=i[6],o=e.ignore_listeners;return e.ignore_listeners=!0,e.x=s,e._construct?e.x:(null==e.listen_x||e.ignore_listeners||e.listen_x(s),e.x),e.y=n,e._construct?e.y:(null==e.listen_y||e.ignore_listeners||e.listen_y(n),e.y),e.z=r,e._construct?e.z:(null==e.listen_z||e.ignore_listeners||e.listen_z(r),e.z),e.ignore_listeners=o,null==e.listen_x||e.ignore_listeners||e.listen_x(e.x),null==e.listen_y||e.ignore_listeners||e.listen_y(e.y),null==e.listen_z||e.ignore_listeners||e.listen_z(e.z),t=e}(this).get_length(),r=1/function(){var t,s=i[8],n=i[9],r=i[10],o=e.ignore_listeners;return e.ignore_listeners=!0,e.x=s,e._construct?e.x:(null==e.listen_x||e.ignore_listeners||e.listen_x(s),e.x),e.y=n,e._construct?e.y:(null==e.listen_y||e.ignore_listeners||e.listen_y(n),e.y),e.z=r,e._construct?e.z:(null==e.listen_z||e.ignore_listeners||e.listen_z(r),e.z),e.ignore_listeners=o,null==e.listen_x||e.ignore_listeners||e.listen_x(e.x),null==e.listen_y||e.ignore_listeners||e.listen_y(e.y),null==e.listen_z||e.ignore_listeners||e.listen_z(e.z),t=e}(this).get_length();return this.elements[0]=i[0]*s,this.elements[1]=i[1]*s,this.elements[2]=i[2]*s,this.elements[4]=i[4]*n,this.elements[5]=i[5]*n,this.elements[6]=i[6]*n,this.elements[8]=i[8]*r,this.elements[9]=i[9]*r,this.elements[10]=i[10]*r,this},makeRotationFromEuler:function(t,e){null==e&&(e=0);var i=this.elements,s=t.x,n=t.y,r=t.z,o=Math.cos(s),l=Math.sin(s),a=Math.cos(n),h=Math.sin(n),_=Math.cos(r),u=Math.sin(r);if(0==e){var c=o*_,d=o*u,f=l*_,p=l*u;i[0]=a*_,i[4]=-a*u,i[8]=h,i[1]=d+f*h,i[5]=c-p*h,i[9]=-l*a,i[2]=p-c*h,i[6]=f+d*h,i[10]=o*a}else if(1==e){var g=a*_,m=a*u,v=h*_,y=h*u;i[0]=g+y*l,i[4]=v*l-m,i[8]=o*h,i[1]=o*u,i[5]=o*_,i[9]=-l,i[2]=m*l-v,i[6]=y+g*l,i[10]=o*a}else if(2==e){var w=a*_,x=a*u,b=h*_,k=h*u;i[0]=w-k*l,i[4]=-o*u,i[8]=b+x*l,i[1]=x+b*l,i[5]=o*_,i[9]=k-w*l,i[2]=-o*h,i[6]=l,i[10]=o*a}else if(3==e){var z=o*_,S=o*u,T=l*_,A=l*u;i[0]=a*_,i[4]=T*h-S,i[8]=z*h+A,i[1]=a*u,i[5]=A*h+z,i[9]=S*h-T,i[2]=-h,i[6]=l*a,i[10]=o*a}else if(4==e){var I=o*a,E=o*h,M=l*a,C=l*h;i[0]=a*_,i[4]=C-I*u,i[8]=M*u+E,i[1]=u,i[5]=o*_,i[9]=-l*_,i[2]=-h*_,i[6]=E*u+M,i[10]=I-C*u}else if(5==e){var R=o*a,B=o*h,F=l*a,P=l*h;i[0]=a*_,i[4]=-u,i[8]=h*_,i[1]=R*u+P,i[5]=o*_,i[9]=B*u-F,i[2]=F*u-B,i[6]=l*_,i[10]=P*u+R}return i[3]=0,i[7]=0,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,this},makeRotationFromQuaternion:function(t){var e=this.elements,i=t.x+t.x,s=t.y+t.y,n=t.z+t.z,r=t.x*i,o=t.x*s,l=t.x*n,a=t.y*s,h=t.y*n,_=t.z*n,u=t.w*i,c=t.w*s,d=t.w*n;return e[0]=1-(a+_),e[4]=o-d,e[8]=l+c,e[1]=o+d,e[5]=1-(r+_),e[9]=h-u,e[2]=l-c,e[6]=h+u,e[10]=1-(r+a),e[3]=0,e[7]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this},lookAt:function(t,e,i){var s=new y,n=new y,r=new y,o=this.elements;if(r=new y(e.x-t.x,e.y-t.y,e.z-t.z).get_normalized(),0==Math.sqrt(r.x*r.x+r.y*r.y+r.z*r.z)&&(r.z=1,r._construct?r.z:(null==r.listen_z||r.ignore_listeners||r.listen_z(1),r.z)),s=new y(i.y*r.z-i.z*r.y,i.z*r.x-i.x*r.z,i.x*r.y-i.y*r.x).get_normalized(),0==Math.sqrt(s.x*s.x+s.y*s.y+s.z*s.z)){var l=r;l.set_x(l.x+1e-4),s=new y(i.y*r.z-i.z*r.y,i.z*r.x-i.x*r.z,i.x*r.y-i.y*r.x).get_normalized()}return n=new y(r.y*s.z-r.z*s.y,r.z*s.x-r.x*s.z,r.x*s.y-r.y*s.x),o[0]=s.x,o[4]=n.x,o[8]=r.x,o[1]=s.y,o[5]=n.y,o[9]=r.y,o[2]=s.z,o[6]=n.z,o[10]=r.z,this},multiply:function(t){return this.multiplyMatrices(this,t)},multiplyMatrices:function(t,e){var i=t.elements,s=e.elements,n=this.elements,r=i[0],o=i[4],l=i[8],a=i[12],h=i[1],_=i[5],u=i[9],c=i[13],d=i[2],f=i[6],p=i[10],g=i[14],m=i[3],v=i[7],y=i[11],w=i[15],x=s[0],b=s[4],k=s[8],z=s[12],S=s[1],T=s[5],A=s[9],I=s[13],E=s[2],M=s[6],C=s[10],R=s[14],B=s[3],F=s[7],P=s[11],N=s[15];return n[0]=r*x+o*S+l*E+a*B,n[4]=r*b+o*T+l*M+a*F,n[8]=r*k+o*A+l*C+a*P,n[12]=r*z+o*I+l*R+a*N,n[1]=h*x+_*S+u*E+c*B,n[5]=h*b+_*T+u*M+c*F,n[9]=h*k+_*A+u*C+c*P,n[13]=h*z+_*I+u*R+c*N,n[2]=d*x+f*S+p*E+g*B,n[6]=d*b+f*T+p*M+g*F,n[10]=d*k+f*A+p*C+g*P,n[14]=d*z+f*I+p*R+g*N,n[3]=m*x+v*S+y*E+w*B,n[7]=m*b+v*T+y*M+w*F,n[11]=m*k+v*A+y*C+w*P,n[15]=m*z+v*I+y*R+w*N,this},multiplyToArray:function(t,e,i){var s=this.elements;return this.multiplyMatrices(t,e),i[0]=s[0],i[1]=s[1],i[2]=s[2],i[3]=s[3],i[4]=s[4],i[5]=s[5],i[6]=s[6],i[7]=s[7],i[8]=s[8],i[9]=s[9],i[10]=s[10],i[11]=s[11],i[12]=s[12],i[13]=s[13],i[14]=s[14],i[15]=s[15],this},multiplyScalar:function(t){var e=this.elements;return e[0]*=t,e[4]*=t,e[8]*=t,e[12]*=t,e[1]*=t,e[5]*=t,e[9]*=t,e[13]*=t,e[2]*=t,e[6]*=t,e[10]*=t,e[14]*=t,e[3]*=t,e[7]*=t,e[11]*=t,e[15]*=t,this},multiplyVector3Array:function(t){for(var e=new y,i=0,s=t.length;s>i;)e.set_x(t[i]),e.set_y(t[i+1]),e.set_z(t[i+2]),e.applyProjection(this),t[i]=e.x,t[i+1]=e.y,t[i+2]=e.z,i+=3;return t},determinant:function(){var t=this.elements,e=t[0],i=t[4],s=t[8],n=t[12],r=t[1],o=t[5],l=t[9],a=t[13],h=t[2],_=t[6],u=t[10],c=t[14],d=t[3],f=t[7],p=t[11],g=t[15];return d*(n*l*_-s*a*_-n*o*u+i*a*u+s*o*c-i*l*c)+f*(e*l*c-e*a*u+n*r*u-s*r*c+s*a*h-n*l*h)+p*(e*a*_-e*o*c-n*r*_+i*r*c+n*o*h-i*a*h)+g*(-s*o*h-e*l*_+e*o*u+s*r*_-i*r*u+i*l*h)},transpose:function(){var t,e=this.elements;return t=e[1],e[1]=e[4],e[4]=t,t=e[2],e[2]=e[8],e[8]=t,t=e[6],e[6]=e[9],e[9]=t,t=e[3],e[3]=e[12],e[12]=t,t=e[7],e[7]=e[13],e[13]=t,t=e[11],e[11]=e[14],e[14]=t,this},flattenToArray:function(t){if(null==t){t=[];for(var e=0;16>e;){{e++}t.push(0)}}var i=this.elements;return t[0]=i[0],t[1]=i[1],t[2]=i[2],t[3]=i[3],t[4]=i[4],t[5]=i[5],t[6]=i[6],t[7]=i[7],t[8]=i[8],t[9]=i[9],t[10]=i[10],t[11]=i[11],t[12]=i[12],t[13]=i[13],t[14]=i[14],t[15]=i[15],t},flattenToArrayOffset:function(t,e){var i=this.elements;return t[e]=i[0],t[e+1]=i[1],t[e+2]=i[2],t[e+3]=i[3],t[e+4]=i[4],t[e+5]=i[5],t[e+6]=i[6],t[e+7]=i[7],t[e+8]=i[8],t[e+9]=i[9],t[e+10]=i[10],t[e+11]=i[11],t[e+12]=i[12],t[e+13]=i[13],t[e+14]=i[14],t[e+15]=i[15],t},setPosition:function(t){var e=this.elements;return e[12]=t.x,e[13]=t.y,e[14]=t.z,this},inverse:function(){return this.clone().getInverse(this)},getInverse:function(t){var e=this.elements,i=t.elements,s=i[0],n=i[4],r=i[8],o=i[12],l=i[1],a=i[5],h=i[9],_=i[13],u=i[2],c=i[6],d=i[10],f=i[14],p=i[3],g=i[7],m=i[11],v=i[15];e[0]=h*f*g-_*d*g+_*c*m-a*f*m-h*c*v+a*d*v,e[4]=o*d*g-r*f*g-o*c*m+n*f*m+r*c*v-n*d*v,e[8]=r*_*g-o*h*g+o*a*m-n*_*m-r*a*v+n*h*v,e[12]=o*h*c-r*_*c-o*a*d+n*_*d+r*a*f-n*h*f,e[1]=_*d*p-h*f*p-_*u*m+l*f*m+h*u*v-l*d*v,e[5]=r*f*p-o*d*p+o*u*m-s*f*m-r*u*v+s*d*v,e[9]=o*h*p-r*_*p-o*l*m+s*_*m+r*l*v-s*h*v,e[13]=r*_*u-o*h*u+o*l*d-s*_*d-r*l*f+s*h*f,e[2]=a*f*p-_*c*p+_*u*g-l*f*g-a*u*v+l*c*v,e[6]=o*c*p-n*f*p-o*u*g+s*f*g+n*u*v-s*c*v,e[10]=n*_*p-o*a*p+o*l*g-s*_*g-n*l*v+s*a*v,e[14]=o*a*u-n*_*u-o*l*c+s*_*c+n*l*f-s*a*f,e[3]=h*c*p-a*d*p-h*u*g+l*d*g+a*u*m-l*c*m,e[7]=n*d*p-r*c*p+r*u*g-s*d*g-n*u*m+s*c*m,e[11]=r*a*p-n*h*p-r*l*g+s*h*g+n*l*m-s*a*m,e[15]=n*h*u-r*a*u+r*l*c-s*h*c-n*l*d+s*a*d;var y=i[0]*e[0]+i[1]*e[4]+i[2]*e[8]+i[3]*e[12];return 0==y?(this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this):(this.multiplyScalar(1/y),this)},scale:function(t){var e=this.elements,i=t.x,s=t.y,n=t.z;return e[0]*=i,e[4]*=s,e[8]*=n,e[1]*=i,e[5]*=s,e[9]*=n,e[2]*=i,e[6]*=s,e[10]*=n,e[3]*=i,e[7]*=s,e[11]*=n,this},getMaxScaleOnAxis:function(){var t=this.elements,e=t[0]*t[0]+t[1]*t[1]+t[2]*t[2],i=t[4]*t[4]+t[5]*t[5]+t[6]*t[6],s=t[8]*t[8]+t[9]*t[9]+t[10]*t[10];return Math.sqrt(Math.max(e,Math.max(i,s)))},makeTranslation:function(t,e,i){return this.set(1,0,0,t,0,1,0,e,0,0,1,i,0,0,0,1),this},makeRotationX:function(t){var e=Math.cos(t),i=Math.sin(t);return this.set(1,0,0,0,0,e,-i,0,0,i,e,0,0,0,0,1),this},makeRotationY:function(t){var e=Math.cos(t),i=Math.sin(t);return this.set(e,0,i,0,0,1,0,0,-i,0,e,0,0,0,0,1),this},makeRotationZ:function(t){var e=Math.cos(t),i=Math.sin(t);return this.set(e,-i,0,0,i,e,0,0,0,0,1,0,0,0,0,1),this},makeRotationAxis:function(t,e){var i=Math.cos(e),s=Math.sin(e),n=1-i,r=t.x,o=t.y,l=t.z,a=n*r,h=n*o;return this.set(a*r+i,a*o-s*l,a*l+s*o,0,a*o+s*l,h*o+i,h*l-s*r,0,a*l-s*o,h*l+s*r,n*l*l+i,0,0,0,0,1),this},makeScale:function(t,e,i){return this.set(t,0,0,0,0,e,0,0,0,0,i,0,0,0,0,1),this},compose_with_origin:function(t,e,i,s){return this.set(1,0,0,e.x,0,1,0,e.y,0,0,1,e.z,0,0,0,1),this.scale(s),this.multiply((new sn).makeRotationFromQuaternion(i)),this.multiply((new sn).makeTranslation(-e.x,-e.y,-e.z)),this.multiply((new sn).makeTranslation(t.x,t.y,t.z)),this},compose:function(t,e,i){return this.makeRotationFromQuaternion(e),this.scale(i),this.setPosition(t),this},decompose:function(t,e,i){var s=this.elements,n=new sn,r=s[0],o=s[1],l=s[2],a=s[4],h=s[5],_=s[6],u=s[8],c=s[9],d=s[10],f=Math.sqrt(r*r+o*o+l*l),p=Math.sqrt(a*a+h*h+_*_),g=Math.sqrt(u*u+c*c+d*d);null==e&&(e=new nn),null==t?t=new y(s[12],s[13],s[14]):(t.set_x(s[12]),t.set_y(s[13]),t.set_z(s[14])),null==i?i=new y(f,p,g):(i.x=f,i._construct?i.x:(null==i.listen_x||i.ignore_listeners||i.listen_x(f),i.x),i.y=p,i._construct?i.y:(null==i.listen_y||i.ignore_listeners||i.listen_y(p),i.y),i.z=g,i._construct?i.z:(null==i.listen_z||i.ignore_listeners||i.listen_z(g),i.z)),n.elements=this.elements.concat([]);var m=n.elements;return m[0]/=f,m[1]/=f,m[2]/=f,m[4]/=p,m[5]/=p,m[6]/=p,m[8]/=g,m[9]/=g,m[10]/=g,e.setFromRotationMatrix(n),null==this._transform?this._transform=new en(t,e,i):(this._transform.pos=t,this._transform.rotation=e,this._transform.scale=i),this._transform},makeFrustum:function(t,e,i,s,n,r){var o=this.elements,l=2*n/(e-t),a=2*n/(s-i),h=(e+t)/(e-t),_=(s+i)/(s-i),u=-(r+n)/(r-n),c=-2*r*n/(r-n);return o[0]=l,o[4]=0,o[8]=h,o[12]=0,o[1]=0,o[5]=a,o[9]=_,o[13]=0,o[2]=0,o[6]=0,o[10]=u,o[14]=c,o[3]=0,o[7]=0,o[11]=-1,o[15]=0,this},makePerspective:function(t,e,i,s){var n=i*Math.tan(.5*t*.017453292519943278),r=-n,o=r*e,l=n*e;return this.makeFrustum(o,l,r,n,i,s)},makeOrthographic:function(t,e,i,s,n,r){var o=this.elements,l=e-t,a=i-s,h=r-n,_=(e+t)/l,u=(i+s)/a,c=(r+n)/h;return o[0]=2/l,o[4]=0,o[8]=0,o[12]=-_,o[1]=0,o[5]=2/a,o[9]=0,o[13]=-u,o[2]=0,o[6]=0,o[10]=-2/h,o[14]=-c,o[3]=0,o[7]=0,o[11]=0,o[15]=1,this},fromArray:function(t){this.elements=t.concat([])},toArray:function(){var t=this.elements;return[t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8],t[9],t[10],t[11],t[12],t[13],t[14],t[15]]},clone:function(){var t=this.elements;return new sn(t[0],t[4],t[8],t[12],t[1],t[5],t[9],t[13],t[2],t[6],t[10],t[14],t[3],t[7],t[11],t[15])},up:function(){return new y(this.elements[4],this.elements[5],this.elements[10])},down:function(){return new y(this.elements[4],this.elements[5],this.elements[10]).get_inverted()},left:function(){return new y(this.elements[0],this.elements[1],this.elements[2]).get_inverted()},right:function(){return new y(this.elements[0],this.elements[1],this.elements[2])},backward:function(){return new y(this.elements[8],this.elements[9],this.elements[10])},forward:function(){return new y(this.elements[8],this.elements[9],this.elements[10]).get_inverted()},__class__:sn,__properties__:{set_M44:"set_M44",get_M44:"get_M44",set_M34:"set_M34",get_M34:"get_M34",set_M24:"set_M24",get_M24:"get_M24",set_M14:"set_M14",get_M14:"get_M14",set_M43:"set_M43",get_M43:"get_M43",set_M33:"set_M33",get_M33:"get_M33",set_M23:"set_M23",get_M23:"get_M23",set_M13:"set_M13",get_M13:"get_M13",set_M42:"set_M42",get_M42:"get_M42",set_M32:"set_M32",get_M32:"get_M32",set_M22:"set_M22",get_M22:"get_M22",set_M12:"set_M12",get_M12:"get_M12",set_M41:"set_M41",get_M41:"get_M41",set_M31:"set_M31",get_M31:"get_M31",set_M21:"set_M21",get_M21:"get_M21",set_M11:"set_M11",get_M11:"get_M11"}};var nn=function(t,e,i,s){null==s&&(s=1),null==i&&(i=0),null==e&&(e=0),null==t&&(t=0),this.ignore_euler=!1,this._construct=!1,this.ignore_listeners=!1,this.w=0,this.z=0,this.y=0,this.x=0,this._construct=!0,this.x=t,this._construct?this.x:(null==this.euler||this.ignore_euler||this._construct||this.euler.setEulerFromQuaternion(this,null),null==this.listen_x||this.ignore_listeners||this.listen_x(this.x),this.x),this.y=e,this._construct?this.y:(null==this.euler||this.ignore_euler||this._construct||this.euler.setEulerFromQuaternion(this,null),null==this.listen_y||this.ignore_listeners||this.listen_y(this.y),this.y),this.z=i,this._construct?this.z:(null==this.euler||this.ignore_euler||this._construct||this.euler.setEulerFromQuaternion(this,null),null==this.listen_z||this.ignore_listeners||this.listen_z(this.z),this.z),this.w=s,this._construct?this.w:(null==this.euler||this.ignore_euler||this._construct||this.euler.setEulerFromQuaternion(this,null),null==this.listen_w||this.ignore_listeners||this.listen_w(this.w),this.w),this.euler=new y,this._construct=!1};r["phoenix.Quaternion"]=nn,nn.__name__=["phoenix","Quaternion"],nn.Add=function(t,e){return t.clone().add(e)},nn.Multiply=function(t,e){return t.clone().multiply(e)},nn.MultiplyScalar=function(t,e){return t.clone().multiplyScalar(e)},nn.Slerp=function(t,e,i,s){return i.copy(t).slerp(e,s)},nn.Dot=function(t,e){return new nn(t.x,t.y,t.z,t.w).dot(e)},nn.Listen=function(t,e){t.listen_x=e,t.listen_y=e,t.listen_z=e,t.listen_w=e},nn.prototype={toString:function(){return"{ x:"+this.x+", y:"+this.y+", z:"+this.z+", w:"+this.w+" }"},set:function(t,e,i,s){return this.ignore_euler=!0,this.x=t,this._construct?this.x:(null==this.euler||this.ignore_euler||this._construct||this.euler.setEulerFromQuaternion(this,null),null==this.listen_x||this.ignore_listeners||this.listen_x(this.x),this.x),this.y=e,this._construct?this.y:(null==this.euler||this.ignore_euler||this._construct||this.euler.setEulerFromQuaternion(this,null),null==this.listen_y||this.ignore_listeners||this.listen_y(this.y),this.y),this.z=i,this._construct?this.z:(null==this.euler||this.ignore_euler||this._construct||this.euler.setEulerFromQuaternion(this,null),null==this.listen_z||this.ignore_listeners||this.listen_z(this.z),this.z),this.w=s,this._construct?this.w:(null==this.euler||this.ignore_euler||this._construct||this.euler.setEulerFromQuaternion(this,null),null==this.listen_w||this.ignore_listeners||this.listen_w(this.w),this.w),this.ignore_euler=!1,null==this.euler||this.ignore_euler||this._construct||this.euler.setEulerFromQuaternion(this,null),null==this.listen_x||this.ignore_listeners||this.listen_x(this.x),null==this.listen_y||this.ignore_listeners||this.listen_y(this.y),null==this.listen_z||this.ignore_listeners||this.listen_z(this.z),null==this.listen_w||this.ignore_listeners||this.listen_w(this.w),this},copy:function(t){return this.ignore_euler=!0,this.x=t.x,this._construct?this.x:(null==this.euler||this.ignore_euler||this._construct||this.euler.setEulerFromQuaternion(this,null),null==this.listen_x||this.ignore_listeners||this.listen_x(this.x),this.x),this.y=t.y,this._construct?this.y:(null==this.euler||this.ignore_euler||this._construct||this.euler.setEulerFromQuaternion(this,null),null==this.listen_y||this.ignore_listeners||this.listen_y(this.y),this.y),this.z=t.z,this._construct?this.z:(null==this.euler||this.ignore_euler||this._construct||this.euler.setEulerFromQuaternion(this,null),null==this.listen_z||this.ignore_listeners||this.listen_z(this.z),this.z),this.w=t.w,this._construct?this.w:(null==this.euler||this.ignore_euler||this._construct||this.euler.setEulerFromQuaternion(this,null),null==this.listen_w||this.ignore_listeners||this.listen_w(this.w),this.w),this.ignore_euler=!1,null==this.euler||this.ignore_euler||this._construct||this.euler.setEulerFromQuaternion(this,null),null==this.listen_x||this.ignore_listeners||this.listen_x(this.x),null==this.listen_y||this.ignore_listeners||this.listen_y(this.y),null==this.listen_z||this.ignore_listeners||this.listen_z(this.z),null==this.listen_w||this.ignore_listeners||this.listen_w(this.w),this},dot:function(t){return this.x*t.x+this.y*t.y+this.z*t.z+this.w*t.w},setFromEuler:function(t,e){null==e&&(e=0);var i=this.x,s=this.y,n=this.z,r=this.w,o=Math.cos(t.x/2),l=Math.cos(t.y/2),a=Math.cos(t.z/2),h=Math.sin(t.x/2),_=Math.sin(t.y/2),u=Math.sin(t.z/2);return 0==e?(i=h*l*a+o*_*u,s=o*_*a-h*l*u,n=o*l*u+h*_*a,r=o*l*a-h*_*u):1==e?(i=h*l*a+o*_*u,s=o*_*a-h*l*u,n=o*l*u-h*_*a,r=o*l*a+h*_*u):2==e?(i=h*l*a-o*_*u,s=o*_*a+h*l*u,n=o*l*u+h*_*a,r=o*l*a-h*_*u):3==e?(i=h*l*a-o*_*u,s=o*_*a+h*l*u,n=o*l*u-h*_*a,r=o*l*a+h*_*u):4==e?(i=h*l*a+o*_*u,s=o*_*a+h*l*u,n=o*l*u-h*_*a,r=o*l*a-h*_*u):5==e&&(i=h*l*a-o*_*u,s=o*_*a-h*l*u,n=o*l*u+h*_*a,r=o*l*a+h*_*u),this.ignore_euler=!0,this.x=i,this._construct?this.x:(null==this.euler||this.ignore_euler||this._construct||this.euler.setEulerFromQuaternion(this,null),null==this.listen_x||this.ignore_listeners||this.listen_x(this.x),this.x),this.y=s,this._construct?this.y:(null==this.euler||this.ignore_euler||this._construct||this.euler.setEulerFromQuaternion(this,null),null==this.listen_y||this.ignore_listeners||this.listen_y(this.y),this.y),this.z=n,this._construct?this.z:(null==this.euler||this.ignore_euler||this._construct||this.euler.setEulerFromQuaternion(this,null),null==this.listen_z||this.ignore_listeners||this.listen_z(this.z),this.z),this.w=r,this._construct?this.w:(null==this.euler||this.ignore_euler||this._construct||this.euler.setEulerFromQuaternion(this,null),null==this.listen_w||this.ignore_listeners||this.listen_w(this.w),this.w),this.ignore_euler=!1,null==this.euler||this.ignore_euler||this._construct||this.euler.setEulerFromQuaternion(this,null),null==this.listen_x||this.ignore_listeners||this.listen_x(this.x),null==this.listen_y||this.ignore_listeners||this.listen_y(this.y),null==this.listen_z||this.ignore_listeners||this.listen_z(this.z),null==this.listen_w||this.ignore_listeners||this.listen_w(this.w),this},setFromAxisAngle:function(t,e){var i=e/2,s=Math.sin(i);return this.set_xyzw(t.x*s,t.y*s,t.z*s,Math.cos(i)),this},setFromRotationMatrix:function(t){var e,i=t.elements,s=i[0],n=i[4],r=i[8],o=i[1],l=i[5],a=i[9],h=i[2],_=i[6],u=i[10],c=this.x,d=this.y,f=this.z,p=this.w,g=s+l+u;return g>0?(e=.5/Math.sqrt(g+1),p=.25/e,c=(_-a)*e,d=(r-h)*e,f=(o-n)*e):s>l&&s>u?(e=2*Math.sqrt(1+s-l-u),p=(_-a)/e,c=.25*e,d=(n+o)/e,f=(r+h)/e):l>u?(e=2*Math.sqrt(1+l-s-u),p=(r-h)/e,c=(n+o)/e,d=.25*e,f=(a+_)/e):(e=2*Math.sqrt(1+u-s-l),p=(o-n)/e,c=(r+h)/e,d=(a+_)/e,f=.25*e),this.ignore_euler=!0,this.x=c,this._construct?this.x:(null==this.euler||this.ignore_euler||this._construct||this.euler.setEulerFromQuaternion(this,null),null==this.listen_x||this.ignore_listeners||this.listen_x(this.x),this.x),this.y=d,this._construct?this.y:(null==this.euler||this.ignore_euler||this._construct||this.euler.setEulerFromQuaternion(this,null),null==this.listen_y||this.ignore_listeners||this.listen_y(this.y),this.y),this.z=f,this._construct?this.z:(null==this.euler||this.ignore_euler||this._construct||this.euler.setEulerFromQuaternion(this,null),null==this.listen_z||this.ignore_listeners||this.listen_z(this.z),this.z),this.w=p,this._construct?this.w:(null==this.euler||this.ignore_euler||this._construct||this.euler.setEulerFromQuaternion(this,null),null==this.listen_w||this.ignore_listeners||this.listen_w(this.w),this.w),this.ignore_euler=!1,null==this.euler||this.ignore_euler||this._construct||this.euler.setEulerFromQuaternion(this,null),null==this.listen_x||this.ignore_listeners||this.listen_x(this.x),null==this.listen_y||this.ignore_listeners||this.listen_y(this.y),null==this.listen_z||this.ignore_listeners||this.listen_z(this.z),null==this.listen_w||this.ignore_listeners||this.listen_w(this.w),this},inverse:function(){return this.conjugate().normalize()},conjugate:function(){return this.ignore_euler=!0,this.x=-1*this.x,this._construct?this.x:(null==this.euler||this.ignore_euler||this._construct||this.euler.setEulerFromQuaternion(this,null),null==this.listen_x||this.ignore_listeners||this.listen_x(this.x),this.x),this.y=-1*this.y,this._construct?this.y:(null==this.euler||this.ignore_euler||this._construct||this.euler.setEulerFromQuaternion(this,null),null==this.listen_y||this.ignore_listeners||this.listen_y(this.y),this.y),this.z=-1*this.z,this._construct?this.z:(null==this.euler||this.ignore_euler||this._construct||this.euler.setEulerFromQuaternion(this,null),null==this.listen_z||this.ignore_listeners||this.listen_z(this.z),this.z),this.ignore_euler=!1,null==this.euler||this.ignore_euler||this._construct||this.euler.setEulerFromQuaternion(this,null),null==this.listen_x||this.ignore_listeners||this.listen_x(this.x),null==this.listen_y||this.ignore_listeners||this.listen_y(this.y),null==this.listen_z||this.ignore_listeners||this.listen_z(this.z),this},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},normalize:function(){var t=this.length();return 0==t?(this.ignore_euler=!0,this.x=0,this._construct?this.x:(null==this.euler||this.ignore_euler||this._construct||this.euler.setEulerFromQuaternion(this,null),null==this.listen_x||this.ignore_listeners||this.listen_x(this.x),this.x),this.y=0,this._construct?this.y:(null==this.euler||this.ignore_euler||this._construct||this.euler.setEulerFromQuaternion(this,null),null==this.listen_y||this.ignore_listeners||this.listen_y(this.y),this.y),this.z=0,this._construct?this.z:(null==this.euler||this.ignore_euler||this._construct||this.euler.setEulerFromQuaternion(this,null),null==this.listen_z||this.ignore_listeners||this.listen_z(this.z),this.z),this.w=1,this._construct?this.w:(null==this.euler||this.ignore_euler||this._construct||this.euler.setEulerFromQuaternion(this,null),null==this.listen_w||this.ignore_listeners||this.listen_w(this.w),this.w),this.ignore_euler=!1,null==this.euler||this.ignore_euler||this._construct||this.euler.setEulerFromQuaternion(this,null),null==this.listen_x||this.ignore_listeners||this.listen_x(this.x),null==this.listen_y||this.ignore_listeners||this.listen_y(this.y),null==this.listen_z||this.ignore_listeners||this.listen_z(this.z),null==this.listen_w||this.ignore_listeners||this.listen_w(this.w)):(t=1/t,this.ignore_euler=!0,this.x=this.x*t,this._construct?this.x:(null==this.euler||this.ignore_euler||this._construct||this.euler.setEulerFromQuaternion(this,null),null==this.listen_x||this.ignore_listeners||this.listen_x(this.x),this.x),this.y=this.y*t,this._construct?this.y:(null==this.euler||this.ignore_euler||this._construct||this.euler.setEulerFromQuaternion(this,null),null==this.listen_y||this.ignore_listeners||this.listen_y(this.y),this.y),this.z=this.z*t,this._construct?this.z:(null==this.euler||this.ignore_euler||this._construct||this.euler.setEulerFromQuaternion(this,null),null==this.listen_z||this.ignore_listeners||this.listen_z(this.z),this.z),this.w=this.w*t,this._construct?this.w:(null==this.euler||this.ignore_euler||this._construct||this.euler.setEulerFromQuaternion(this,null),null==this.listen_w||this.ignore_listeners||this.listen_w(this.w),this.w),this.ignore_euler=!1,null==this.euler||this.ignore_euler||this._construct||this.euler.setEulerFromQuaternion(this,null),null==this.listen_x||this.ignore_listeners||this.listen_x(this.x),null==this.listen_y||this.ignore_listeners||this.listen_y(this.y),null==this.listen_z||this.ignore_listeners||this.listen_z(this.z),null==this.listen_w||this.ignore_listeners||this.listen_w(this.w)),this},multiply:function(t){return this.multiplyQuaternions(this,t)},add:function(t){return this.addQuaternions(this,t)},addQuaternions:function(t,e){return this.x=t.x+e.x,this._construct?this.x:(null==this.euler||this.ignore_euler||this._construct||this.euler.setEulerFromQuaternion(this,null),null==this.listen_x||this.ignore_listeners||this.listen_x(this.x),this.x),this.y=t.y+e.y,this._construct?this.y:(null==this.euler||this.ignore_euler||this._construct||this.euler.setEulerFromQuaternion(this,null),null==this.listen_y||this.ignore_listeners||this.listen_y(this.y),this.y),this.z=t.z+e.z,this._construct?this.z:(null==this.euler||this.ignore_euler||this._construct||this.euler.setEulerFromQuaternion(this,null),null==this.listen_z||this.ignore_listeners||this.listen_z(this.z),this.z),this.w=t.w+e.w,this._construct?this.w:(null==this.euler||this.ignore_euler||this._construct||this.euler.setEulerFromQuaternion(this,null),null==this.listen_w||this.ignore_listeners||this.listen_w(this.w),this.w),this},multiplyScalar:function(t){var e=this;e.x=e.x*t,e._construct?e.x:(null==e.euler||e.ignore_euler||e._construct||e.euler.setEulerFromQuaternion(e,null),null==e.listen_x||e.ignore_listeners||e.listen_x(e.x),e.x);var i=this;i.y=i.y*t,i._construct?i.y:(null==i.euler||i.ignore_euler||i._construct||i.euler.setEulerFromQuaternion(i,null),null==i.listen_y||i.ignore_listeners||i.listen_y(i.y),i.y);var s=this;s.z=s.z*t,s._construct?s.z:(null==s.euler||s.ignore_euler||s._construct||s.euler.setEulerFromQuaternion(s,null),null==s.listen_z||s.ignore_listeners||s.listen_z(s.z),s.z);var n=this;return n.w=n.w*t,n._construct?n.w:(null==n.euler||n.ignore_euler||n._construct||n.euler.setEulerFromQuaternion(n,null),null==n.listen_w||n.ignore_listeners||n.listen_w(n.w),n.w),this},multiplyQuaternions:function(t,e){var i=t.x,s=t.y,n=t.z,r=t.w,o=e.x,l=e.y,a=e.z,h=e.w;return this.ignore_euler=!0,this.x=i*h+r*o+s*a-n*l,this._construct?this.x:(null==this.euler||this.ignore_euler||this._construct||this.euler.setEulerFromQuaternion(this,null),null==this.listen_x||this.ignore_listeners||this.listen_x(this.x),this.x),this.y=s*h+r*l+n*o-i*a,this._construct?this.y:(null==this.euler||this.ignore_euler||this._construct||this.euler.setEulerFromQuaternion(this,null),null==this.listen_y||this.ignore_listeners||this.listen_y(this.y),this.y),this.z=n*h+r*a+i*l-s*o,this._construct?this.z:(null==this.euler||this.ignore_euler||this._construct||this.euler.setEulerFromQuaternion(this,null),null==this.listen_z||this.ignore_listeners||this.listen_z(this.z),this.z),this.w=r*h-i*o-s*l-n*a,this._construct?this.w:(null==this.euler||this.ignore_euler||this._construct||this.euler.setEulerFromQuaternion(this,null),null==this.listen_w||this.ignore_listeners||this.listen_w(this.w),this.w),this.ignore_euler=!1,null==this.euler||this.ignore_euler||this._construct||this.euler.setEulerFromQuaternion(this,null),null==this.listen_x||this.ignore_listeners||this.listen_x(this.x),null==this.listen_y||this.ignore_listeners||this.listen_y(this.y),null==this.listen_z||this.ignore_listeners||this.listen_z(this.z),null==this.listen_w||this.ignore_listeners||this.listen_w(this.w),this},slerp:function(t,e){var i=this.x,s=this.y,n=this.z,r=this.w,o=r*t.w+i*t.x+s*t.y+n*t.z;if(0>o?(this.w=-t.w,this._construct?this.w:(null==this.euler||this.ignore_euler||this._construct||this.euler.setEulerFromQuaternion(this,null),null==this.listen_w||this.ignore_listeners||this.listen_w(this.w),this.w),this.x=-t.x,this._construct?this.x:(null==this.euler||this.ignore_euler||this._construct||this.euler.setEulerFromQuaternion(this,null),null==this.listen_x||this.ignore_listeners||this.listen_x(this.x),this.x),this.y=-t.y,this._construct?this.y:(null==this.euler||this.ignore_euler||this._construct||this.euler.setEulerFromQuaternion(this,null),null==this.listen_y||this.ignore_listeners||this.listen_y(this.y),this.y),this.z=-t.z,this._construct?this.z:(null==this.euler||this.ignore_euler||this._construct||this.euler.setEulerFromQuaternion(this,null),null==this.listen_z||this.ignore_listeners||this.listen_z(this.z),this.z),o=-o):this.copy(t),o>=1)return this.ignore_euler=!0,this.x=i,this._construct?this.x:(null==this.euler||this.ignore_euler||this._construct||this.euler.setEulerFromQuaternion(this,null),null==this.listen_x||this.ignore_listeners||this.listen_x(this.x),this.x),this.y=s,this._construct?this.y:(null==this.euler||this.ignore_euler||this._construct||this.euler.setEulerFromQuaternion(this,null),null==this.listen_y||this.ignore_listeners||this.listen_y(this.y),this.y),this.z=n,this._construct?this.z:(null==this.euler||this.ignore_euler||this._construct||this.euler.setEulerFromQuaternion(this,null),null==this.listen_z||this.ignore_listeners||this.listen_z(this.z),this.z),this.w=r,this._construct?this.w:(null==this.euler||this.ignore_euler||this._construct||this.euler.setEulerFromQuaternion(this,null),null==this.listen_w||this.ignore_listeners||this.listen_w(this.w),this.w),this.ignore_euler=!1,null==this.euler||this.ignore_euler||this._construct||this.euler.setEulerFromQuaternion(this,null),null==this.listen_x||this.ignore_listeners||this.listen_x(this.x),null==this.listen_y||this.ignore_listeners||this.listen_y(this.y),null==this.listen_z||this.ignore_listeners||this.listen_z(this.z),null==this.listen_w||this.ignore_listeners||this.listen_w(this.w),this;var l=Math.acos(o),a=Math.sqrt(1-o*o);if(Math.abs(a)<.001)return this.ignore_euler=!0,this.x=.5*(r+this.w),this._construct?this.x:(null==this.euler||this.ignore_euler||this._construct||this.euler.setEulerFromQuaternion(this,null),null==this.listen_x||this.ignore_listeners||this.listen_x(this.x),this.x),this.y=.5*(i+this.x),this._construct?this.y:(null==this.euler||this.ignore_euler||this._construct||this.euler.setEulerFromQuaternion(this,null),null==this.listen_y||this.ignore_listeners||this.listen_y(this.y),this.y),this.z=.5*(s+this.y),this._construct?this.z:(null==this.euler||this.ignore_euler||this._construct||this.euler.setEulerFromQuaternion(this,null),null==this.listen_z||this.ignore_listeners||this.listen_z(this.z),this.z),this.w=.5*(n+this.z),this._construct?this.w:(null==this.euler||this.ignore_euler||this._construct||this.euler.setEulerFromQuaternion(this,null),null==this.listen_w||this.ignore_listeners||this.listen_w(this.w),this.w),this.ignore_euler=!1,null==this.euler||this.ignore_euler||this._construct||this.euler.setEulerFromQuaternion(this,null),null==this.listen_x||this.ignore_listeners||this.listen_x(this.x),null==this.listen_y||this.ignore_listeners||this.listen_y(this.y),null==this.listen_z||this.ignore_listeners||this.listen_z(this.z),null==this.listen_w||this.ignore_listeners||this.listen_w(this.w),this;var h=Math.sin((1-e)*l)/a,_=Math.sin(e*l)/a;return this.ignore_euler=!0,this.x=r*h+this.w*_,this._construct?this.x:(null==this.euler||this.ignore_euler||this._construct||this.euler.setEulerFromQuaternion(this,null),null==this.listen_x||this.ignore_listeners||this.listen_x(this.x),this.x),this.y=i*h+this.x*_,this._construct?this.y:(null==this.euler||this.ignore_euler||this._construct||this.euler.setEulerFromQuaternion(this,null),null==this.listen_y||this.ignore_listeners||this.listen_y(this.y),this.y),this.z=s*h+this.y*_,this._construct?this.z:(null==this.euler||this.ignore_euler||this._construct||this.euler.setEulerFromQuaternion(this,null),null==this.listen_z||this.ignore_listeners||this.listen_z(this.z),this.z),this.w=n*h+this.z*_,this._construct?this.w:(null==this.euler||this.ignore_euler||this._construct||this.euler.setEulerFromQuaternion(this,null),null==this.listen_w||this.ignore_listeners||this.listen_w(this.w),this.w),this.ignore_euler=!1,null==this.euler||this.ignore_euler||this._construct||this.euler.setEulerFromQuaternion(this,null),null==this.listen_x||this.ignore_listeners||this.listen_x(this.x),null==this.listen_y||this.ignore_listeners||this.listen_y(this.y),null==this.listen_z||this.ignore_listeners||this.listen_z(this.z),null==this.listen_w||this.ignore_listeners||this.listen_w(this.w),this
},equals:function(t){return t.x==this.x&&t.y==this.y&&t.z==this.z&&t.w==this.w},fromArray:function(t){return this.ignore_euler=!0,this.x=t[0],this._construct?this.x:(null==this.euler||this.ignore_euler||this._construct||this.euler.setEulerFromQuaternion(this,null),null==this.listen_x||this.ignore_listeners||this.listen_x(this.x),this.x),this.y=t[1],this._construct?this.y:(null==this.euler||this.ignore_euler||this._construct||this.euler.setEulerFromQuaternion(this,null),null==this.listen_y||this.ignore_listeners||this.listen_y(this.y),this.y),this.z=t[2],this._construct?this.z:(null==this.euler||this.ignore_euler||this._construct||this.euler.setEulerFromQuaternion(this,null),null==this.listen_z||this.ignore_listeners||this.listen_z(this.z),this.z),this.w=t[3],this._construct?this.w:(null==this.euler||this.ignore_euler||this._construct||this.euler.setEulerFromQuaternion(this,null),null==this.listen_w||this.ignore_listeners||this.listen_w(this.w),this.w),this.ignore_euler=!1,null==this.euler||this.ignore_euler||this._construct||this.euler.setEulerFromQuaternion(this,null),null==this.listen_x||this.ignore_listeners||this.listen_x(this.x),null==this.listen_y||this.ignore_listeners||this.listen_y(this.y),null==this.listen_z||this.ignore_listeners||this.listen_z(this.z),null==this.listen_w||this.ignore_listeners||this.listen_w(this.w),this},toArray:function(){return[this.x,this.y,this.z,this.w]},clone:function(){return new nn(this.x,this.y,this.z,this.w)},toeuler:function(){return(new y).setEulerFromQuaternion(this,null).degrees()},update_euler:function(){null==this.euler||this.ignore_euler||this._construct||this.euler.setEulerFromQuaternion(this,null)},set_xyzw:function(t,e,i,s){this.ignore_euler=!0,this.x=t,this._construct?this.x:(null==this.euler||this.ignore_euler||this._construct||this.euler.setEulerFromQuaternion(this,null),null==this.listen_x||this.ignore_listeners||this.listen_x(this.x),this.x),this.y=e,this._construct?this.y:(null==this.euler||this.ignore_euler||this._construct||this.euler.setEulerFromQuaternion(this,null),null==this.listen_y||this.ignore_listeners||this.listen_y(this.y),this.y),this.z=i,this._construct?this.z:(null==this.euler||this.ignore_euler||this._construct||this.euler.setEulerFromQuaternion(this,null),null==this.listen_z||this.ignore_listeners||this.listen_z(this.z),this.z),this.w=s,this._construct?this.w:(null==this.euler||this.ignore_euler||this._construct||this.euler.setEulerFromQuaternion(this,null),null==this.listen_w||this.ignore_listeners||this.listen_w(this.w),this.w),this.ignore_euler=!1,null==this.euler||this.ignore_euler||this._construct||this.euler.setEulerFromQuaternion(this,null),null==this.listen_x||this.ignore_listeners||this.listen_x(this.x),null==this.listen_y||this.ignore_listeners||this.listen_y(this.y),null==this.listen_z||this.ignore_listeners||this.listen_z(this.z),null==this.listen_w||this.ignore_listeners||this.listen_w(this.w)},set_xyz:function(t,e,i){this.ignore_euler=!0,this.x=t,this._construct?this.x:(null==this.euler||this.ignore_euler||this._construct||this.euler.setEulerFromQuaternion(this,null),null==this.listen_x||this.ignore_listeners||this.listen_x(this.x),this.x),this.y=e,this._construct?this.y:(null==this.euler||this.ignore_euler||this._construct||this.euler.setEulerFromQuaternion(this,null),null==this.listen_y||this.ignore_listeners||this.listen_y(this.y),this.y),this.z=i,this._construct?this.z:(null==this.euler||this.ignore_euler||this._construct||this.euler.setEulerFromQuaternion(this,null),null==this.listen_z||this.ignore_listeners||this.listen_z(this.z),this.z),this.ignore_euler=!1,null==this.euler||this.ignore_euler||this._construct||this.euler.setEulerFromQuaternion(this,null),null==this.listen_x||this.ignore_listeners||this.listen_x(this.x),null==this.listen_y||this.ignore_listeners||this.listen_y(this.y),null==this.listen_z||this.ignore_listeners||this.listen_z(this.z)},set_x:function(t){return this.x=t,this._construct?this.x:(null==this.euler||this.ignore_euler||this._construct||this.euler.setEulerFromQuaternion(this,null),null==this.listen_x||this.ignore_listeners||this.listen_x(this.x),this.x)},set_y:function(t){return this.y=t,this._construct?this.y:(null==this.euler||this.ignore_euler||this._construct||this.euler.setEulerFromQuaternion(this,null),null==this.listen_y||this.ignore_listeners||this.listen_y(this.y),this.y)},set_z:function(t){return this.z=t,this._construct?this.z:(null==this.euler||this.ignore_euler||this._construct||this.euler.setEulerFromQuaternion(this,null),null==this.listen_z||this.ignore_listeners||this.listen_z(this.z),this.z)},set_w:function(t){return this.w=t,this._construct?this.w:(null==this.euler||this.ignore_euler||this._construct||this.euler.setEulerFromQuaternion(this,null),null==this.listen_w||this.ignore_listeners||this.listen_w(this.w),this.w)},__class__:nn,__properties__:{set_w:"set_w",set_z:"set_z",set_y:"set_y",set_x:"set_x"}};var rn=function(t,e,i){if(null==i&&(i=new on(0,0,m.core.screen.get_w(),m.core.screen.get_h())),null==e)throw new Ie("Camera required for a ray!");this.camera=e,this.viewport=i,this.refresh(t)};r["phoenix.Ray"]=rn,rn.__name__=["phoenix","Ray"],rn.prototype={refresh:function(t){var e=2*(t.x/this.viewport.w-.5),i=2*((this.viewport.h-t.y)/this.viewport.h-.5),s=new y(e,i,0,1),n=new y(e,i,1,1);this.origin=this.camera.unproject(s),this.end=this.camera.unproject(n),this.dir=y.Subtract(this.end,this.origin)},__class__:rn};var on=function(t,e,i,s){null==s&&(s=0),null==i&&(i=0),null==e&&(e=0),null==t&&(t=0),this.ignore_listeners=!1,this.h=0,this.w=0,this.y=0,this.x=0,this.set_x(t),this.set_y(e),this.set_w(i),this.set_h(s)};r["phoenix.Rectangle"]=on,on.__name__=["phoenix","Rectangle"],on.listen=function(t,e){t.listen_x=e,t.listen_y=e,t.listen_w=e,t.listen_h=e},on.prototype={toString:function(){return"{ x:"+this.x+", y:"+this.y+", w:"+this.w+", h:"+this.h+" }"},point_inside:function(t){return t.x<this.x?!1:t.y<this.y?!1:t.x>this.x+this.w?!1:t.y>this.y+this.h?!1:!0},overlaps:function(t){return null==t?!1:this.x<t.x+t.w&&this.y<t.y+t.h&&this.x+this.w>t.x&&this.y+this.h>t.y?!0:!1},clone:function(){return new on(this.x,this.y,this.w,this.h)},equal:function(t){return null==t?!1:this.x==t.x&&this.y==t.y&&this.w==t.w&&this.h==t.h},copy_from:function(t){this.set_x(t.x),this.set_y(t.y),this.set_w(t.w),this.set_h(t.h)},set:function(t,e,i,s){var n=this.x,r=this.y,o=this.w,l=this.h;return null!=t&&(n=t),null!=e&&(r=e),null!=i&&(o=i),null!=s&&(l=s),this.set_x(n),this.set_y(r),this.set_w(o),this.set_h(l),this},set_x:function(t){return this.x=t,null==this.listen_x||this.ignore_listeners||this.listen_x(t),this.x},set_y:function(t){return this.y=t,null==this.listen_y||this.ignore_listeners||this.listen_y(t),this.y},set_w:function(t){return this.w=t,null==this.listen_w||this.ignore_listeners||this.listen_w(t),this.w},set_h:function(t){return this.h=t,null==this.listen_h||this.ignore_listeners||this.listen_h(t),this.h},__class__:on,__properties__:{set_h:"set_h",set_w:"set_w",set_y:"set_y",set_x:"set_x"}};var ln=function(t){this.renderer=t};r["phoenix.RenderPath"]=ln,ln.__name__=["phoenix","RenderPath"],ln.prototype={render:function(t,e){for(var i=0;i<t.length;){var s=t[i];++i,s.enabled&&(m.debug.start("batch."+s.name),s.draw_calls=0,s.vert_count=0,s.emitter.emit(1,s),s.view.process(),s.renderer.state.viewport(s.view.get_viewport().x,s.view.get_viewport().y,s.view.get_viewport().w,s.view.get_viewport().h),s.renderer.logging?s.batch_log(!1):s.batch(!1),s.emitter.emit(2,s),e.geometry_count+=s.geometry.size(),e.dynamic_batched_count+=s.dynamic_batched_count,e.static_batched_count+=s.static_batched_count,e.visible_count+=s.visible_count,e.draw_calls+=s.draw_calls,e.vert_count+=s.vert_count,m.debug.end("batch."+s.name))}},__class__:ln};var an=function(t){this._last_depth_mask=!0,this._last_line_width=1,this._active_texture=-1,this._used_program=null,this._current_rbo=null,this._current_fbo=null,this.depth_func=-1,this.depth_mask=!0,this.depth_test=!1,this.cull_face=!1,this.renderer=t,this._viewport=new on(0,0,0,0)};r["phoenix.RenderState"]=an,an.__name__=["phoenix","RenderState"],an.prototype={enable:function(t){switch(t){case 2884:this.cull_face||(this.cull_face=!0,_r.current_context.enable(2884));break;case 2929:m.core.app.config.render.depth&&(this.depth_test||(this.depth_test=!0,_r.current_context.enable(2929)))}},disable:function(t){switch(t){case 2884:this.cull_face&&(this.cull_face=!1,_r.current_context.disable(2884));break;case 2929:m.core.app.config.render.depth&&this.depth_test&&(this.depth_test=!1,_r.current_context.disable(2929))}},depth_function:function(t){this.depth_func!=t&&(_r.current_context.depthFunc(t),this.depth_func=t)},viewport:function(t,e,i,s){if(this._viewport.x!=t||this._viewport.y!=e||this._viewport.w!=i||this._viewport.h!=s){this._viewport.set_x(t),this._viewport.set_y(e),this._viewport.set_w(i),this._viewport.set_h(s);var n=this.renderer.target_size.y-(e+s);_r.current_context.viewport(0|t,0|n,0|i,0|s)}},bindFramebuffer:function(t){this._current_fbo!=t&&(null==t&&(t=this.renderer.default_fbo),_r.current_context.bindFramebuffer(36160,t),this._current_fbo=t)},bindRenderbuffer:function(t){this._current_rbo!=t&&(null==t&&(t=this.renderer.default_rbo),_r.current_context.bindRenderbuffer(36161,t),this._current_rbo=t)},useProgram:function(t){this._used_program!=t&&(this._used_program=t,_r.current_context.useProgram(t))},activeTexture:function(t){this._active_texture!=t&&(_r.current_context.activeTexture(t),this._active_texture=t)},bindTexture:function(t,e){switch(t){case 3553:this.bindTexture2D(e);break;case 34067:this.bindTextureCube(e)}},bindTexture2D:function(t){an.bound_texture_2D!=t&&(an.bound_texture_2D=t,_r.current_context.bindTexture(3553,t))},bindTextureCube:function(t){an.bound_texture_cube!=t&&(an.bound_texture_cube=t,_r.current_context.bindTexture(34067,t))},lineWidth:function(t){this._last_line_width!=t&&(this._last_line_width=t,_r.current_context.lineWidth(t))},depthMask:function(t){this._last_depth_mask!=t&&(this._last_depth_mask=t,_r.current_context.depthMask(t))},__class__:an};var hn=function(t){if(this.load_premultiply_alpha=!1,this.height=-1,this.width=-1,this.height_actual=-1,this.width_actual=-1,this.compressed=!1,this.border=0,this.slot=0,null==t)throw new Ie(ei.null_assertion("_options was null ( Texture create requires non-null options )"));if(null==t.resource_type&&(t.resource_type=4),t.resource_type,Ni.call(this,t),null==t.texture&&(t.texture=this.create_texture_id()),t.texture,this.texture=t.texture,this.bind(),this.apply_default_options(t),null!=t.pixels){if(null==t.width)throw new Ie(ei.null_assertion("_options.width was null ( Texture create with pixels requires both width and height )"));if(null==t.height)throw new Ie(ei.null_assertion("_options.height was null ( Texture create with pixels requires both width and height )"))}if(null!=t.width||null!=t.height){if(null==t.height)throw new Ie(ei.null_assertion("_options.height was null ( Texture requires both width and height, only width was given in construct options )"));if(null==t.width)throw new Ie(ei.null_assertion("_options.width was null ( Texture requires both width and height, only height was given in construct options )"));this.width=this.width_actual=t.width,this.height=this.height_actual=t.height,null!=t.pixels&&this.submit(t.pixels)}};r["phoenix.Texture"]=hn,hn.__name__=["phoenix","Texture"],hn.max_size=function(){return _r.current_context.getParameter(3379)},hn.dump_asset_info=function(){},hn.type_name=function(t){switch(t){case 3553:return"tex_2D";case 34067:return"tex_cube"}},hn.filter_name=function(t){switch(t){case 9729:return"linear";case 9728:return"nearest";case 9987:return"mip_linear_linear";case 9985:return"mip_linear_nearest";case 9986:return"mip_nearest_linear";case 9984:return"mip_nearest_nearest"}},hn.clamp_name=function(t){switch(t){case 33071:return"edge";case 10497:return"repeat";case 33648:return"mirror"}},hn.__super__=Ni,hn.prototype=i(Ni.prototype,{memory_use:function(){return this.width_actual*this.height_actual*4},fetch:function(t,e,i,s,n){if(null==i&&(i=0),null==e&&(e=0),null==t)throw new Ie(ei.null_assertion("_into was null ( Texture fetch requires a valid buffer to store the pixels. )"));null==e&&(e=0),null==i&&(i=0),null==s&&(s=this.width),null==n&&(n=this.height);var r=s*n*4;if(!(t.length>=r))throw new Ie(ei.assertion("_into.length >= _required"+(" ( "+("Texture fetch requires at least "+r+" (w * h * 4) bytes for the pixels, you have "+t.length+"!")+" )")));var o=_r.current_context.createFramebuffer();if(_r.current_context.bindFramebuffer(36160,o),_r.current_context.framebufferTexture2D(36160,36064,3553,this.texture,0),36053!=_r.current_context.checkFramebufferStatus(36160))throw new Ie(ei.assertion("GL.checkFramebufferStatus(GL.FRAMEBUFFER) == GL.FRAMEBUFFER_COMPLETE"));return _r.current_context.readPixels(e,i,s,n,6408,5121,t),_r.current_context.bindFramebuffer(36160,null),_r.current_context.deleteFramebuffer(o),o=null,t},submit:function(t,e,i){if(null==i&&(i=0),!(i>=0))throw new Ie(ei.assertion("_level >= 0 ( Texture submit level cannot be negative )"));var s=hn.max_size();if(!(this.width_actual<=s))throw new Ie(ei.assertion("width_actual <= _max"+(" ( "+("Texture actual width bigger than maximum hardware size (width:"+this.width_actual+", max:"+s+")")+" )")));if(!(this.height_actual<=s))throw new Ie(ei.assertion("height_actual <= _max"+(" ( "+("Texture actual height bigger than maximum hardware size (height:"+this.height_actual+", max:"+s+")")+" )")));if(this.bind(),3553==this.type)null==e&&(e=3553);else if(null==e)throw new Ie(ei.null_assertion("_target was null ( Texture submit to a non 2D texture requires the _target to be specified )"));this.compressed?_r.current_context.compressedTexImage2D(e,i,this.format,this.width_actual,this.height_actual,this.border,t):_r.current_context.texImage2D(e,i,this.format,this.width_actual,this.height_actual,this.border,this.format,this.data_type,t)},generate_mipmaps:function(){this.bind(),_r.current_context.generateMipmap(this.type)},bind:function(){m.renderer.state.activeTexture(33984+this.slot),m.renderer.state.bindTexture(this.type,this.texture)},reload:function(){var t=this;if(6==this.state)throw new Ie(ei.assertion("state != ResourceState.destroyed ( Resource cannot reload when already destroyed )"));return this.clear(),new Un(function(e,i){t.set_state(2);var s=cr.load(m.core.app.assets,t.id);s.then(function(i){t.texture=t.create_texture_id(),t.from_asset(i),t.set_state(3),e(t)}),s.error(function(e){t.set_state(4),i(e)})})},from_asset:function(t,e){null==e&&(e=!0),this.width=t.image.width,this.height=t.image.height,this.width_actual=t.image.width_actual,this.height_actual=t.image.height_actual,this.load_premultiply_alpha&&m.utils.premultiply_alpha(t.image.pixels),this.submit(t.image.pixels),e&&(t.image.pixels=null,t=null),_r.current_context.texParameteri(this.type,10241,this.filter_min),_r.current_context.texParameteri(this.type,10240,this.filter_mag),_r.current_context.texParameteri(this.type,10242,this.clamp_s),_r.current_context.texParameteri(this.type,10243,this.clamp_t)},clear:function(){null!=this.texture&&_r.current_context.deleteTexture(this.texture)},create_texture_id:function(){return _r.current_context.createTexture()},apply_props:function(){_r.current_context.texParameteri(this.type,10241,this.filter_min),_r.current_context.texParameteri(this.type,10240,this.filter_mag),_r.current_context.texParameteri(this.type,10242,this.clamp_s),_r.current_context.texParameteri(this.type,10243,this.clamp_t)},apply_default_options:function(t){null==t.load_premultiply_alpha&&(t.load_premultiply_alpha=!1),this.load_premultiply_alpha=t.load_premultiply_alpha,null==t.compressed&&(t.compressed=!1),this.compressed=t.compressed,null==t.format&&(t.format=6408),this.format=t.format,null==t.type&&(t.type=3553),this.type=t.type,null==t.data_type&&(t.data_type=5121),this.data_type=t.data_type,this.set_filter_min(function(){var e;return null==t.filter_min&&(t.filter_min=hn.default_filter),e=t.filter_min}(this)),this.set_filter_mag(function(){var e;return null==t.filter_mag&&(t.filter_mag=hn.default_filter),e=t.filter_mag}(this)),this.set_clamp_s(function(){var e;return null==t.clamp_s&&(t.clamp_s=hn.default_clamp),e=t.clamp_s}(this)),this.set_clamp_t(function(){var e;return null==t.clamp_t&&(t.clamp_t=hn.default_clamp),e=t.clamp_t}(this))},set_clamp_s:function(t){return this.bind(),_r.current_context.texParameteri(this.type,10242,t),this.clamp_s=t},set_clamp_t:function(t){return this.bind(),_r.current_context.texParameteri(this.type,10243,t),this.clamp_t=t},set_filter_min:function(t){return this.bind(),_r.current_context.texParameteri(this.type,10241,t),this.filter_min=t},set_filter_mag:function(t){return this.bind(),_r.current_context.texParameteri(this.type,10240,t),this.filter_mag=t},apply_clamp:function(t,e){_r.current_context.texParameteri(this.type,e,t)},apply_filter:function(t,e){_r.current_context.texParameteri(this.type,e,t)},toString:function(){var t=hn.type_name(this.type),e=hn.filter_name(this.filter_min),i=hn.filter_name(this.filter_mag),s=(hn.clamp_name(this.clamp_s),hn.clamp_name(this.clamp_t)),n="filter(min: "+e+", mag:"+i+")",r="clamp(s: "+s+", t: "+s+")",o="size(size: "+this.width+"x"+this.height+", actual: "+this.width_actual+"x"+this.height_actual+")";return"Texture(id: "+this.id+", tex: "+C.string(this.texture)+", type:"+t+", "+o+" "+n+" "+r+" )"},__class__:hn,__properties__:i(Ni.prototype.__properties__,{set_clamp_t:"set_clamp_t",set_clamp_s:"set_clamp_s",set_filter_mag:"set_filter_mag",set_filter_min:"set_filter_min"})});var _n=function(t){t.resource_type=5,hn.call(this,t),null==t.width&&(t.width=C["int"](m.core.screen.get_w())),t.width,null==t.height&&(t.height=C["int"](m.core.screen.get_h())),t.height,this.width=this.width_actual=t.width,this.height=this.height_actual=t.height,null!=t.texture&&this.submit(null),_r.current_context.texParameteri(this.type,10241,this.filter_min),_r.current_context.texParameteri(this.type,10240,this.filter_mag),_r.current_context.texParameteri(this.type,10242,this.clamp_s),_r.current_context.texParameteri(this.type,10243,this.clamp_t),this.fbo=_r.current_context.createFramebuffer(),this.bindBuffer(),this.renderbuffer=_r.current_context.createRenderbuffer(),this.bindRenderBuffer(),_r.current_context.renderbufferStorage(36161,33189,this.width,this.height),_r.current_context.framebufferTexture2D(36160,36064,3553,this.texture,0),_r.current_context.framebufferRenderbuffer(36160,36096,36161,this.renderbuffer);var e=_r.current_context.checkFramebufferStatus(36160);switch(e){case 36053:break;case 36054:throw new Ie("Incomplete framebuffer: FRAMEBUFFER_INCOMPLETE_ATTACHMENT");case 36055:throw new Ie("Incomplete framebuffer: FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT");case 36057:throw new Ie("Incomplete framebuffer: FRAMEBUFFER_INCOMPLETE_DIMENSIONS");case 36061:throw new Ie("Incomplete framebuffer: FRAMEBUFFER_UNSUPPORTED");default:throw new Ie("Incomplete framebuffer: "+e)}this.unbindBuffer(),this.unbindRenderBuffer(),this.system.add(this)};r["phoenix.RenderTexture"]=_n,_n.__name__=["phoenix","RenderTexture"],_n.__super__=hn,_n.prototype=i(hn.prototype,{clear:function(){hn.prototype.clear.call(this),null!=this.fbo&&_r.current_context.deleteFramebuffer(this.fbo),null!=this.renderbuffer&&_r.current_context.deleteRenderbuffer(this.renderbuffer)},bindBuffer:function(){m.renderer.state.bindFramebuffer(this.fbo)},unbindBuffer:function(t){m.renderer.state.bindFramebuffer(t)},bindRenderBuffer:function(){m.renderer.state.bindRenderbuffer(this.renderbuffer)},unbindRenderBuffer:function(t){m.renderer.state.bindRenderbuffer(t)},__class__:_n});var un=function(t,e){this.logging=!1,this.stop_count=0,this.stop=!1,this.should_clear=!0,this.core=t,this.font_asset=e,this.default_fbo=_r.current_context.getParameter(36006),this.default_rbo=_r.current_context.getParameter(36007)};r["phoenix.Renderer"]=un,un.__name__=["phoenix","Renderer"],un.prototype={init:function(){this.state=new an(this),this.clear_color=(new F).rgb(1710618),this.stats=new cn,this.batchers=[],this.target_size=new y(m.core.screen.get_w(),m.core.screen.get_h()),this.camera=new Ws,this.default_render_path=new ln(this),this.render_path=this.default_render_path,this.create_default_shaders(),this.batcher=new Zs(this,"default batcher"),this.batcher.set_layer(1),this.add_batch(this.batcher),m.core.app.config.render.depth&&(this.state.enable(2929),this.state.depth_function(515),_r.current_context.clearDepth(1)),_r.current_context.enable(3042),_r.current_context.blendFunc(770,771),_r.current_context.pixelStorei(37441,0)},destroy:function(){this.clear((new F).rgb(16729099))},sort_batchers:function(t,e){return t.layer<e.layer?-1:t.layer>e.layer?1:t.sequence<e.sequence?-1:t.sequence>e.sequence?1:1},add_batch:function(t){this.batchers.push(t),this.batchers.sort(n(this,this.sort_batchers))},remove_batch:function(t){d.remove(this.batchers,t)},create_batcher:function(t){var e=2;null!=t?(null==t.name&&(t.name="batcher"),t.name,null==t.layer&&(t.layer=e),t.layer,null==t.camera&&(t.camera=new Ws),t.camera):t={name:"batcher",camera:new Ws,layer:e};var i=new Zs(this,t.name);return i.view=t.camera,i.layer=t.layer,i.renderer.batchers.sort((Ur=i.renderer,n(Ur,Ur.sort_batchers))),i.layer,(null==t.no_add||0==t.no_add)&&this.add_batch(i),i},clear:function(t){null==t&&(t=this.clear_color),_r.current_context.clearColor(t.r,t.g,t.b,t.a),m.core.app.config.render.depth?(_r.current_context.clear(16640),_r.current_context.clearDepth(1)):_r.current_context.clear(16384)},blend_mode:function(t,e){null==e&&(e=771),null==t&&(t=770),_r.current_context.blendFunc(t,e)},blend_equation:function(t){null==t&&(t=32774),_r.current_context.blendEquation(t)},internal_resized:function(t,e){if(null==this.get_target()){var i=this.target_size,s=i.ignore_listeners;i.ignore_listeners=!0,i.x=t,i._construct?i.x:(null==i.listen_x||i.ignore_listeners||i.listen_x(t),i.x),i.y=e,i._construct?i.y:(null==i.listen_y||i.ignore_listeners||i.listen_y(e),i.y),i.ignore_listeners=s,null==i.listen_x||i.ignore_listeners||i.listen_x(i.x),null==i.listen_y||i.ignore_listeners||i.listen_y(i.y)}},process:function(){this.stop||(this.should_clear&&this.clear(this.clear_color),this.stats.batchers=this.batchers.length,this.stats.reset(),this.logging&&(this.cmd_log=[]),this.render_path.render(this.batchers,this.stats),this.logging&&(this.logging=!1,this.cmd_log=null))},onresize:function(){},set_vsync:function(t){return m.core.app.windowing.enable_vsync(t),this.vsync=t},get_vsync:function(){return this.vsync},get_target:function(){return this.target},set_target:function(t){return null!=t?(this.target_size.set_x(t.width),this.target_size.set_y(t.height),this.state.bindFramebuffer(t.fbo)):(this.target_size.set_x(m.core.screen.get_w()),this.target_size.set_y(m.core.screen.get_h()),this.state.bindFramebuffer()),this.target=t},create_default_shaders:function(){{var t=te.getString("default.vert.glsl"),e=te.getString("default.frag.glsl"),i=te.getString("default.frag.textured.glsl"),s=te.getString("default.frag.bitmapfont.glsl");_r.current_context.getExtension("OES_standard_derivatives")}e="precision mediump float;\n"+e,i="precision mediump float;\n"+i,s="#extension GL_OES_standard_derivatives : enable\n#extension OES_standard_derivatives : enable\nprecision mediump float;\n"+s;var n=new fn({id:"luxe.shader",frag_id:"default",vert_id:"default"}),r=new fn({id:"luxe.shader_textured",frag_id:"textured",vert_id:"default"}),o=new fn({id:"luxe.shader_bitmapfont",frag_id:"bitmapfont",vert_id:"default"}),l=!0;if(l=l&&n.from_string(t,e),l=l&&r.from_string(t,i),l=l&&o.from_string(t,s),!l)throw new Ie(ei.assertion("_ok ( Default shaders failed to compile or link. See log for errors )"));this.shaders={plain:{shader:n,source:{vert:t,frag:e}},textured:{shader:r,source:{vert:t,frag:i}},bitmapfont:{shader:o,source:{vert:t,frag:s}}}},create_default_font:function(){if(null==this.font_asset)throw new Ie(ei.null_assertion("font_asset was null ( Renderer / failed to create the default font )"));var t=new hn({id:"luxe.font.png",width:this.font_asset.image.width_actual,height:this.font_asset.image.height_actual,pixels:this.font_asset.image.pixels});if(null==t)throw new Ie(ei.null_assertion("_font_texture was null ( Renderer / failed to create the default font... font_texture was null. )"));var e=te.getString("default.fnt");this.font=new Qs({id:"luxe.font",font_data:e,pages:[t]})},__class__:un,__properties__:{set_target:"set_target",get_target:"get_target",set_vsync:"set_vsync",get_vsync:"get_vsync"}};var cn=function(){this.vert_count=0,this.draw_calls=0,this.visible_count=0,this.static_batched_count=0,this.dynamic_batched_count=0,this.geometry_count=0,this.batchers=0};r["phoenix.RendererStats"]=cn,cn.__name__=["phoenix","RendererStats"],cn.prototype={reset:function(){this.geometry_count=0,this.dynamic_batched_count=0,this.static_batched_count=0,this.visible_count=0,this.draw_calls=0,this.vert_count=0},toString:function(){return"Renderer Statistics\n	batcher count : "+this.batchers+"\n	total geometry : "+this.geometry_count+"\n	visible geometry : "+this.visible_count+"\n	dynamic batched geometry : "+this.dynamic_batched_count+"\n	static batched geometry : "+this.static_batched_count+"\n	total draw calls : "+this.draw_calls+"\n	total vertices : "+this.vert_count},__class__:cn};var dn=function(){this.clear()};r["phoenix.Uniforms"]=dn,dn.__name__=["phoenix","Uniforms"],dn.prototype={destroy:function(){this.ints=null,this.floats=null,this.vector2s=null,this.vector3s=null,this.vector4s=null,this.matrix4s=null,this.colors=null,this.textures=null,this.dirty_ints=null,this.dirty_floats=null,this.dirty_vector2s=null,this.dirty_vector3s=null,this.dirty_vector4s=null,this.dirty_matrix4s=null,this.dirty_matrix4arrs=null,this.dirty_colors=null,this.dirty_textures=null},clear:function(){this.destroy(),this.ints=new de,this.floats=new de,this.vector2s=new de,this.vector3s=new de,this.vector4s=new de,this.matrix4s=new de,this.matrix4arrs=new de,this.colors=new de,this.textures=new de,this.dirty_ints=[],this.dirty_floats=[],this.dirty_vector2s=[],this.dirty_vector3s=[],this.dirty_vector4s=[],this.dirty_matrix4s=[],this.dirty_matrix4arrs=[],this.dirty_colors=[],this.dirty_textures=[]},set_int:function(t,e,i){var s=this.ints.get(t);null!=s?s.value=e:(s=new pn(t,e,i),this.ints.set(t,s)),this.dirty_ints.push(s)},set_float:function(t,e,i){var s=this.floats.get(t);null!=s?s.value=e:(s=new pn(t,e,i),this.floats.set(t,s)),this.dirty_floats.push(s)},set_vector2:function(t,e,i){var s=this.vector2s.get(t);null!=s?s.value=e:(s=new pn(t,e,i),this.vector2s.set(t,s)),this.dirty_vector2s.push(s)},set_vector3:function(t,e,i){var s=this.vector3s.get(t);null!=s?s.value=e:(s=new pn(t,e,i),this.vector3s.set(t,s)),this.dirty_vector3s.push(s)},set_vector4:function(t,e,i){var s=this.vector4s.get(t);null!=s?s.value=e:(s=new pn(t,e,i),this.vector4s.set(t,s)),this.dirty_vector4s.push(s)},set_matrix4:function(t,e,i){var s=this.matrix4s.get(t);null!=s?s.value=e:(s=new pn(t,e,i),this.matrix4s.set(t,s)),this.dirty_matrix4s.push(s)},set_matrix4_arr:function(t,e,i){var s=this.matrix4arrs.get(t);null!=s?s.value=e:(s=new pn(t,e,i),this.matrix4arrs.set(t,s)),this.dirty_matrix4arrs.push(s)},set_color:function(t,e,i){var s=this.colors.get(t);null!=s?s.value=e:(s=new pn(t,e,i),this.colors.set(t,s)),this.dirty_colors.push(s)},set_texture:function(t,e,i){var s=this.textures.get(t);null!=s?s.value=e:(s=new pn(t,e,i),this.textures.set(t,s)),this.dirty_textures.push(s)},apply:function(){for(;this.dirty_ints.length>0;){var t=this.dirty_ints.pop();_r.current_context.uniform1i(t.location,t.value)}for(;this.dirty_floats.length>0;){var e=this.dirty_floats.pop();_r.current_context.uniform1f(e.location,e.value)}for(;this.dirty_vector2s.length>0;){var i=this.dirty_vector2s.pop();_r.current_context.uniform2f(i.location,i.value.x,i.value.y)}for(;this.dirty_vector3s.length>0;){var s=this.dirty_vector3s.pop();_r.current_context.uniform3f(s.location,s.value.x,s.value.y,s.value.z)}for(;this.dirty_vector4s.length>0;){var n=this.dirty_vector4s.pop();_r.current_context.uniform4f(n.location,n.value.x,n.value.y,n.value.z,n.value.w)}for(;this.dirty_colors.length>0;){var r=this.dirty_colors.pop();_r.current_context.uniform4f(r.location,r.value.r,r.value.g,r.value.b,r.value.a)}for(;this.dirty_textures.length>0;){var o=this.dirty_textures.pop();_r.current_context.uniform1i(o.location,o.value.slot),o.value.bind()}for(;this.dirty_matrix4s.length>0;){var l=this.dirty_matrix4s.pop();_r.uniformMatrix4fv(l.location,!1,l.value.float32array())}for(;this.dirty_matrix4arrs.length>0;){var a=this.dirty_matrix4arrs.pop();_r.current_context.uniformMatrix4fv(a.location,!1,a.value)}},__class__:dn};var fn=function(t){if(this.no_default_uniforms=!1,this.frag_id="",this.vert_id="",this.log="",null==t)throw new Ie(ei.null_assertion("_options was null"));t.resource_type=7,Ni.call(this,t),this.frag_id=t.frag_id,this.vert_id=t.vert_id,null==t.no_default_uniforms&&(t.no_default_uniforms=!1),this.no_default_uniforms=t.no_default_uniforms,this.uniforms=new dn};r["phoenix.Shader"]=fn,fn.__name__=["phoenix","Shader"],fn.__super__=Ni,fn.prototype=i(Ni.prototype,{activate:function(){this.use(),this.uniforms.apply(),m.renderer.state.activeTexture(33984)},use:function(){null!=this.program&&m.renderer.state.useProgram(this.program)},deactivate:function(){m.renderer.state.useProgram(null)},clone:function(t){var e=new fn({id:t,frag_id:this.frag_id,vert_id:this.vert_id});return e.from_string(this.vert_source,this.frag_source),e},set_int:function(t,e){this.uniforms.set_int(t,e,this.location(t))},set_float:function(t,e){this.uniforms.set_float(t,e,this.location(t))},set_vector2:function(t,e){this.uniforms.set_vector2(t,e,this.location(t))},set_vector3:function(t,e){this.uniforms.set_vector3(t,e,this.location(t))},set_vector4:function(t,e){this.uniforms.set_vector4(t,e,this.location(t))},set_matrix4:function(t,e){this.uniforms.set_matrix4(t,e,this.location(t))},set_matrix4_arr:function(t,e){this.uniforms.set_matrix4_arr(t,e,this.location(t))},set_color:function(t,e){this.uniforms.set_color(t,e,this.location(t))},set_texture:function(t,e){this.uniforms.set_texture(t,e,this.location(t))},compile:function(t,e){var i=_r.current_context.createShader(t);_r.current_context.shaderSource(i,e),_r.current_context.compileShader(i);var s=_r.current_context.getShaderInfoLog(i),n="";if(s.length>0){var r,o=35632==t;r=o?"frag":"vert";var l;l=o?this.frag_id:this.vert_id,n+="\n	// start -- ("+r+" / "+l+") compile log --\n",n+=this.format_log(s),n+="\n	// end --\n"}return 0==_r.current_context.getShaderParameter(i,35713)?(this.log+="	Failed to compile shader `"+this.id+"`:\n",this.add_log(0==n.length?this.format_log(_r.current_context.getShaderInfoLog(i)):n),_r.current_context.deleteShader(i),i=null,null):i},link:function(){if(this.location_cache=null,this.location_cache=new de,this.program=_r.current_context.createProgram(),_r.current_context.attachShader(this.program,this.vert_shader),_r.current_context.attachShader(this.program,this.frag_shader),_r.current_context.bindAttribLocation(this.program,0,"vertexPosition"),_r.current_context.bindAttribLocation(this.program,1,"vertexTCoord"),_r.current_context.bindAttribLocation(this.program,2,"vertexColor"),_r.current_context.bindAttribLocation(this.program,3,"vertexNormal"),_r.current_context.linkProgram(this.program),0==_r.current_context.getProgramParameter(this.program,35714))return this.log+="	Failed to link shader program:",this.add_log(this.format_log(_r.current_context.getProgramInfoLog(this.program))),_r.current_context.deleteProgram(this.program),this.program=null,!1;if(this.use(),!this.no_default_uniforms){this.proj_attribute=this.location("projectionMatrix"),this.view_attribute=this.location("modelViewMatrix");var t=this.location("tex0"),e=this.location("tex1"),i=this.location("tex2"),s=this.location("tex3"),n=this.location("tex4"),r=this.location("tex5"),o=this.location("tex6"),l=this.location("tex7");
null!=t&&_r.current_context.uniform1i(t,0),null!=e&&_r.current_context.uniform1i(e,1),null!=i&&_r.current_context.uniform1i(i,2),null!=s&&_r.current_context.uniform1i(s,3),null!=n&&_r.current_context.uniform1i(n,4),null!=r&&_r.current_context.uniform1i(r,5),null!=o&&_r.current_context.uniform1i(o,6),null!=l&&_r.current_context.uniform1i(l,7)}return!0},location:function(t){var e=this.location_cache.get(t);return null==e&&(e=_r.current_context.getUniformLocation(this.program,t),this.location_cache.set(t,e)),e},clear:function(){null!=this.vert_shader&&_r.current_context.deleteShader(this.vert_shader),null!=this.frag_shader&&_r.current_context.deleteShader(this.frag_shader),null!=this.program&&_r.current_context.deleteProgram(this.program),this.vert_source=null,this.frag_source=null,this.uniforms.clear()},reload:function(){var t=this;if(6==this.state)throw new Ie(ei.assertion("state != ResourceState.destroyed"));return this.clear(),new Un(function(e,i){t.set_state(2);var s=t.frag_id;switch(s){case"default":t.frag_source=m.renderer.shaders.plain.source.frag;break;case"textured":t.frag_source=m.renderer.shaders.textured.source.frag}var n=t.vert_id;switch(n){case"default":t.vert_source=m.renderer.shaders.plain.source.vert}var r=function(e){t.set_state(4),i(e)},o=[Un.resolve()];if(null==t.frag_source){var l=fr.load(m.core.app.assets,t.frag_id);l.then(function(e){t.frag_source=e.text}),o.push(l)}if(null==t.vert_source){var a=fr.load(m.core.app.assets,t.vert_id);a.then(function(e){t.vert_source=e.text}),o.push(a)}Un.all(o).then(function(){t.from_string(t.vert_source,t.frag_source)?(t.set_state(3),e(t)):r(br.error("`"+t.id+"` failed to create :\n\n"+t.log))}).error(function(e){r(br.error("`"+t.id+"` failed to create :\n		"+e+"\n"))})})},from_string:function(t,e){var i=this;return this.clear(),this.frag_source=e,this.vert_source=t,this.vert_shader=this.compile(35633,this.vert_source),this.frag_shader=this.compile(35632,this.frag_source),null==this.vert_shader||null==this.frag_shader?(i.log.length>0,!1):this.link()?!0:(i.log.length>0,!1)},add_log:function(t){this.log+=t},toString:function(){return"Shader("+this.id+") vert:"+this.vert_id+" / frag: "+this.frag_id},format_log:function(t){var e=t.split("\n");return e=e.filter(function(t){return""!=B.trim(t)}),e=e.map(function(t){return"		"+B.trim(t)}),e.join("\n")},__class__:fn});var pn=function(t,e,i){this.name=t,this.value=e,this.location=i};r["phoenix.Uniform"]=pn,pn.__name__=["phoenix","Uniform"],pn.prototype={__class__:pn};var gn=function(){this._destroying=!1,this._cleaning=!1,this._setup=!0,this.dirty=!0,l.call(this,"transform"),this.set_local(new mn),this.set_world(new mn),this._origin_undo_matrix=new sn,this._pos_matrix=new sn,this._rotation_matrix=new sn,this.set_origin(new y),this.local.pos_changed=n(this,this.on_local_pos_change),this.local.rotation_changed=n(this,this.on_local_rotation_change),this.local.scale_changed=n(this,this.on_local_scale_change),this._setup=!1};r["phoenix.Transform"]=gn,gn.__name__=["phoenix","Transform"],gn.__super__=l,gn.prototype=i(l.prototype,{destroy:function(){this._destroying=!0,null!=this.parent&&this.parent.unlisten(n(this,this.on_parent_cleaned)),this._clean_handlers=null,this._dirty_handlers=null,this._pos_handlers=null,this._rotation_handlers=null,this._scale_handlers=null,this._origin_handlers=null,this._parent_handlers=null,this.local.destroy(),this.get_world().destroy(),this.local=null,this.world=null,this.dirty=!0,this.dirty&&!this._setup&&null!=this._dirty_handlers&&this._dirty_handlers.length>0&&this.propagate_dirty(),this.dirty,this.origin=null,null!=this._origin_handlers&&this._origin_handlers.length>0&&this.propagate_origin(this.origin),this.origin,this._origin_undo_matrix=null,this._pos_matrix=null,this._rotation_matrix=null},set_dirty:function(t){return this.dirty=t,this.dirty&&!this._setup&&null!=this._dirty_handlers&&this._dirty_handlers.length>0&&this.propagate_dirty(),this.dirty},on_local_pos_change:function(t){this.dirty=!0,this.dirty&&!this._setup&&null!=this._dirty_handlers&&this._dirty_handlers.length>0&&this.propagate_dirty(),this.dirty,null!=this._pos_handlers&&this._pos_handlers.length>0&&this.propagate_pos(t)},on_local_rotation_change:function(t){this.dirty=!0,this.dirty&&!this._setup&&null!=this._dirty_handlers&&this._dirty_handlers.length>0&&this.propagate_dirty(),this.dirty,null!=this._rotation_handlers&&this._rotation_handlers.length>0&&this.propagate_rotation(t)},on_local_scale_change:function(t){this.dirty=!0,this.dirty&&!this._setup&&null!=this._dirty_handlers&&this._dirty_handlers.length>0&&this.propagate_dirty(),this.dirty,null!=this._scale_handlers&&this._scale_handlers.length>0&&this.propagate_scale(t)},on_parent_cleaned:function(){this.dirty=!0,this.dirty&&!this._setup&&null!=this._dirty_handlers&&this._dirty_handlers.length>0&&this.propagate_dirty(),this.dirty},get_local:function(){return this.local},set_local:function(t){return null!=t&&(this.dirty=!0,this.dirty&&!this._setup&&null!=this._dirty_handlers&&this._dirty_handlers.length>0&&this.propagate_dirty(),this.dirty,t.pos_changed=n(this,this.on_local_pos_change),t.rotation_changed=n(this,this.on_local_rotation_change),t.scale_changed=n(this,this.on_local_scale_change)),this.local=t},get_world:function(){if(!this._destroying){if(null!=this.parent&&this.parent.dirty){var t=this.parent;t.dirty&&(t._cleaning=!0,t._pos_matrix.makeTranslation(t.local.pos.x,t.local.pos.y,t.local.pos.z),t._rotation_matrix.makeRotationFromQuaternion(t.local.rotation),t._origin_undo_matrix.makeTranslation(-t.origin.x,-t.origin.y,-t.origin.z),t.local.matrix.makeTranslation(t.origin.x,t.origin.y,t.origin.z),t.local.matrix.multiply(t._rotation_matrix),t.local.matrix.scale(t.local.scale),t.local.matrix.setPosition(t.local.pos),t.local.matrix.multiply(t._origin_undo_matrix),t.get_world().set_matrix(null!=t.parent?t.get_world().get_matrix().multiplyMatrices(t.parent.get_world().get_matrix(),t.local.matrix):t.local.matrix.clone()),t.get_world().decompose(!1),t.dirty=!1,t.dirty&&!t._setup&&null!=t._dirty_handlers&&t._dirty_handlers.length>0&&t.propagate_dirty(),t.dirty,t._cleaning=!1,null!=t._clean_handlers&&t._clean_handlers.length>0&&t.propagate_clean())}this.dirty&&!this._cleaning&&this.dirty&&(this._cleaning=!0,this._pos_matrix.makeTranslation(this.local.pos.x,this.local.pos.y,this.local.pos.z),this._rotation_matrix.makeRotationFromQuaternion(this.local.rotation),this._origin_undo_matrix.makeTranslation(-this.origin.x,-this.origin.y,-this.origin.z),this.local.matrix.makeTranslation(this.origin.x,this.origin.y,this.origin.z),this.local.matrix.multiply(this._rotation_matrix),this.local.matrix.scale(this.local.scale),this.local.matrix.setPosition(this.local.pos),this.local.matrix.multiply(this._origin_undo_matrix),this.get_world().set_matrix(null!=this.parent?this.get_world().get_matrix().multiplyMatrices(this.parent.get_world().get_matrix(),this.local.matrix):this.local.matrix.clone()),this.get_world().decompose(!1),this.dirty=!1,this.dirty&&!this._setup&&null!=this._dirty_handlers&&this._dirty_handlers.length>0&&this.propagate_dirty(),this.dirty,this._cleaning=!1,null!=this._clean_handlers&&this._clean_handlers.length>0&&this.propagate_clean())}return this.world},toString:function(){return"Transform ("+this.id+")"},get_origin:function(){return this.origin},set_origin:function(t){return this.dirty=!0,this.dirty&&!this._setup&&null!=this._dirty_handlers&&this._dirty_handlers.length>0&&this.propagate_dirty(),this.dirty,this.origin=t,null!=this._origin_handlers&&this._origin_handlers.length>0&&this.propagate_origin(this.origin),this.origin},set_world:function(t){return null==t?this.world=t:(this.dirty=!0,this.dirty&&!this._setup&&null!=this._dirty_handlers&&this._dirty_handlers.length>0&&this.propagate_dirty(),this.dirty,this.world=t)},get_parent:function(){return this.parent},set_parent:function(t){return this.dirty=!0,this.dirty&&!this._setup&&null!=this._dirty_handlers&&this._dirty_handlers.length>0&&this.propagate_dirty(),this.dirty,null!=this.parent&&this.parent.unlisten(n(this,this.on_parent_cleaned)),this.parent=t,null!=this._parent_handlers&&this._parent_handlers.length>0&&this.propagate_parent(this.parent),null!=this.parent&&this.parent.listen(n(this,this.on_parent_cleaned)),this.parent},get_pos:function(){return this.local.pos},get_rotation:function(){return this.local.rotation},get_scale:function(){return this.local.scale},set_pos:function(t){return this.local.set_pos(t)},set_rotation:function(t){return this.local.set_rotation(t)},set_scale:function(t){return this.local.set_scale(t)},propagate_clean:function(){for(var t=0,e=this._clean_handlers;t<e.length;){var i=e[t];++t,null!=i&&i(this)}},propagate_dirty:function(){for(var t=0,e=this._dirty_handlers;t<e.length;){var i=e[t];++t,null!=i&&i(this)}},propagate_pos:function(t){for(var e=0,i=this._pos_handlers;e<i.length;){var s=i[e];++e,null!=s&&s(t)}},propagate_rotation:function(t){for(var e=0,i=this._rotation_handlers;e<i.length;){var s=i[e];++e,null!=s&&s(t)}},propagate_scale:function(t){for(var e=0,i=this._scale_handlers;e<i.length;){var s=i[e];++e,null!=s&&s(t)}},propagate_origin:function(t){for(var e=0,i=this._origin_handlers;e<i.length;){var s=i[e];++e,null!=s&&s(t)}},propagate_parent:function(t){for(var e=0,i=this._parent_handlers;e<i.length;){var s=i[e];++e,null!=s&&s(t)}},listen:function(t){null==this._clean_handlers&&(this._clean_handlers=[]),this._clean_handlers.push(t)},unlisten:function(t){return null==this._clean_handlers?!1:d.remove(this._clean_handlers,t)},listen_dirty:function(t){null==this._dirty_handlers&&(this._dirty_handlers=[]),this._dirty_handlers.push(t)},unlisten_dirty:function(t){return null==this._dirty_handlers?!1:d.remove(this._dirty_handlers,t)},listen_pos:function(t){null==this._pos_handlers&&(this._pos_handlers=[]),this._pos_handlers.push(t)},unlisten_pos:function(t){return null==this._pos_handlers?!1:d.remove(this._pos_handlers,t)},listen_scale:function(t){null==this._scale_handlers&&(this._scale_handlers=[]),this._scale_handlers.push(t)},unlisten_scale:function(t){return null==this._scale_handlers?!1:d.remove(this._scale_handlers,t)},listen_rotation:function(t){null==this._rotation_handlers&&(this._rotation_handlers=[]),this._rotation_handlers.push(t)},unlisten_rotation:function(t){return null==this._rotation_handlers?!1:d.remove(this._rotation_handlers,t)},listen_origin:function(t){null==this._origin_handlers&&(this._origin_handlers=[]),this._origin_handlers.push(t)},unlisten_origin:function(t){return null==this._origin_handlers?!1:d.remove(this._origin_handlers,t)},listen_parent:function(t){null==this._parent_handlers&&(this._parent_handlers=[]),this._parent_handlers.push(t)},unlisten_parent:function(t){return null==this._parent_handlers?!1:d.remove(this._parent_handlers,t)},__class__:gn,__properties__:{set_scale:"set_scale",get_scale:"get_scale",set_rotation:"set_rotation",get_rotation:"get_rotation",set_pos:"set_pos",get_pos:"get_pos",set_dirty:"set_dirty",set_origin:"set_origin",get_origin:"get_origin",set_world:"set_world",get_world:"get_world",set_local:"set_local",get_local:"get_local",set_parent:"set_parent",get_parent:"get_parent"}});var mn=function(){this._setup=!0,this.auto_decompose=!1,this.ignore_listeners=!1,this.set_matrix(new sn),this.floats=this.matrix.float32array(),this.set_pos(new y),this.set_rotation(new nn),this.set_scale(new y(1,1,1)),this._setup=!1};r["phoenix.Spatial"]=mn,mn.__name__=["phoenix","Spatial"],mn.prototype={destroy:function(){this.matrix=null,this.matrix,this.floats=null,this.pos=null,this.pos,this.rotation=null,this.rotation,this.scale=null,this.scale},decompose:function(t){if(null==t&&(t=!0),this.auto_decompose||t){var e=this.matrix.decompose(null,null,null);this.set_pos(e.pos),this.set_rotation(e.rotation),this.set_scale(e.scale)}return this},get_matrix:function(){return this.matrix},set_matrix:function(t){return this.matrix=t,null!=t&&(this.floats=this.matrix.float32array()),this.matrix},propagate_pos:function(t){null==this.pos_changed||this.ignore_listeners||this.pos_changed(t)},propagate_rotation:function(t){null==this.rotation_changed||this.ignore_listeners||this.rotation_changed(t)},propagate_scale:function(t){null==this.scale_changed||this.ignore_listeners||this.scale_changed(t)},set_pos:function(t){return this.pos=t,null!=t&&(y.Listen(this.pos,n(this,this._pos_change)),null==this.pos_changed||this.ignore_listeners||this.pos_changed(this.pos)),this.pos},set_rotation:function(t){return this.rotation=t,null!=t&&(nn.Listen(this.rotation,n(this,this._rotation_change)),null==this.rotation_changed||this.ignore_listeners||this.rotation_changed(this.rotation)),this.rotation},set_scale:function(t){return this.scale=t,null!=t&&(y.Listen(this.scale,n(this,this._scale_change)),null==this.scale_changed||this.ignore_listeners||this.scale_changed(this.scale)),this.scale},_pos_change:function(){this.set_pos(this.pos)},_scale_change:function(){this.set_scale(this.scale)},_rotation_change:function(){this.set_rotation(this.rotation)},__class__:mn,__properties__:{set_matrix:"set_matrix",get_matrix:"get_matrix",set_scale:"set_scale",set_rotation:"set_rotation",set_pos:"set_pos"}};var vn={};r["phoenix._Vector.Vec_Impl_"]=vn,vn.__name__=["phoenix","_Vector","Vec_Impl_"],vn._new=function(t,e,i,s){return new y(t,e,i,s)},vn._multiply=function(t,e){return new y(t.x*e.x,t.y*e.y,t.z*e.z)},vn._multiply_scalar=function(t,e){return y.Multiply(t,e)},vn._multiply_scalar_int=function(t,e){return y.Multiply(t,e)},vn._divide=function(t,e){return new y(t.x/e.x,t.y/e.y,t.z/e.z)},vn._divide_scalar=function(t,e){return new y(t.x/e,t.y/e,t.z/e)},vn._divide_scalar_int=function(t,e){return new y(t.x/e,t.y/e,t.z/e)},vn._add=function(t,e){return new y(t.x+e.x,t.y+e.y,t.z+e.z)},vn._add_scalar=function(t,e){return new y(t.x+e,t.y+e,t.z+e)},vn._add_scalar_int=function(t,e){return new y(t.x+e,t.y+e,t.z+e)},vn._subtract=function(t,e){return new y(t.x-e.x,t.y-e.y,t.z-e.z)},vn._subtract_scalar=function(t,e){return new y(t.x-e,t.y-e,t.z-e)},vn._subtract_scalar_int=function(t,e){return new y(t.x-e,t.y-e,t.z-e)};var yn=function(t){this._prev_count=0,this.dirty=!1,this.locked=!1,this.immediate=!1,this.visible=!0,this.dirty_clip=!1,this.dirty_depth=!1,this.dirty_shader=!1,this.dirty_texture=!1,this.dirty_primitive_type=!1,this.shadow_clip=!1,this.shadow_depth=0,this.id="",this.uuid="",this.dropped=!1,this.added=!1,this.buffer_type=35048,this.buffer_based=!1,this.object_space=!1,this.uuid=m.utils.uniqueid(),this.id=this.uuid,this.state=new zn,this.vertices=[],this.batchers=[],this.transform=new gn,this._final_vert_position=new y,this.set_clip_rect(null),this.set_clip(!1);var e=!0;if(null!=t){if(null==t.id&&(t.id=this.uuid),this.id=t.id,this.set_color(function(){var e;return null==t.color&&(t.color=new F),e=t.color}(this)),this.set_visible(function(){var e;return null==t.visible&&(t.visible=!0),e=t.visible}(this)),null==t.immediate&&(t.immediate=!1),this.immediate=t.immediate,null==t.buffer_based&&(t.buffer_based=!1),this.buffer_based=t.buffer_based,null==t.object_space&&(t.object_space=!1),this.object_space=t.object_space,this.state.set_depth(function(e){var i;return null==t.depth&&(t.depth=e.state.depth),i=t.depth}(this)),this.state.set_texture(function(e){var i;return null==t.texture&&(t.texture=e.state.texture),i=t.texture}(this)),this.state.set_primitive_type(function(e){var i;return null==t.primitive_type&&(t.primitive_type=e.state.primitive_type),i=t.primitive_type}(this)),this.state.set_shader(function(e){var i;return null==t.shader&&(t.shader=e.state.shader),i=t.shader}(this)),null!=t.clip_rect){var i=t.clip_rect;this.state.set_clip_x(i.x),this.state.set_clip_y(i.y),this.state.set_clip_w(i.w),this.state.set_clip_h(i.h)}this.transform.set_pos(function(e){var i;return null==t.pos&&(t.pos=e.transform.local.pos),i=t.pos}(this)),this.transform.set_rotation(function(e){var i;return null==t.rotation&&(t.rotation=e.transform.local.rotation),i=t.rotation}(this)),this.transform.set_scale(function(e){var i;return null==t.scale&&(t.scale=e.transform.local.scale),i=t.scale}(this)),this.transform.set_origin(function(e){var i;return null==t.origin&&(t.origin=e.transform.origin),i=t.origin}(this)),null!=t.no_batcher_add&&1==t.no_batcher_add&&(e=!1)}else this.set_color(new F);yn._sequence_key++,this.key=new kn,this.key.uuid=this.uuid,this.key.timestamp=Nn.core.timestamp(),this.key.sequence=yn._sequence_key,this.key.primitive_type=this.state.primitive_type,this.key.texture=this.state.texture,this.key.shader=this.state.shader,this.key.depth=this.state.depth,this.key.clip=this.state.clip,this.transform.id=this.uuid,this.transform.name=this.id,null!=t&&null!=t.batcher&&e&&t.batcher.add(this),this.buffer_based&&(null!=this.vb_pos||(this.vb_pos=_r.current_context.createBuffer(),this.vb_tcoords=_r.current_context.createBuffer(),this.vb_colors=_r.current_context.createBuffer(),this.set_dirty(!0))),this.uniforms=new dn};r["phoenix.geometry.Geometry"]=yn,yn.__name__=["phoenix","geometry","Geometry"],yn.prototype={key_string:function(){return"ts: "+this.key.timestamp+"\nsequence: "+this.key.sequence+"\nprimitive_type: "+function(t){var e,i=t.key.primitive_type;return e=function(){var t;switch(i){case 3:t="line_strip";break;case 2:t="line_loop";break;case 1:t="lines";break;case 5:t="triangle_strip";break;case 4:t="triangles";break;case 6:t="triangle_fan";break;case 0:t="points";break;default:t=""+i}return t}(t)}(this)+"\ntexture: "+(null==this.key.texture?"null":this.key.texture.id)+"\nshader: "+(null==this.key.shader?"null":this.key.shader.id)+"\ndepth: "+this.key.depth+"\nclip: "+C.string(this.key.clip)},refresh_key:function(){this.key.uuid=this.uuid,this.key.timestamp=Nn.core.timestamp(),this.key.sequence=yn._sequence_key,this.key.primitive_type=this.state.primitive_type,this.key.texture=this.state.texture,this.key.shader=this.state.shader,this.key.depth=this.state.depth,this.key.clip=this.state.clip},str:function(){this.state.log&&(this.state.log=!0,this.state.str(),this.state.log=!1)},drop:function(t){if(null==t&&(t=!0),t&&this.added)for(var e=0,i=this.batchers;e<i.length;){var s=i[e];++e,s.remove(this,!0)}this.key=null,this.set_color(null),this.state=null,this._final_vert_position=null,this.batchers=null,this.uuid=null,this.id=null,this.shadow_texture=null,this.shadow_shader=null,this.vertices=null,null!=this.transform&&(this.transform.destroy(),this.transform=null),this.destroy_vbos(),null!=this.buffer_pos&&(this.buffer_pos=null,this.buffer_tcoords=null,this.buffer_colors=null,this.buffer_normals=null),this.dropped=!0},add:function(t){if(this.vertices.push(t),this.vertices.length>m.renderer.batcher.max_verts)throw new Ie(""+this.id+" / Currently a single geometry cannot exceed the maximum vert count of "+m.renderer.batcher.max_verts)},remove:function(t){d.remove(this.vertices,t)},batch_object_space:function(t,e,i,s,n,r,o){for(var l=0,a=this.vertices;l<a.length;){var h=a[l];++l;var _=h.pos,u=h.uv.uv0,c=h.color;n[t]=_.x,n[t+1]=_.y,n[t+2]=_.z,n[t+3]=_.w,t+=4,r[e]=u.u,r[e+1]=u.v,r[e+2]=u.w,r[e+3]=u.t,e+=4,o[i]=c.r,o[i+1]=c.g,o[i+2]=c.b,o[i+3]=c.a,i+=4,s+=4}},batch_into_arrays:function(t,e,i){for(var s=0,n=this.vertices;s<n.length;){var r=n[s];++s;var o=this._final_vert_position,l=r.pos.x,a=r.pos.y,h=r.pos.z,_=o.ignore_listeners;o.ignore_listeners=!0,o.x=l,o._construct?o.x:(null==o.listen_x||o.ignore_listeners||o.listen_x(l),o.x),o.y=a,o._construct?o.y:(null==o.listen_y||o.ignore_listeners||o.listen_y(a),o.y),o.z=h,o._construct?o.z:(null==o.listen_z||o.ignore_listeners||o.listen_z(h),o.z),o.w=r.pos.w,o.ignore_listeners=_,null==o.listen_x||o.ignore_listeners||o.listen_x(o.x),null==o.listen_y||o.ignore_listeners||o.listen_y(o.y),null==o.listen_z||o.ignore_listeners||o.listen_z(o.z);var u=this._final_vert_position,c=this.transform.get_world().get_matrix(),d=u.x,f=u.y,p=u.z,g=c.elements,m=g[0]*d+g[4]*f+g[8]*p+g[12],v=g[1]*d+g[5]*f+g[9]*p+g[13],y=g[2]*d+g[6]*f+g[10]*p+g[14],w=u.ignore_listeners;u.ignore_listeners=!0,u.x=m,u._construct?u.x:(null==u.listen_x||u.ignore_listeners||u.listen_x(m),u.x),u.y=v,u._construct?u.y:(null==u.listen_y||u.ignore_listeners||u.listen_y(v),u.y),u.z=y,u._construct?u.z:(null==u.listen_z||u.ignore_listeners||u.listen_z(y),u.z),u.ignore_listeners=w,null==u.listen_x||u.ignore_listeners||u.listen_x(u.x),null==u.listen_y||u.ignore_listeners||u.listen_y(u.y),null==u.listen_z||u.ignore_listeners||u.listen_z(u.z),t.push(this._final_vert_position.x),t.push(this._final_vert_position.y),t.push(this._final_vert_position.z),t.push(this._final_vert_position.w),e.push(r.uv.uv0.u),e.push(r.uv.uv0.v),e.push(r.uv.uv0.w),e.push(r.uv.uv0.t),i.push(r.color.r),i.push(r.color.g),i.push(r.color.b),i.push(r.color.a)}},destroy_vbos:function(){null!=this.vb_pos&&(_r.current_context.deleteBuffer(this.vb_pos),_r.current_context.deleteBuffer(this.vb_tcoords),_r.current_context.deleteBuffer(this.vb_colors))},create_vbos:function(){null==this.vb_pos&&(this.vb_pos=_r.current_context.createBuffer(),this.vb_tcoords=_r.current_context.createBuffer(),this.vb_colors=_r.current_context.createBuffer(),this.set_dirty(!0))},bind:function(){_r.current_context.bindBuffer(34962,this.vb_pos),_r.current_context.vertexAttribPointer(0,4,5126,!1,0,0),_r.current_context.bindBuffer(34962,this.vb_tcoords),_r.current_context.vertexAttribPointer(1,4,5126,!1,0,0),_r.current_context.bindBuffer(34962,this.vb_colors),_r.current_context.vertexAttribPointer(2,4,5126,!1,0,0)},bind_pos:function(){_r.current_context.bindBuffer(34962,this.vb_pos),_r.current_context.vertexAttribPointer(0,4,5126,!1,0,0)},bind_tcoords:function(){_r.current_context.bindBuffer(34962,this.vb_tcoords),_r.current_context.vertexAttribPointer(1,4,5126,!1,0,0)},bind_colors:function(){_r.current_context.bindBuffer(34962,this.vb_colors),_r.current_context.vertexAttribPointer(2,4,5126,!1,0,0)},unbind:function(){_r.current_context.bindBuffer(34962,null)},bind_and_upload:function(){_r.current_context.bindBuffer(34962,this.vb_pos),_r.current_context.vertexAttribPointer(0,4,5126,!1,0,0),_r.current_context.bufferData(34962,this.buffer_pos,this.buffer_type),_r.current_context.bindBuffer(34962,this.vb_tcoords),_r.current_context.vertexAttribPointer(1,4,5126,!1,0,0),_r.current_context.bufferData(34962,this.buffer_tcoords,this.buffer_type),_r.current_context.bindBuffer(34962,this.vb_colors),_r.current_context.vertexAttribPointer(2,4,5126,!1,0,0),_r.current_context.bufferData(34962,this.buffer_colors,this.buffer_type)},update_buffers:function(){if(!this.dirty)return!1;var t=this.vertices.length;if(t!=this._prev_count||null==this.buffer_pos){var e=4*this.vertices.length;this.buffer_pos=null,this.buffer_normals=null,this.buffer_colors=null,this.buffer_tcoords=null;var i;i=null!=e?new Float32Array(e):null,this.buffer_pos=i;var s;s=null!=e?new Float32Array(e):null,this.buffer_tcoords=s;var n;n=null!=e?new Float32Array(e):null,this.buffer_colors=n}if(this.object_space)this.batch_object_space(0,0,0,0,this.buffer_pos,this.buffer_tcoords,this.buffer_colors,this.buffer_normals);else for(var r=0,o=0,l=0,a=0,h=this.buffer_pos,_=this.buffer_tcoords,u=this.buffer_colors,c=0,d=this.vertices;c<d.length;){var f=d[c];++c;var p=this._final_vert_position,g=f.pos.x,m=f.pos.y,v=f.pos.z,y=p.ignore_listeners;p.ignore_listeners=!0,p.x=g,p._construct?p.x:(null==p.listen_x||p.ignore_listeners||p.listen_x(g),p.x),p.y=m,p._construct?p.y:(null==p.listen_y||p.ignore_listeners||p.listen_y(m),p.y),p.z=v,p._construct?p.z:(null==p.listen_z||p.ignore_listeners||p.listen_z(v),p.z),p.w=f.pos.w,p.ignore_listeners=y,null==p.listen_x||p.ignore_listeners||p.listen_x(p.x),null==p.listen_y||p.ignore_listeners||p.listen_y(p.y),null==p.listen_z||p.ignore_listeners||p.listen_z(p.z);var w=this._final_vert_position,x=this.transform.get_world().get_matrix(),b=w.x,k=w.y,z=w.z,S=x.elements,T=S[0]*b+S[4]*k+S[8]*z+S[12],A=S[1]*b+S[5]*k+S[9]*z+S[13],I=S[2]*b+S[6]*k+S[10]*z+S[14],E=w.ignore_listeners;w.ignore_listeners=!0,w.x=T,w._construct?w.x:(null==w.listen_x||w.ignore_listeners||w.listen_x(T),w.x),w.y=A,w._construct?w.y:(null==w.listen_y||w.ignore_listeners||w.listen_y(A),w.y),w.z=I,w._construct?w.z:(null==w.listen_z||w.ignore_listeners||w.listen_z(I),w.z),w.ignore_listeners=E,null==w.listen_x||w.ignore_listeners||w.listen_x(w.x),null==w.listen_y||w.ignore_listeners||w.listen_y(w.y),null==w.listen_z||w.ignore_listeners||w.listen_z(w.z),h[r]=this._final_vert_position.x,h[r+1]=this._final_vert_position.y,h[r+2]=this._final_vert_position.z,h[r+3]=this._final_vert_position.w,r+=4;var M=f.uv.uv0;_[o]=M.u,_[o+1]=M.v,_[o+2]=M.w,_[o+3]=M.t,o+=4,u[l]=f.color.r,u[l+1]=f.color.g,u[l+2]=f.color.b,u[l+3]=f.color.a,l+=4,a+=4}return this.set_dirty(!1),!0},draw:function(){_r.current_context.drawArrays(this.state.primitive_type,0,this.buffer_pos.length/4|0)},translate:function(t){var e=this.transform.local.pos,i=this.transform.local.pos.x+t.x,s=this.transform.local.pos.y+t.y,n=this.transform.local.pos.x+t.z,r=e.ignore_listeners;e.ignore_listeners=!0,e.x=i,e._construct?e.x:(null==e.listen_x||e.ignore_listeners||e.listen_x(i),e.x),e.y=s,e._construct?e.y:(null==e.listen_y||e.ignore_listeners||e.listen_y(s),e.y),e.z=n,e._construct?e.z:(null==e.listen_z||e.ignore_listeners||e.listen_z(n),e.z),e.ignore_listeners=r,null==e.listen_x||e.ignore_listeners||e.listen_x(e.x),null==e.listen_y||e.ignore_listeners||e.listen_y(e.y),null==e.listen_z||e.ignore_listeners||e.listen_z(e.z)},set_locked:function(t){return this.buffer_type=t?35044:35048,t&&null==this.vb_pos&&(null!=this.vb_pos||(this.vb_pos=_r.current_context.createBuffer(),this.vb_tcoords=_r.current_context.createBuffer(),this.vb_colors=_r.current_context.createBuffer(),this.set_dirty(!0))),t||null==this.vb_pos||this.destroy_vbos(),this.locked=t},get_locked:function(){return this.locked},set_dirty:function(t){return this.dirty=t},get_dirty:function(){return this.dirty},refresh:function(){for(var t=0,e=this.batchers;t<e.length;){var i=e[t];++t,i.remove(this,!1)}this.dirty_primitive_type&&(this.dirty_primitive_type=!1,this.state.set_primitive_type(this.shadow_primitive_type)),this.dirty_texture&&(this.dirty_texture=!1,this.state.set_texture(this.shadow_texture)),this.dirty_shader&&(this.dirty_shader=!1,this.state.set_shader(this.shadow_shader)),this.dirty_depth&&(this.dirty_depth=!1,this.state.depth=this.shadow_depth),this.dirty_clip&&(this.dirty_clip=!1,this.state.set_clip(this.shadow_clip)),this.refresh_key();for(var s=0,n=this.batchers;s<n.length;){var r=n[s];++s,r.add(this,!1)}},get_primitive_type:function(){return this.state.primitive_type},set_primitive_type:function(t){return this.state.primitive_type!=t&&(this.shadow_primitive_type=t,this.dirty_primitive_type=!0,this.refresh()),this.primitive_type=t},get_texture:function(){return this.state.texture},set_texture:function(t){return this.state.texture!=t&&(this.shadow_texture=t,this.dirty_texture=!0,this.refresh()),this.texture=t},set_visible:function(t){return this.visible=t},set_color:function(t){if(null!=this.vertices&&this.vertices.length>0)for(var e=0,i=this.vertices;e<i.length;){var s=i[e];++e,s.color=t}return this.color=t},get_shader:function(){return this.state.shader},set_shader:function(t){return this.state.shader!=t&&(this.shadow_shader=t,this.dirty_shader=!0,this.refresh()),this.shader=t},get_depth:function(){return this.state.depth},set_depth:function(t){return this.state.depth!=t&&(this.shadow_depth=t,this.dirty_depth=!0,this.refresh()),this.depth=t},get_clip:function(){return this.state.clip},set_clip:function(t){return this.state.clip!=t&&(this.shadow_clip=t,this.dirty_clip=!0,this.refresh()),this.clip=t},get_clip_rect:function(){return this.clip_rect},set_clip_rect:function(t){return null==t?this.set_clip(!1):(this.set_clip(!0),this.state.set_clip_x(t.x),this.state.set_clip_y(t.y),this.state.set_clip_w(t.w),this.state.set_clip_h(t.h)),this.clip_rect=t},__class__:yn,__properties__:{set_clip:"set_clip",get_clip:"get_clip",set_color:"set_color",set_dirty:"set_dirty",get_dirty:"get_dirty",set_locked:"set_locked",get_locked:"get_locked",set_visible:"set_visible",set_clip_rect:"set_clip_rect",get_clip_rect:"get_clip_rect",set_depth:"set_depth",get_depth:"get_depth",set_shader:"set_shader",get_shader:"get_shader",set_texture:"set_texture",get_texture:"get_texture",set_primitive_type:"set_primitive_type",get_primitive_type:"get_primitive_type"}};var wn=function(t){if(yn.call(this,t),null!=t){var e=32,i=32;if(null==t.end_angle&&(t.end_angle=360),t.end_angle,null==t.start_angle&&(t.start_angle=0),t.start_angle,null!=t.r&&(e=t.r,i=t.r),null!=t.rx&&(e=t.rx),null!=t.ry&&(i=t.ry),null==t.steps)if(null==t.smooth){var s=Math.max(e,i);t.steps=m.utils.geometry.segments_for_smooth_circle(s)}else{var n=t.smooth,r=Math.max(e,i);t.steps=m.utils.geometry.segments_for_smooth_circle(r,n)}this.set(t.x,t.y,e,i,t.steps,t.start_angle,t.end_angle),null!=t.visible&&this.set_visible(t.visible)}};r["phoenix.geometry.CircleGeometry"]=wn,wn.__name__=["phoenix","geometry","CircleGeometry"],wn.__super__=yn,wn.prototype=i(yn.prototype,{set:function(t,e,i,s,n,r,o){null==o&&(o=360),null==r&&(r=0),this.set_primitive_type(4);var l=Math.PI/2,a=.017453292519943278*r-l,h=.017453292519943278*o-l,_=h-a;n=Math.ceil(Math.abs(_)/(2*Math.PI)*n);var u=_/n,c=Math.tan(u),d=Math.cos(u),f=i*Math.cos(a),p=i*Math.sin(a),g=i/s;0==g&&(g=1e-9);for(var m=0,v=[],w=0,x=n+1;x>w;){var b=(w++,f),k=p/g,z=new y(b,k);v.push(z),m>0&&this.add(new Bn(z,this.color)),this.add(new Bn(new y(0,0),this.color)),this.add(new Bn(z,this.color));var S=-p,T=f;f+=S*c,p+=T*c,f*=d,p*=d,m++}this.add(new Bn(v[n],this.color)),this.transform.set_pos(new y(t,e))},__class__:wn});var xn=function(t){wn.call(this,t),this.set_primitive_type(1)};r["phoenix.geometry.RingGeometry"]=xn,xn.__name__=["phoenix","geometry","RingGeometry"],xn.__super__=wn,xn.prototype=i(wn.prototype,{set:function(t,e,i,s,n,r,o){null==o&&(o=360),null==r&&(r=0),this.set_primitive_type(4);var l=.017453292519943278*r,a=.017453292519943278*o,h=a-l,_=h/n,u=Math.tan(_),c=Math.cos(_),d=i*Math.cos(l),f=i*Math.sin(l),p=i/s;0==p&&(p=1e-9);for(var g=0,m=[],v=0;n>v;){var w=(v++,d),x=f/p,b=new y(w,x);if(m.push(b),this.add(new Bn(b,this.color)),g>0){var k=m[g];this.add(new Bn(new y(k.x,k.y,k.z,k.w),this.color))}var z=-f,S=d;d+=z*u,f+=S*u,d*=c,f*=c,g++}m.length>0&&this.add(new Bn(m[0].clone(),this.color)),this.transform.set_pos(new y(t,e))},__class__:xn});var bn=function(t){xn.call(this,t),this.vertices.pop(),this.vertices.pop(),this.set_primitive_type(1)};r["phoenix.geometry.ArcGeometry"]=bn,bn.__name__=["phoenix","geometry","ArcGeometry"],bn.__super__=xn,bn.prototype=i(xn.prototype,{__class__:bn});var kn=function(){this.clip=!1,this.depth=0,this.uuid="",this.sequence=0,this.timestamp=0};r["phoenix.geometry.GeometryKey"]=kn,kn.__name__=["phoenix","geometry","GeometryKey"],kn.prototype={__class__:kn};var zn=function(){this.log=!1,this.dirty=!0,this.clip=!1,this.dirty=!0,this.clip_x=0,this.dirty=!0,this.clip_y=0,this.dirty=!0,this.clip_w=0,this.dirty=!0,this.clip_h=0,this.dirty=!0,this.texture=null,this.dirty=!0,this.shader=null,this.depth=0,this.dirty=!0,this.primitive_type=0,this.dirty=!1};r["phoenix.geometry.GeometryState"]=zn,zn.__name__=["phoenix","geometry","GeometryState"],zn.prototype={clone_onto:function(t){t.dirty=this.dirty,t.dirty=!0,t.texture=this.texture,t.dirty=!0,t.shader=this.shader,t.depth=this.depth,t.dirty=!0,t.primitive_type=this.primitive_type,t.dirty=!0,t.clip=this.clip,t.dirty=!0,t.clip_x=this.clip_x,t.dirty=!0,t.clip_y=this.clip_y,t.dirty=!0,t.clip_w=this.clip_w,t.dirty=!0,t.clip_h=this.clip_h},str:function(){this.log&&null!=this.texture},clean:function(){this.dirty=!1},set_primitive_type:function(t){return this.dirty=!0,this.primitive_type=t},set_texture:function(t){return this.dirty=!0,this.texture=t},set_shader:function(t){return this.dirty=!0,this.shader=t},set_depth:function(t){return this.depth=t},set_clip:function(t){return this.dirty=!0,this.clip=t},set_clip_x:function(t){return this.dirty=!0,this.clip_x=t},set_clip_y:function(t){return this.dirty=!0,this.clip_y=t
},set_clip_w:function(t){return this.dirty=!0,this.clip_w=t},set_clip_h:function(t){return this.dirty=!0,this.clip_h=t},__class__:zn,__properties__:{set_clip_h:"set_clip_h",set_clip_w:"set_clip_w",set_clip_y:"set_clip_y",set_clip_x:"set_clip_x",set_clip:"set_clip",set_depth:"set_depth",set_texture:"set_texture",set_shader:"set_shader",set_primitive_type:"set_primitive_type"}};var Sn=function(t){null!=t&&(t.primitive_type=1),yn.call(this,t),null!=t&&(null==t.color&&(t.color=new F),t.color,null==t.color0&&(t.color0=t.color),t.color0,null==t.color1&&(t.color1=t.color),t.color1,this.set_p0(function(){var e;return null==t.p0&&(t.p0=new y),e=t.p0}(this)),this.set_p1(function(){var e;return null==t.p1&&(t.p1=new y(64,64)),e=t.p1}(this)),this.add(new Bn(this.p0,t.color0)),this.add(new Bn(this.p1,t.color1)))};r["phoenix.geometry.LineGeometry"]=Sn,Sn.__name__=["phoenix","geometry","LineGeometry"],Sn.__super__=yn,Sn.prototype=i(yn.prototype,{set_p0:function(t){return this.p0=t,0==this.vertices.length?this.p0:(this.vertices[0].pos=this.p0,this.p0=t)},set_p1:function(t){return this.p1=t,0==this.vertices.length?this.p1:(this.vertices[1].pos=this.p1,this.p1=t)},set_color0:function(t){return this.color0=t,0==this.vertices.length?this.color0:(this.vertices[0].color=this.color0,this.color0)},set_color1:function(t){return this.color1=t,0==this.vertices.length?this.color1:(this.vertices[1].color=this.color1,this.color1)},__class__:Sn,__properties__:i(yn.prototype.__properties__,{set_color1:"set_color1",set_color0:"set_color0",set_p1:"set_p1",set_p0:"set_p0"})});var Tn=function(t){this.is_set=!1,this.flipy=!1,this.flipx=!1,yn.call(this,t),null!=t&&(null!=t.flipx&&this.set_flipx(t.flipx),null!=t.flipy&&this.set_flipy(t.flipy),this._uv_cache=new on(0,0,1,1),this.set(new on(t.x,t.z,t.w,t.h),t.y),null!=t.visible&&this.set_visible(t.visible),null!=t.immediate&&(this.immediate=t.immediate))};r["phoenix.geometry.PlaneGeometry"]=Tn,Tn.__name__=["phoenix","geometry","PlaneGeometry"],Tn.__super__=yn,Tn.prototype=i(yn.prototype,{uv:function(t){if(null!=this.state.texture){var e=t.x/this.state.texture.width_actual,i=t.y/this.state.texture.height_actual,s=t.w/this.state.texture.width_actual,n=t.h/this.state.texture.height_actual;this.uv_space(new on(e,i,s,n))}},uv_space:function(t){var e=t.w,i=t.h,s=t.x,n=t.y;this._uv_cache.set(s,n,e,i);var r=s+e,o=n,l=s+e,a=n+i,h=s,_=n+i,u=0,c=0;this.flipy&&(c=_,_=n,n=c,c=a,a=o,o=c),this.flipx&&(u=r,r=s,s=u,u=l,l=h,h=u),this.vertices[0].uv.uv0.set_uv(s,n),this.vertices[1].uv.uv0.set_uv(r,o),this.vertices[2].uv.uv0.set_uv(l,a),this.vertices[3].uv.uv0.set_uv(h,_),this.vertices[4].uv.uv0.set_uv(s,n),this.vertices[5].uv.uv0.set_uv(l,a),this.set_dirty(!0)},set:function(t,e){this.vertices.splice(0,this.vertices.length);var i=new Bn(new y(0,0,0),this.color),s=new Bn(new y(t.w,0,0),this.color),n=new Bn(new y(t.w,0,t.h),this.color),r=new Bn(new y(0,0,t.h),this.color),o=new Bn(new y(0,0,0),this.color),l=new Bn(new y(t.w,0,t.h),this.color);this.add(l),this.add(o),this.add(r),this.add(n),this.add(s),this.add(i),this.set_primitive_type(4),this.immediate=!1,this.transform.set_pos(new y(t.x,e,t.y)),this.is_set=!0,this.uv_space(new on(0,0,1,1))},set_flipx:function(t){return this.flipx=t,this.is_set&&this.uv_space(this._uv_cache),this.flipx},set_flipy:function(t){return this.flipy=t,this.is_set&&this.uv_space(this._uv_cache),this.flipy},__class__:Tn,__properties__:i(yn.prototype.__properties__,{set_flipy:"set_flipy",set_flipx:"set_flipx"})});var An=function(t){if(this._uv_h=1,this._uv_w=1,this._uv_y=0,this._uv_x=0,this.uv_angle=0,this.flipy=!1,this.flipx=!1,t.primitive_type=4,yn.call(this,t),null!=t){null!=t.flipx&&this.set_flipx(t.flipx),null!=t.flipy&&this.set_flipy(t.flipy);var e=t.x,i=t.y,s=t.w,n=t.h;null!=t.rect&&(e=t.rect.x,i=t.rect.y,s=t.rect.w,n=t.rect.h),this.add(new Bn(new y(0,0),this.color)),this.add(new Bn(new y(s,0),this.color)),this.add(new Bn(new y(s,n),this.color)),this.add(new Bn(new y(0,n),this.color)),this.add(new Bn(new y(0,0),this.color)),this.add(new Bn(new y(s,n),this.color)),this.transform.set_pos(function(t){var s,n=t.transform.local.pos,r=n.ignore_listeners;return n.ignore_listeners=!0,n.x=e,n._construct?n.x:(null==n.listen_x||n.ignore_listeners||n.listen_x(e),n.x),n.y=i,n._construct?n.y:(null==n.listen_y||n.ignore_listeners||n.listen_y(i),n.y),n.ignore_listeners=r,null==n.listen_x||n.ignore_listeners||n.listen_x(n.x),null==n.listen_y||n.ignore_listeners||n.listen_y(n.y),s=n}(this)),null!=t.uv?this.uv(t.uv):this.uv_space(0,0,1,1),null!=t.visible&&this.set_visible(t.visible),null!=t.immediate&&(this.immediate=t.immediate)}};r["phoenix.geometry.QuadGeometry"]=An,An.__name__=["phoenix","geometry","QuadGeometry"],An.__super__=yn,An.prototype=i(yn.prototype,{uv:function(t){if(null==this.state.texture)throw new Ie(ei.null_assertion("texture was null ( QuadGeometry; Calling UV on a geometry with null texture. )"));var e=t.x/this.state.texture.width_actual,i=t.y/this.state.texture.height_actual,s=t.w/this.state.texture.width_actual,n=t.h/this.state.texture.height_actual;this.uv_space(e,i,s,n)},uv_space:function(t,e,i,s){if(0!=this.vertices.length){var n=i,r=s,o=t,l=e;this._uv_x=o,this._uv_y=l,this._uv_w=n,this._uv_h=r;var a=o+n,h=l,_=o+n,u=l+r,c=o,d=l+r,f=0,p=0,g=this.uv_angle/90|0;g-=4*Math.floor(g/4);for(var m=0;g>m;){{m++}f=o,o=c,c=_,_=a,a=f,p=l,l=d,d=u,u=h,h=p}this.flipy&&(p=d,d=l,l=p,f=c,c=o,o=f,p=u,u=h,h=p,f=_,_=a,a=f),this.flipx&&(f=a,a=o,o=f,p=h,h=l,l=p,f=_,_=c,c=f,p=u,u=d,d=p),this.vertices[0].uv.uv0.set_uv(o,l),this.vertices[1].uv.uv0.set_uv(a,h),this.vertices[2].uv.uv0.set_uv(_,u),this.vertices[3].uv.uv0.set_uv(c,d),this.vertices[4].uv.uv0.set_uv(o,l),this.vertices[5].uv.uv0.set_uv(_,u),this.set_dirty(!0)}},resize_xy:function(t,e){if(0!=this.vertices.length){var i=this.vertices[0].pos,s=i.ignore_listeners;i.ignore_listeners=!0,i.x=0,i._construct?i.x:(null==i.listen_x||i.ignore_listeners||i.listen_x(0),i.x),i.y=0,i._construct?i.y:(null==i.listen_y||i.ignore_listeners||i.listen_y(0),i.y),i.ignore_listeners=s,null==i.listen_x||i.ignore_listeners||i.listen_x(i.x),null==i.listen_y||i.ignore_listeners||i.listen_y(i.y);var n=this.vertices[1].pos,r=n.ignore_listeners;n.ignore_listeners=!0,n.x=t,n._construct?n.x:(null==n.listen_x||n.ignore_listeners||n.listen_x(t),n.x),n.y=0,n._construct?n.y:(null==n.listen_y||n.ignore_listeners||n.listen_y(0),n.y),n.ignore_listeners=r,null==n.listen_x||n.ignore_listeners||n.listen_x(n.x),null==n.listen_y||n.ignore_listeners||n.listen_y(n.y);var o=this.vertices[2].pos,l=o.ignore_listeners;o.ignore_listeners=!0,o.x=t,o._construct?o.x:(null==o.listen_x||o.ignore_listeners||o.listen_x(t),o.x),o.y=e,o._construct?o.y:(null==o.listen_y||o.ignore_listeners||o.listen_y(e),o.y),o.ignore_listeners=l,null==o.listen_x||o.ignore_listeners||o.listen_x(o.x),null==o.listen_y||o.ignore_listeners||o.listen_y(o.y);var a=this.vertices[3].pos,h=a.ignore_listeners;a.ignore_listeners=!0,a.x=0,a._construct?a.x:(null==a.listen_x||a.ignore_listeners||a.listen_x(0),a.x),a.y=e,a._construct?a.y:(null==a.listen_y||a.ignore_listeners||a.listen_y(e),a.y),a.ignore_listeners=h,null==a.listen_x||a.ignore_listeners||a.listen_x(a.x),null==a.listen_y||a.ignore_listeners||a.listen_y(a.y);var _=this.vertices[4].pos,u=_.ignore_listeners;_.ignore_listeners=!0,_.x=0,_._construct?_.x:(null==_.listen_x||_.ignore_listeners||_.listen_x(0),_.x),_.y=0,_._construct?_.y:(null==_.listen_y||_.ignore_listeners||_.listen_y(0),_.y),_.ignore_listeners=u,null==_.listen_x||_.ignore_listeners||_.listen_x(_.x),null==_.listen_y||_.ignore_listeners||_.listen_y(_.y);var c=this.vertices[5].pos,d=c.ignore_listeners;c.ignore_listeners=!0,c.x=t,c._construct?c.x:(null==c.listen_x||c.ignore_listeners||c.listen_x(t),c.x),c.y=e,c._construct?c.y:(null==c.listen_y||c.ignore_listeners||c.listen_y(e),c.y),c.ignore_listeners=d,null==c.listen_x||c.ignore_listeners||c.listen_x(c.x),null==c.listen_y||c.ignore_listeners||c.listen_y(c.y)}},resize:function(t){this.resize_xy(t.x,t.y)},set:function(t){this.set_xywh(t.x,t.y,t.w,t.h)},set_xywh:function(t,e,i,s){if(0!=this.vertices.length){var n=this.vertices[0].pos,r=n.ignore_listeners;n.ignore_listeners=!0,n.x=0,n._construct?n.x:(null==n.listen_x||n.ignore_listeners||n.listen_x(0),n.x),n.y=0,n._construct?n.y:(null==n.listen_y||n.ignore_listeners||n.listen_y(0),n.y),n.ignore_listeners=r,null==n.listen_x||n.ignore_listeners||n.listen_x(n.x),null==n.listen_y||n.ignore_listeners||n.listen_y(n.y);var o=this.vertices[1].pos,l=o.ignore_listeners;o.ignore_listeners=!0,o.x=i,o._construct?o.x:(null==o.listen_x||o.ignore_listeners||o.listen_x(i),o.x),o.y=0,o._construct?o.y:(null==o.listen_y||o.ignore_listeners||o.listen_y(0),o.y),o.ignore_listeners=l,null==o.listen_x||o.ignore_listeners||o.listen_x(o.x),null==o.listen_y||o.ignore_listeners||o.listen_y(o.y);var a=this.vertices[2].pos,h=a.ignore_listeners;a.ignore_listeners=!0,a.x=i,a._construct?a.x:(null==a.listen_x||a.ignore_listeners||a.listen_x(i),a.x),a.y=s,a._construct?a.y:(null==a.listen_y||a.ignore_listeners||a.listen_y(s),a.y),a.ignore_listeners=h,null==a.listen_x||a.ignore_listeners||a.listen_x(a.x),null==a.listen_y||a.ignore_listeners||a.listen_y(a.y);var _=this.vertices[3].pos,u=_.ignore_listeners;_.ignore_listeners=!0,_.x=0,_._construct?_.x:(null==_.listen_x||_.ignore_listeners||_.listen_x(0),_.x),_.y=s,_._construct?_.y:(null==_.listen_y||_.ignore_listeners||_.listen_y(s),_.y),_.ignore_listeners=u,null==_.listen_x||_.ignore_listeners||_.listen_x(_.x),null==_.listen_y||_.ignore_listeners||_.listen_y(_.y);var c=this.vertices[4].pos,d=c.ignore_listeners;c.ignore_listeners=!0,c.x=0,c._construct?c.x:(null==c.listen_x||c.ignore_listeners||c.listen_x(0),c.x),c.y=0,c._construct?c.y:(null==c.listen_y||c.ignore_listeners||c.listen_y(0),c.y),c.ignore_listeners=d,null==c.listen_x||c.ignore_listeners||c.listen_x(c.x),null==c.listen_y||c.ignore_listeners||c.listen_y(c.y);var f=this.vertices[5].pos,p=f.ignore_listeners;f.ignore_listeners=!0,f.x=i,f._construct?f.x:(null==f.listen_x||f.ignore_listeners||f.listen_x(i),f.x),f.y=s,f._construct?f.y:(null==f.listen_y||f.ignore_listeners||f.listen_y(s),f.y),f.ignore_listeners=p,null==f.listen_x||f.ignore_listeners||f.listen_x(f.x),null==f.listen_y||f.ignore_listeners||f.listen_y(f.y),this.transform.set_pos(function(i){var s,n=i.transform.local.pos,r=n.ignore_listeners;return n.ignore_listeners=!0,n.x=t,n._construct?n.x:(null==n.listen_x||n.ignore_listeners||n.listen_x(t),n.x),n.y=e,n._construct?n.y:(null==n.listen_y||n.ignore_listeners||n.listen_y(e),n.y),n.ignore_listeners=r,null==n.listen_x||n.ignore_listeners||n.listen_x(n.x),null==n.listen_y||n.ignore_listeners||n.listen_y(n.y),s=n}(this))}},set_flipx:function(t){return this.flipx=t,this.uv_space(this._uv_x,this._uv_y,this._uv_w,this._uv_h),this.flipx},set_flipy:function(t){return this.flipy=t,this.uv_space(this._uv_x,this._uv_y,this._uv_w,this._uv_h),this.flipy},set_uv_angle:function(t){if(t%90!=0)throw new Ie(ei.assertion("_val % 90 == 0 ( uv_angle has to be a multiple of 90 )"));return this.uv_angle=t,this.uv_space(this._uv_x,this._uv_y,this._uv_w,this._uv_h),this.uv_angle},__class__:An,__properties__:i(yn.prototype.__properties__,{set_uv_angle:"set_uv_angle",set_flipy:"set_flipy",set_flipx:"set_flipx"})});var In=function(t){t.primitive_type=4,yn.call(this,t),this.quads=new _e};r["phoenix.geometry.QuadPackGeometry"]=In,In.__name__=["phoenix","geometry","QuadPackGeometry"],In.__super__=yn,In.prototype=i(yn.prototype,{clear:function(){for(var t=this.quads.keys();t.hasNext();){var e=t.next();this.quad_remove(e)}},quad_add:function(t){null==t.visible&&(t.visible=!0),t.visible,null==t.flipx&&(t.flipx=!1),t.flipx,null==t.flipy&&(t.flipy=!1),t.flipy;var e=m.utils.uniquehash(),i=new Bn(new y(t.x,t.y),t.color),s=new Bn(new y(t.x+t.w,t.y),t.color),n=new Bn(new y(t.x+t.w,t.y+t.h),t.color),r=new Bn(new y(t.x,t.y+t.h),t.color),o=new Bn(new y(t.x,t.y),t.color),l=new Bn(new y(t.x+t.w,t.y+t.h),t.color);this.add(i),this.add(s),this.add(n),this.add(r),this.add(o),this.add(l);var a={uid:e,verts:[],flipx:t.flipx,flipy:t.flipx,visible:t.visible,_uv_cache:new on(0,0,1,1)};return a.verts.push(i),a.verts.push(s),a.verts.push(n),a.verts.push(r),a.verts.push(o),a.verts.push(l),this.quads.h[e]=a,null!=t.uv&&this.quad_uv(e,t.uv),this.set_dirty(!0),e},quad_remove:function(t){var e=this.quads.h[t];null!=e&&(this.remove(e.verts[0]),this.remove(e.verts[1]),this.remove(e.verts[2]),this.remove(e.verts[3]),this.remove(e.verts[4]),this.remove(e.verts[5]),this.quads.remove(t),this.set_dirty(!0))},quad_visible:function(t,e){var i=this.quads.h[t];null!=i&&(e&&!i.visible?(i.visible=!1,this.add(i.verts[0]),this.add(i.verts[1]),this.add(i.verts[2]),this.add(i.verts[3]),this.add(i.verts[4]),this.add(i.verts[5])):!e&&i.visible&&(i.visible=!1,this.remove(i.verts[0]),this.remove(i.verts[1]),this.remove(i.verts[2]),this.remove(i.verts[3]),this.remove(i.verts[4]),this.remove(i.verts[5])),this.set_dirty(!0))},quad_resize:function(t,e){var i=this.quads.h[t];null!=i&&(i.verts[0].pos=new y(e.x,e.y),i.verts[1].pos=new y(e.x+e.w,e.y),i.verts[2].pos=new y(e.x+e.w,e.y+e.h),i.verts[3].pos=new y(e.x,e.y+e.h),i.verts[4].pos=new y(e.x,e.y),i.verts[5].pos=new y(e.x+e.w,e.y+e.h),this.set_dirty(!0))},quad_pos:function(t,e){var i=this.quads.h[t];if(null!=i){var s=e.x-i.verts[0].pos.x,n=e.y-i.verts[0].pos.y,r=i.verts[0].pos;r.set_x(r.x+s);var o=i.verts[0].pos;o.set_y(o.y+n);var l=i.verts[1].pos;l.set_x(l.x+s);var a=i.verts[1].pos;a.set_y(a.y+n);var h=i.verts[2].pos;h.set_x(h.x+s);var _=i.verts[2].pos;_.set_y(_.y+n);var u=i.verts[3].pos;u.set_x(u.x+s);var c=i.verts[3].pos;c.set_y(c.y+n);var d=i.verts[4].pos;d.set_x(d.x+s);var f=i.verts[4].pos;f.set_y(f.y+n);var p=i.verts[5].pos;p.set_x(p.x+s);var g=i.verts[5].pos;g.set_y(g.y+n),this.set_dirty(!0)}},quad_color:function(t,e){var i=this.quads.h[t];null!=i&&(i.verts[0].color=e,i.verts[1].color=e,i.verts[2].color=e,i.verts[3].color=e,i.verts[4].color=e,i.verts[5].color=e)},quad_alpha:function(t,e){var i=this.quads.h[t];null!=i&&(i.verts[0].color.a=e,i.verts[1].color.a=e,i.verts[2].color.a=e,i.verts[3].color.a=e,i.verts[4].color.a=e,i.verts[5].color.a=e)},quad_uv_space:function(t,e){var i=this.quads.h[t];if(null!=i){var s=i.flipx,n=i.flipy,r=e.w,o=e.h,l=e.x,a=e.y;i._uv_cache.set(l,a,r,o);var h=l+r,_=a,u=l+r,c=a+o,d=l,f=a+o,p=0,g=0;n&&(g=f,f=a,a=g,g=c,c=_,_=g),s&&(p=h,h=l,l=p,p=u,u=d,d=p),i.verts[0].uv.uv0.set_uv(l,a),i.verts[1].uv.uv0.set_uv(h,_),i.verts[2].uv.uv0.set_uv(u,c),i.verts[3].uv.uv0.set_uv(d,f),i.verts[4].uv.uv0.set_uv(l,a),i.verts[5].uv.uv0.set_uv(u,c),this.set_dirty(!0)}},quad_uv:function(t,e){if(null!=this.state.texture){var i=e.x/this.state.texture.width_actual,s=e.y/this.state.texture.height_actual,n=e.w/this.state.texture.width_actual,r=e.h/this.state.texture.height_actual;this.quad_uv_space(t,new on(i,s,n,r))}},quad_flipx:function(t,e){var i=this.quads.h[t];null!=i&&(i.flipx=e,this.quad_uv_space(t,i._uv_cache))},quad_flipy:function(t,e){var i=this.quads.h[t];null!=i&&(i.flipy=e,this.quad_uv_space(t,i._uv_cache))},__class__:In});var En=function(t){if(t.primitive_type=1,yn.call(this,t),null!=t){var e=t.x,i=t.y,s=t.w,n=t.h;null!=t.rect&&(e=t.rect.x,i=t.rect.y,s=t.rect.w,n=t.rect.h),this.add(new Bn(new y(0,0),this.color)),this.add(new Bn(new y(s,0),this.color)),this.add(new Bn(new y(s,0),this.color)),this.add(new Bn(new y(s,n),this.color)),this.add(new Bn(new y(s,n),this.color)),this.add(new Bn(new y(0,n),this.color)),this.add(new Bn(new y(0,n),this.color)),this.add(new Bn(new y(0,0),this.color)),null==t.immediate&&(t.immediate=!1),this.immediate=t.immediate,this.set_visible(function(){var e;return null==t.visible&&(t.visible=!0),e=t.visible}(this)),this.transform.set_pos(function(t){var s,n=t.transform.local.pos,r=n.ignore_listeners;return n.ignore_listeners=!0,n.x=e,n._construct?n.x:(null==n.listen_x||n.ignore_listeners||n.listen_x(e),n.x),n.y=i,n._construct?n.y:(null==n.listen_y||n.ignore_listeners||n.listen_y(i),n.y),n.ignore_listeners=r,null==n.listen_x||n.ignore_listeners||n.listen_x(n.x),null==n.listen_y||n.ignore_listeners||n.listen_y(n.y),s=n}(this))}};r["phoenix.geometry.RectangleGeometry"]=En,En.__name__=["phoenix","geometry","RectangleGeometry"],En.__super__=yn,En.prototype=i(yn.prototype,{set_xywh:function(t,e,i,s){if(0!=this.vertices.length){var n=this.vertices[0].pos,r=n.ignore_listeners;n.ignore_listeners=!0,n.x=0,n._construct?n.x:(null==n.listen_x||n.ignore_listeners||n.listen_x(0),n.x),n.y=0,n._construct?n.y:(null==n.listen_y||n.ignore_listeners||n.listen_y(0),n.y),n.ignore_listeners=r,null==n.listen_x||n.ignore_listeners||n.listen_x(n.x),null==n.listen_y||n.ignore_listeners||n.listen_y(n.y);var o=this.vertices[1].pos,l=o.ignore_listeners;o.ignore_listeners=!0,o.x=i,o._construct?o.x:(null==o.listen_x||o.ignore_listeners||o.listen_x(i),o.x),o.y=0,o._construct?o.y:(null==o.listen_y||o.ignore_listeners||o.listen_y(0),o.y),o.ignore_listeners=l,null==o.listen_x||o.ignore_listeners||o.listen_x(o.x),null==o.listen_y||o.ignore_listeners||o.listen_y(o.y);var a=this.vertices[2].pos,h=a.ignore_listeners;a.ignore_listeners=!0,a.x=i,a._construct?a.x:(null==a.listen_x||a.ignore_listeners||a.listen_x(i),a.x),a.y=0,a._construct?a.y:(null==a.listen_y||a.ignore_listeners||a.listen_y(0),a.y),a.ignore_listeners=h,null==a.listen_x||a.ignore_listeners||a.listen_x(a.x),null==a.listen_y||a.ignore_listeners||a.listen_y(a.y);var _=this.vertices[3].pos,u=_.ignore_listeners;_.ignore_listeners=!0,_.x=i,_._construct?_.x:(null==_.listen_x||_.ignore_listeners||_.listen_x(i),_.x),_.y=s,_._construct?_.y:(null==_.listen_y||_.ignore_listeners||_.listen_y(s),_.y),_.ignore_listeners=u,null==_.listen_x||_.ignore_listeners||_.listen_x(_.x),null==_.listen_y||_.ignore_listeners||_.listen_y(_.y);var c=this.vertices[4].pos,d=c.ignore_listeners;c.ignore_listeners=!0,c.x=i,c._construct?c.x:(null==c.listen_x||c.ignore_listeners||c.listen_x(i),c.x),c.y=s,c._construct?c.y:(null==c.listen_y||c.ignore_listeners||c.listen_y(s),c.y),c.ignore_listeners=d,null==c.listen_x||c.ignore_listeners||c.listen_x(c.x),null==c.listen_y||c.ignore_listeners||c.listen_y(c.y);var f=this.vertices[5].pos,p=f.ignore_listeners;f.ignore_listeners=!0,f.x=0,f._construct?f.x:(null==f.listen_x||f.ignore_listeners||f.listen_x(0),f.x),f.y=s,f._construct?f.y:(null==f.listen_y||f.ignore_listeners||f.listen_y(s),f.y),f.ignore_listeners=p,null==f.listen_x||f.ignore_listeners||f.listen_x(f.x),null==f.listen_y||f.ignore_listeners||f.listen_y(f.y);var g=this.vertices[6].pos,m=g.ignore_listeners;g.ignore_listeners=!0,g.x=0,g._construct?g.x:(null==g.listen_x||g.ignore_listeners||g.listen_x(0),g.x),g.y=s,g._construct?g.y:(null==g.listen_y||g.ignore_listeners||g.listen_y(s),g.y),g.ignore_listeners=m,null==g.listen_x||g.ignore_listeners||g.listen_x(g.x),null==g.listen_y||g.ignore_listeners||g.listen_y(g.y);var v=this.vertices[7].pos,y=v.ignore_listeners;v.ignore_listeners=!0,v.x=0,v._construct?v.x:(null==v.listen_x||v.ignore_listeners||v.listen_x(0),v.x),v.y=0,v._construct?v.y:(null==v.listen_y||v.ignore_listeners||v.listen_y(0),v.y),v.ignore_listeners=y,null==v.listen_x||v.ignore_listeners||v.listen_x(v.x),null==v.listen_y||v.ignore_listeners||v.listen_y(v.y),this.transform.set_pos(function(i){var s,n=i.transform.local.pos,r=n.ignore_listeners;return n.ignore_listeners=!0,n.x=t,n._construct?n.x:(null==n.listen_x||n.ignore_listeners||n.listen_x(t),n.x),n.y=e,n._construct?n.y:(null==n.listen_y||n.ignore_listeners||n.listen_y(e),n.y),n.ignore_listeners=r,null==n.listen_x||n.ignore_listeners||n.listen_x(n.x),null==n.listen_y||n.ignore_listeners||n.listen_y(n.y),s=n}(this))}},set:function(t){this.set_xywh(t.x,t.y,t.w,t.h)},__class__:En});var Mn=function(t){if(this.dirty_align=!0,this.dirty_sizing=!0,this.point_ratio=1,this.text_h_h=0,this.text_h_w=0,this.text_height=0,this.text_width=0,this.glow_amount=0,this.glow_threshold=0,this.outline=0,this.thickness=.5,this.smoothness=.75,this.unique=!1,this.sdf=!1,this.bounds_wrap=!1,this.letter_spacing=0,this.line_spacing=0,this.point_size=32,this.text="",this.options=t,this.emitter=new x,null==this.options)throw new Ie(ei.null_assertion("options was null ( TextGeometry requires non-null options )"));null!=this.options.sdf&&(this.sdf=this.options.sdf),null==this.options.font&&(this.options.font=m.renderer.font),this.font=this.options.font,this.font==m.renderer.font&&(this.sdf=!0),null==this.options.shader?this.options.shader=this.sdf?m.renderer.shaders.bitmapfont.shader:m.renderer.shaders.textured.shader:this.options.shader!=m.renderer.shaders.bitmapfont.shader&&(this.unique=!0),this.options.primitive_type=4,yn.call(this,this.options),this.cache=[],this.line_widths=[],this.line_offsets=[[],[]],this.lines=[],this.set_outline_color(new F),this.set_glow_color(new F),this.default_options()};r["phoenix.geometry.TextGeometry"]=Mn,Mn.__name__=["phoenix","geometry","TextGeometry"],Mn.__super__=yn,Mn.prototype=i(yn.prototype,{tidy:function(){var t=Math.floor(this.vertices.length/6),e=this.cache.length-t;if(e>0)for(var i=this.cache.splice(t,e),s=i.length;s>0;){s--;var n=i.pop();n=null}},default_options:function(){this.set_texture(this.font.pages.h[0]),null!=this.options.letter_spacing&&this.set_letter_spacing(this.options.letter_spacing),null!=this.options.line_spacing&&this.set_line_spacing(this.options.line_spacing),null!=this.options.point_size&&this.set_point_size(this.options.point_size),null!=this.options.bounds&&this.set_bounds(this.options.bounds),null!=this.options.bounds_wrap&&this.set_bounds_wrap(this.options.bounds_wrap),null==this.options.align&&(this.options.align=0),this.options.align,null==this.options.align_vertical&&(this.options.align_vertical=3),this.options.align_vertical,this.set_align(this.options.align),this.set_align_vertical(this.options.align_vertical),null!=this.options.thickness&&this.set_thickness(this.options.thickness),null!=this.options.smoothness&&this.set_smoothness(this.options.smoothness),null!=this.options.outline&&this.set_outline(this.options.outline),null!=this.options.outline_color&&this.set_outline_color(this.options.outline_color),null!=this.options.glow_threshold&&this.set_glow_threshold(this.options.glow_threshold),null!=this.options.glow_amount&&this.set_glow_amount(this.options.glow_amount),null!=this.options.glow_color&&this.set_glow_color(this.options.glow_color),this.sdf&&this.flush_uniforms(),null!=this.options.text&&this.set_text(this.options.text)},set_text:function(t){return null==t&&(t=""),this.text!=t&&(this.text=t,""!=this.text?(this.set_dirty_sizing(!0),this.update_text()):this.vertices.splice(0,this.vertices.length)),this.text},stats:function(){return"letters:"+this.vertices.length/6+" / cache:"+this.cache.length},update_sizes:function(){if(!this.dirty_sizing)return!1;var t=Mn.tab_regex.replace(this.text,"    ");return this.bounds_wrap&&null!=this.bounds&&(t=this.font.wrap_string_to_bounds(t,this.bounds,this.point_size,this.letter_spacing)),this.lines.splice(0,this.lines.length),this.lines=t.split("\n"),this.line_widths.splice(0,this.line_widths.length),this.text_width=this.font.width_of(t,this.point_size,this.letter_spacing,this.line_widths),this.text_height=this.font.height_of_lines(this.lines,this.point_size,this.line_spacing),this.text_h_w=this.text_width/2,this.text_h_h=this.text_height/2,this.point_ratio=this.point_size/this.font.info.point_size,this.set_dirty_sizing(!1),!0},update_text:function(){var t=this,e=0,i=0,s=null!=this.bounds;s&&(this.transform.local.pos.set_x(e=this.bounds.x),this.transform.local.pos.set_y(i=this.bounds.y));for(var n=0,r=0,o=0,l=0,a=!0,h=(this.update_sizes(),0),_=this.lines;h<_.length;){var u=_[h];++h;var c=0,d=0;if(this.dirty_align){if(s){var f=this.align;switch(f){case 2:c=-(this.line_widths[o]/2)+this.bounds.w/2;break;case 1:c=-this.line_widths[o]+this.bounds.w;break;default:c=0}var p=this.align_vertical;switch(p){case 2:d=this.bounds.h/2-this.text_h_h;break;case 4:d=this.bounds.h-this.text_height;break;default:d=0}}else{var g=this.align;switch(g){case 2:c=-(this.line_widths[o]/2);break;case 1:c=-this.line_widths[o];break;default:c=0}var m=this.align_vertical;switch(m){case 2:d=-this.text_h_h;break;case 4:d=-this.text_height;break;default:d=0}}this.line_offsets[0][o]=c,this.line_offsets[1][o]=d}else c=this.line_offsets[0][o],d=this.line_offsets[1][o];0!=o&&(r+=(t.font.info.line_height+t.line_spacing)*t.point_ratio,n=0);for(var v=0,y=0,w=u,x=0,b=u.length;b>x;){var k;y=x,x+=Gs.codePointWidthAt(w,x),k=Us.codePointAt(w,y);var z=k,S=this.font.info.chars.h[z];if(a=null!=S&&z>32,a||(S=this.font.space_char),a){var T=c+n+S.xoffset*this.point_ratio,A=d+r+S.yoffset*this.point_ratio,I=this.font.pages.h[S.page],E=S.x/I.width_actual,M=S.y/I.height_actual,C=(S.x+S.width)/I.width_actual,R=(S.y+S.height)/I.height_actual;this.update_char(l,T,A,S.width*this.point_ratio,S.height*this.point_ratio,E,M,C,R,this.color),l++}var B=S.xadvance;v<u.length-1&&(B+=this.font.kerning(z,Os.uCharCodeAt(u,v+1)),z>=32&&(B+=this.letter_spacing)),B*=this.point_ratio,n+=B,v++}o++}var F=this.vertices.length/6|0,P=F-l;P>0&&this.vertices.splice(6*l,6*P),this.dirty_align=!1,this.emitter.emit(1)},update_char:function(t,e,i,s,n,r,o,l,a,h){var _,u,c,d,f,p,g=this.cache[t];if(null==g)_=new Bn(new y(e,i),h),u=new Bn(new y(e+s,i),h),c=new Bn(new y(e+s,i+n),h),d=new Bn(new y(e,i+n),h),f=new Bn(new y(e,i),h),p=new Bn(new y(e+s,i+n),h),g=[_,u,c,d,f,p],this.cache[t]=g;else{_=g[0],u=g[1],c=g[2],d=g[3],f=g[4],p=g[5];var m=_.pos,v=m.ignore_listeners;m.ignore_listeners=!0,m.x=e,m._construct?m.x:(null==m.listen_x||m.ignore_listeners||m.listen_x(e),m.x),m.y=i,m._construct?m.y:(null==m.listen_y||m.ignore_listeners||m.listen_y(i),m.y),m.ignore_listeners=v,null==m.listen_x||m.ignore_listeners||m.listen_x(m.x),null==m.listen_y||m.ignore_listeners||m.listen_y(m.y);var w=u.pos,x=e+s,b=w.ignore_listeners;w.ignore_listeners=!0,w.x=x,w._construct?w.x:(null==w.listen_x||w.ignore_listeners||w.listen_x(x),w.x),w.y=i,w._construct?w.y:(null==w.listen_y||w.ignore_listeners||w.listen_y(i),w.y),w.ignore_listeners=b,null==w.listen_x||w.ignore_listeners||w.listen_x(w.x),null==w.listen_y||w.ignore_listeners||w.listen_y(w.y);var k=c.pos,z=e+s,S=i+n,T=k.ignore_listeners;k.ignore_listeners=!0,k.x=z,k._construct?k.x:(null==k.listen_x||k.ignore_listeners||k.listen_x(z),k.x),k.y=S,k._construct?k.y:(null==k.listen_y||k.ignore_listeners||k.listen_y(S),k.y),k.ignore_listeners=T,null==k.listen_x||k.ignore_listeners||k.listen_x(k.x),null==k.listen_y||k.ignore_listeners||k.listen_y(k.y);var A=d.pos,I=i+n,E=A.ignore_listeners;A.ignore_listeners=!0,A.x=e,A._construct?A.x:(null==A.listen_x||A.ignore_listeners||A.listen_x(e),A.x),A.y=I,A._construct?A.y:(null==A.listen_y||A.ignore_listeners||A.listen_y(I),A.y),A.ignore_listeners=E,null==A.listen_x||A.ignore_listeners||A.listen_x(A.x),null==A.listen_y||A.ignore_listeners||A.listen_y(A.y);var M=f.pos,C=M.ignore_listeners;M.ignore_listeners=!0,M.x=e,M._construct?M.x:(null==M.listen_x||M.ignore_listeners||M.listen_x(e),M.x),M.y=i,M._construct?M.y:(null==M.listen_y||M.ignore_listeners||M.listen_y(i),M.y),M.ignore_listeners=C,null==M.listen_x||M.ignore_listeners||M.listen_x(M.x),null==M.listen_y||M.ignore_listeners||M.listen_y(M.y);var R=p.pos,B=e+s,F=i+n,P=R.ignore_listeners;R.ignore_listeners=!0,R.x=B,R._construct?R.x:(null==R.listen_x||R.ignore_listeners||R.listen_x(B),R.x),R.y=F,R._construct?R.y:(null==R.listen_y||R.ignore_listeners||R.listen_y(F),R.y),R.ignore_listeners=P,null==R.listen_x||R.ignore_listeners||R.listen_x(R.x),null==R.listen_y||R.ignore_listeners||R.listen_y(R.y)}_.uv.uv0.set_uv(r,o),u.uv.uv0.set_uv(l,o),c.uv.uv0.set_uv(l,a),d.uv.uv0.set_uv(r,a),f.uv.uv0.set_uv(r,o),p.uv.uv0.set_uv(l,a);var N=Math.floor(this.vertices.length/6);t>=N&&(this.add(_),this.add(u),this.add(c),this.add(d),this.add(f),this.add(p))},set_dirty_sizing:function(t){return this.dirty_align=!0,this.dirty_sizing=t},set_bounds:function(t){return this.bounds=t,this.set_dirty_sizing(!0),this.update_text(),this.bounds},set_bounds_wrap:function(t){return this.bounds_wrap=t,this.set_dirty_sizing(!0),this.update_text(),this.bounds_wrap},set_line_spacing:function(t){return this.line_spacing=t,this.set_dirty_sizing(!0),this.update_text(),this.line_spacing},set_letter_spacing:function(t){return this.letter_spacing=t,this.set_dirty_sizing(!0),this.update_text(),this.letter_spacing},set_align:function(t){return this.align=t,this.dirty_align=!0,this.update_text(),this.align},set_align_vertical:function(t){return this.align_vertical=t,this.dirty_align=!0,this.update_text(),this.align_vertical},set_point_size:function(t){return 0>t&&(t=0),this.point_size=t,this.set_dirty_sizing(!0),this.update_text(),this.point_size},set_smoothness:function(t){return 0>t&&(t=0),null!=this.state.shader&&this.sdf&&this.unique&&this.state.shader.set_float("smoothness",t),this.smoothness=t},set_thickness:function(t){return 0>t&&(t=0),null!=this.state.shader&&this.sdf&&this.unique&&this.state.shader.set_float("thickness",t),this.thickness=t},set_outline:function(t){return t=0>t?0:t>1?1:t,null!=this.state.shader&&this.sdf&&this.unique&&this.state.shader.set_float("outline",t),this.outline=t},set_glow_threshold:function(t){return 0>t&&(t=0),null!=this.state.shader&&this.sdf&&this.unique&&this.state.shader.set_float("glow_threshold",t),this.glow_threshold=t},set_glow_amount:function(t){return 0>t&&(t=0),null!=this.state.shader&&this.sdf&&this.unique&&this.state.shader.set_float("glow_amount",t),this.glow_amount=t},set_outline_color:function(t){return null!=this.state.shader&&this.sdf&&this.unique&&this.state.shader.set_color("outline_color",t),this.outline_color=t},set_glow_color:function(t){return null!=this.state.shader&&this.sdf&&this.unique&&this.state.shader.set_color("glow_color",t),this.glow_color=t},flush_uniforms:function(){null!=this.state.shader&&this.sdf&&(this.state.shader.set_float("smoothness",this.smoothness),this.state.shader.set_float("thickness",this.thickness),this.state.shader.set_float("outline",this.outline),this.state.shader.set_float("glow_threshold",this.glow_threshold),this.state.shader.set_float("glow_amount",this.glow_amount),this.state.shader.set_color("outline_color",this.outline_color),this.state.shader.set_color("glow_color",this.glow_color))},__class__:Mn,__properties__:i(yn.prototype.__properties__,{set_dirty_sizing:"set_dirty_sizing",set_glow_color:"set_glow_color",set_glow_amount:"set_glow_amount",set_glow_threshold:"set_glow_threshold",set_outline_color:"set_outline_color",set_outline:"set_outline",set_thickness:"set_thickness",set_smoothness:"set_smoothness",set_align_vertical:"set_align_vertical",set_align:"set_align",set_bounds_wrap:"set_bounds_wrap",set_bounds:"set_bounds",set_letter_spacing:"set_letter_spacing",set_line_spacing:"set_line_spacing",set_point_size:"set_point_size",set_text:"set_text"})});var Cn=function(){this.uv0=new Rn,this.uv1=new Rn,this.uv2=new Rn,this.uv3=new Rn,this.uv4=new Rn,this.uv5=new Rn,this.uv6=new Rn,this.uv7=new Rn};r["phoenix.geometry.TextureCoordSet"]=Cn,Cn.__name__=["phoenix","geometry","TextureCoordSet"],Cn.prototype={clone:function(){var t=new Cn;return t.uv0.set(this.uv0.u,this.uv0.v,this.uv0.w,this.uv0.t),t.uv1.set(this.uv1.u,this.uv1.v,this.uv1.w,this.uv1.t),t.uv2.set(this.uv2.u,this.uv2.v,this.uv2.w,this.uv2.t),t.uv3.set(this.uv3.u,this.uv3.v,this.uv3.w,this.uv3.t),t.uv4.set(this.uv4.u,this.uv4.v,this.uv4.w,this.uv4.t),t.uv5.set(this.uv5.u,this.uv5.v,this.uv5.w,this.uv5.t),t.uv6.set(this.uv6.u,this.uv6.v,this.uv6.w,this.uv6.t),t.uv7.set(this.uv7.u,this.uv7.v,this.uv7.w,this.uv7.t),t},__class__:Cn};var Rn=function(t,e,i,s){null==s&&(s=0),null==i&&(i=0),null==e&&(e=0),null==t&&(t=0),this.t=0,this.w=0,this.v=0,this.u=0,this.u=t,this.v=e,this.w=i,this.t=s};r["phoenix.geometry.TextureCoord"]=Rn,Rn.__name__=["phoenix","geometry","TextureCoord"],Rn.prototype={clone:function(){return new Rn(this.u,this.v,this.w,this.t)},set:function(t,e,i,s){return this.u=t,this.v=e,this.w=i,this.t=s,this},set_uv:function(t,e){return this.u=t,this.v=e,this
},toString:function(){return"{ u:"+this.v+", v:"+this.v+" }"},__class__:Rn};var Bn=function(t,e,i){this.uv=new Cn,this.pos=t,this.color=null==e?new F:e,this.normal=null==i?new y:i};r["phoenix.geometry.Vertex"]=Bn,Bn.__name__=["phoenix","geometry","Vertex"],Bn.prototype={clone:function(){var t=new Bn(this.pos.clone(),this.color.clone(),this.normal.clone());return t.uv=this.uv.clone(),t},__class__:Bn};var Fn=function(){};r["phoenix.utils.Rendering"]=Fn,Fn.__name__=["phoenix","utils","Rendering"],Fn.gl_blend_mode_from_BlendMode=function(t){switch(t){case 0:return 0;case 1:return 1;case 768:return 768;case 769:return 769;case 770:return 770;case 771:return 771;case 772:return 772;case 773:return 773;case 774:return 774;case 775:return 775;case 776:return 776}},Fn.fovx_to_y=function(t,e){return 180/Math.PI*2*Math.atan(Math.tan(t*(Math.PI/180)/2)*(1/e))};var Pn=function(){this.overflow=0,this.frame_time=.0167,Le.call(this)};r["snow.AppFixedTimestep"]=Pn,Pn.__name__=["snow","AppFixedTimestep"],Pn.__super__=Le,Pn.prototype=i(Le.prototype,{on_internal_init:function(){Le.prototype.on_internal_init.call(this),this.frame_time=.016666666666666666,this.last_frame_start=Nn.core.timestamp()},on_internal_update:function(){for(this.cur_frame_start=Nn.core.timestamp(),this.delta_time=this.cur_frame_start-this.last_frame_start,this.delta_sim=this.delta_time*this.timescale,this.delta_sim>this.max_frame_time&&(this.delta_sim=this.max_frame_time),this.last_frame_start=this.cur_frame_start,this.overflow+=this.delta_sim;this.overflow>=this.frame_time;)this.app.do_internal_update(this.frame_time*this.timescale),this.current_time+=this.frame_time*this.timescale,this.overflow-=this.frame_time*this.timescale;this.alpha=this.overflow/this.frame_time},__class__:Pn});var Nn=function(){this.is_ready=!1,this.was_ready=!1,this.has_shutdown=!1,this.shutting_down=!1,this.debug=!1,this.os="unknown",this.platform="unknown",this.freeze=!1,this.platform="web",Nn.core=new Qn(this),Nn.next_queue=[],Nn.defer_queue=[]};r["snow.Snow"]=Nn,Nn.__name__=["snow","Snow"],Nn.__properties__={get_timestamp:"get_timestamp"},Nn.next=function(t){null!=t&&Nn.next_queue.push(t)},Nn.defer=function(t){null!=t&&Nn.defer_queue.push(t)},Nn.get_timestamp=function(){return Nn.core.timestamp()},Nn.prototype={shutdown:function(){this.shutting_down=!0,this.host.ondestroy(),this.io.module.destroy(),this.audio.destroy(),this.input.destroy(),this.windowing.destroy(),Nn.core.shutdown(),this.has_shutdown=!0},render:function(){this.windowing.update()},dispatch_system_event:function(t){this.on_event(t)},init:function(t,e){this.snow_config=t,null==this.snow_config.app_package&&(this.snow_config.app_package="org.snowkit.snow"),null==this.snow_config.config_path&&(this.snow_config.config_path=""),this.config=this.default_config(),this.host=e,this.host.app=this,Nn.core.init(n(this,this.on_event))},on_snow_init:function(){this.host.on_internal_init()},on_snow_ready:function(){var t=this;if(this.was_ready)throw new Ie(br.error("firing ready event more than once is invalid usage"));for(this.io=new yr(this),this.input=new vr(this),this.audio=new mr(this),this.assets=new gr(this),this.windowing=new xr(this),this.was_ready=!0,this.setup_app_path(),this.setup_configs().then(function(){t.setup_default_window(),Nn.next(n(t,t.on_ready))}).error(function(t){throw new Ie(br.init("snow / cannot recover from error: "+t))}),Hn.step();Nn.next_queue.length>0;)this.cycle_next_queue();for(;Nn.defer_queue.length>0;)this.cycle_defer_queue()},do_internal_update:function(t){this.io.module.update(),this.input.update(),this.audio.update(),this.host.update(t)},on_ready:function(){this.is_ready=!0,this.host.ready()},on_snow_update:function(){this.freeze||(qn.update(),Hn.step(),this.cycle_next_queue(),this.is_ready&&(this.host.ontickstart(),this.host.on_internal_update(),this.host.on_internal_render(),this.host.ontickend(),this.cycle_defer_queue()))},on_event:function(t){3!=t.type&&0!=t.type&&5!=t.type&&6!=t.type,3!=t.type,this.is_ready&&(this.io.module.on_event(t),this.audio.on_event(t),this.windowing.on_event(t),this.input.on_event(t)),this.host.onevent(t);var e=t.type;if(null!=e)switch(e){case 1:this.on_snow_init();break;case 2:this.on_snow_ready();break;case 3:this.on_snow_update();break;case 7:case 8:this.shutdown();break;case 4:}},cycle_next_queue:function(){for(var t=Nn.next_queue.length,e=0;t>e;)Nn.next_queue.shift()(),++e},cycle_defer_queue:function(){for(var t=Nn.defer_queue.length,e=0;t>e;)Nn.defer_queue.shift()(),++e},setup_app_path:function(){},setup_configs:function(){var t=this;return""==this.snow_config.config_path?(this.setup_host_config(),Un.resolve()):new Un(function(e){t.default_runtime_config().then(function(e){t.config.runtime=e}).error(function(t){throw new Ie(br.init("config / failed / default runtime config failed to parse as JSON. cannot recover. "+t))}).then(function(){t.setup_host_config(),e()})})},setup_host_config:function(){this.config=this.host.config(this.config)},setup_default_window:function(){if(1==this.config.has_window&&(this.window=this.windowing.create(this.config.window),null==this.window.handle))throw new Ie(br.windowing("requested default window cannot be created. cannot continue"))},default_config:function(){return{has_window:!0,runtime:{},window:this.default_window_config(),render:this.default_render_config(),web:{no_context_menu:!0,prevent_default_keys:[tr.left,tr.right,tr.up,tr.down,tr.backspace,tr.tab,tr["delete"],tr.space],prevent_default_mouse_wheel:!0,true_fullscreen:!1},"native":{audio_buffer_length:176400,audio_buffer_count:4}}},default_runtime_config:function(){var t=this;return new Un(function(e,i){var s=t.io.data_flow(we.join([t.assets.root,t.snow_config.config_path]),pr.processor);s.then(e).error(function(t){switch(t[1]){case 3:{t[2]}i(t);break;default:e()}})})},default_render_config:function(){return{depth:!1,stencil:!1,antialiasing:0,red_bits:8,green_bits:8,blue_bits:8,alpha_bits:8,depth_bits:0,stencil_bits:0,opengl:{minor:0,major:0,profile:0}}},default_window_config:function(){var t={fullscreen_desktop:!0,fullscreen:!1,borderless:!1,resizable:!0,x:536805376,y:536805376,width:960,height:640,title:"snow app"};return t},set_freeze:function(t){return this.freeze=t,t?this.audio.suspend():this.audio.resume(),this.freeze},get_time:function(){return Nn.core.timestamp()},get_uniqueid:function(){return this.make_uniqueid()},make_uniqueid:function(t){null==t&&(t=C.random(2147483647));var e=t%62|0,i=t/62|0;return i>0?this.make_uniqueid(i)+(e>9?function(){var t,i=65+(e-10);return i>90&&(i+=6),t=String.fromCharCode(i)}(this):(null==e?"null":""+e).charAt(0)):C.string(e>9?function(){var t,i=65+(e-10);return i>90&&(i+=6),t=String.fromCharCode(i)}(this):(null==e?"null":""+e).charAt(0))},typename:function(t){return V.getClassName(V.getClass(t))},__class__:Nn,__properties__:{set_freeze:"set_freeze",get_uniqueid:"get_uniqueid",get_time:"get_time"}};var Gn=r["snow.api._Debug.LogError"]={__ename__:["snow","api","_Debug","LogError"],__constructs__:["RequireString"]};Gn.RequireString=function(t){var e=["RequireString",0,t];return e.__enum__=Gn,e.toString=o,e};var Dn=function(){};r["snow.api.Debug"]=Dn,Dn.__name__=["snow","api","Debug"],Dn._get_spacing=function(t){var e="",i=t.length+4,s=Dn._log_width-i;if(s>0)for(var n=0;s>n;){{n++}e+=" "}return e};var Ln=r["snow.api.DebugError"]={__ename__:["snow","api","DebugError"],__constructs__:["assertion","null_assertion"]};Ln.assertion=function(t){var e=["assertion",0,t];return e.__enum__=Ln,e.toString=o,e},Ln.null_assertion=function(t){var e=["null_assertion",1,t];return e.__enum__=Ln,e.toString=o,e};var On=function(){};r["snow.api.Libs"]=On,On.__name__=["snow","api","Libs"],On.tryLoad=function(){return null},On.findHaxeLib=function(){try{}catch(t){t instanceof Ie&&(t=t.val)}return""},On.get_system_name=function(){return window.navigator.userAgent},On.web_add_lib=function(t,e){null==On._web_libs&&(On._web_libs=new de);var i=e;return On._web_libs.set(t,i),!0},On.web_lib_load=function(t,e){null==On._web_libs&&(On._web_libs=new de);var i=On._web_libs.get(t);return null!=i?I.field(i,e):null},On.load=function(t,e,i){null==i&&(i=0);var s=On.web_lib_load(t,e);if(s)return s;null==On.__moduleNames&&(On.__moduleNames=new de),On.__moduleNames.exists(t),On.__moduleNames.set(t,t);var n=On.tryLoad("./"+t,t,e,i);if(null==n&&(n=On.tryLoad(".\\"+t,t,e,i)),null==n&&(n=On.tryLoad(t,t,e,i)),null==n){var r;r="windows"==function(){var t,e=On.get_system_name();return t=d.substr(e,7,null)}(this).toLowerCase()?"\\":"/";var o=On.findHaxeLib("snow");""!=o&&(n=On.tryLoad(o+r+"ndll"+r+On.get_system_name()+r+t,t,e,i),null==n&&(n=On.tryLoad(o+r+"ndll"+r+On.get_system_name()+"64"+r+t,t,e,i)))}return On.loaderTrace("Result : "+C.string(n)),n},On.loaderTrace=function(){};var Un=function(t){this.was_caught=!1;var e=this;this.state=0,this.reject_reactions=[],this.fulfill_reactions=[],this.settle_reactions=[],Hn.queue(function(){t(n(e,e.onfulfill),n(e,e.onreject)),Hn.defer(Hn.next)})};r["snow.api.Promise"]=Un,Un.__name__=["snow","api","Promise"],Un.all=function(t){return new Un(function(e,i){for(var s=0,n=t.length,r=[],o=null,l=0,a=function(t,i){0==l&&(s++,r[t]=i,n==s&&(l=1,e(r)))},h=function(t){0==l&&(l=2,o=t,i(o))},_=0,u=0;u<t.length;){var c=t[u];++u,c.then(function(t,e){return function(i){t(e,i)}}(a,_)).error(h),_++}})},Un.race=function(t){return new Un(function(e,i){for(var s=!1,n=function(t){s||(s=!0,e(t))},r=function(t){s||(s=!0,i(t))},o=0;o<t.length;){var l=t[o];++o,l.then(n).error(r)}})},Un.reject=function(t){return new Un(function(e,i){i(t)})},Un.resolve=function(t){return new Un(function(e){e(t)})},Un.prototype={then:function(t,e){var i=this.state;switch(i){case 0:return this.add_fulfill(t),this.add_reject(e),this.new_linked_promise();case 1:return Hn.defer(t,this.result),Un.resolve(this.result);case 2:return Hn.defer(e,this.result),Un.reject(this.result)}},error:function(t){var e=this.state;switch(e){case 0:return this.add_reject(t),this.new_linked_resolve_empty();case 1:return Un.resolve(this.result);case 2:return Hn.defer(t,this.result),Un.reject(this.result)}},toString:function(){return"Promise { state:"+this.state_string()+", result:"+C.string(this.result)+" }"},add_settle:function(t){0==this.state?this.settle_reactions.push(t):Hn.defer(t,this.result)},new_linked_promise:function(){var t=this;return new Un(function(e,i){t.add_settle(function(){1==t.state?e(t.result):i(t.result)})})},new_linked_resolve:function(){var t=this;return new Un(function(e){t.add_settle(function(t){e(t)})})},new_linked_reject:function(){var t=this;return new Un(function(e,i){t.add_settle(function(t){i(t)})})},new_linked_resolve_empty:function(){var t=this;return new Un(function(e){t.add_settle(function(){e()})})},new_linked_reject_empty:function(){var t=this;return new Un(function(e,i){t.add_settle(function(){i()})})},add_fulfill:function(t){null!=t&&this.fulfill_reactions.push(t)},add_reject:function(t){null!=t&&(this.was_caught=!0,this.reject_reactions.push(t))},onfulfill:function(t){for(this.state=1,this.result=t;this.fulfill_reactions.length>0;){var e=this.fulfill_reactions.shift();e(this.result)}this.onsettle()},onreject:function(t){for(this.state=2,this.result=t;this.reject_reactions.length>0;){var e=this.reject_reactions.shift();e(this.result)}this.onsettle()},onsettle:function(){for(;this.settle_reactions.length>0;){var t=this.settle_reactions.shift();t(this.result)}},onexception:function(t){var e=this;this.add_settle(function(){if(!e.was_caught&&2==e.state)throw new Ie(Vn.UnhandledPromiseRejection(e.toString()))}),0==this.state&&this.onreject(t)},state_string:function(){var t=this.state;switch(t){case 0:return"pending";case 1:return"fulfilled";case 2:return"rejected"}},__class__:Un};var Hn=function(){};r["snow.api.Promises"]=Hn,Hn.__name__=["snow","api","Promises"],Hn.step=function(){for(Hn.next();Hn.defers.length>0;){var t=Hn.defers.shift();t.f(t.a)}},Hn.next=function(){Hn.calls.length>0&&Hn.calls.shift()()},Hn.defer=function(t,e){null!=t&&Hn.defers.push({f:t,a:e})},Hn.queue=function(t){null!=t&&Hn.calls.push(t)};var Vn=r["snow.api.PromiseError"]={__ename__:["snow","api","PromiseError"],__constructs__:["UnhandledPromiseRejection"]};Vn.UnhandledPromiseRejection=function(t){var e=["UnhandledPromiseRejection",0,t];return e.__enum__=Vn,e.toString=o,e};var qn=function(t){this.time=t,qn.running_timers.push(this),this.fire_at=Nn.core.timestamp()+this.time,this.running=!0};r["snow.api.Timer"]=qn,qn.__name__=["snow","api","Timer"],qn.measure=function(t,e){var i=Nn.core.timestamp(),s=t();return $.trace(Nn.core.timestamp()-i+"s",e),s},qn.update=function(){for(var t=Nn.core.timestamp(),e=0,i=qn.running_timers;e<i.length;){var s=i[e];++e,s.running&&s.fire_at<t&&(s.fire_at+=s.time,s.run())}},qn.delay=function(t,e){var i=new qn(t);return i.run=function(){i.stop(),e()},i},qn.prototype={run:function(){},stop:function(){this.running&&(this.running=!1,d.remove(qn.running_timers,this))},__class__:qn};var jn={};r["snow.api.buffers._Float32Array.Float32Array_Impl_"]=jn,jn.__name__=["snow","api","buffers","_Float32Array","Float32Array_Impl_"],jn.fromBytes=function(t,e,i){return null==e&&(e=0),null==e?new Float32Array(t.b.bufferValue):null==i?new Float32Array(t.b.bufferValue,e):new Float32Array(t.b.bufferValue,e,i)},jn.toBytes=function(t){return new oe(new Yr(t.buffer))},jn.toString=function(t){return"Float32Array [byteLength:"+t.byteLength+", length:"+t.length+"]"};var Zn={};r["snow.api.buffers._Int32Array.Int32Array_Impl_"]=Zn,Zn.__name__=["snow","api","buffers","_Int32Array","Int32Array_Impl_"],Zn.fromBytes=function(t,e,i){return null==e&&(e=0),null==e?new Int32Array(t.b.bufferValue):null==i?new Int32Array(t.b.bufferValue,e):new Int32Array(t.b.bufferValue,e,i)},Zn.toBytes=function(t){return new oe(new Yr(t.buffer))},Zn.toString=function(t){return"Int32Array [byteLength:"+t.byteLength+", length:"+t.length+"]"};var Kn={};r["snow.api.buffers._Uint8Array.Uint8Array_Impl_"]=Kn,Kn.__name__=["snow","api","buffers","_Uint8Array","Uint8Array_Impl_"],Kn.fromBytes=function(t,e,i){return null==e?new Yr(t.b.bufferValue):null==i?new Yr(t.b.bufferValue,e):new Yr(t.b.bufferValue,e,i)},Kn.toBytes=function(t){return new oe(new Yr(t.buffer))},Kn.toString=function(t){return"Uint8Array [byteLength:"+t.byteLength+", length:"+t.length+"]"};var Qn=function(t){this._time_now=0,this._lf_timestamp=.016,this.start_timestamp=0,this.app=t,this.start_timestamp=this.timestamp(),this.guess_os()};r["snow.core.web.Core"]=Qn,Qn.__name__=["snow","core","web","Core"],Qn.prototype={init:function(){this.app.on_event({type:1}),this.app.on_event({type:2}),this.app.snow_config.has_loop&&this.request_update()},shutdown:function(){},timestamp:function(){var t;return t=null!=window.performance?window.performance.now()/1e3:ie.stamp(),t-this.start_timestamp},request_update:function(){var t=this;null!=(Ur=window,n(Ur,Ur.requestAnimationFrame))?window.requestAnimationFrame(n(this,this.snow_core_loop)):window.setTimeout(function(){var e=t.timestamp();t._time_now+=e-t._lf_timestamp,t.snow_core_loop(1e3*t._time_now),t._lf_timestamp=e},1e3*this.app.host.render_rate|0)},snow_core_loop:function(t){return null==t&&(t=.016),this.update(),this.app.on_event({type:3}),this.request_update(),!0},update:function(){},guess_os:function(){var t=window.navigator.appVersion,e=window.navigator.userAgent;(function(){var e,i=new _("mac","gi");return e=i.match(t)})(this)&&(this.app.os="mac"),function(){var e,i=new _("win","gi");return e=i.match(t)}(this)&&(this.app.os="windows"),function(){var e,i=new _("x11","gi");return e=i.match(t)}(this)&&(this.app.os="linux"),function(){var e,i=new _("linux","gi");return e=i.match(t)}(this)&&(this.app.os="linux"),function(){var e,i=new _("android","gi");return e=i.match(t)}(this)&&(this.app.os="android"),function(){var t,i=new _("ipad","gi");return t=i.match(e)}(this)&&(this.app.os="ios"),function(){var t,i=new _("iphone","gi");return t=i.match(e)}(this)&&(this.app.os="ios"),function(){var t,i=new _("ipod","gi");return t=i.match(e)}(this)&&(this.app.os="ios")},__class__:Qn};var Xn=function(){};r["snow.modules.interfaces.Assets"]=Xn,Xn.__name__=["snow","modules","interfaces","Assets"],Xn.prototype={__class__:Xn};var Wn=function(t){this.system=t};r["snow.core.web.assets.Assets"]=Wn,Wn.__name__=["snow","core","web","assets","Assets"],Wn.__interfaces__=[Xn],Wn.prototype={init:function(){},update:function(){},destroy:function(){},on_event:function(){},image_load_info:function(t,e){return null==e&&(e=4),this.system.app.io.data_flow(t,cr.processor)},image_info_from_element:function(t,e){var i=this.nearest_power_of_two(e.width),s=this.nearest_power_of_two(e.height),n=this.POT_bytes_from_element(e.width,e.height,i,s,e),r={id:t,bpp:4,width:e.width,height:e.height,width_actual:i,height_actual:s,bpp_source:4,pixels:n};return n=null,r},image_info_from_pixels:function(t,e,i,s){var n=this.nearest_power_of_two(e),r=this.nearest_power_of_two(i),o=this.POT_bytes_from_pixels(e,i,n,r,s),l={id:t,bpp:4,width:e,height:i,width_actual:n,height_actual:r,bpp_source:4,pixels:o};return o=null,l},image_info_from_bytes:function(t,e,i){null==i&&(i=4);var s=this;if(null==t)throw new Ie(Ln.null_assertion("_id was null"));if(null==e)throw new Ie(Ln.null_assertion("_bytes was null"));if(0==e.length)throw new Ie(Ln.assertion("_bytes.length != 0"));var n=we.extension(t);return new Un(function(i,r){for(var o="",l=0,a=e.length;a>l;)o+=String.fromCharCode(function(){var t,i,s=l++;return i=e[s],t=255&i}(this));var h=window.btoa(o),_="data:image/"+n+";base64,"+h,u=new Image;u.onload=function(){var e=s.image_info_from_element(t,u);i(e)},u.onerror=function(t){r(br.error("failed to load image from bytes, on error: "+t))},u.src=_})},POT_bytes_from_pixels:function(t,e,i,s,n){var r,o=window.document;r=o.createElement("canvas"),r.width=i,r.height=s;var l=r.getContext("2d",null);l.clearRect(0,0,r.width,r.height);var a=null,h=new Uint8ClampedArray(n.buffer),_=l.createImageData(t,e);_.data.set(h);try{l.putImageData(_,0,0),a=l.getImageData(0,0,r.width,r.height)}catch(u){u instanceof Ie&&(u=u.val);var c="- textures served from file:/// throw security errors\n";throw c+="- textures served over http:// work for cross origin byte requests",new Ie(u)}r=null,l=null,_=null;var d,f=a.data;return d=null!=f?new Yr(f):null},POT_bytes_from_element:function(t,e,i,s,n){var r,o=window.document;r=o.createElement("canvas"),r.width=i,r.height=s;var l=r.getContext("2d",null);l.clearRect(0,0,r.width,r.height),l.drawImage(n,0,0,t,e);var a=null;try{a=l.getImageData(0,0,r.width,r.height)}catch(h){h instanceof Ie&&(h=h.val);var _="- textures served from file:/// throw security errors\n";throw _+="- textures served over http:// work for cross origin byte requests",new Ie(h)}r=null,l=null;var u,c=a.data;return u=null!=c?new Yr(c):null},nearest_power_of_two:function(t){return Wn.POT?(t--,t|=t>>1,t|=t>>2,t|=t>>4,t|=t>>8,t|=t>>16,t++,t):t},__class__:Wn};var Yn=function(){};r["snow.core.web.input.DOMKeys"]=Yn,Yn.__name__=["snow","core","web","input","DOMKeys"],Yn.dom_key_to_keycode=function(t){switch(t){case 16:return tr.lshift;case 17:return tr.lctrl;case 18:return tr.lalt;case 20:return tr.capslock;case 33:return tr.pageup;case 34:return tr.pagedown;case 35:return tr.end;case 36:return tr.home;case 37:return tr.left;case 38:return tr.up;case 39:return tr.right;case 40:return tr.down;case 44:return tr.printscreen;case 45:return tr.insert;case 46:return tr["delete"];case 91:return tr.lmeta;case 93:return tr.rmeta;case 224:return tr.lmeta;case 96:return tr.kp_0;case 97:return tr.kp_1;case 98:return tr.kp_2;case 99:return tr.kp_3;case 100:return tr.kp_4;case 101:return tr.kp_5;case 102:return tr.kp_6;case 103:return tr.kp_7;case 104:return tr.kp_8;case 105:return tr.kp_9;case 106:return tr.kp_multiply;case 107:return tr.kp_plus;case 109:return tr.kp_minus;case 110:return tr.kp_decimal;case 111:return tr.kp_divide;case 144:return tr.numlockclear;case 112:return tr.f1;case 113:return tr.f2;case 114:return tr.f3;case 115:return tr.f4;case 116:return tr.f5;case 117:return tr.f6;case 118:return tr.f7;case 119:return tr.f8;case 120:return tr.f9;case 121:return tr.f10;case 122:return tr.f11;case 123:return tr.f12;case 124:return tr.f13;case 125:return tr.f14;case 126:return tr.f15;case 127:return tr.f16;case 128:return tr.f17;case 129:return tr.f18;case 130:return tr.f19;case 131:return tr.f20;case 132:return tr.f21;case 133:return tr.f22;case 134:return tr.f23;case 135:return tr.f24;case 160:return tr.caret;case 161:return tr.exclaim;case 162:return tr.quotedbl;case 163:return tr.hash;case 164:return tr.dollar;case 165:return tr.percent;case 166:return tr.ampersand;case 167:return tr.underscore;case 168:return tr.leftparen;case 169:return tr.rightparen;case 170:return tr.asterisk;case 171:return tr.plus;case 172:return tr.backslash;case 173:return tr.minus;case 174:return tr.leftbracket;case 175:return tr.rightbracket;case 176:return tr.backquote;case 181:return tr.audiomute;case 182:return tr.volumedown;case 183:return tr.volumeup;case 188:return tr.comma;case 190:return tr.period;case 191:return tr.slash;case 192:return tr.backquote;case 219:return tr.leftbracket;case 221:return tr.rightbracket;case 220:return tr.backslash;case 222:return tr.quote}return t};var Jn=function(){};r["snow.modules.interfaces.Input"]=Jn,Jn.__name__=["snow","modules","interfaces","Input"],Jn.prototype={__class__:Jn};var $n=function(){};r["snow.system.input.Scancodes"]=$n,$n.__name__=["snow","system","input","Scancodes"],$n.$name=function(t){var e=null;return t>=0&&t<$n.scancode_names.length&&(e=$n.scancode_names[t]),null!=e?e:""};var tr=function(){};r["snow.system.input.Keycodes"]=tr,tr.__name__=["snow","system","input","Keycodes"],tr.from_scan=function(t){return t|$n.MASK},tr.to_scan=function(t){if(0!=(t&$n.MASK))return t&~$n.MASK;switch(t){case 13:return $n.enter;case 27:return $n.escape;case 8:return $n.backspace;case 9:return $n.tab;case 32:return $n.space;case 47:return $n.slash;case 48:return $n.key_0;case 49:return $n.key_1;case 50:return $n.key_2;case 51:return $n.key_3;case 52:return $n.key_4;case 53:return $n.key_5;case 54:return $n.key_6;case 55:return $n.key_7;case 56:return $n.key_8;case 57:return $n.key_9;case 59:return $n.semicolon;case 61:return $n.equals;case 91:return $n.leftbracket;case 92:return $n.backslash;case 93:return $n.rightbracket;case 96:return $n.grave;case 97:return $n.key_a;case 98:return $n.key_b;case 99:return $n.key_c;case 100:return $n.key_d;case 101:return $n.key_e;case 102:return $n.key_f;case 103:return $n.key_g;case 104:return $n.key_h;case 105:return $n.key_i;case 106:return $n.key_j;case 107:return $n.key_k;case 108:return $n.key_l;case 109:return $n.key_m;case 110:return $n.key_n;case 111:return $n.key_o;case 112:return $n.key_p;case 113:return $n.key_q;case 114:return $n.key_r;case 115:return $n.key_s;case 116:return $n.key_t;case 117:return $n.key_u;case 118:return $n.key_v;case 119:return $n.key_w;case 120:return $n.key_x;case 121:return $n.key_y;case 122:return $n.key_z}return $n.unknown},tr.$name=function(t){if(0!=(t&$n.MASK))return $n.$name(t&~$n.MASK);switch(t){case 13:return $n.$name($n.enter);case 27:return $n.$name($n.escape);case 8:return $n.$name($n.backspace);case 9:return $n.$name($n.tab);case 32:return $n.$name($n.space);case 127:return $n.$name($n["delete"]);default:var e=new ne;return e.__b+=String.fromCharCode(t),e.__b}};var er=function(t){this.windowpos={x:0,y:0},this.gamepads_supported=!1,this.system=t};r["snow.core.web.input.Input"]=er,er.__name__=["snow","core","web","input","Input"],er.__interfaces__=[Jn],er.prototype={init:function(){window.document.addEventListener("keypress",n(this,this.on_keypress)),window.document.addEventListener("keydown",n(this,this.on_keydown)),window.document.addEventListener("keyup",n(this,this.on_keyup)),this.active_gamepads=new _e,this.gamepads_supported=null!=this.get_gamepad_list()},update:function(){this.gamepads_supported&&this.poll_gamepads()},destroy:function(){},listen:function(t){t.handle.addEventListener("contextmenu",n(this,this.on_contextmenu)),t.handle.addEventListener("mousedown",n(this,this.on_mousedown)),t.handle.addEventListener("mouseup",n(this,this.on_mouseup)),t.handle.addEventListener("mousemove",n(this,this.on_mousemove)),t.handle.addEventListener("mousewheel",n(this,this.on_mousewheel)),t.handle.addEventListener("wheel",n(this,this.on_mousewheel)),t.handle.addEventListener("touchstart",n(this,this.on_touchdown)),t.handle.addEventListener("touchend",n(this,this.on_touchup)),t.handle.addEventListener("touchmove",n(this,this.on_touchmove))},unlisten:function(){},on_event:function(){},text_input_start:function(){},text_input_stop:function(){},text_input_rect:function(){},poll_gamepads:function(){if(this.gamepads_supported){var t=this.get_gamepad_list();if(null!=t)for(var e=0,i=t.length;i>e;){var s=e++;if(null!=t[s])this.handle_gamepad(t[s]);else{var n=this.active_gamepads.h[s];null!=n&&this.system.dispatch_gamepad_device_event(n.index,n.id,2,Nn.core.timestamp()),this.active_gamepads.remove(s)}}}},handle_gamepad:function(t){if(null!=t)if(function(e){var i,s=t.index;return i=e.active_gamepads.h.hasOwnProperty(s)}(this)){var e,i=t.index;e=this.active_gamepads.h[i],e.id!=t.id&&(e.id=t.id);for(var s=[],n=[],r=e.axes,o=e.buttons,l=t.axes,a=t.buttons,h=0,_=0;_<l.length;){var u=l[_];++_,u!=r[h]&&(s.push(h),e.axes[h]=u),h++}for(var c=0,d=0;d<a.length;){var f=a[d];++d,f.value!=o[c].value&&(n.push(c),e.buttons[c].pressed=f.pressed,e.buttons[c].value=f.value),c++}for(var p=0;p<s.length;){var g=s[p];++p,this.system.dispatch_gamepad_axis_event(e.index,g,l[g],e.timestamp)}for(var m=0;m<n.length;){var v=n[m];++m,1==a[v].pressed?this.system.dispatch_gamepad_button_down_event(e.index,v,a[v].value,e.timestamp):this.system.dispatch_gamepad_button_up_event(e.index,v,a[v].value,e.timestamp)}}else{for(var y={id:t.id,index:t.index,axes:[],buttons:[],timestamp:Nn.core.timestamp()},w=t.axes,x=0;x<w.length;){var b=w[x];++x,y.axes.push(b)}for(var k=t.buttons,z=0;z<k.length;){{k[z]}++z,y.buttons.push({pressed:!1,value:0})}this.active_gamepads.h[y.index]=y,this.system.dispatch_gamepad_device_event(y.index,y.id,1,y.timestamp)}},fail_gamepads:function(){this.gamepads_supported=!1},get_gamepad_list:function(){return null!=(Ur=window.navigator,n(Ur,Ur.getGamepads))?window.navigator.getGamepads():null!=window.navigator.webkitGetGamepads?window.navigator.webkitGetGamepads():(this.fail_gamepads(),null)},dpr:function(){var t=window.devicePixelRatio;return null==t&&(t=1),t},get_real_window_position:function(t,e){for(var i=0,s=0,n=t,r=!0,o=0;1==r;){if(o++,o>100){r=!1;break}null!=n.offsetParent?(i+=n.offsetLeft,s+=n.offsetTop,n=n.offsetParent):r=!1}return e.x=i,e.y=s,e},translate_mouse_x:function(t,e,i){return Math.floor(t*(e.pageX-i))},translate_mouse_y:function(t,e,i){return Math.floor(t*(e.pageY-i))},on_mousedown:function(t){var e=this.dpr(),i=this.system.app.windowing.window_from_handle(t.target);this.get_real_window_position(i.handle,this.windowpos),this.system.dispatch_mouse_down_event(this.translate_mouse_x(e,t,this.windowpos.x),this.translate_mouse_y(e,t,this.windowpos.y),t.button+1,t.timeStamp,i.id)},on_mouseup:function(t){var e=this.dpr(),i=this.system.app.windowing.window_from_handle(t.target);this.get_real_window_position(i.handle,this.windowpos),this.system.dispatch_mouse_up_event(this.translate_mouse_x(e,t,this.windowpos.x),this.translate_mouse_y(e,t,this.windowpos.y),t.button+1,t.timeStamp,i.id)},on_mousemove:function(t){var e=this.dpr(),i=this.system.app.windowing.window_from_handle(t.target);this.get_real_window_position(i.handle,this.windowpos);var s=t.movementX,n=t.movementY;null==s&&(null!=t.webkitMovementX?(s=t.webkitMovementX,n=t.webkitMovementY):null!=t.mozMovementX&&(s=t.mozMovementX,n=t.mozMovementY)),this.system.dispatch_mouse_move_event(this.translate_mouse_x(e,t,this.windowpos.x),this.translate_mouse_y(e,t,this.windowpos.y),Math.floor(s*e),Math.floor(n*e),t.timeStamp,i.id)},on_mousewheel:function(t){this.system.app.config.web.prevent_default_mouse_wheel&&t.preventDefault();var e=this.system.app.windowing.window_from_handle(t.target),i=0,s=0;null!=t.deltaY?s=t.deltaY:null!=t.wheelDeltaY&&(s=-t.wheelDeltaY/3|0),null!=t.deltaX?i=t.deltaX:null!=t.wheelDeltaX&&(i=-t.wheelDeltaX/3|0),this.system.dispatch_mouse_wheel_event(Math.round(i/16),Math.round(s/16),t.timeStamp,e.id)},on_contextmenu:function(t){this.system.app.config.web.no_context_menu&&t.preventDefault()},on_keypress:function(t){if(0!=t.which&&-1==d.indexOf(er._keypress_blacklist,t.keyCode,0)){var e=String.fromCharCode(t.charCode);this.system.dispatch_text_event(e,0,e.length,2,t.timeStamp,1)}},on_keydown:function(t){var e=this.convert_keycode(t.keyCode),i=tr.to_scan(e),s=this.mod_state_from_event(t);-1!=d.indexOf(this.system.app.config.web.prevent_default_keys,e,0)&&t.preventDefault(),this.system.dispatch_key_down_event(e,i,t.repeat,s,t.timeStamp,1)},on_keyup:function(t){var e=this.convert_keycode(t.keyCode),i=tr.to_scan(e),s=this.mod_state_from_event(t);-1!=d.indexOf(this.system.app.config.web.prevent_default_keys,e,0)&&t.preventDefault(),this.system.dispatch_key_up_event(e,i,t.repeat,s,t.timeStamp,1)},mod_state_from_event:function(t){var e=!(t.altKey||t.ctrlKey||t.metaKey||t.shiftKey);return{none:e,lshift:t.shiftKey,rshift:t.shiftKey,lctrl:t.ctrlKey,rctrl:t.ctrlKey,lalt:t.altKey,ralt:t.altKey,lmeta:t.metaKey,rmeta:t.metaKey,num:!1,caps:!1,mode:!1,ctrl:t.ctrlKey,shift:t.shiftKey,alt:t.altKey,meta:t.metaKey}},convert_keycode:function(t){return t>=65&&90>=t?t+32:Yn.dom_key_to_keycode(t)},on_touchdown:function(t){t.preventDefault();for(var e=this.system.app.windowing.window_from_handle(t.target),i=e.handle.getBoundingClientRect(),s=0,n=t.changedTouches;s<n.length;){var r=n[s];++s;var o=r.clientX-i.left,l=r.clientY-i.top;o/=i.width,l/=i.height,this.system.dispatch_touch_down_event(o,l,r.identifier,Nn.core.timestamp())}},on_touchup:function(t){t.preventDefault();for(var e=this.system.app.windowing.window_from_handle(t.target),i=e.handle.getBoundingClientRect(),s=0,n=t.changedTouches;s<n.length;){var r=n[s];++s;var o=r.clientX-i.left,l=r.clientY-i.top;o/=i.width,l/=i.height,this.system.dispatch_touch_up_event(o,l,r.identifier,Nn.core.timestamp())}},on_touchmove:function(t){t.preventDefault();for(var e=this.system.app.windowing.window_from_handle(t.target),i=e.handle.getBoundingClientRect(),s=0,n=t.changedTouches;s<n.length;){var r=n[s];++s;var o=r.clientX-i.left,l=r.clientY-i.top;o/=i.width,l/=i.height,this.system.dispatch_touch_move_event(o,l,0,0,r.identifier,Nn.core.timestamp())}},__class__:er};var ir=function(){};r["snow.modules.interfaces.IO"]=ir,ir.__name__=["snow","modules","interfaces","IO"],ir.prototype={__class__:ir};var sr=function(t){this.system=t};r["snow.core.web.io.IO"]=sr,sr.__name__=["snow","core","web","io","IO"],sr.__interfaces__=[ir],sr.prototype={url_open:function(t){null!=t&&t.length>0&&window.open(t,"_blank")},data_load:function(t,e){return new Un(function(i,s){var n=!0,r=!0;null!=e&&null!=e.binary&&(r=e.binary);var o=new XMLHttpRequest;o.open("GET",t,n),o.overrideMimeType(r?"text/plain; charset=x-user-defined":"text/plain; charset=UTF-8"),n&&(o.responseType="arraybuffer"),o.onload=function(){200==o.status?i(function(){var t,e,i=o.response;return e=null!=i?new Yr(i):null,t=e}(this)):s(br.error("request status was "+o.status+" / "+o.statusText))},o.send()})},data_save:function(){return!1},string_save_path:function(t){null==t&&(t=0);var e="<localstorage>",i=this.string_slot_id(t),s=we.join([e,i]);return we.normalize(s)},init:function(){},update:function(){},destroy:function(){},on_event:function(){},string_slot_id:function(t){null==t&&(t=0);var e=this.system.app.snow_config.app_package.split("."),i=e.pop(),s=e.join(".");return""+s+"/"+i+"/"+this.system.string_save_prefix+"."+t},string_slot_destroy:function(t){null==t&&(t=0);var e=window.localStorage;if(null==e)return!1;var i=this.string_slot_id(t);return e.removeItem(i),!1},string_slot_save:function(t,e){null==t&&(t=0);
var i=window.localStorage;if(null==i)return!1;var s=this.string_slot_id(t);return i.setItem(s,e),!0},string_slot_load:function(t){null==t&&(t=0);var e=window.localStorage;if(null==e)return null;var i=this.string_slot_id(t);return e.getItem(i)},string_slot_encode:function(t){return window.btoa(t)},string_slot_decode:function(t){return window.atob(t)},__class__:sr};var nr=function(){};r["snow.modules.interfaces.Windowing"]=nr,nr.__name__=["snow","modules","interfaces","Windowing"],nr.prototype={__class__:nr};var rr=function(t){this._hidden_event_name="",this._hidden_name="",this._cursor_visible=!0,this._pre_fs_body_margin="0",this._pre_fs_body_overflow="0",this._pre_fs_height=0,this._pre_fs_width=0,this._pre_fs_s_height="",this._pre_fs_s_width="",this._pre_fs_margin="0",this._pre_fs_padding="0",this.seq_window=1,this.system=t,this.fs_windows=[],this.gl_contexts=new _e};r["snow.core.web.window.Windowing"]=rr,rr.__name__=["snow","core","web","window","Windowing"],rr.__interfaces__=[nr],rr.prototype={init:function(){this.listen_for_visibility(),this.listen_for_resize()},update:function(){},destroy:function(){},on_event:function(){},_copy_config:function(t){return{borderless:t.borderless,fullscreen:t.fullscreen,fullscreen_desktop:t.fullscreen_desktop,height:t.height,no_input:t.no_input,resizable:t.resizable,title:t.title,width:t.width,x:t.x,y:t.y}},dpr:function(){var t=window.devicePixelRatio;return null==t&&(t=1),t},create:function(t,e,i){var s,n=this.seq_window,r=window.document;s=r.createElement("canvas");var o=this._copy_config(e),l=this.dpr();s.width=Math.floor(o.width*l),s.height=Math.floor(o.height*l),s.style.width=o.width+"px",s.style.height=o.height+"px",s.style.display="block",s.style.position="relative",s.style.background="#000";var a=window.document.getElementById("device");a.appendChild(s);var h=Me.getContextWebGL(s,{alpha:!1,premultipliedAlpha:!1,antialias:t.antialiasing>0});if(null==h){var _="WebGL is required to run this!<br/><br/>";throw _+="visit http://get.webgl.org/ for help <br/>",_+="and contact the developer of the application",this.internal_fallback(_),new Ie(br.windowing(_))}null==_r.current_context&&(_r.current_context=h),this.gl_contexts.h[n]=h;var u=this.get_real_window_position(s);o.x=u.x,o.y=u.y,o.width=s.width,o.height=s.height,null!=o.title&&""!=o.title&&(window.document.title=o.title),i(s,n,{config:o,render_config:t}),s.setAttribute("id","window"+n),this.seq_window++},destroy_window:function(t){window.document.body.removeChild(t.handle)},close:function(t){t.handle.style.display="none"},show:function(t){t.handle.style.display=null},internal_resize:function(t,e,i){this.system.app.dispatch_system_event({type:5,window:{type:7,timestamp:Nn.core.timestamp(),window_id:t.id,event:{x:e,y:i}}}),this.system.app.dispatch_system_event({type:5,window:{type:6,timestamp:Nn.core.timestamp(),window_id:t.id,event:{x:e,y:i}}})},update_window:function(t){var e=t.handle.getBoundingClientRect();(e.left!=t.x||e.top!=t.y)&&this.system.app.dispatch_system_event({type:5,window:{type:5,timestamp:Nn.core.timestamp(),window_id:t.id,event:{x:e.left,y:e.top}}}),e.width!=t.width||e.height!=t.height,e=null},render:function(t){var e=this.gl_contexts.h[t.id];_r.current_context!=e&&(_r.current_context=e)},swap:function(){},simple_message:function(t,e,i){null==i&&(i=""),window.alert(e)},set_size:function(t,e,i){var s=this.dpr();t.handle.width=Math.floor(e*s),t.handle.height=Math.floor(i*s),t.handle.style.width=""+e+"px",t.handle.style.height=""+i+"px",this.internal_resize(t,e,i)},set_position:function(t,e,i){t.handle.style.left=""+e+"px",t.handle.style.top=""+i+"px"},get_real_window_position:function(t){for(var e=0,i=0,s=t,n=!0,r=0;1==n;){if(r++,r>100){n=!1;break}null!=s.offsetParent?(e+=s.offsetLeft,i+=s.offsetTop,s=s.offsetParent):n=!1}return{x:e,y:i}},set_title:function(t,e){window.document.title=e},set_max_size:function(t,e,i){t.handle.style.maxWidth=""+e+"px",t.handle.style.maxHeight=""+i+"px"},set_min_size:function(t,e,i){t.handle.style.minWidth=""+e+"px",t.handle.style.minHeight=""+i+"px"},internal_fullscreen:function(t,e){var i=t.handle;e?-1==d.indexOf(this.fs_windows,t,0)&&this.fs_windows.push(t):d.remove(this.fs_windows,t);var s=this.system.app.config.web.true_fullscreen;e?s?null==n(i,i.requestFullscreen)?null==i.requestFullScreen?null==i.webkitRequestFullscreen?null==i.mozRequestFullScreen||i.mozRequestFullScreen():i.webkitRequestFullscreen():i.requestFullScreen(null):i.requestFullscreen():(this._pre_fs_padding=i.style.padding,this._pre_fs_margin=i.style.margin,this._pre_fs_s_width=i.style.width,this._pre_fs_s_height=i.style.height,this._pre_fs_width=i.width,this._pre_fs_height=i.height,this._pre_fs_body_margin=window.document.body.style.margin,this._pre_fs_body_overflow=window.document.body.style.overflow,i.style.margin="0",i.style.padding="0",i.style.width=window.innerWidth+"px",i.style.height=window.innerHeight+"px",i.width=window.innerWidth,i.height=window.innerHeight,window.document.body.style.margin="0",window.document.body.style.overflow="hidden"):s||(i.style.padding=this._pre_fs_padding,i.style.margin=this._pre_fs_margin,i.style.width=this._pre_fs_s_width,i.style.height=this._pre_fs_s_height,i.width=this._pre_fs_width,i.height=this._pre_fs_height,window.document.body.style.margin=this._pre_fs_body_margin,window.document.body.style.overflow=this._pre_fs_body_overflow)},fullscreen:function(t,e){this.internal_fullscreen(t,e)},bordered:function(){},grab:function(t,e){e&&(null==(Ur=t.handle,n(Ur,Ur.requestPointerLock))?null==t.handle.webkitRequestPointerLock?null==t.handle.mozRequestPointerLock||t.handle.mozRequestPointerLock():t.handle.webkitRequestPointerLock():t.handle.requestPointerLock())},set_cursor_position:function(){},system_enable_cursor:function(t){if(null==this.cursor_style){var e=window.document;this.cursor_style=e.createElement("style"),this.cursor_style.innerHTML="* { cursor:none; }"}t&&!this._cursor_visible?(this._cursor_visible=!0,window.document.body.removeChild(this.cursor_style)):!t&&this._cursor_visible&&(this._cursor_visible=!1,window.document.body.appendChild(this.cursor_style))},system_lock_cursor:function(t){null!=this.system.app.window&&this.grab(this.system.app.window,t)},system_enable_vsync:function(){return-1},display_count:function(){return 1},display_mode_count:function(){return 1},display_native_mode:function(){return{format:0,refresh_rate:0,width:window.screen.width,height:window.screen.height}},display_current_mode:function(t){return this.display_native_mode(t)},display_mode:function(t){return this.display_native_mode(t)},display_bounds:function(){return{x:0,y:0,width:window.innerWidth,height:window.innerHeight}},display_name:function(){return window.navigator.vendor},listen:function(t){t.handle.addEventListener("mouseleave",n(this,this.on_internal_leave)),t.handle.addEventListener("mouseenter",n(this,this.on_internal_enter)),t.config.fullscreen&&(this.internal_fullscreen(t,t.config.fullscreen),t.config.width=t.handle.width,t.config.height=t.handle.height)},unlisten:function(t){t.handle.removeEventListener("mouseleave",n(this,this.on_internal_leave)),t.handle.removeEventListener("mouseenter",n(this,this.on_internal_enter)),d.remove(this.fs_windows,t)},on_internal_leave:function(t){var e=this.system.window_from_handle(t.target);this.system.app.dispatch_system_event({type:5,window:{type:12,timestamp:t.timeStamp,window_id:e.id,event:t}})},on_internal_enter:function(t){var e=this.system.window_from_handle(t.target);this.system.app.dispatch_system_event({type:5,window:{type:11,timestamp:t.timeStamp,window_id:e.id,event:t}})},listen_for_resize:function(){var t=this;window.onresize=function(){if(!t.system.app.config.web.true_fullscreen)for(var e=0,i=t.fs_windows;e<i.length;){var s=i[e];++e,s.set_size(window.innerWidth,window.innerHeight),t.internal_resize(s,s.width,s.height)}}},listen_for_visibility:function(){void 0!==typeof document.hidden?(this._hidden_name="hidden",this._hidden_event_name="visibilitychange"):void 0!==typeof document.mozHidden?(this._hidden_name="mozHidden",this._hidden_name="mozvisibilitychange"):"undefined"!=typeof document.msHidden?(this._hidden_name="msHidden",this._hidden_event_name="msvisibilitychange"):"undefined"!=typeof document.webkitHidden&&(this._hidden_name="webkitHidden",this._hidden_event_name="webkitvisibilitychange"),""!=this._hidden_name&&""!=this._hidden_event_name&&window.document.addEventListener(this._hidden_event_name,n(this,this.on_visibility_change))},on_visibility_change:function(t){var e={type:5,window:{type:2,timestamp:Nn.core.timestamp(),window_id:1,event:t}};document[this._hidden_name]?(e.window.type=3,this.system.app.dispatch_system_event(e),e.window.type=8,this.system.app.dispatch_system_event(e),e.window.type=14,this.system.app.dispatch_system_event(e)):(e.window.type=2,this.system.app.dispatch_system_event(e),e.window.type=10,this.system.app.dispatch_system_event(e),e.window.type=13,this.system.app.dispatch_system_event(e))},internal_fallback:function(t){var e,i,s=window.document;e=s.createElement("div");var n=window.document;i=n.createElement("div"),e.style.marginLeft="auto",e.style.marginRight="auto",e.style.color="#d3d3d3",e.style.marginTop="5em",e.style.fontSize="1.4em",e.style.fontFamily="helvetica,sans-serif",e.innerHTML=t,i.style.top="0",i.style.left="0",i.style.width="100%",i.style.height="100%",i.style.display="block",i.style.minWidth="100%",i.style.minHeight="100%",i.style.textAlign="center",i.style.position="absolute",i.style.background="rgba(1,1,1,0.90)",i.appendChild(e),window.document.body.appendChild(i)},__class__:rr};var or=function(){};r["snow.modules.interfaces.Audio"]=or,or.__name__=["snow","modules","interfaces","Audio"],or.prototype={__class__:or};var lr=function(t){this.system=t,this.suspended_sounds=[],this.handles=new ue};r["snow.modules.howlerjs.Audio"]=lr,lr.__name__=["snow","modules","howlerjs","Audio"],lr.__interfaces__=[or],lr.prototype={init:function(){},update:function(){},destroy:function(){},on_event:function(){},suspend:function(){for(var t=this.handles.iterator();t.hasNext();){var e=t.next();e.get_playing()&&(e.toggle(),this.suspended_sounds.push(e))}},resume:function(){for(;this.suspended_sounds.length>0;){var t=this.suspended_sounds.pop();t.toggle()}},info_from_id:function(t,e){if(null==e){var i=we.extension(t);switch(i){case"wav":e=2;break;case"ogg":e=1;break;case"pcm":e=3;break;default:e=0}}return{format:e,id:t,handle:null,data:null}},create_sound:function(t,e,i,s){null==i&&(i=!1);var n=this;return new Un(function(r,o){var l=we.join([n.system.app.assets.root,t]),a=n.info_from_id(l,s),h=new hr(n.system,e,i);a.handle=new window.Howl({urls:[l],onend:function(){n.system.app.audio.module._on_end(a.handle)},onloaderror:function(){o(br.error("failed to create sound "+e+" from "+t))},onload:function(){a.handle=this,h.set_info(a);var t=a.handle;n.handles.set(t,h),r(h)}})})},create_sound_from_bytes:function(t,e,i){var s,n=this;switch(i){case 1:s="ogg";break;case 2:s="wav";break;case 3:throw new Ie(br.error("pcm audio format unsupported atm"));case 0:throw new Ie(br.error("unknown audio format for create_sound_from_bytes "+t))}for(var r="",o=0,l=e.length;l>o;)r+=String.fromCharCode(function(){var t,i,s=o++;return i=e[s],t=255&i}(this));var a=window.btoa(r),h="data:audio/"+s+";base64,"+a,_=this.info_from_id("bytes;"+t,i),u=new hr(this.system,t,!1);return _.handle=new window.Howl({urls:[h],onend:function(){n.system.app.audio.module._on_end(_.handle)},onloaderror:function(){throw new Ie(br.error("failed to create sound "+t+" from bytes"))},onload:function(){_.handle=this,u.set_info(_);var t=_.handle;n.handles.set(t,u)}}),u},_on_end:function(t){var e,i=t;e=this.handles.h[i.__id__],null!=e&&e.emit("end")},__class__:lr};var ar=function(t,e,i){null==i&&(i=!1),this.is_stream=!1,this.position_bytes=0,this.length_bytes=0,this.duration=0,this.position=0,this.looping=!1,this.pan=0,this.volume=1,this.pitch=1,this.loaded=!1,this.paused=!1,this.playing=!1,this.name="",this.name=e,this.system=t,this.is_stream=i};r["snow.system.audio.Sound"]=ar,ar.__name__=["snow","system","audio","Sound"],ar.prototype={emit:function(t){this.system.sound_event(this,t)},on:function(t,e){this.system.on(this.name,t,e)},off:function(t,e){this.system.off(this.name,t,e)},play:function(){},loop:function(){},stop:function(){},pause:function(){},destroy:function(){},internal_update:function(){},internal_play:function(){},internal_loop:function(){},internal_stop:function(){},internal_pause:function(){},toggle:function(){this.set_playing(!this.get_playing()),this.get_playing()?this.get_looping()?this.loop():this.play():this.pause()},get_playing:function(){return this.playing},get_paused:function(){return this.paused},get_loaded:function(){return this.loaded},get_info:function(){return this.info},set_info:function(t){return this.info=t},get_pan:function(){return this.pan},get_pitch:function(){return this.pitch},get_volume:function(){return this.volume},get_looping:function(){return this.looping},get_position:function(){return this.position},get_position_bytes:function(){return this.position_bytes},get_length_bytes:function(){return this.length_bytes},get_duration:function(){return 0},set_playing:function(t){return this.playing=t},set_paused:function(t){return this.paused=t},set_loaded:function(t){return this.loaded=t},set_pan:function(t){return this.pan=t},set_pitch:function(t){return this.pitch=t},set_volume:function(t){return this.volume=t},set_position:function(t){return this.position=t},set_looping:function(t){return this.looping=t},set_position_bytes:function(t){return this.position_bytes=t},__class__:ar,__properties__:{set_position_bytes:"set_position_bytes",get_position_bytes:"get_position_bytes",get_length_bytes:"get_length_bytes",get_duration:"get_duration",set_position:"set_position",get_position:"get_position",set_looping:"set_looping",get_looping:"get_looping",set_pan:"set_pan",get_pan:"get_pan",set_volume:"set_volume",get_volume:"get_volume",set_pitch:"set_pitch",get_pitch:"get_pitch",set_info:"set_info",get_info:"get_info",set_loaded:"set_loaded",get_loaded:"get_loaded",set_paused:"set_paused",get_paused:"get_paused",set_playing:"set_playing",get_playing:"get_playing"}};var hr=function(t,e,i){null==i&&(i=!1),ar.call(this,t,e,i)};r["snow.modules.howlerjs.sound.Sound"]=hr,hr.__name__=["snow","modules","howlerjs","sound","Sound"],hr.__super__=ar,hr.prototype=i(ar.prototype,{set_info:function(t){return null!=this.get_info()&&this.destroy(),this.info=null,null==t?this.get_info():(this.info=t,this.set_loaded(!0),this.get_info())},set_pan:function(t){return null!=this.get_info()&&null!=this.get_info().handle&&this.get_info().handle.pos3d(this.get_pan()),this.pan=t},set_volume:function(t){return null!=this.get_info()&&null!=this.get_info().handle&&this.get_info().handle.volume(t),this.volume=t},set_pitch:function(t){return null!=this.get_info()&&null!=this.get_info().handle&&this.get_info().handle.rate(t),this.pitch=t},set_position:function(t){return null!=this.get_info()&&null!=this.get_info().handle&&this.get_info().handle.pos(t),this.position=t},get_position:function(){return null!=this.get_info()&&null!=this.get_info().handle?this.get_info().handle.pos():this.position},get_duration:function(){return null!=this.get_info()&&null!=this.get_info().handle?this.get_info().handle._duration:0},play:function(){null!=this.get_info()&&null!=this.get_info().handle&&(this.set_playing(!0),this.set_looping(!1),this.get_info().handle.loop(!1),this.get_info().handle.play(),null!=this.get_info()&&null!=this.get_info().handle&&(this.get_info().handle.rate(this.get_pitch()),this.get_info().handle.volume(this.get_volume()),this.get_info().handle.pos3d(this.get_pan())))},loop:function(){null!=this.get_info()&&null!=this.get_info().handle&&(this.set_playing(!0),this.set_looping(!0),this.get_info().handle.loop(!0),this.get_info().handle.play(),null!=this.get_info()&&null!=this.get_info().handle&&(this.get_info().handle.rate(this.get_pitch()),this.get_info().handle.volume(this.get_volume()),this.get_info().handle.pos3d(this.get_pan())))},stop:function(){this.set_playing(!1),null!=this.get_info()&&null!=this.get_info().handle&&this.get_info().handle.stop()},pause:function(){null!=this.get_info()&&null!=this.get_info().handle&&this.get_info().handle.pause()},destroy:function(){null!=this.get_info()&&null!=this.get_info().handle&&this.get_info().handle.unload(),this.system.kill(this)},ensure_parameters:function(){null!=this.get_info()&&null!=this.get_info().handle&&(this.get_info().handle.rate(this.get_pitch()),this.get_info().handle.volume(this.get_volume()),this.get_info().handle.pos3d(this.get_pan()))},__class__:hr});var _r=function(){};r["snow.modules.opengl.web.GL"]=_r,_r.__name__=["snow","modules","opengl","web","GL"],_r.__properties__={get_version:"get_version"},_r.versionString=function(){var t=_r.current_context.getParameter(7938),e=_r.current_context.getParameter(35724),i=_r.current_context.getParameter(7937),s=_r.current_context.getParameter(7936);return"/ "+t+" / "+e+" / "+i+" / "+s+" /"},_r.activeTexture=function(t){_r.current_context.activeTexture(t)},_r.attachShader=function(t,e){_r.current_context.attachShader(t,e)},_r.bindAttribLocation=function(t,e,i){_r.current_context.bindAttribLocation(t,e,i)},_r.bindBuffer=function(t,e){_r.current_context.bindBuffer(t,e)},_r.bindFramebuffer=function(t,e){_r.current_context.bindFramebuffer(t,e)},_r.bindRenderbuffer=function(t,e){_r.current_context.bindRenderbuffer(t,e)},_r.bindTexture=function(t,e){_r.current_context.bindTexture(t,e)},_r.blendColor=function(t,e,i,s){_r.current_context.blendColor(t,e,i,s)},_r.blendEquation=function(t){_r.current_context.blendEquation(t)},_r.blendEquationSeparate=function(t,e){_r.current_context.blendEquationSeparate(t,e)},_r.blendFunc=function(t,e){_r.current_context.blendFunc(t,e)},_r.blendFuncSeparate=function(t,e,i,s){_r.current_context.blendFuncSeparate(t,e,i,s)},_r.bufferData=function(t,e,i){_r.current_context.bufferData(t,e,i)},_r.bufferSubData=function(t,e,i){_r.current_context.bufferSubData(t,e,i)},_r.checkFramebufferStatus=function(t){return _r.current_context.checkFramebufferStatus(t)},_r.clear=function(t){_r.current_context.clear(t)},_r.clearColor=function(t,e,i,s){_r.current_context.clearColor(t,e,i,s)},_r.clearDepth=function(t){_r.current_context.clearDepth(t)},_r.clearStencil=function(t){_r.current_context.clearStencil(t)},_r.colorMask=function(t,e,i,s){_r.current_context.colorMask(t,e,i,s)},_r.compileShader=function(t){_r.current_context.compileShader(t)},_r.compressedTexImage2D=function(t,e,i,s,n,r,o){_r.current_context.compressedTexImage2D(t,e,i,s,n,r,o)},_r.compressedTexSubImage2D=function(t,e,i,s,n,r,o,l){_r.current_context.compressedTexSubImage2D(t,e,i,s,n,r,o,l)},_r.copyTexImage2D=function(t,e,i,s,n,r,o,l){_r.current_context.copyTexImage2D(t,e,i,s,n,r,o,l)},_r.copyTexSubImage2D=function(t,e,i,s,n,r,o,l){_r.current_context.copyTexSubImage2D(t,e,i,s,n,r,o,l)},_r.createBuffer=function(){return _r.current_context.createBuffer()},_r.createFramebuffer=function(){return _r.current_context.createFramebuffer()},_r.createProgram=function(){return _r.current_context.createProgram()},_r.createRenderbuffer=function(){return _r.current_context.createRenderbuffer()},_r.createShader=function(t){return _r.current_context.createShader(t)},_r.createTexture=function(){return _r.current_context.createTexture()},_r.cullFace=function(t){_r.current_context.cullFace(t)},_r.deleteBuffer=function(t){_r.current_context.deleteBuffer(t)},_r.deleteFramebuffer=function(t){_r.current_context.deleteFramebuffer(t)},_r.deleteProgram=function(t){_r.current_context.deleteProgram(t)},_r.deleteRenderbuffer=function(t){_r.current_context.deleteRenderbuffer(t)},_r.deleteShader=function(t){_r.current_context.deleteShader(t)},_r.deleteTexture=function(t){_r.current_context.deleteTexture(t)},_r.depthFunc=function(t){_r.current_context.depthFunc(t)},_r.depthMask=function(t){_r.current_context.depthMask(t)},_r.depthRange=function(t,e){_r.current_context.depthRange(t,e)},_r.detachShader=function(t,e){_r.current_context.detachShader(t,e)},_r.disable=function(t){_r.current_context.disable(t)},_r.disableVertexAttribArray=function(t){_r.current_context.disableVertexAttribArray(t)},_r.drawArrays=function(t,e,i){_r.current_context.drawArrays(t,e,i)},_r.drawElements=function(t,e,i,s){_r.current_context.drawElements(t,e,i,s)},_r.enable=function(t){_r.current_context.enable(t)},_r.enableVertexAttribArray=function(t){_r.current_context.enableVertexAttribArray(t)},_r.finish=function(){_r.current_context.finish()},_r.flush=function(){_r.current_context.flush()},_r.framebufferRenderbuffer=function(t,e,i,s){_r.current_context.framebufferRenderbuffer(t,e,i,s)},_r.framebufferTexture2D=function(t,e,i,s,n){_r.current_context.framebufferTexture2D(t,e,i,s,n)},_r.frontFace=function(t){_r.current_context.frontFace(t)},_r.generateMipmap=function(t){_r.current_context.generateMipmap(t)},_r.getActiveAttrib=function(t,e){return _r.current_context.getActiveAttrib(t,e)},_r.getActiveUniform=function(t,e){return _r.current_context.getActiveUniform(t,e)},_r.getAttachedShaders=function(t){return _r.current_context.getAttachedShaders(t)},_r.getAttribLocation=function(t,e){return _r.current_context.getAttribLocation(t,e)},_r.getBufferParameter=function(t,e){return _r.current_context.getBufferParameter(t,e)},_r.getContextAttributes=function(){return _r.current_context.getContextAttributes()},_r.getError=function(){return _r.current_context.getError()},_r.getExtension=function(t){return _r.current_context.getExtension(t)},_r.getFramebufferAttachmentParameter=function(t,e,i){return _r.current_context.getFramebufferAttachmentParameter(t,e,i)},_r.getParameter=function(t){return _r.current_context.getParameter(t)},_r.getProgramInfoLog=function(t){return _r.current_context.getProgramInfoLog(t)},_r.getProgramParameter=function(t,e){return _r.current_context.getProgramParameter(t,e)},_r.getRenderbufferParameter=function(t,e){return _r.current_context.getRenderbufferParameter(t,e)},_r.getShaderInfoLog=function(t){return _r.current_context.getShaderInfoLog(t)},_r.getShaderParameter=function(t,e){return _r.current_context.getShaderParameter(t,e)},_r.getShaderPrecisionFormat=function(t,e){return _r.current_context.getShaderPrecisionFormat(t,e)},_r.getShaderSource=function(t){return _r.current_context.getShaderSource(t)},_r.getSupportedExtensions=function(){return _r.current_context.getSupportedExtensions()},_r.getTexParameter=function(t,e){return _r.current_context.getTexParameter(t,e)},_r.getUniform=function(t,e){return _r.current_context.getUniform(t,e)},_r.getUniformLocation=function(t,e){return _r.current_context.getUniformLocation(t,e)},_r.getVertexAttrib=function(t,e){return _r.current_context.getVertexAttrib(t,e)},_r.getVertexAttribOffset=function(t,e){return _r.current_context.getVertexAttribOffset(t,e)},_r.hint=function(t,e){_r.current_context.hint(t,e)},_r.isBuffer=function(t){return _r.current_context.isBuffer(t)},_r.isEnabled=function(t){return _r.current_context.isEnabled(t)},_r.isFramebuffer=function(t){return _r.current_context.isFramebuffer(t)},_r.isProgram=function(t){return _r.current_context.isProgram(t)},_r.isRenderbuffer=function(t){return _r.current_context.isRenderbuffer(t)},_r.isShader=function(t){return _r.current_context.isShader(t)},_r.isTexture=function(t){return _r.current_context.isTexture(t)},_r.lineWidth=function(t){_r.current_context.lineWidth(t)},_r.linkProgram=function(t){_r.current_context.linkProgram(t)},_r.pixelStorei=function(t,e){_r.current_context.pixelStorei(t,e)},_r.polygonOffset=function(t,e){_r.current_context.polygonOffset(t,e)},_r.readPixels=function(t,e,i,s,n,r,o){_r.current_context.readPixels(t,e,i,s,n,r,o)},_r.renderbufferStorage=function(t,e,i,s){_r.current_context.renderbufferStorage(t,e,i,s)},_r.sampleCoverage=function(t,e){_r.current_context.sampleCoverage(t,e)},_r.scissor=function(t,e,i,s){_r.current_context.scissor(t,e,i,s)},_r.shaderSource=function(t,e){_r.current_context.shaderSource(t,e)},_r.stencilFunc=function(t,e,i){_r.current_context.stencilFunc(t,e,i)},_r.stencilFuncSeparate=function(t,e,i,s){_r.current_context.stencilFuncSeparate(t,e,i,s)},_r.stencilMask=function(t){_r.current_context.stencilMask(t)},_r.stencilMaskSeparate=function(t,e){_r.current_context.stencilMaskSeparate(t,e)},_r.stencilOp=function(t,e,i){_r.current_context.stencilOp(t,e,i)},_r.stencilOpSeparate=function(t,e,i,s){_r.current_context.stencilOpSeparate(t,e,i,s)},_r.texImage2D=function(t,e,i,s,n,r,o,l,a){_r.current_context.texImage2D(t,e,i,s,n,r,o,l,a)},_r.texParameterf=function(t,e,i){_r.current_context.texParameterf(t,e,i)},_r.texParameteri=function(t,e,i){_r.current_context.texParameteri(t,e,i)},_r.texSubImage2D=function(t,e,i,s,n,r,o,l,a){_r.current_context.texSubImage2D(t,e,i,s,n,r,o,l,a)},_r.uniform1f=function(t,e){_r.current_context.uniform1f(t,e)},_r.uniform1fv=function(t,e){_r.current_context.uniform1fv(t,e)},_r.uniform1i=function(t,e){_r.current_context.uniform1i(t,e)},_r.uniform1iv=function(t,e){_r.current_context.uniform1iv(t,e)},_r.uniform2f=function(t,e,i){_r.current_context.uniform2f(t,e,i)},_r.uniform2fv=function(t,e){_r.current_context.uniform2fv(t,e)},_r.uniform2i=function(t,e,i){_r.current_context.uniform2i(t,e,i)},_r.uniform2iv=function(t,e){_r.current_context.uniform2iv(t,e)},_r.uniform3f=function(t,e,i,s){_r.current_context.uniform3f(t,e,i,s)},_r.uniform3fv=function(t,e){_r.current_context.uniform3fv(t,e)},_r.uniform3i=function(t,e,i,s){_r.current_context.uniform3i(t,e,i,s)},_r.uniform3iv=function(t,e){_r.current_context.uniform3iv(t,e)},_r.uniform4f=function(t,e,i,s,n){_r.current_context.uniform4f(t,e,i,s,n)},_r.uniform4fv=function(t,e){_r.current_context.uniform4fv(t,e)},_r.uniform4i=function(t,e,i,s,n){_r.current_context.uniform4i(t,e,i,s,n)},_r.uniform4iv=function(t,e){_r.current_context.uniform4iv(t,e)},_r.uniformMatrix2fv=function(t,e,i){_r.current_context.uniformMatrix2fv(t,e,i)},_r.uniformMatrix3fv=function(t,e,i){_r.current_context.uniformMatrix3fv(t,e,i)},_r.uniformMatrix4fv=function(t,e,i){_r.current_context.uniformMatrix4fv(t,e,i)},_r.useProgram=function(t){_r.current_context.useProgram(t)},_r.validateProgram=function(t){_r.current_context.validateProgram(t)},_r.vertexAttrib1f=function(t,e){_r.current_context.vertexAttrib1f(t,e)},_r.vertexAttrib1fv=function(t,e){_r.current_context.vertexAttrib1fv(t,e)},_r.vertexAttrib2f=function(t,e,i){_r.current_context.vertexAttrib2f(t,e,i)},_r.vertexAttrib2fv=function(t,e){_r.current_context.vertexAttrib2fv(t,e)},_r.vertexAttrib3f=function(t,e,i,s){_r.current_context.vertexAttrib3f(t,e,i,s)},_r.vertexAttrib3fv=function(t,e){_r.current_context.vertexAttrib3fv(t,e)},_r.vertexAttrib4f=function(t,e,i,s,n){_r.current_context.vertexAttrib4f(t,e,i,s,n)},_r.vertexAttrib4fv=function(t,e){_r.current_context.vertexAttrib4fv(t,e)},_r.vertexAttribPointer=function(t,e,i,s,n,r){_r.current_context.vertexAttribPointer(t,e,i,s,n,r)},_r.viewport=function(t,e,i,s){_r.current_context.viewport(t,e,i,s)},_r.get_version=function(){return 7938};var ur=function(t,e,i){if(null==i&&(i=0),this.loaded=!1,null==e)throw new Ie(Ln.null_assertion("_id was null"));if(null==t)throw new Ie(Ln.null_assertion("_system was null"));this.system=t,this.type=i,this.id=e};r["snow.system.assets.Asset"]=ur,ur.__name__=["snow","system","assets","Asset"],ur.prototype={destroy:function(){},__class__:ur};var cr=function(t,e,i){ur.call(this,t,e,4),this.set_image(i)};r["snow.system.assets.AssetImage"]=cr,cr.__name__=["snow","system","assets","AssetImage"],cr.load=function(t,e){if(null==e)throw new Ie(Ln.null_assertion("_id was null"));if(null==t)throw new Ie(Ln.null_assertion("_system was null"));return new cr(t,e,null).reload()},cr.load_from_bytes=function(t,e,i){if(null==e)throw new Ie(Ln.null_assertion("_id was null"));if(null==i)throw new Ie(Ln.null_assertion("_bytes was null"));if(null==t)throw new Ie(Ln.null_assertion("_system was null"));return new cr(t,e,null).reload_from_bytes(i)},cr.load_from_pixels=function(t,e,i,s,n){if(null==e)throw new Ie(Ln.null_assertion("_id was null"));if(null==n)throw new Ie(Ln.null_assertion("_pixels was null"));if(null==t)throw new Ie(Ln.null_assertion("_system was null"));var r=t.module.image_info_from_pixels(e,i,s,n);return new cr(t,e,r)},cr.provider=function(t,e){return t.assets.module.image_load_info(e)},cr.processor=function(t,e,i){return null==i?Un.reject(br.error("AssetImage processor: data was null")):t.assets.module.image_info_from_bytes(e,i)},cr.__super__=ur,cr.prototype=i(ur.prototype,{reload:function(){var t=this;return this.loaded=!1,new Un(function(e,i){var s=t.system.app.io.data_flow(we.join([t.system.root,t.id]),null,cr.provider);s.then(function(i){t.set_image(i),e(t)}).error(i)})},destroy:function(){this.set_image(null)},reload_from_bytes:function(t){var e=this;return this.loaded=!1,new Un(function(i,s){var n=e.system.module.image_info_from_bytes(e.id,t);n.then(function(t){e.set_image(t),i(e)}).error(s)})},reload_from_pixels:function(t,e,i){this.loaded=!1,this.set_image(this.system.module.image_info_from_pixels(this.id,t,e,i))},set_image:function(t){return this.loaded=null!=t,this.image=t},__class__:cr,__properties__:{set_image:"set_image"}});var dr=function(t,e,i){ur.call(this,t,e,1),this.set_bytes(i)};r["snow.system.assets.AssetBytes"]=dr,dr.__name__=["snow","system","assets","AssetBytes"],dr.load=function(t,e){return new dr(t,e,null).reload()},dr.__super__=ur,dr.prototype=i(ur.prototype,{reload:function(){var t=this;return new Un(function(e,i){t.system.app.io.data_flow(we.join([t.system.root,t.id])).then(function(i){t.set_bytes(i),e(t)}).error(i)})},destroy:function(){this.set_bytes(null)},set_bytes:function(t){return this.loaded=null!=t,this.bytes=t},__class__:dr,__properties__:{set_bytes:"set_bytes"}});var fr=function(t,e,i){ur.call(this,t,e,2),this.set_text(i)};r["snow.system.assets.AssetText"]=fr,fr.__name__=["snow","system","assets","AssetText"],fr.load=function(t,e){return new fr(t,e,null).reload()},fr.processor=function(t,e,i){return null==i?Un.reject(br.error("AssetText processor: data was null")):Un.resolve(new oe(new Yr(i.buffer)).toString())},fr.__super__=ur,fr.prototype=i(ur.prototype,{reload:function(){var t=this;return new Un(function(e,i){t.system.app.io.data_flow(we.join([t.system.root,t.id]),fr.processor).then(function(i){t.set_text(i),e(t)}).error(i)})},destroy:function(){this.set_text(null)},set_text:function(t){return this.loaded=null!=t,this.text=t},__class__:fr,__properties__:{set_text:"set_text"}});var pr=function(t,e,i){ur.call(this,t,e,3),this.set_json(i)};r["snow.system.assets.AssetJSON"]=pr,pr.__name__=["snow","system","assets","AssetJSON"],pr.load=function(t,e){return new pr(t,e,null).reload()},pr.processor=function(t,e,i){return null==i?Un.reject(br.error("AssetJSON: data was null")):new Un(function(t,e){var s=null;try{s=JSON.parse(new oe(new Yr(i.buffer)).toString())}catch(n){return n instanceof Ie&&(n=n.val),e(br.parse(n))}return t(s)})},pr.__super__=ur,pr.prototype=i(ur.prototype,{reload:function(){var t=this;return new Un(function(e,i){t.system.app.io.data_flow(we.join([t.system.root,t.id]),pr.processor).then(function(i){t.set_json(i),e(t)}).error(i)})},destroy:function(){this.set_json(null)},set_json:function(t){return this.loaded=null!=t,this.json=t},__class__:pr,__properties__:{set_json:"set_json"}});var gr=function(t){this.root="",this.app=t,this.module=new Wn(this)};r["snow.system.assets.Assets"]=gr,gr.__name__=["snow","system","assets","Assets"],gr.prototype={path:function(t){return we.join([this.root,t])},bytes:function(t){return dr.load(this,t)},text:function(t){return fr.load(this,t)},json:function(t){return pr.load(this,t)},image:function(t){return cr.load(this,t)},image_from_bytes:function(t,e){return cr.load_from_bytes(this,t,e)},image_from_pixels:function(t,e,i,s){return cr.load_from_pixels(this,t,e,i,s)},__class__:gr};var mr=function(t){this.active=!1,this.app=t,this.module=new lr(this),this.module.init(),this.sound_list=new de,this.stream_list=new de,this.active=!0
};r["snow.system.audio.Audio"]=mr,mr.__name__=["snow","system","audio","Audio"],mr.prototype={create:function(t,e,i){null==i&&(i=!1),null==e&&(e="");var s=this;return""==e&&(e=this.app.make_uniqueid()),new Un(function(n,r){var o=s.module.create_sound(t,e,i);o.then(function(t){s.sound_list.set(e,t),i&&s.stream_list.set(e,t),n(t),t.emit("load")}).error(r)})},create_from_bytes:function(t,e,i){null==t&&(t=""),""==t&&(t=this.app.make_uniqueid());var s=this.module.create_sound_from_bytes(t,e,i);if(null==s)throw new Ie(Ln.null_assertion("sound was null"));return this.sound_list.set(t,s),s},uncreate:function(t){var e=this.sound_list.get(t);e.destroy()},add:function(t){this.sound_list.set(t.name,t),t.is_stream&&this.stream_list.set(t.name,t)},on:function(t,e,i){if("load"==e){var s=this.get(t);if(null!=s&&s.get_loaded())return void i(s)}var n=""+e+mr.splitter+t;null==this.handlers&&(this.handlers=new de),this.handlers.exists(n)||this.handlers.set(n,[]);var r=this.handlers.get(n);if(-1!=d.indexOf(r,i,0))throw new Ie("Audio on event adding the same handler twice");r.push(i),this.handlers.set(n,r)},off:function(t,e,i){if(null!=this.handlers){var s=""+e+mr.splitter+t,n=this.handlers.get(s);null!=n&&(d.remove(n,i),this.handlers.set(s,n))}},get:function(t){var e=this.sound_list.get(t);return e},volume:function(t,e){var i=this.get(t);return null!=i?null!=e?i.set_volume(e):i.get_volume():0},pan:function(t,e){var i=this.get(t);return null!=i?null!=e?i.set_pan(e):i.get_pan():0},pitch:function(t,e){var i=this.get(t);return null!=i?null!=e?i.set_pitch(e):i.get_pitch():0},position:function(t,e){var i=this.get(t);return null!=i?null!=e?i.set_position(e):i.get_position():0},duration:function(t){var e=this.get(t);return null!=e?e.get_duration():0},play:function(t){if(this.active){var e=this.get(t);null!=e&&e.play()}},loop:function(t){if(this.active){var e=this.get(t);null!=e&&e.loop()}},pause:function(t){if(this.active){var e=this.get(t);null!=e&&e.pause()}},stop:function(t){if(this.active){var e=this.get(t);null!=e&&e.stop()}},toggle:function(t){if(this.active){var e=this.get(t);null!=e&&e.toggle()}},kill:function(t){null!=t&&(this.sound_list.remove(t.name),this.stream_list.remove(t.name))},suspend:function(){if(this.active){this.active=!1;for(var t=this.stream_list.iterator();t.hasNext();){var e=t.next();e.internal_pause()}this.module.suspend()}},resume:function(){if(!this.active){this.active=!0,this.module.resume();for(var t=this.stream_list.iterator();t.hasNext();){var e=t.next();e.internal_play()}}},on_event:function(t){this.module.on_event(t),10==t.type?this.suspend():12==t.type&&this.resume()},destroy:function(){this.active=!1;for(var t=this.sound_list.iterator();t.hasNext();){var e=t.next();e.destroy()}this.module.destroy()},update:function(){if(this.active){for(var t=this.sound_list.iterator();t.hasNext();){var e=t.next();e.get_playing()&&e.internal_update()}this.module.update()}},sound_event:function(t,e){var i=""+e+mr.splitter+t.name;if(null!=this.handlers){var s=this.handlers.get(i);if(null!=s)for(var n=0;n<s.length;){var r=s[n];++n,r(t)}}},__class__:mr};var vr=function(t){this.touch_count=0,this.app=t,this.module=new er(this),this.module.init(),this.key_code_pressed=new _e,this.key_code_down=new _e,this.key_code_released=new _e,this.scan_code_pressed=new _e,this.scan_code_down=new _e,this.scan_code_released=new _e,this.mouse_button_pressed=new _e,this.mouse_button_down=new _e,this.mouse_button_released=new _e,this.gamepad_button_pressed=new _e,this.gamepad_button_down=new _e,this.gamepad_button_released=new _e,this.gamepad_axis_values=new _e,this.touches_down=new _e};r["snow.system.input.Input"]=vr,vr.__name__=["snow","system","input","Input"],vr.prototype={keypressed:function(t){return this.key_code_pressed.h.hasOwnProperty(t)},keyreleased:function(t){return this.key_code_released.h.hasOwnProperty(t)},keydown:function(t){return this.key_code_down.h.hasOwnProperty(t)},scanpressed:function(t){return this.scan_code_pressed.h.hasOwnProperty(t)},scanreleased:function(t){return this.scan_code_released.h.hasOwnProperty(t)},scandown:function(t){return this.scan_code_down.h.hasOwnProperty(t)},mousepressed:function(t){return this.mouse_button_pressed.h.hasOwnProperty(t)},mousereleased:function(t){return this.mouse_button_released.h.hasOwnProperty(t)},mousedown:function(t){return this.mouse_button_down.h.hasOwnProperty(t)},gamepadpressed:function(t,e){var i=this.gamepad_button_pressed.h[t];return null!=i?i.h.hasOwnProperty(e):!1},gamepadreleased:function(t,e){var i=this.gamepad_button_released.h[t];return null!=i?i.h.hasOwnProperty(e):!1},gamepaddown:function(t,e){var i=this.gamepad_button_down.h[t];return null!=i?i.h.hasOwnProperty(e):!1},gamepadaxis:function(t,e){var i=this.gamepad_axis_values.h[t];return null!=i&&i.h.hasOwnProperty(e)?i.h[e]:0},dispatch_key_down_event:function(t,e,i,s,n,r){i||(this.key_code_pressed.h[t]=!1,this.key_code_down.h[t]=!0,this.scan_code_pressed.h[e]=!1,this.scan_code_down.h[e]=!0),this.app.host.onkeydown(t,e,i,s,n,r)},dispatch_key_up_event:function(t,e,i,s,n,r){this.key_code_released.h[t]=!1,this.key_code_down.remove(t),this.scan_code_released.h[e]=!1,this.scan_code_down.remove(e),this.app.host.onkeyup(t,e,i,s,n,r)},dispatch_text_event:function(t,e,i,s,n,r){this.app.host.ontextinput(t,e,i,s,n,r)},dispatch_mouse_move_event:function(t,e,i,s,n,r){this.app.host.onmousemove(t,e,i,s,n,r)},dispatch_mouse_down_event:function(t,e,i,s,n){this.mouse_button_pressed.h[i]=!1,this.mouse_button_down.h[i]=!0,this.app.host.onmousedown(t,e,i,s,n)},dispatch_mouse_up_event:function(t,e,i,s,n){this.mouse_button_released.h[i]=!1,this.mouse_button_down.remove(i),this.app.host.onmouseup(t,e,i,s,n)},dispatch_mouse_wheel_event:function(t,e,i,s){this.app.host.onmousewheel(t,e,i,s)},dispatch_touch_down_event:function(t,e,i,s){this.touches_down.h.hasOwnProperty(i)||(this.touch_count++,this.touches_down.h[i]=!0),this.app.host.ontouchdown(t,e,i,s)},dispatch_touch_up_event:function(t,e,i,s){this.app.host.ontouchup(t,e,i,s),this.touches_down.remove(i)&&this.touch_count--},dispatch_touch_move_event:function(t,e,i,s,n,r){this.app.host.ontouchmove(t,e,i,s,n,r)},dispatch_gamepad_axis_event:function(t,e,i,s){if(!this.gamepad_axis_values.h.hasOwnProperty(t)){var n=new _e;this.gamepad_axis_values.h[t]=n}var r=this.gamepad_axis_values.h[t];r.set(e,i),this.app.host.ongamepadaxis(t,e,i,s)},dispatch_gamepad_button_down_event:function(t,e,i,s){if(!this.gamepad_button_pressed.h.hasOwnProperty(t)){var n=new _e;this.gamepad_button_pressed.h[t]=n}if(!this.gamepad_button_down.h.hasOwnProperty(t)){var r=new _e;this.gamepad_button_down.h[t]=r}var o=this.gamepad_button_pressed.h[t];o.set(e,!1);var l=this.gamepad_button_down.h[t];l.set(e,!0),this.app.host.ongamepaddown(t,e,i,s)},dispatch_gamepad_button_up_event:function(t,e,i,s){if(!this.gamepad_button_released.h.hasOwnProperty(t)){var n=new _e;this.gamepad_button_released.h[t]=n}if(!this.gamepad_button_down.h.hasOwnProperty(t)){var r=new _e;this.gamepad_button_down.h[t]=r}var o=this.gamepad_button_released.h[t];o.set(e,!1);var l=this.gamepad_button_down.h[t];l.remove(e),this.app.host.ongamepadup(t,e,i,s)},dispatch_gamepad_device_event:function(t,e,i,s){this.app.host.ongamepaddevice(t,e,i,s)},listen:function(t){this.module.listen(t)},unlisten:function(t){this.module.unlisten(t)},on_event:function(t){this.module.on_event(t)},update:function(){this.module.update(),this._update_keystate(),this._update_gamepadstate(),this._update_mousestate()},destroy:function(){this.module.destroy()},_update_mousestate:function(){for(var t=this.mouse_button_pressed.keys();t.hasNext();){var e=t.next();this.mouse_button_pressed.h[e]?this.mouse_button_pressed.remove(e):this.mouse_button_pressed.h[e]=!0}for(var i=this.mouse_button_released.keys();i.hasNext();){var s=i.next();this.mouse_button_released.h[s]?this.mouse_button_released.remove(s):this.mouse_button_released.h[s]=!0}},_update_gamepadstate:function(){for(var t=this.gamepad_button_pressed.iterator();t.hasNext();)for(var e=t.next(),i=e.keys();i.hasNext();){var s=i.next();e.h[s]?e.remove(s):e.h[s]=!0}for(var n=this.gamepad_button_released.iterator();n.hasNext();)for(var r=n.next(),o=r.keys();o.hasNext();){var l=o.next();r.h[l]?r.remove(l):r.h[l]=!0}},_update_keystate:function(){for(var t=this.key_code_pressed.keys();t.hasNext();){var e=t.next();this.key_code_pressed.h[e]?this.key_code_pressed.remove(e):this.key_code_pressed.h[e]=!0}for(var i=this.key_code_released.keys();i.hasNext();){var s=i.next();this.key_code_released.h[s]?this.key_code_released.remove(s):this.key_code_released.h[s]=!0}for(var n=this.scan_code_pressed.keys();n.hasNext();){var r=n.next();this.scan_code_pressed.h[r]?this.scan_code_pressed.remove(r):this.scan_code_pressed.h[r]=!0}for(var o=this.scan_code_released.keys();o.hasNext();){var l=o.next();this.scan_code_released.h[l]?this.scan_code_released.remove(l):this.scan_code_released.h[l]=!0}},__class__:vr};var yr=function(t){this.string_save_prefix="slot",this.app=t,this.module=new sr(this),this.module.init()};r["snow.system.io.IO"]=yr,yr.__name__=["snow","system","io","IO"],yr.prototype={url_open:function(t){this.module.url_open(t)},data_load:function(t,e){return this.module.data_load(t,e)},data_save:function(t,e,i){return this.module.data_save(t,e,i)},data_flow:function(t,e,i){var s=this;return null==i&&(i=n(this,this.default_provider)),new Un(function(n,r){i(s.app,t).then(function(i){null!=e?e(s.app,t,i).then(n,r):n(i)}).error(r)})},string_save_path:function(t){return null==t&&(t=0),this.module.string_save_path(t)},string_save:function(t,e,i){null==i&&(i=0);var s=this.string_slots_sync(i),n=window.btoa(t);if(null==e)s.remove(n);else{var r=window.btoa(e);null!=Xr[n]?s.setReserved(n,r):s.h[n]=r}var o=ee.run(s);return o=window.btoa(o),this.module.string_slot_save(i,o)},string_load:function(t,e){null==e&&(e=0);var i,s=this.string_slots_sync(e),n=window.btoa(t);return i=null!=Xr[n]?s.getReserved(n):s.h[n],null==i?null:window.atob(i)},string_destroy:function(t){return null==t&&(t=0),null==this.string_slots?this.string_slots=new _e:this.string_slots.remove(t),this.module.string_slot_destroy(t)},string_slots_sync:function(t){null==t&&(t=0),null==this.string_slots&&(this.string_slots=new _e);var e=this.string_slots.h[t];if(null==e){var i=this.module.string_slot_load(t);null==i?e=new de:(i=window.atob(i),e=se.run(i)),this.string_slots.h[t]=e}return e},default_provider:function(t,e){return this.module.data_load(e,null)},on_event:function(t){this.module.on_event(t)},update:function(){this.module.update()},destroy:function(){this.module.destroy()},__class__:yr};var wr=function(t,e){this.internal_resize=!1,this.internal_position=!1,this.minimized=!1,this.closed=!0,this.auto_render=!0,this.auto_swap=!0,this.height=0,this.width=0,this.y=0,this.x=0,this.fullscreen=!1,this.grab=!1,this.bordered=!0,this.title="snow window",this.set_max_size({x:0,y:0}),this.set_min_size({x:0,y:0}),this.system=t,this.asked_config=e,this.config=e,null==this.config.x&&(this.config.x=536805376),null==this.config.y&&(this.config.y=536805376),this.system.module.create(this.system.app.config.render,e,n(this,this.on_window_created))};r["snow.system.window.Window"]=wr,wr.__name__=["snow","system","window","Window"],wr.prototype={on_window_created:function(t,e,i){this.id=e,this.handle=t,null!=this.handle&&(this.closed=!1,this.config=i.config,this.system.app.config.render=i.render_config,this.internal_position=!0,this.set_x(this.config.x),this.set_y(this.config.y),this.internal_position=!1,this.internal_resize=!0,this.set_width(this.config.width),this.set_height(this.config.height),this.internal_resize=!1,this.on_event({type:1,window_id:e,timestamp:Nn.core.timestamp(),event:{}}))},on_event:function(t){var e=t.type;if(null!=e)switch(e){case 5:this.internal_position=!0,this.set_position(t.event.x,t.event.y),this.internal_position=!1;break;case 6:this.internal_resize=!0,this.set_size(t.event.x,t.event.y),this.internal_resize=!1;break;case 7:this.internal_resize=!0,this.set_size(t.event.x,t.event.y),this.internal_resize=!1;break;case 8:this.minimized=!0;break;case 10:this.minimized=!1}null!=this.onevent&&this.onevent(t)},update:function(){null==this.handle||this.closed||this.system.module.update_window(this)},render:function(){if(!this.minimized&&!this.closed&&null!=this.handle){if(this.system.module.render(this),null!=this.onrender)return this.onrender(this),void(this.auto_swap&&this.swap());_r.current_context.clearColor(0,0,0,1),_r.current_context.clear(16384),this.auto_swap&&this.swap()}},swap:function(){null==this.handle||this.closed||this.minimized||this.system.module.swap(this)},destroy:function(){this.closed=!0,null!=this.handle&&(this.system.remove(this),this.system.module.destroy_window(this),this.handle=null)},close:function(){this.closed=!0,null!=this.handle&&this.system.module.close(this)},show:function(){null!=this.handle&&(this.closed=!1,this.system.module.show(this))},simple_message:function(t,e){null==e&&(e=""),null!=this.handle&&this.system.module.simple_message(this,t,e)},get_fullscreen:function(){return this.fullscreen},set_fullscreen:function(t){return null!=this.handle&&this.system.module.fullscreen(this,t),this.fullscreen=t},get_bordered:function(){return this.bordered},get_grab:function(){return this.grab},get_max_size:function(){return this.max_size},get_min_size:function(){return this.min_size},get_title:function(){return this.title},set_title:function(t){return null!=this.handle&&this.system.module.set_title(this,t),this.title=t},set_x:function(t){return this.x=t,null==this.handle||this.internal_position||this.system.module.set_position(this,this.x,this.y),this.x},set_y:function(t){return this.y=t,null==this.handle||this.internal_position||this.system.module.set_position(this,this.x,this.y),this.y},set_width:function(t){return this.width=t,null==this.handle||this.internal_resize||this.system.module.set_size(this,this.width,this.height),this.width},set_height:function(t){return this.height=t,null==this.handle||this.internal_resize||this.system.module.set_size(this,this.width,this.height),this.height},set_cursor_position:function(t,e){null==this.handle||this.closed||this.system.module.set_cursor_position(this,t,e)},set_position:function(t,e){var i=this.internal_position;this.internal_position=!0,this.set_x(t),this.set_y(e),this.internal_position=i,null==this.handle||this.internal_position||this.system.module.set_position(this,this.x,this.y)},set_size:function(t,e){var i=this.internal_resize;this.internal_resize=!0,this.set_width(t),this.set_height(e),this.internal_resize=i,null==this.handle||this.internal_resize||this.system.module.set_size(this,t,e)},set_max_size:function(t){return null!=this.get_max_size()&&null!=this.handle&&this.system.module.set_max_size(this,t.x,t.y),this.max_size=t},set_min_size:function(t){return null!=this.get_min_size()&&null!=this.handle&&this.system.module.set_min_size(this,t.x,t.y),this.min_size=t},set_bordered:function(t){return null!=this.handle&&this.system.module.bordered(this,t),this.bordered=t},set_grab:function(t){return null!=this.handle&&this.system.module.grab(this,t),this.grab=t},__class__:wr,__properties__:{set_min_size:"set_min_size",get_min_size:"get_min_size",set_max_size:"set_max_size",get_max_size:"get_max_size",set_height:"set_height",set_width:"set_width",set_y:"set_y",set_x:"set_x",set_fullscreen:"set_fullscreen",get_fullscreen:"get_fullscreen",set_grab:"set_grab",get_grab:"get_grab",set_bordered:"set_bordered",get_bordered:"get_bordered",set_title:"set_title",get_title:"get_title"}};var xr=function(t){this.window_count=0,this.app=t,this.window_list=new _e,this.window_handles=new ue,this.module=new rr(this),this.module.init()};r["snow.system.window.Windowing"]=xr,xr.__name__=["snow","system","window","Windowing"],xr.prototype={create:function(t){var e=new wr(this,t);return this.window_list.h[e.id]=e,this.window_handles.set(e.handle,e.id),this.window_count++,this.module.listen(e),(null==t.no_input||0==t.no_input)&&this.app.input.listen(e),e},remove:function(t){this.window_list.remove(t.id),this.window_handles.remove(t.handle),this.window_count--,this.module.unlisten(t),(null==t.config.no_input||0==t.config.no_input)&&this.app.input.unlisten(t)},window_from_handle:function(t){if(null!=this.window_handles.h.__keys__[t.__id__]){var e=this.window_handles.h[t.__id__];return this.window_list.h[e]}return null},window_from_id:function(t){return this.window_list.h[t]},enable_vsync:function(t){return this.module.system_enable_vsync(t)},enable_cursor:function(t){this.module.system_enable_cursor(t)},enable_cursor_lock:function(t){this.module.system_lock_cursor(t)},display_count:function(){return this.module.display_count()},display_mode_count:function(t){return this.module.display_mode_count(t)},display_native_mode:function(t){return this.module.display_native_mode(t)},display_current_mode:function(t){return this.module.display_current_mode(t)},display_mode:function(t,e){return this.module.display_mode(t,e)},display_bounds:function(t){return this.module.display_bounds(t)},display_name:function(t){return this.module.display_name(t)},on_event:function(t){if(5==t.type){var e=t.window,i=this.window_list.h[e.window_id];null!=i&&i.on_event(e)}},update:function(){this.module.update();for(var t=this.window_list.iterator();t.hasNext();){var e=t.next();e.update()}for(var i=this.window_list.iterator();i.hasNext();){var s=i.next();s.auto_render&&s.render()}},destroy:function(){this.module.destroy()},__class__:xr};var br=r["snow.types.Error"]={__ename__:["snow","types","Error"],__constructs__:["error","init","windowing","parse"]};br.error=function(t){var e=["error",0,t];return e.__enum__=br,e.toString=o,e},br.init=function(t){var e=["init",1,t];return e.__enum__=br,e.toString=o,e},br.windowing=function(t){var e=["windowing",2,t];return e.__enum__=br,e.toString=o,e},br.parse=function(t){var e=["parse",3,t];return e.__enum__=br,e.toString=o,e};var kr={};r["snow.types._Types.AssetType_Impl_"]=kr,kr.__name__=["snow","types","_Types","AssetType_Impl_"],kr.toString=function(t){switch(t){case 0:return"unknown";case 1:return"bytes";case 2:return"text";case 3:return"json";case 4:return"image";case 5:return"audio";default:return""+t}};var zr={};r["snow.types._Types.OpenGLProfile_Impl_"]=zr,zr.__name__=["snow","types","_Types","OpenGLProfile_Impl_"],zr.toString=function(t){switch(t){case 0:return"compatibility";case 1:return"core";default:return""+t}};var Sr={};r["snow.types._Types.TextEventType_Impl_"]=Sr,Sr.__name__=["snow","types","_Types","TextEventType_Impl_"],Sr.toString=function(t){switch(t){case 0:return"unknown";case 1:return"edit";case 2:return"input";default:return""+t}};var Tr={};r["snow.types._Types.GamepadDeviceEventType_Impl_"]=Tr,Tr.__name__=["snow","types","_Types","GamepadDeviceEventType_Impl_"],Tr.toString=function(t){switch(t){case 0:return"unknown";case 1:return"device_added";case 2:return"device_removed";case 3:return"device_remapped";default:return""+t}};var Ar={};r["snow.types._Types.SystemEventType_Impl_"]=Ar,Ar.__name__=["snow","types","_Types","SystemEventType_Impl_"],Ar.toString=function(t){switch(t){case 0:return"unknown";case 1:return"init";case 2:return"ready";case 3:return"update";case 4:return"shutdown";case 5:return"window";case 6:return"input";case 7:return"quit";case 8:return"app_terminating";case 9:return"app_lowmemory";case 10:return"app_willenterbackground";case 11:return"app_didenterbackground";case 12:return"app_willenterforeground";case 13:return"app_didenterforeground";case 14:return"file";default:return""+t}};var Ir={};r["snow.types._Types.WindowEventType_Impl_"]=Ir,Ir.__name__=["snow","types","_Types","WindowEventType_Impl_"],Ir.toString=function(t){switch(t){case 0:return"unknown";case 1:return"created";case 2:return"shown";case 3:return"hidden";case 4:return"exposed";case 5:return"moved";case 6:return"resized";case 7:return"size_changed";case 8:return"minimized";case 9:return"maximized";case 10:return"restored";case 11:return"enter";case 12:return"leave";case 13:return"focus_gained";case 14:return"focus_lost";case 15:return"close";case 16:return"destroy";default:return""+t}};var Er={};r["snow.types._Types.InputEventType_Impl_"]=Er,Er.__name__=["snow","types","_Types","InputEventType_Impl_"],Er.toString=function(t){switch(t){case 0:return"unknown";case 1:return"key";case 2:return"mouse";case 3:return"touch";case 4:return"joystick";case 5:return"controller";default:return""+t}};var Mr={};r["snow.types._Types.FileEventType_Impl_"]=Mr,Mr.__name__=["snow","types","_Types","FileEventType_Impl_"],Mr.toString=function(t){switch(t){case 0:return"unknown";case 1:return"modify";case 2:return"remove";case 3:return"create";case 4:return"drop";default:return""+t}};var Cr=function(t,e,i){null==i&&(i=""),this.loadSucceeded=!1,null!=t&&null!=e&&this.Load(t,e,i)};r["threes.Score"]=Cr,Cr.__name__=["threes","Score"],Cr.prototype={Load:function(t,e,i){null==i&&(i=""),this.local=0==i.length,i=this.local?Pr.localId:i;var s=t+e+i;return this.fromDevice=i,this.fromPlace=""+e,this.resetValues(),this.local?(this.loadSucceeded=this.Parse(Or.string("score"+s)),void this.LoadStartTime(Or.string("score"+s+"StartTime"))):void 0},LoadStartTime:function(t){return this.loadSucceeded&&0!=t.length?void(this.startTimestamp=function(){var e,i=parseFloat(t),s=new Date;return s.setTime(i),e=s}(this).getTime()):void(this.startTimestamp=(new Date).getTime())},Save:function(t,e){var i=t+e+Pr.localId;Or.string("score"+i,this.GenerateScoreString()),Or.string("score"+i+"StartTime",""+this.startTimestamp),this.loadSucceeded=!0},GenerateScoreString:function(){var t="";t+=this.name+";",t+=this.score+";",t+=this.rank+";";for(var e=0;16>e;){var i=e++;t+=this.values[i]+","}return t+=";",t+=""+this.endTimestamp},resetValues:function(){this.values=[];for(var t=0;16>t;){{t++}this.values.push(0)}},Parse:function(t){if(null==t)return!1;if(0==t.length)return!1;var e=t.split(";");if(e.length<4||e.length>5)return this.name="CORRUPTED",this.score=0,this.rank=0,this.resetValues(),!0;this.name=e[0],this.score=C.parseInt(e[1]),this.rank=C.parseInt(e[2]),this.resetValues();for(var i=e[3].split(","),s=0,n=i.length;n>s;){var r=s++;16>r&&(this.values[r]=C.parseInt(i[r]))}return this.endTimestamp=5==e.length?function(){var t,i=parseFloat(e[4]),s=new Date;return s.setTime(i),t=s}(this).getTime():(new Date).getTime(),!0},Equals:function(t){return this.score==t.score&&this.name==t.name},IsVisible:function(){return this.endTimestamp>=Rr.clearDate&&this.loadSucceeded},ToString:function(){return this.GenerateScoreString()},__class__:Cr};var Rr=function(t){this.numLocalScores=0,this.Initialize(t)};r["threes.Scoreboard"]=Rr,Rr.__name__=["threes","Scoreboard"],Rr.Sort=function(t,e){null==e&&(e=-1),-1==e&&(e=t.length);for(var i=1,s=t.length;s>i;){for(var n=i++,r=t[n],o=n-1,l=!1;!l;)t[o].score<r.score||t[o].score==r.score&&t[o].rank<r.rank?(t[o+1]=t[o],o-=1,l=0>o):l=!0;t[o+1]=r}for(var a=[],h=0;e>h;){var _=h++;a.push(t[_])}return a},Rr.prototype={Initialize:function(t){this.name=t,this.localScores=[];for(var e=0,i=Rr.kMaxScores;i>e;){var s=e++;this.localScores[s]=new Cr}var n=Or.string("ScoreClearDate");(null==n||""==n)&&(n=""+(new Date).getTime(),Or.string("ScoreClearDate",n)),this.numLocalScores=Or["int"]("ScoreCount"+this.name+Pr.localId);for(var r=0,o=this.numLocalScores;o>r;){var l=r++;this.localScores[l].Load(this.name,l)}this.allScores=this.GetAllScores()},SetClearDate:function(t){Rr.clearDate=t,Or.string("ScoreClearDate",""+t),this.Rescore()},AddScore:function(t){if(t.endTimestamp=P.finishTime,this.numLocalScores<Rr.kMaxScores)this.localScores[this.numLocalScores]=t,this.numLocalScores++;else{for(var e=2147483647,i=-1,s=0,n=this.numLocalScores;n>s;){var r=s++,o=this.localScores[r];if(!o.IsVisible()){i=r;break}o.score<e&&o.score<t.score&&(e=o.score,i=r)}if(-1==i)return!1;this.localScores[i]=t}this.localScores=Rr.Sort(this.localScores),Or["int"]("ScoreCount"+this.name+Pr.localId,this.numLocalScores);for(var l=0,a=this.numLocalScores;a>l;){var h=l++;this.localScores[h].Save(this.name,h)}return this.allScores=this.GetAllScores(),this.ReportScore(t),!0},ReportScore:function(t){},Rescore:function(){this.allScores=this.GetAllScores()},GetScores:function(){return this.allScores},GetAllScores:function(){var t=Or.string("ScoreClearDate");Rr.clearDate=0==t.length?(new Date).getTime():function(){var e,i=parseFloat(t),s=new Date;return s.setTime(i),e=s}(this).getTime();for(var e=[],i=0,s=this.numLocalScores;s>i;){var n=i++;this.localScores[n].IsVisible()&&e.push(this.localScores[n])}for(var r=Rr.Sort(e,C["int"](Math.min(e.length,Rr.kMaxDisplayScores))),o=0,l=r.length;l>o;){o++}return r},GetHighScoreObject:function(){return 0==this.allScores.length?null:this.allScores[0]},GetHighScore:function(){return 0==this.allScores.length?0:this.allScores[0].score},GetHighRank:function(){return 0==this.allScores.length?0:this.allScores[0].rank},__class__:Rr};var Br=function(){this.multiplayer=!1,this.onlyMergeSame=!0,this.infiniteMoves=!1,this.spawnPowerups=!0,this.kMovesPerBite=3,this.kPowerupDelayInit=10,this.kPowerupDelay=10,this.kMaxMoves=10,this.kSpecialDemotion=3,this.kSpecialRareness=20,this.kNumberRandomness=4,this.kSpawnAmnt=1,this.kStartSpawnNumbers=9,this.kStartSize=4};r["threes.Settings"]=Br,Br.__name__=["threes","Settings"],Br.prototype={__class__:Br};var Fr=function(){this.holdThreshold=.8,this.holdJump=.5,this.holdTime=.5,this.borderMove=20,this.slideMod=8};r["threes.Tweaks"]=Fr,Fr.__name__=["threes","Tweaks"],Fr.prototype={__class__:Fr};var Pr=function(){};r["vo.Devices"]=Pr,Pr.__name__=["vo","Devices"];var Nr=function(){};r["vo.Help"]=Nr,Nr.__name__=["vo","Help"],Nr.AddCommasi=function(t){return Nr.AddCommas(""+t)},Nr.AddCommas=function(t){for(var e="",i=0,s=t.length;s>i;){var n=i++;n>0&&(t.length-n)%3==0&&(e+=","),e+=t.charAt(n)}return e},Nr.Delerpv3=function(t,e,i){return new y(Nr.Delerp(t.x,e.x,i.x),Nr.Delerp(t.y,e.y,i.y),Nr.Delerp(t.z,e.z,i.z))},Nr.Delerpv2=function(t,e,i){return new y(Nr.Delerp(t.x,e.x,i.x),Nr.Delerp(t.y,e.y,i.y))},Nr.Delerp=function(t,e,i){return(i-t)/(e-t)},Nr.Blerp=function(t,e,i,s,n,r,o){var l,a=t-s,h=n-e;return r>i&&i>0?(i/=r,l=Nr.BlerpHelp(i,1)*a,t-l):i>1-o&&1>i?(i=(i-(1-o))/o,l=Nr.BlerpHelp(i,1)*h,e+l):t==e?t:(i=(i-r)/(1-o-r),Cs.lerp(t,e,i))},Nr.BlerpHelp=function(t,e){var i=.5,s=-4*e;return s*Math.pow(t-i,2)+e};var Gr=function(t){this.savedList=!1,this.savedItems=!1,this.index=0,this.randomness=1,this.randomness=t,this.Clear()};r["vo.PseudoList"]=Gr,Gr.__name__=["vo","PseudoList"],Gr.prototype={Clear:function(){this.items=[],this.list=[],this.savedItems=!1,this.savedList=!1},GetNext:function(){if(0==this.list.length)return null;var t=this.list[this.index];return this.index++,this.index>=this.list.length&&(this.Shuffle(),this.index=0),t},Add:function(t){for(var e=[],i=0,s=this.items.length;s>i;){var n=i++;e[n]=this.items[n]}e[this.items.length]=t,this.items=e,this.GenerateList(),this.savedItems=!1},GenerateList:function(){this.list=[];for(var t=0,e=0,i=this.items.length;i>e;)for(var s=e++,n=0,r=this.randomness;r>n;){{n++}this.list[t]=this.items[s],t++}this.savedList=!1},Shuffle:function(){var t=this.list.length;if(0!=t){for(;t>0;){t--;var e=Math.floor(Math.random()*(t+1)),i=this.list[t],s=this.list[e];this.list[t]=s,this.list[e]=i}this.index=0,this.savedList=!1}},Load:function(t,e,i){this.index=t,this.items=e,this.list=i,this.savedList=!0,this.savedItems=!0},ForceSave:function(){this.savedList=!1,this.savedItems=!1},GetIndex:function(){return this.index},GetRandomness:function(){return this.randomness},GetItems:function(){return this.items},GetList:function(){return this.list},SaveList:function(){var t=this.savedList;return this.savedList=!0,!t},SaveItems:function(){var t=this.savedItems;return this.savedItems=!0,!t},toString:function(){for(var t="( "+this.index+"-"+this.randomness+" ",e=this.index,i=this.list.length;i>e;){var s=e++;t+=C.string(this.list[s])+","}for(var n=0,r=this.index;r>n;){var o=n++;t+=C.string(this.list[o])+","}return t+=" )"},__class__:Gr};var Dr=function(t){this.savedList=!1,this.savedItems=!1,this.index=0,this.randomness=1,this.randomness=t,this.Clear()};r["vo.PseudoList_Int"]=Dr,Dr.__name__=["vo","PseudoList_Int"],Dr.prototype={Clear:function(){this.items=[],this.list=[],this.savedItems=!1,this.savedList=!1},GetNext:function(){if(0==this.list.length)return null;var t=this.list[this.index];return this.index++,this.index>=this.list.length&&(this.Shuffle(),this.index=0),t},Add:function(t){for(var e=[],i=0,s=this.items.length;s>i;){var n=i++;e[n]=this.items[n]}e[this.items.length]=t,this.items=e,this.GenerateList(),this.savedItems=!1},GenerateList:function(){this.list=[];for(var t=0,e=0,i=this.items.length;i>e;)for(var s=e++,n=0,r=this.randomness;r>n;){{n++}this.list[t]=this.items[s],t++}this.savedList=!1},Shuffle:function(){var t=this.list.length;if(0!=t){for(;t>0;){t--;var e=Math.floor(Math.random()*(t+1)),i=this.list[t],s=this.list[e];this.list[t]=s,this.list[e]=i}this.index=0,this.savedList=!1}},Load:function(t,e,i){this.index=t,this.items=e,this.list=i,this.savedList=!0,this.savedItems=!0},ForceSave:function(){this.savedList=!1,this.savedItems=!1},GetIndex:function(){return this.index},GetRandomness:function(){return this.randomness},GetItems:function(){return this.items},GetList:function(){return this.list},SaveList:function(){var t=this.savedList;return this.savedList=!0,!t},SaveItems:function(){var t=this.savedItems;return this.savedItems=!0,!t},toString:function(){for(var t="( "+this.index+"-"+this.randomness+" ",e=this.index,i=this.list.length;i>e;){var s=e++;t+=C.string(this.list[s])+","}for(var n=0,r=this.index;r>n;){var o=n++;t+=C.string(this.list[o])+","}return t+=" )"},__class__:Dr};var Lr=function(t){this.savedList=!1,this.savedItems=!1,this.index=0,this.randomness=1,this.randomness=t,this.Clear()};r["vo.PseudoList_Tile"]=Lr,Lr.__name__=["vo","PseudoList_Tile"],Lr.prototype={Clear:function(){this.items=[],this.list=[],this.savedItems=!1,this.savedList=!1},GetNext:function(){if(0==this.list.length)return null;var t=this.list[this.index];return this.index++,this.index>=this.list.length&&(this.Shuffle(),this.index=0),t},Add:function(t){for(var e=[],i=0,s=this.items.length;s>i;){var n=i++;e[n]=this.items[n]}e[this.items.length]=t,this.items=e,this.GenerateList(),this.savedItems=!1},GenerateList:function(){this.list=[];for(var t=0,e=0,i=this.items.length;i>e;)for(var s=e++,n=0,r=this.randomness;r>n;){{n++}this.list[t]=this.items[s],t++}this.savedList=!1},Shuffle:function(){var t=this.list.length;if(0!=t){for(;t>0;){t--;var e=Math.floor(Math.random()*(t+1)),i=this.list[t],s=this.list[e];this.list[t]=s,this.list[e]=i}this.index=0,this.savedList=!1}},Load:function(t,e,i){this.index=t,this.items=e,this.list=i,this.savedList=!0,this.savedItems=!0},ForceSave:function(){this.savedList=!1,this.savedItems=!1},GetIndex:function(){return this.index},GetRandomness:function(){return this.randomness},GetItems:function(){return this.items},GetList:function(){return this.list},SaveList:function(){var t=this.savedList;return this.savedList=!0,!t},SaveItems:function(){var t=this.savedItems;return this.savedItems=!0,!t},toString:function(){for(var t="( "+this.index+"-"+this.randomness+" ",e=this.index,i=this.list.length;i>e;){var s=e++;t+=C.string(this.list[s])+","}for(var n=0,r=this.index;r>n;){var o=n++;t+=C.string(this.list[o])+","}return t+=" )"},__class__:Lr};var Or=function(){};r["vo.Remember"]=Or,Or.__name__=["vo","Remember"],Or["int"]=function(t,e){return null!=e?(m.io.core.app.io.string_save(t,""+e,0),e):Or.loadint(t)},Or.bool=function(t,e){return null!=e?(m.io.core.app.io.string_save(t,""+(null==e?"null":""+e),0),e):Or.loadbool(t)},Or.string=function(t,e){return null!=e?(m.io.core.app.io.string_save(t,e,0),e):Or.loadstring(t)},Or.psuedolist=function(t,e){return null!=e?(Or.psuedolist_save(t,e),e):Or.psuedolist_load(t)},Or.loadbool=function(t,e){var i=m.io.core.app.io.string_load(t,0);return null==i?(null==e&&(e=!1),m.io.core.app.io.string_save(t,""+(null==e?"null":""+e),0),e):"true"==i
},Or.loadint=function(t,e){var i=m.io.core.app.io.string_load(t,0);return null==i?(null==e&&(e=0),m.io.core.app.io.string_save(t,""+e,0),e):C.parseInt(i)},Or.loadstring=function(t,e){var i=m.io.core.app.io.string_load(t,0);return null==i?(null==e&&(e=""),m.io.core.app.io.string_save(t,e,0),e):i},Or.psuedolist_save=function(t,e){var i="Pseudo"+t;if(Or.string(i,e.GetRandomness()+"|"+e.GetIndex()),e.SaveItems()){for(var s="",n=e.GetItems(),r=n.length,o=0;r>o;){var l=o++;s+=n[l]+Or.delimiter}Or.string(i+"Items",s)}if(e.SaveList()){for(var a="",h=e.GetList(),_=h.length,u=0;_>u;){var c=u++;a+=h[c]+Or.delimiter}Or.string(i+"List",a)}},Or.psuedolist_load=function(t){for(var e="Pseudo"+t,i=Or.string(e).split(Or.delimiter),s=C.parseInt(i[0]),n=C.parseInt(i[1]),r=Or.string(e+"Items").split(Or.delimiter),o=r.length-1,l=[],a=0;o>a;){var h=a++;l[h]=C.parseInt(r[h])}for(var _=Or.string(e+"List").split(Or.delimiter),u=_.length-1,c=[],d=0;u>d;){var f=d++;c[f]=C.parseInt(_[f])}var p=new Dr(s);return p.Load(n,l,c),p};var Ur,Hr=0;Array.prototype.indexOf&&(d.indexOf=function(t,e,i){return Array.prototype.indexOf.call(t,e,i)}),r.Math=Math,String.prototype.__class__=r.String=String,String.__name__=["String"],r.Array=Array,Array.__name__=["Array"],Date.prototype.__class__=r.Date=Date,Date.__name__=["Date"];var Vr=r.Int={__name__:["Int"]},qr=r.Dynamic={__name__:["Dynamic"]},jr=r.Float=Number;jr.__name__=["Float"];var Zr=r.Bool=Boolean;Zr.__ename__=["Bool"];var Kr=r.Class={__name__:["Class"]},Qr={};null==Array.prototype.map&&(Array.prototype.map=function(t){for(var e=[],i=0,s=this.length;s>i;){var n=i++;e[n]=t(this[n])}return e}),null==Array.prototype.filter&&(Array.prototype.filter=function(t){for(var e=[],i=0,s=this.length;s>i;){var n=i++,r=this[n];t(r)&&e.push(r)}return e}),te.content=[{name:"version",data:"MS4wLjAtYWxwaGEuMQ"},{name:"default.vert.glsl",data:"YXR0cmlidXRlIHZlYzMgdmVydGV4UG9zaXRpb247CmF0dHJpYnV0ZSB2ZWMyIHZlcnRleFRDb29yZDsKYXR0cmlidXRlIHZlYzQgdmVydGV4Q29sb3I7CmF0dHJpYnV0ZSB2ZWMzIHZlcnRleE5vcm1hbDsKCnZhcnlpbmcgdmVjMiB0Y29vcmQ7CnZhcnlpbmcgdmVjNCBjb2xvcjsKCnVuaWZvcm0gbWF0NCBwcm9qZWN0aW9uTWF0cml4Owp1bmlmb3JtIG1hdDQgbW9kZWxWaWV3TWF0cml4OwoKdm9pZCBtYWluKHZvaWQpIHsKCiAgICBnbF9Qb3NpdGlvbiA9IHByb2plY3Rpb25NYXRyaXggKiBtb2RlbFZpZXdNYXRyaXggKiB2ZWM0KHZlcnRleFBvc2l0aW9uLCAxLjApOwogICAgdGNvb3JkID0gdmVydGV4VENvb3JkOwogICAgY29sb3IgPSB2ZXJ0ZXhDb2xvcjsKICAgICAgICAvL2htbSEgSSB0aGluayBzaGFkZXJzIGFyZSBjb21waWxlZCBvcHRpbWlzZWQsIHJlbW92aW5nIHVudXNlZCB2YWx1ZXMgd2hpY2ggbWVhbnMKICAgICAgICAvL3RoYXQgdGhlIHNoYWRlcnMgZ2V0VmVydGV4Tm9ybWFsIGF0dHJpYnV0ZSByZXR1cm5zIGludmFsaWQgKC0xKSB2YWx1ZXMhCiAgICB2ZWMzIG4gPSB2ZXJ0ZXhOb3JtYWw7CiAgICBnbF9Qb2ludFNpemUgPSAxLjA7Cgp9"},{name:"build",data:"KzRiODAzMjlmMWM"},{name:"default.frag.glsl",data:"dmFyeWluZyB2ZWMyIHRjb29yZDsKdmFyeWluZyB2ZWM0IGNvbG9yOwoKdm9pZCBtYWluKCkgewogICAgZ2xfRnJhZ0NvbG9yID0gY29sb3I7Cn0"},{name:"default.frag.textured.glsl",data:"dW5pZm9ybSBzYW1wbGVyMkQgdGV4MDsKdmFyeWluZyB2ZWMyIHRjb29yZDsKdmFyeWluZyB2ZWM0IGNvbG9yOwoKdm9pZCBtYWluKCkgewogICAgdmVjNCB0ZXhjb2xvciA9IHRleHR1cmUyRCh0ZXgwLCB0Y29vcmQpOwogICAgLy8gZmxvYXQgbHVtaW5vc2l0eSA9ICh0ZXhjb2xvci5yICsgdGV4Y29sb3IuZyArIHRleGNvbG9yLmIpIC8gMy4wOwogICAgLy8gdmVjNCBncmF5ID0gdmVjNChsdW1pbm9zaXR5LGx1bWlub3NpdHksbHVtaW5vc2l0eSwxKTsKICAgIC8vIHZlYzQgb2NvbG9yID0gdmVjNCh0ZXhjb2xvci5yLCB0ZXhjb2xvci5nLCB0ZXhjb2xvci5iLCAxKTsKICAgIC8vIHZlYzQgdXZjb2xvciA9IHZlYzQodGNvb3JkLngsIHRjb29yZC55LCAodGNvb3JkLngrdGNvb3JkLnkpKjIuMCwgMSk7CiAgICAvLyB2ZWM0IHdoaXRlID0gdmVjNCgxLCAxLCAxLCAwLjYpOwogICAgLy8gZ2xfRnJhZ0NvbG9yID0gZ3JheSAqICgodGNvb3JkLngrdGNvb3JkLnkpLzIuMCk7CiAgICBnbF9GcmFnQ29sb3IgPSBjb2xvciAqIHRleGNvbG9yOyAvL3ZlYzQoMCwwLjksMC42LDEpOyA7CiAgICAvLyBnbF9GcmFnQ29sb3IgPSB2ZWM0KGdsX1BvaW50Q29vcmQueCwgZ2xfUG9pbnRDb29yZC55LCAwLCAxKTsKICAgIC8vIHZlYzQgY2MgPSB1dmNvbG9yICogZ3JheTsKICAgIC8vIGdsX0ZyYWdDb2xvciA9IHRleGNvbG9yOwp9"},{name:"default.frag.bitmapfont.glsl",data:"I2RlZmluZSBPVVRMSU5FIDEKI2RlZmluZSBHTE9XIDEKI2RlZmluZSBTVVBFUlNBTVBMRSAxCgp1bmlmb3JtIHNhbXBsZXIyRCB0ZXgwOwp2YXJ5aW5nIHZlYzIgdGNvb3JkOwp2YXJ5aW5nIHZlYzQgY29sb3I7Cgp1bmlmb3JtIGZsb2F0IHNtb290aG5lc3M7CnVuaWZvcm0gZmxvYXQgdGhpY2tuZXNzOwoKdW5pZm9ybSB2ZWM0IG91dGxpbmVfY29sb3I7CnVuaWZvcm0gZmxvYXQgb3V0bGluZTsKCnVuaWZvcm0gdmVjNCBnbG93X2NvbG9yOwp1bmlmb3JtIGZsb2F0IGdsb3dfdGhyZXNob2xkOwp1bmlmb3JtIGZsb2F0IGdsb3dfYW1vdW50OwoKCmZsb2F0IGVkZ2UoZmxvYXQgdmFsdWUsIGZsb2F0IGFtb3VudCwgZmxvYXQgdCkgewogICAgcmV0dXJuIHNtb290aHN0ZXAodmFsdWUgLSBhbW91bnQsIHZhbHVlICsgYW1vdW50LCB0KTsKfQoKZmxvYXQgZ2V0KHZlYzIgdXYsIGZsb2F0IHdpZHRoKSB7CiAgICBmbG9hdCB0ZXhhID0gdGV4dHVyZTJEKHRleDAsIHV2KS5hOwogICAgcmV0dXJuIHNtb290aHN0ZXAoMC41IC0gd2lkdGgsIDAuNSArIHdpZHRoLCB0ZXhhKTsKfQoKdm9pZCBtYWluKCkgewoKLy9iYXNpYyBzZGYKCiAgICBmbG9hdCBkaXN0ID0gdGV4dHVyZTJEKHRleDAsIHRjb29yZCkuYTsKICAgICAgICAvL2Z3aWR0aCBrZWVwcyB3aWR0aCBzaW1pbGFyIGRlc3BpdGUgc2NhbGluZywgc2VlIGJlbG93IGZvciBvcHRpb25zCiAgICBmbG9hdCBzbW9vdGhhbXQgPSBzbW9vdGhuZXNzICogZndpZHRoKGRpc3QpOwogICAgLy8gZmxvYXQgc21vb3RoYW10ID0gc21vb3RobmVzcyAqIGxlbmd0aCh2ZWMyKGRGZHgoZGlzdCksIGRGZHkoZGlzdCkpKTsKCiAgICAgICAgLy9jYWxjdWxhdGUgdGhlIGVkZ2Ugc21vb3RoaW5nCiAgICBmbG9hdCBhbHBoYSA9IGVkZ2UoMS4wIC0gdGhpY2tuZXNzLCBzbW9vdGhhbXQsIGRpc3QpOwoKLy9zdXBlciBzYW1wbGluZwoKICAgICAgICAjaWYgU1VQRVJTQU1QTEUgPT0gMQoKICAgICAgICAgICAgICAgIC8vdGhlc2UgdmFsdWVzIGNhbiBiZSBleHBvc2VkIGxhdGVyCiAgICAgICAgICAgICAgICAvL3RoZSBjdXJyZW50IGJlaW5nIDAuMjUvc3FydCgyKQogICAgICAgICAgICBmbG9hdCBmYWN0b3IgPSAwLjE3Njc3NjY5NTM7CiAgICAgICAgICAgIGZsb2F0IHNhbXBsZWFtdCA9IDAuNTsKICAgICAgICAgICAgICAgIC8vdGhpcyBpcyBhIHNpbXBsZSBib3ggZmlsdGVyIGFyb3VuZCB0aGUgcG9pbnQsCiAgICAgICAgICAgICAgICAvL3dlIHVzZSBhIHNlcGFyYXRlIHdpZHRoIGZvciBub3cKICAgICAgICAgICAgZmxvYXQgc2FtcGxldyA9IHNhbXBsZWFtdCAqIGZ3aWR0aChkaXN0KTsKICAgICAgICAgICAgdmVjMiBzYW1wbGVvZmZzZXQgPSBmYWN0b3IgKiAoZEZkeCh0Y29vcmQpICsgZEZkeSh0Y29vcmQpKTsKICAgICAgICAgICAgdmVjNCBmbHRyID0gdmVjNCh0Y29vcmQgLSBzYW1wbGVvZmZzZXQsIHRjb29yZCArIHNhbXBsZW9mZnNldCk7CgogICAgICAgICAgICBmbG9hdCB0b3RhbCA9IGdldCggZmx0ci54eSwgc2FtcGxldyApICsgZ2V0KCBmbHRyLnp3LCBzYW1wbGV3ICkgKwogICAgICAgICAgICAgICAgICAgICAgICAgIGdldCggZmx0ci54dywgc2FtcGxldyApICsgZ2V0KCBmbHRyLnp5LCBzYW1wbGV3ICk7CgogICAgICAgICAgICBhbHBoYSA9IChhbHBoYSArIDAuNSAqIHRvdGFsKSAvIDMuMDsKCiAgICAgICAgI2VuZGlmIC8vU1VQRVJTQU1QTEUKCiAgICAgICAgLy90aGUgYmFzZSBjb2xvciArIHNjYWxlZCBieSB0aGUgbmV3IGFscGhhCiAgICB2ZWM0IGZpbmFsQ29sb3IgPSB2ZWM0KGNvbG9yLnJnYiwgY29sb3IuYSAqIGFscGhhKTsKCi8vb3V0bGluZQoKICAgICNpZiBPVVRMSU5FID09IDEKCiAgICAgICAgICAgIC8vd2lwCiAgICAgICAgaWYob3V0bGluZSA+IDAuMCkgewoKICAgICAgICAgICAgLy9yYW5nZSBvZiAxLjAgfiAwLjEsIHdlIGdldCAwIH4gMQogICAgICAgICAgICBmbG9hdCBfb3V0bGluZSA9IDAuOSAtIChvdXRsaW5lICogMC45KTsKICAgICAgICAgICAgZmxvYXQgX291dGxpbmVfYSA9IGVkZ2UoX291dGxpbmUsIHNtb290aGFtdCwgZGlzdCk7CiAgICAgICAgICAgIHZlYzQgX291dGxpbmVfYyA9IHZlYzQob3V0bGluZV9jb2xvci5yZ2IsIG91dGxpbmVfY29sb3IuYSAqIF9vdXRsaW5lX2EpOwoKICAgICAgICAgICAgZmluYWxDb2xvciA9IG1peChfb3V0bGluZV9jLCBmaW5hbENvbG9yLCBhbHBoYSk7CgogICAgICAgIH0gLy9vdXRsaW5lID4gMC4wCgogICAgI2VuZGlmIC8vT1VUTElORQoKLy8gZ2xvdwoKICAgICNpZiBHTE9XID09IDEKCiAgICAgICAgICAgIC8vd2lwCiAgICAgICAgaWYoZ2xvd19hbW91bnQgPiAwLjApIHsKCiAgICAgICAgICAgIC8vOnRvZG86IGV4cG9zZSBvZmZzZXQgZm9yIGRpcmVjdGlvbmFsIHNoYWRvdwogICAgICAgICAgICAvLyB2ZWMyIF9nbG93X29mZnMgPSB2ZWMyKDAsMCk7CiAgICAgICAgICAgIC8vIGZsb2F0IF9nbG93X2Rpc3QgPSB0ZXh0dXJlMkQodGV4MCwgdGNvb3JkIC0gX2dsb3dfb2Zmc2V0KS5hOwoKICAgICAgICAgICAgZmxvYXQgX2dsb3dfYW10ID0gMS4wIC0gZ2xvd19hbW91bnQ7CiAgICAgICAgICAgIGZsb2F0IF9nbG93X2xpbWl0ID0gKF9nbG93X2FtdCAqIGdsb3dfdGhyZXNob2xkKTsKICAgICAgICAgICAgZmxvYXQgX2dsb3dfYSA9IGVkZ2UoX2dsb3dfYW10LCBfZ2xvd19saW1pdCwgZGlzdCk7CiAgICAgICAgICAgIHZlYzQgIF9nbG93X2MgPSB2ZWM0KGdsb3dfY29sb3IucmdiLCBnbG93X2NvbG9yLmEgKiBfZ2xvd19hKTsKCiAgICAgICAgICAgIGZpbmFsQ29sb3IgPSBtaXgoX2dsb3dfYywgZmluYWxDb2xvciwgZmluYWxDb2xvci5hKTsKCiAgICAgICAgfSAvL2dsb3dfYW1vdW50ID4gMAoKICAgICNlbmRpZiAvL0dMT1cKCi8vZG9uZQoKICAgIGdsX0ZyYWdDb2xvciA9IGZpbmFsQ29sb3I7CgoKfSAvL21haW4K"}];var Xr={},Wr=e.ArrayBuffer||Ce;null==Wr.prototype.slice&&(Wr.prototype.slice=Ce.sliceImpl);var Yr=(e.DataView||Re,e.Uint8Array||Be._new);c.activated=!1,c.isReady=!1,c.isLocked=!1,c.isEnding=!1,c.hasEnded=!1,m.version="dev",m.build="+4b80329f1c",w.FLOAT_MAX=16777216,w.kVeryLargeNumber=16777216,w.kVeryFarAway=new y(w.kVeryLargeNumber,w.kVeryLargeNumber),k.view_y=0,k.view_x=0,k.card_scale=1,k.menu_w=540,k.world_w=640,k.world_h=960,k.touch_dir_x=0,k.touch_dir_y=0,S.activated=!1,S.from_menu=!1,A.use_zip=!0,P.desireToSave=!1,P.validNope=-1,P.lastHighestMerge=-1,P.didNope=!1,P.tutorialGame=!0,P.completedTutorial=!1,P.disableGold=!1,P.refreshPreview=!1,P.disableCenter=!1,P.fleeBoard=!1,P.lastMoveDir=new y(0,-1),P.vec_forward=new y(0,0,1),P.vec_right=new y(1,0,0),P.vec_up=new y(0,1,0),P.kSlotWidth=120,P.kSlotHeight=160,P.kMaxGridSize=4,P.kMaxGridLength=P.kMaxGridSize*P.kMaxGridSize,P.kMaxTiles=P.kMaxGridLength+4,P.kMaxSupportedTiles=12,P.shortBoard=!1,P.numMoves=0,P.doSpawn=!1,P.noGold=!1,P.canMove=!1,P.numRecords=0,P.scoreRecord=!1,P.rankRecord=!1,P.spawnAmount=1,P.gridSize=0,P.gridLength=0,P.kCycleGames=!1,P.highColor=(new F).rgb(15820416),P.lowColor=(new F).rgb(16764006),P.previewP=0,P.any_key=!1,O.kNonCoord=new y(-1,-1),O.valid=[1,2,3,6,12,24,48,96,192,384,768,1536,3072,6144,12288],U.isActive=!1,U.allowNoSpawn=!1,ee.USE_CACHE=!1,ee.USE_ENUM_INDEX=!1,ee.BASE64="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789%:",se.DEFAULT_RESOLVER=V,se.BASE64="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789%:",le.CHARS="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",le.BYTES=oe.ofString(le.CHARS),ue.count=0,ye.i64tmp=function(){var t,e=new J(0,0);return t=e}(this),Te.LEN_EXTRA_BITS_TBL=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,-1,-1],Te.LEN_BASE_VAL_TBL=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258],Te.DIST_EXTRA_BITS_TBL=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,-1,-1],Te.DIST_BASE_VAL_TBL=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577],Te.CODE_LENGTHS_POS=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],Ee.__toStr={}.toString,Be.BYTES_PER_ELEMENT=1,Ue.update="update dt",Ue.renderdt="render dt",Ue.game_update="game.update",Ue.render="core.render",Ue.debug="core.debug",Ue.updates="core.updates",Ue.events="core.events",Ue.audio="core.audio",Ue.input="core.input",Ue.timer="core.timer",Ue.scene="core.scene",Ue.debug_batch="batcher.debug_batcher",He.shut_down=!1,ti._level=1,ti._log_width=16,ai.tag_physics="physics",ki.color_red=(new F).rgb(13369344),ki.color_green=(new F).rgb(2263108),ki.color_normal=(new F).rgb(15790320),Fi._save=!1,Hi.red=!0,Hi.black=!1,Ji.actuators=[],Ji.actuatorsLength=0,Ji.addedEvent=!1,Ji.update_timer=0,Ji.current_time=0,is.defaultActuator=Ji,is.defaultEase=$i.get_easeOut(),is.targetLibraries=new ue,Ms.two_pi=6.283185307179586,Cs._PI_OVER_180=.017453292519943278,Cs._180_OVER_PI=57.29577951308238,Ls.minCodePoint=0,Ls.maxCodePoint=1114111,Ls.minHighSurrogate=55296,Ls.maxHighSurrogate=56319,Ls.minLowSurrogate=56320,Ls.maxLowSurrogate=57343,Zs._sequence_key=-1,Zs.vert_attribute=0,Zs.tcoord_attribute=1,Zs.color_attribute=2,Zs.normal_attribute=3,Ks.unknown=-1,Ks.line_strip=3,Ks.line_loop=2,Ks.lines=1,Ks.triangle_strip=5,Ks.triangles=4,Ks.triangle_fan=6,Ks.points=0,hn.default_filter=9729,hn.default_clamp=33071,yn._sequence_key=-1,Mn.tab_regex=new _("	","gim"),Dn._level=1,Dn._log_width=16,Hn.calls=[],Hn.defers=[],qn.running_timers=[],jn.BYTES_PER_ELEMENT=4,Zn.BYTES_PER_ELEMENT=4,Kn.BYTES_PER_ELEMENT=1,Wn.POT=!0,Yn.dom_shift=16,Yn.dom_ctrl=17,Yn.dom_alt=18,Yn.dom_capslock=20,Yn.dom_pageup=33,Yn.dom_pagedown=34,Yn.dom_end=35,Yn.dom_home=36,Yn.dom_left=37,Yn.dom_up=38,Yn.dom_right=39,Yn.dom_down=40,Yn.dom_printscr=44,Yn.dom_insert=45,Yn.dom_delete=46,Yn.dom_lmeta=91,Yn.dom_rmeta=93,Yn.dom_kp_0=96,Yn.dom_kp_1=97,Yn.dom_kp_2=98,Yn.dom_kp_3=99,Yn.dom_kp_4=100,Yn.dom_kp_5=101,Yn.dom_kp_6=102,Yn.dom_kp_7=103,Yn.dom_kp_8=104,Yn.dom_kp_9=105,Yn.dom_kp_multiply=106,Yn.dom_kp_plus=107,Yn.dom_kp_minus=109,Yn.dom_kp_decimal=110,Yn.dom_kp_divide=111,Yn.dom_kp_numlock=144,Yn.dom_f1=112,Yn.dom_f2=113,Yn.dom_f3=114,Yn.dom_f4=115,Yn.dom_f5=116,Yn.dom_f6=117,Yn.dom_f7=118,Yn.dom_f8=119,Yn.dom_f9=120,Yn.dom_f10=121,Yn.dom_f11=122,Yn.dom_f12=123,Yn.dom_f13=124,Yn.dom_f14=125,Yn.dom_f15=126,Yn.dom_f16=127,Yn.dom_f17=128,Yn.dom_f18=129,Yn.dom_f19=130,Yn.dom_f20=131,Yn.dom_f21=132,Yn.dom_f22=133,Yn.dom_f23=134,Yn.dom_f24=135,Yn.dom_caret=160,Yn.dom_exclaim=161,Yn.dom_quotedbl=162,Yn.dom_hash=163,Yn.dom_dollar=164,Yn.dom_percent=165,Yn.dom_ampersand=166,Yn.dom_underscore=167,Yn.dom_leftparen=168,Yn.dom_rightparen=169,Yn.dom_asterisk=170,Yn.dom_plus=171,Yn.dom_pipe=172,Yn.dom_minus=173,Yn.dom_leftbrace=174,Yn.dom_rightbrace=175,Yn.dom_tilde=176,Yn.dom_audiomute=181,Yn.dom_volumedown=182,Yn.dom_volumeup=183,Yn.dom_comma=188,Yn.dom_period=190,Yn.dom_slash=191,Yn.dom_backquote=192,Yn.dom_leftbracket=219,Yn.dom_rightbracket=221,Yn.dom_backslash=220,Yn.dom_quote=222,Yn.dom_meta=224,$n.MASK=1073741824,$n.unknown=0,$n.key_a=4,$n.key_b=5,$n.key_c=6,$n.key_d=7,$n.key_e=8,$n.key_f=9,$n.key_g=10,$n.key_h=11,$n.key_i=12,$n.key_j=13,$n.key_k=14,$n.key_l=15,$n.key_m=16,$n.key_n=17,$n.key_o=18,$n.key_p=19,$n.key_q=20,$n.key_r=21,$n.key_s=22,$n.key_t=23,$n.key_u=24,$n.key_v=25,$n.key_w=26,$n.key_x=27,$n.key_y=28,$n.key_z=29,$n.key_1=30,$n.key_2=31,$n.key_3=32,$n.key_4=33,$n.key_5=34,$n.key_6=35,$n.key_7=36,$n.key_8=37,$n.key_9=38,$n.key_0=39,$n.enter=40,$n.escape=41,$n.backspace=42,$n.tab=43,$n.space=44,$n.minus=45,$n.equals=46,$n.leftbracket=47,$n.rightbracket=48,$n.backslash=49,$n.nonushash=50,$n.semicolon=51,$n.apostrophe=52,$n.grave=53,$n.comma=54,$n.period=55,$n.slash=56,$n.capslock=57,$n.f1=58,$n.f2=59,$n.f3=60,$n.f4=61,$n.f5=62,$n.f6=63,$n.f7=64,$n.f8=65,$n.f9=66,$n.f10=67,$n.f11=68,$n.f12=69,$n.printscreen=70,$n.scrolllock=71,$n.pause=72,$n.insert=73,$n.home=74,$n.pageup=75,$n["delete"]=76,$n.end=77,$n.pagedown=78,$n.right=79,$n.left=80,$n.down=81,$n.up=82,$n.numlockclear=83,$n.kp_divide=84,$n.kp_multiply=85,$n.kp_minus=86,$n.kp_plus=87,$n.kp_enter=88,$n.kp_1=89,$n.kp_2=90,$n.kp_3=91,$n.kp_4=92,$n.kp_5=93,$n.kp_6=94,$n.kp_7=95,$n.kp_8=96,$n.kp_9=97,$n.kp_0=98,$n.kp_period=99,$n.nonusbackslash=100,$n.application=101,$n.power=102,$n.kp_equals=103,$n.f13=104,$n.f14=105,$n.f15=106,$n.f16=107,$n.f17=108,$n.f18=109,$n.f19=110,$n.f20=111,$n.f21=112,$n.f22=113,$n.f23=114,$n.f24=115,$n.execute=116,$n.help=117,$n.menu=118,$n.select=119,$n.stop=120,$n.again=121,$n.undo=122,$n.cut=123,$n.copy=124,$n.paste=125,$n.find=126,$n.mute=127,$n.volumeup=128,$n.volumedown=129,$n.kp_comma=133,$n.kp_equalsas400=134,$n.international1=135,$n.international2=136,$n.international3=137,$n.international4=138,$n.international5=139,$n.international6=140,$n.international7=141,$n.international8=142,$n.international9=143,$n.lang1=144,$n.lang2=145,$n.lang3=146,$n.lang4=147,$n.lang5=148,$n.lang6=149,$n.lang7=150,$n.lang8=151,$n.lang9=152,$n.alterase=153,$n.sysreq=154,$n.cancel=155,$n.clear=156,$n.prior=157,$n.return2=158,$n.separator=159,$n.out=160,$n.oper=161,$n.clearagain=162,$n.crsel=163,$n.exsel=164,$n.kp_00=176,$n.kp_000=177,$n.thousandsseparator=178,$n.decimalseparator=179,$n.currencyunit=180,$n.currencysubunit=181,$n.kp_leftparen=182,$n.kp_rightparen=183,$n.kp_leftbrace=184,$n.kp_rightbrace=185,$n.kp_tab=186,$n.kp_backspace=187,$n.kp_a=188,$n.kp_b=189,$n.kp_c=190,$n.kp_d=191,$n.kp_e=192,$n.kp_f=193,$n.kp_xor=194,$n.kp_power=195,$n.kp_percent=196,$n.kp_less=197,$n.kp_greater=198,$n.kp_ampersand=199,$n.kp_dblampersand=200,$n.kp_verticalbar=201,$n.kp_dblverticalbar=202,$n.kp_colon=203,$n.kp_hash=204,$n.kp_space=205,$n.kp_at=206,$n.kp_exclam=207,$n.kp_memstore=208,$n.kp_memrecall=209,$n.kp_memclear=210,$n.kp_memadd=211,$n.kp_memsubtract=212,$n.kp_memmultiply=213,$n.kp_memdivide=214,$n.kp_plusminus=215,$n.kp_clear=216,$n.kp_clearentry=217,$n.kp_binary=218,$n.kp_octal=219,$n.kp_decimal=220,$n.kp_hexadecimal=221,$n.lctrl=224,$n.lshift=225,$n.lalt=226,$n.lmeta=227,$n.rctrl=228,$n.rshift=229,$n.ralt=230,$n.rmeta=231,$n.mode=257,$n.audionext=258,$n.audioprev=259,$n.audiostop=260,$n.audioplay=261,$n.audiomute=262,$n.mediaselect=263,$n.www=264,$n.mail=265,$n.calculator=266,$n.computer=267,$n.ac_search=268,$n.ac_home=269,$n.ac_back=270,$n.ac_forward=271,$n.ac_stop=272,$n.ac_refresh=273,$n.ac_bookmarks=274,$n.brightnessdown=275,$n.brightnessup=276,$n.displayswitch=277,$n.kbdillumtoggle=278,$n.kbdillumdown=279,$n.kbdillumup=280,$n.eject=281,$n.sleep=282,$n.app1=283,$n.app2=284,$n.scancode_names=[null,null,null,null,"A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","1","2","3","4","5","6","7","8","9","0","Enter","Escape","Backspace","Tab","Space","-","=","[","]","\\","#",";","'","`",",",".","/","CapsLock","F1","F2","F3","F4","F5","F6","F7","F8","F9","F10","F11","F12","PrintScreen","ScrollLock","Pause","Insert","Home","PageUp","Delete","End","PageDown","Right","Left","Down","Up","Numlock","Keypad /","Keypad *","Keypad -","Keypad +","Keypad Enter","Keypad 1","Keypad 2","Keypad 3","Keypad 4","Keypad 5","Keypad 6","Keypad 7","Keypad 8","Keypad 9","Keypad 0","Keypad .",null,"Application","Power","Keypad =","F13","F14","F15","F16","F17","F18","F19","F20","F21","F22","F23","F24","Execute","Help","Menu","Select","Stop","Again","Undo","Cut","Copy","Paste","Find","Mute","VolumeUp","VolumeDown",null,null,null,"Keypad ,","Keypad = (AS400)",null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,"AltErase","SysReq","Cancel","Clear","Prior","Enter","Separator","Out","Oper","Clear / Again","CrSel","ExSel",null,null,null,null,null,null,null,null,null,null,null,"Keypad 00","Keypad 000","ThousandsSeparator","DecimalSeparator","CurrencyUnit","CurrencySubUnit","Keypad (","Keypad )","Keypad {","Keypad }","Keypad Tab","Keypad Backspace","Keypad A","Keypad B","Keypad C","Keypad D","Keypad E","Keypad F","Keypad XOR","Keypad ^","Keypad %","Keypad <","Keypad >","Keypad &","Keypad &&","Keypad |","Keypad ||","Keypad :","Keypad #","Keypad Space","Keypad @","Keypad !","Keypad MemStore","Keypad MemRecall","Keypad MemClear","Keypad MemAdd","Keypad MemSubtract","Keypad MemMultiply","Keypad MemDivide","Keypad +/-","Keypad Clear","Keypad ClearEntry","Keypad Binary","Keypad Octal","Keypad Decimal","Keypad Hexadecimal",null,null,"Left Ctrl","Left Shift","Left Alt","Left Meta","Right Ctrl","Right Shift","Right Alt","Right Meta",null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,"ModeSwitch","AudioNext","AudioPrev","AudioStop","AudioPlay","AudioMute","MediaSelect","WWW","Mail","Calculator","Computer","AC Search","AC Home","AC Back","AC Forward","AC Stop","AC Refresh","AC Bookmarks","BrightnessDown","BrightnessUp","DisplaySwitch","KBDIllumToggle","KBDIllumDown","KBDIllumUp","Eject","Sleep"],tr.unknown=0,tr.enter=13,tr.escape=27,tr.backspace=8,tr.tab=9,tr.space=32,tr.exclaim=33,tr.quotedbl=34,tr.hash=35,tr.percent=37,tr.dollar=36,tr.ampersand=38,tr.quote=39,tr.leftparen=40,tr.rightparen=41,tr.asterisk=42,tr.plus=43,tr.comma=44,tr.minus=45,tr.period=46,tr.slash=47,tr.key_0=48,tr.key_1=49,tr.key_2=50,tr.key_3=51,tr.key_4=52,tr.key_5=53,tr.key_6=54,tr.key_7=55,tr.key_8=56,tr.key_9=57,tr.colon=58,tr.semicolon=59,tr.less=60,tr.equals=61,tr.greater=62,tr.question=63,tr.at=64,tr.leftbracket=91,tr.backslash=92,tr.rightbracket=93,tr.caret=94,tr.underscore=95,tr.backquote=96,tr.key_a=97,tr.key_b=98,tr.key_c=99,tr.key_d=100,tr.key_e=101,tr.key_f=102,tr.key_g=103,tr.key_h=104,tr.key_i=105,tr.key_j=106,tr.key_k=107,tr.key_l=108,tr.key_m=109,tr.key_n=110,tr.key_o=111,tr.key_p=112,tr.key_q=113,tr.key_r=114,tr.key_s=115,tr.key_t=116,tr.key_u=117,tr.key_v=118,tr.key_w=119,tr.key_x=120,tr.key_y=121,tr.key_z=122,tr.capslock=tr.from_scan($n.capslock),tr.f1=tr.from_scan($n.f1),tr.f2=tr.from_scan($n.f2),tr.f3=tr.from_scan($n.f3),tr.f4=tr.from_scan($n.f4),tr.f5=tr.from_scan($n.f5),tr.f6=tr.from_scan($n.f6),tr.f7=tr.from_scan($n.f7),tr.f8=tr.from_scan($n.f8),tr.f9=tr.from_scan($n.f9),tr.f10=tr.from_scan($n.f10),tr.f11=tr.from_scan($n.f11),tr.f12=tr.from_scan($n.f12),tr.printscreen=tr.from_scan($n.printscreen),tr.scrolllock=tr.from_scan($n.scrolllock),tr.pause=tr.from_scan($n.pause),tr.insert=tr.from_scan($n.insert),tr.home=tr.from_scan($n.home),tr.pageup=tr.from_scan($n.pageup),tr["delete"]=127,tr.end=tr.from_scan($n.end),tr.pagedown=tr.from_scan($n.pagedown),tr.right=tr.from_scan($n.right),tr.left=tr.from_scan($n.left),tr.down=tr.from_scan($n.down),tr.up=tr.from_scan($n.up),tr.numlockclear=tr.from_scan($n.numlockclear),tr.kp_divide=tr.from_scan($n.kp_divide),tr.kp_multiply=tr.from_scan($n.kp_multiply),tr.kp_minus=tr.from_scan($n.kp_minus),tr.kp_plus=tr.from_scan($n.kp_plus),tr.kp_enter=tr.from_scan($n.kp_enter),tr.kp_1=tr.from_scan($n.kp_1),tr.kp_2=tr.from_scan($n.kp_2),tr.kp_3=tr.from_scan($n.kp_3),tr.kp_4=tr.from_scan($n.kp_4),tr.kp_5=tr.from_scan($n.kp_5),tr.kp_6=tr.from_scan($n.kp_6),tr.kp_7=tr.from_scan($n.kp_7),tr.kp_8=tr.from_scan($n.kp_8),tr.kp_9=tr.from_scan($n.kp_9),tr.kp_0=tr.from_scan($n.kp_0),tr.kp_period=tr.from_scan($n.kp_period),tr.application=tr.from_scan($n.application),tr.power=tr.from_scan($n.power),tr.kp_equals=tr.from_scan($n.kp_equals),tr.f13=tr.from_scan($n.f13),tr.f14=tr.from_scan($n.f14),tr.f15=tr.from_scan($n.f15),tr.f16=tr.from_scan($n.f16),tr.f17=tr.from_scan($n.f17),tr.f18=tr.from_scan($n.f18),tr.f19=tr.from_scan($n.f19),tr.f20=tr.from_scan($n.f20),tr.f21=tr.from_scan($n.f21),tr.f22=tr.from_scan($n.f22),tr.f23=tr.from_scan($n.f23),tr.f24=tr.from_scan($n.f24),tr.execute=tr.from_scan($n.execute),tr.help=tr.from_scan($n.help),tr.menu=tr.from_scan($n.menu),tr.select=tr.from_scan($n.select),tr.stop=tr.from_scan($n.stop),tr.again=tr.from_scan($n.again),tr.undo=tr.from_scan($n.undo),tr.cut=tr.from_scan($n.cut),tr.copy=tr.from_scan($n.copy),tr.paste=tr.from_scan($n.paste),tr.find=tr.from_scan($n.find),tr.mute=tr.from_scan($n.mute),tr.volumeup=tr.from_scan($n.volumeup),tr.volumedown=tr.from_scan($n.volumedown),tr.kp_comma=tr.from_scan($n.kp_comma),tr.kp_equalsas400=tr.from_scan($n.kp_equalsas400),tr.alterase=tr.from_scan($n.alterase),tr.sysreq=tr.from_scan($n.sysreq),tr.cancel=tr.from_scan($n.cancel),tr.clear=tr.from_scan($n.clear),tr.prior=tr.from_scan($n.prior),tr.return2=tr.from_scan($n.return2),tr.separator=tr.from_scan($n.separator),tr.out=tr.from_scan($n.out),tr.oper=tr.from_scan($n.oper),tr.clearagain=tr.from_scan($n.clearagain),tr.crsel=tr.from_scan($n.crsel),tr.exsel=tr.from_scan($n.exsel),tr.kp_00=tr.from_scan($n.kp_00),tr.kp_000=tr.from_scan($n.kp_000),tr.thousandsseparator=tr.from_scan($n.thousandsseparator),tr.decimalseparator=tr.from_scan($n.decimalseparator),tr.currencyunit=tr.from_scan($n.currencyunit),tr.currencysubunit=tr.from_scan($n.currencysubunit),tr.kp_leftparen=tr.from_scan($n.kp_leftparen),tr.kp_rightparen=tr.from_scan($n.kp_rightparen),tr.kp_leftbrace=tr.from_scan($n.kp_leftbrace),tr.kp_rightbrace=tr.from_scan($n.kp_rightbrace),tr.kp_tab=tr.from_scan($n.kp_tab),tr.kp_backspace=tr.from_scan($n.kp_backspace),tr.kp_a=tr.from_scan($n.kp_a),tr.kp_b=tr.from_scan($n.kp_b),tr.kp_c=tr.from_scan($n.kp_c),tr.kp_d=tr.from_scan($n.kp_d),tr.kp_e=tr.from_scan($n.kp_e),tr.kp_f=tr.from_scan($n.kp_f),tr.kp_xor=tr.from_scan($n.kp_xor),tr.kp_power=tr.from_scan($n.kp_power),tr.kp_percent=tr.from_scan($n.kp_percent),tr.kp_less=tr.from_scan($n.kp_less),tr.kp_greater=tr.from_scan($n.kp_greater),tr.kp_ampersand=tr.from_scan($n.kp_ampersand),tr.kp_dblampersand=tr.from_scan($n.kp_dblampersand),tr.kp_verticalbar=tr.from_scan($n.kp_verticalbar),tr.kp_dblverticalbar=tr.from_scan($n.kp_dblverticalbar),tr.kp_colon=tr.from_scan($n.kp_colon),tr.kp_hash=tr.from_scan($n.kp_hash),tr.kp_space=tr.from_scan($n.kp_space),tr.kp_at=tr.from_scan($n.kp_at),tr.kp_exclam=tr.from_scan($n.kp_exclam),tr.kp_memstore=tr.from_scan($n.kp_memstore),tr.kp_memrecall=tr.from_scan($n.kp_memrecall),tr.kp_memclear=tr.from_scan($n.kp_memclear),tr.kp_memadd=tr.from_scan($n.kp_memadd),tr.kp_memsubtract=tr.from_scan($n.kp_memsubtract),tr.kp_memmultiply=tr.from_scan($n.kp_memmultiply),tr.kp_memdivide=tr.from_scan($n.kp_memdivide),tr.kp_plusminus=tr.from_scan($n.kp_plusminus),tr.kp_clear=tr.from_scan($n.kp_clear),tr.kp_clearentry=tr.from_scan($n.kp_clearentry),tr.kp_binary=tr.from_scan($n.kp_binary),tr.kp_octal=tr.from_scan($n.kp_octal),tr.kp_decimal=tr.from_scan($n.kp_decimal),tr.kp_hexadecimal=tr.from_scan($n.kp_hexadecimal),tr.lctrl=tr.from_scan($n.lctrl),tr.lshift=tr.from_scan($n.lshift),tr.lalt=tr.from_scan($n.lalt),tr.lmeta=tr.from_scan($n.lmeta),tr.rctrl=tr.from_scan($n.rctrl),tr.rshift=tr.from_scan($n.rshift),tr.ralt=tr.from_scan($n.ralt),tr.rmeta=tr.from_scan($n.rmeta),tr.mode=tr.from_scan($n.mode),tr.audionext=tr.from_scan($n.audionext),tr.audioprev=tr.from_scan($n.audioprev),tr.audiostop=tr.from_scan($n.audiostop),tr.audioplay=tr.from_scan($n.audioplay),tr.audiomute=tr.from_scan($n.audiomute),tr.mediaselect=tr.from_scan($n.mediaselect),tr.www=tr.from_scan($n.www),tr.mail=tr.from_scan($n.mail),tr.calculator=tr.from_scan($n.calculator),tr.computer=tr.from_scan($n.computer),tr.ac_search=tr.from_scan($n.ac_search),tr.ac_home=tr.from_scan($n.ac_home),tr.ac_back=tr.from_scan($n.ac_back),tr.ac_forward=tr.from_scan($n.ac_forward),tr.ac_stop=tr.from_scan($n.ac_stop),tr.ac_refresh=tr.from_scan($n.ac_refresh),tr.ac_bookmarks=tr.from_scan($n.ac_bookmarks),tr.brightnessdown=tr.from_scan($n.brightnessdown),tr.brightnessup=tr.from_scan($n.brightnessup),tr.displayswitch=tr.from_scan($n.displayswitch),tr.kbdillumtoggle=tr.from_scan($n.kbdillumtoggle),tr.kbdillumdown=tr.from_scan($n.kbdillumdown),tr.kbdillumup=tr.from_scan($n.kbdillumup),tr.eject=tr.from_scan($n.eject),tr.sleep=tr.from_scan($n.sleep),er._keypress_blacklist=[tr.backspace,tr.enter],_r.DEPTH_BUFFER_BIT=256,_r.STENCIL_BUFFER_BIT=1024,_r.COLOR_BUFFER_BIT=16384,_r.POINTS=0,_r.LINES=1,_r.LINE_LOOP=2,_r.LINE_STRIP=3,_r.TRIANGLES=4,_r.TRIANGLE_STRIP=5,_r.TRIANGLE_FAN=6,_r.ZERO=0,_r.ONE=1,_r.SRC_COLOR=768,_r.ONE_MINUS_SRC_COLOR=769,_r.SRC_ALPHA=770,_r.ONE_MINUS_SRC_ALPHA=771,_r.DST_ALPHA=772,_r.ONE_MINUS_DST_ALPHA=773,_r.DST_COLOR=774,_r.ONE_MINUS_DST_COLOR=775,_r.SRC_ALPHA_SATURATE=776,_r.FUNC_ADD=32774,_r.BLEND_EQUATION=32777,_r.BLEND_EQUATION_RGB=32777,_r.BLEND_EQUATION_ALPHA=34877,_r.FUNC_SUBTRACT=32778,_r.FUNC_REVERSE_SUBTRACT=32779,_r.BLEND_DST_RGB=32968,_r.BLEND_SRC_RGB=32969,_r.BLEND_DST_ALPHA=32970,_r.BLEND_SRC_ALPHA=32971,_r.CONSTANT_COLOR=32769,_r.ONE_MINUS_CONSTANT_COLOR=32770,_r.CONSTANT_ALPHA=32771,_r.ONE_MINUS_CONSTANT_ALPHA=32772,_r.BLEND_COLOR=32773,_r.ARRAY_BUFFER=34962,_r.ELEMENT_ARRAY_BUFFER=34963,_r.ARRAY_BUFFER_BINDING=34964,_r.ELEMENT_ARRAY_BUFFER_BINDING=34965,_r.STREAM_DRAW=35040,_r.STATIC_DRAW=35044,_r.DYNAMIC_DRAW=35048,_r.BUFFER_SIZE=34660,_r.BUFFER_USAGE=34661,_r.CURRENT_VERTEX_ATTRIB=34342,_r.FRONT=1028,_r.BACK=1029,_r.FRONT_AND_BACK=1032,_r.CULL_FACE=2884,_r.BLEND=3042,_r.DITHER=3024,_r.STENCIL_TEST=2960,_r.DEPTH_TEST=2929,_r.SCISSOR_TEST=3089,_r.POLYGON_OFFSET_FILL=32823,_r.SAMPLE_ALPHA_TO_COVERAGE=32926,_r.SAMPLE_COVERAGE=32928,_r.NO_ERROR=0,_r.INVALID_ENUM=1280,_r.INVALID_VALUE=1281,_r.INVALID_OPERATION=1282,_r.OUT_OF_MEMORY=1285,_r.CW=2304,_r.CCW=2305,_r.LINE_WIDTH=2849,_r.ALIASED_POINT_SIZE_RANGE=33901,_r.ALIASED_LINE_WIDTH_RANGE=33902,_r.CULL_FACE_MODE=2885,_r.FRONT_FACE=2886,_r.DEPTH_RANGE=2928,_r.DEPTH_WRITEMASK=2930,_r.DEPTH_CLEAR_VALUE=2931,_r.DEPTH_FUNC=2932,_r.STENCIL_CLEAR_VALUE=2961,_r.STENCIL_FUNC=2962,_r.STENCIL_FAIL=2964,_r.STENCIL_PASS_DEPTH_FAIL=2965,_r.STENCIL_PASS_DEPTH_PASS=2966,_r.STENCIL_REF=2967,_r.STENCIL_VALUE_MASK=2963,_r.STENCIL_WRITEMASK=2968,_r.STENCIL_BACK_FUNC=34816,_r.STENCIL_BACK_FAIL=34817,_r.STENCIL_BACK_PASS_DEPTH_FAIL=34818,_r.STENCIL_BACK_PASS_DEPTH_PASS=34819,_r.STENCIL_BACK_REF=36003,_r.STENCIL_BACK_VALUE_MASK=36004,_r.STENCIL_BACK_WRITEMASK=36005,_r.VIEWPORT=2978,_r.SCISSOR_BOX=3088,_r.COLOR_CLEAR_VALUE=3106,_r.COLOR_WRITEMASK=3107,_r.UNPACK_ALIGNMENT=3317,_r.PACK_ALIGNMENT=3333,_r.MAX_TEXTURE_SIZE=3379,_r.MAX_VIEWPORT_DIMS=3386,_r.SUBPIXEL_BITS=3408,_r.RED_BITS=3410,_r.GREEN_BITS=3411,_r.BLUE_BITS=3412,_r.ALPHA_BITS=3413,_r.DEPTH_BITS=3414,_r.STENCIL_BITS=3415,_r.POLYGON_OFFSET_UNITS=10752,_r.POLYGON_OFFSET_FACTOR=32824,_r.TEXTURE_BINDING_2D=32873,_r.SAMPLE_BUFFERS=32936,_r.SAMPLES=32937,_r.SAMPLE_COVERAGE_VALUE=32938,_r.SAMPLE_COVERAGE_INVERT=32939,_r.COMPRESSED_TEXTURE_FORMATS=34467,_r.DONT_CARE=4352,_r.FASTEST=4353,_r.NICEST=4354,_r.GENERATE_MIPMAP_HINT=33170,_r.BYTE=5120,_r.UNSIGNED_BYTE=5121,_r.SHORT=5122,_r.UNSIGNED_SHORT=5123,_r.INT=5124,_r.UNSIGNED_INT=5125,_r.FLOAT=5126,_r.DEPTH_COMPONENT=6402,_r.ALPHA=6406,_r.RGB=6407,_r.RGBA=6408,_r.LUMINANCE=6409,_r.LUMINANCE_ALPHA=6410,_r.UNSIGNED_SHORT_4_4_4_4=32819,_r.UNSIGNED_SHORT_5_5_5_1=32820,_r.UNSIGNED_SHORT_5_6_5=33635,_r.FRAGMENT_SHADER=35632,_r.VERTEX_SHADER=35633,_r.MAX_VERTEX_ATTRIBS=34921,_r.MAX_VERTEX_UNIFORM_VECTORS=36347,_r.MAX_VARYING_VECTORS=36348,_r.MAX_COMBINED_TEXTURE_IMAGE_UNITS=35661,_r.MAX_VERTEX_TEXTURE_IMAGE_UNITS=35660,_r.MAX_TEXTURE_IMAGE_UNITS=34930,_r.MAX_FRAGMENT_UNIFORM_VECTORS=36349,_r.SHADER_TYPE=35663,_r.DELETE_STATUS=35712,_r.LINK_STATUS=35714,_r.VALIDATE_STATUS=35715,_r.ATTACHED_SHADERS=35717,_r.ACTIVE_UNIFORMS=35718,_r.ACTIVE_ATTRIBUTES=35721,_r.SHADING_LANGUAGE_VERSION=35724,_r.CURRENT_PROGRAM=35725,_r.NEVER=512,_r.LESS=513,_r.EQUAL=514,_r.LEQUAL=515,_r.GREATER=516,_r.NOTEQUAL=517,_r.GEQUAL=518,_r.ALWAYS=519,_r.KEEP=7680,_r.REPLACE=7681,_r.INCR=7682,_r.DECR=7683,_r.INVERT=5386,_r.INCR_WRAP=34055,_r.DECR_WRAP=34056,_r.VENDOR=7936,_r.RENDERER=7937,_r.VERSION=7938,_r.NEAREST=9728,_r.LINEAR=9729,_r.NEAREST_MIPMAP_NEAREST=9984,_r.LINEAR_MIPMAP_NEAREST=9985,_r.NEAREST_MIPMAP_LINEAR=9986,_r.LINEAR_MIPMAP_LINEAR=9987,_r.TEXTURE_MAG_FILTER=10240,_r.TEXTURE_MIN_FILTER=10241,_r.TEXTURE_WRAP_S=10242,_r.TEXTURE_WRAP_T=10243,_r.TEXTURE_2D=3553,_r.TEXTURE=5890,_r.TEXTURE_CUBE_MAP=34067,_r.TEXTURE_BINDING_CUBE_MAP=34068,_r.TEXTURE_CUBE_MAP_POSITIVE_X=34069,_r.TEXTURE_CUBE_MAP_NEGATIVE_X=34070,_r.TEXTURE_CUBE_MAP_POSITIVE_Y=34071,_r.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072,_r.TEXTURE_CUBE_MAP_POSITIVE_Z=34073,_r.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074,_r.MAX_CUBE_MAP_TEXTURE_SIZE=34076,_r.TEXTURE0=33984,_r.TEXTURE1=33985,_r.TEXTURE2=33986,_r.TEXTURE3=33987,_r.TEXTURE4=33988,_r.TEXTURE5=33989,_r.TEXTURE6=33990,_r.TEXTURE7=33991,_r.TEXTURE8=33992,_r.TEXTURE9=33993,_r.TEXTURE10=33994,_r.TEXTURE11=33995,_r.TEXTURE12=33996,_r.TEXTURE13=33997,_r.TEXTURE14=33998,_r.TEXTURE15=33999,_r.TEXTURE16=34e3,_r.TEXTURE17=34001,_r.TEXTURE18=34002,_r.TEXTURE19=34003,_r.TEXTURE20=34004,_r.TEXTURE21=34005,_r.TEXTURE22=34006,_r.TEXTURE23=34007,_r.TEXTURE24=34008,_r.TEXTURE25=34009,_r.TEXTURE26=34010,_r.TEXTURE27=34011,_r.TEXTURE28=34012,_r.TEXTURE29=34013,_r.TEXTURE30=34014,_r.TEXTURE31=34015,_r.ACTIVE_TEXTURE=34016,_r.REPEAT=10497,_r.CLAMP_TO_EDGE=33071,_r.MIRRORED_REPEAT=33648,_r.FLOAT_VEC2=35664,_r.FLOAT_VEC3=35665,_r.FLOAT_VEC4=35666,_r.INT_VEC2=35667,_r.INT_VEC3=35668,_r.INT_VEC4=35669,_r.BOOL=35670,_r.BOOL_VEC2=35671,_r.BOOL_VEC3=35672,_r.BOOL_VEC4=35673,_r.FLOAT_MAT2=35674,_r.FLOAT_MAT3=35675,_r.FLOAT_MAT4=35676,_r.SAMPLER_2D=35678,_r.SAMPLER_CUBE=35680,_r.VERTEX_ATTRIB_ARRAY_ENABLED=34338,_r.VERTEX_ATTRIB_ARRAY_SIZE=34339,_r.VERTEX_ATTRIB_ARRAY_STRIDE=34340,_r.VERTEX_ATTRIB_ARRAY_TYPE=34341,_r.VERTEX_ATTRIB_ARRAY_NORMALIZED=34922,_r.VERTEX_ATTRIB_ARRAY_POINTER=34373,_r.VERTEX_ATTRIB_ARRAY_BUFFER_BINDING=34975,_r.VERTEX_PROGRAM_POINT_SIZE=34370,_r.POINT_SPRITE=34913,_r.COMPILE_STATUS=35713,_r.LOW_FLOAT=36336,_r.MEDIUM_FLOAT=36337,_r.HIGH_FLOAT=36338,_r.LOW_INT=36339,_r.MEDIUM_INT=36340,_r.HIGH_INT=36341,_r.FRAMEBUFFER=36160,_r.RENDERBUFFER=36161,_r.RGBA4=32854,_r.RGB5_A1=32855,_r.RGB565=36194,_r.DEPTH_COMPONENT16=33189,_r.STENCIL_INDEX=6401,_r.STENCIL_INDEX8=36168,_r.DEPTH_STENCIL=34041,_r.RENDERBUFFER_WIDTH=36162,_r.RENDERBUFFER_HEIGHT=36163,_r.RENDERBUFFER_INTERNAL_FORMAT=36164,_r.RENDERBUFFER_RED_SIZE=36176,_r.RENDERBUFFER_GREEN_SIZE=36177,_r.RENDERBUFFER_BLUE_SIZE=36178,_r.RENDERBUFFER_ALPHA_SIZE=36179,_r.RENDERBUFFER_DEPTH_SIZE=36180,_r.RENDERBUFFER_STENCIL_SIZE=36181,_r.FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE=36048,_r.FRAMEBUFFER_ATTACHMENT_OBJECT_NAME=36049,_r.FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL=36050,_r.FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE=36051,_r.COLOR_ATTACHMENT0=36064,_r.DEPTH_ATTACHMENT=36096,_r.STENCIL_ATTACHMENT=36128,_r.DEPTH_STENCIL_ATTACHMENT=33306,_r.NONE=0,_r.FRAMEBUFFER_COMPLETE=36053,_r.FRAMEBUFFER_INCOMPLETE_ATTACHMENT=36054,_r.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT=36055,_r.FRAMEBUFFER_INCOMPLETE_DIMENSIONS=36057,_r.FRAMEBUFFER_UNSUPPORTED=36061,_r.FRAMEBUFFER_BINDING=36006,_r.RENDERBUFFER_BINDING=36007,_r.MAX_RENDERBUFFER_SIZE=34024,_r.INVALID_FRAMEBUFFER_OPERATION=1286,_r.UNPACK_FLIP_Y_WEBGL=37440,_r.UNPACK_PREMULTIPLY_ALPHA_WEBGL=37441,_r.CONTEXT_LOST_WEBGL=37442,_r.UNPACK_COLORSPACE_CONVERSION_WEBGL=37443,_r.BROWSER_DEFAULT_WEBGL=37444,mr.splitter="  ",kr.unknown=0,kr.bytes=1,kr.text=2,kr.json=3,kr.image=4,kr.audio=5,zr.compatibility=0,zr.core=1,Sr.unknown=0,Sr.edit=1,Sr.input=2,Tr.unknown=0,Tr.device_added=1,Tr.device_removed=2,Tr.device_remapped=3,Ar.unknown=0,Ar.init=1,Ar.ready=2,Ar.update=3,Ar.shutdown=4,Ar.window=5,Ar.input=6,Ar.quit=7,Ar.app_terminating=8,Ar.app_lowmemory=9,Ar.app_willenterbackground=10,Ar.app_didenterbackground=11,Ar.app_willenterforeground=12,Ar.app_didenterforeground=13,Ar.file=14,Ir.unknown=0,Ir.created=1,Ir.shown=2,Ir.hidden=3,Ir.exposed=4,Ir.moved=5,Ir.resized=6,Ir.size_changed=7,Ir.minimized=8,Ir.maximized=9,Ir.restored=10,Ir.enter=11,Ir.leave=12,Ir.focus_gained=13,Ir.focus_lost=14,Ir.close=15,Ir.destroy=16,Er.unknown=0,Er.key=1,Er.mouse=2,Er.touch=3,Er.joystick=4,Er.controller=5,Mr.unknown=0,Mr.modify=1,Mr.remove=2,Mr.create=3,Mr.drop=4,Cr.kMaxNameLength=24,Rr.kMaxDisplayScores=1,Rr.kMaxScores=1,Rr.clearDate=0,Pr.localId="web",Or.delimiter="|",v.main()
}("undefined"!=typeof console?console:{log:function(){}},"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this);